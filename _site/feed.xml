<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2023-12-13T10:53:20+09:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Joshua Kim</title><subtitle>Data Analyst</subtitle><entry><title type="html">Near Protocol: Account Model and Transaction Story</title><link href="http://localhost:4000/near-protocol/" rel="alternate" type="text/html" title="Near Protocol: Account Model and Transaction Story" /><published>2023-11-18T00:00:00+09:00</published><updated>2023-11-18T00:00:00+09:00</updated><id>http://localhost:4000/near-protocol</id><content type="html" xml:base="http://localhost:4000/near-protocol/"><![CDATA[<blockquote>
  <p>Dive into the intricate world of blockchain with Joshua. Uncover the complexities of Near Protocol‚Äôs account model, transaction stories, and personal insights. This article offers a captivating exploration of addresses, private keys, and the execution flow of transactions, providing a unique perspective on user experience and protocol design. Join me on this insightful journey, backed by personal research and a wealth of references from the blockchain realm.</p>
</blockquote>

<h3 id="contents">CONTENTS</h3>
<ol>
  <li>Account Model Story
    <ul>
      <li>1.1. Addresses</li>
      <li>1.2. Private Keys</li>
      <li>1.3. A Sample UX Case</li>
    </ul>
  </li>
  <li>Transaction Story
    <ul>
      <li>2.1. Transactions</li>
      <li>2.2. Actions</li>
      <li>2.3. Receipts</li>
      <li>2.4. A Sample Transactions Case</li>
    </ul>
  </li>
  <li>Personal Thoughts</li>
  <li>References</li>
</ol>

<hr />

<h3 id="disclaimer">DISCLAIMER</h3>
<blockquote>
  <p>This material is based on personal research and study; therefore, it may contain factual errors and cannot be relied upon for critical decision-making. Additionally, the opinions in the material are purely subjective and have no connection to any past or current companies that I have worked at.</p>
</blockquote>

<h1 id="1-account-model-story">1. Account Model Story</h1>

<p><img src="/assets/2023-11-18-near-protocol/account-model-story.webp" alt="" /></p>
<blockquote>
  <p><a href="https://docs.near.org/concepts/basics/accounts/model">Source</a></p>
</blockquote>

<h2 id="11-addresses">1.1. Addresses</h2>

<h3 id="there-are-two-types-of-accounts">There are Two Types of Accounts.</h3>

<p><strong>1. Named Account</strong></p>
<ul>
  <li>i.e.,  <code class="language-plaintext highlighter-rouge">alice.near</code>,  <code class="language-plaintext highlighter-rouge">bob.near</code>,  <code class="language-plaintext highlighter-rouge">usa.near</code>,  <code class="language-plaintext highlighter-rouge">texas.usa.near</code></li>
  <li>Formatically Same as DNS</li>
  <li>üôÜüèª‚Äç‚ôÇÔ∏è  <code class="language-plaintext highlighter-rouge">usa.near</code>  ‚Üí  <code class="language-plaintext highlighter-rouge">texas.usa.near</code>  can be created.</li>
  <li>üôÖüèª‚Äç‚ôÇÔ∏è  <code class="language-plaintext highlighter-rouge">usa.near</code>  ‚Üí  <code class="language-plaintext highlighter-rouge">texas.uk.near</code>  can NOT be created.</li>
</ul>

<p><strong>2. Implicit Account</strong></p>
<ul>
  <li>i.e.,  <code class="language-plaintext highlighter-rouge">98793cd91a3f870fb126f662858[...]</code></li>
  <li>Formatically Similar to the Traditional Way to Create Addresses such as Bitcoin and Ethereum (64 letters)</li>
</ul>

<h3 id="personal-thoughts">Personal Thoughts</h3>

<p><strong>1. Named Account</strong></p>
<ul>
  <li>Improves the end-user UX of the product because it‚Äôs easy to memorize!</li>
  <li>While ENS is executed at the  <strong>contract layer</strong>, Near‚Äôs Named Account is executed at the  <strong>protocol layer</strong>.</li>
</ul>

<p><strong>2. Implicit Account</strong></p>
<ul>
  <li>For user groups that want to maintain pseudonymization!</li>
  <li>For developers accustomed to traditional address systems, especially hardware wallet service companies</li>
</ul>

<h2 id="12-private-keys">1.2. Private Keys</h2>

<h3 id="there-are-two-types-of-private-keys">There are Two Types of Private Keys.</h3>

<p><img src="/assets/2023-11-18-near-protocol/private-keys.webp" alt="" /></p>
<blockquote>
  <p><a href="https://www.vitalpoint.ai/understanding-near-keys/">Source</a></p>
</blockquote>

<p><strong>1. Full Access Key</strong></p>
<blockquote>
  <p><strong>The address can be used to sign transactions of all types.</strong></p>
</blockquote>

<ul>
  <li>The 8 Types of Transactions (<code class="language-plaintext highlighter-rouge">Transaction Actions</code>)
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Transfer</span><span class="p">,</span> <span class="c1"># Transfer Tokens  
</span><span class="n">CreateAccount</span><span class="p">,</span> <span class="c1"># Create Accounts  
</span><span class="n">DeleteAccount</span><span class="p">,</span> <span class="c1"># Delete Accounts  
</span><span class="n">DeployContract</span><span class="p">,</span> <span class="c1"># Deploy Contracts  
</span><span class="n">FunctionCall</span><span class="p">,</span> <span class="c1"># Call Functions of Contracts  
</span><span class="n">Stake</span><span class="p">,</span> <span class="c1"># Staking  
</span><span class="n">AddKey</span><span class="p">,</span> <span class="c1"># Add Keys  
</span><span class="n">DeleteKey</span> <span class="c1"># Delete Keys
</span></code></pre></div>    </div>
  </li>
</ul>

<p><strong>2. Function Call Key</strong></p>
<blockquote>
  <p><strong>The address can be used to sign the following restricted transactions.</strong></p>
</blockquote>

<ul>
  <li>Transactions are restricted to  <strong>specific function(s)</strong>  within  <strong>a specific contract</strong>.</li>
  <li>Sending Native Token, $NEAR, is NOT possible.
    <ul>
      <li>Gas Fees can be paid, however.</li>
      <li>Of course, if you set it so that you can‚Äôt even pay Gas Fees, only functions related to View methods can be called.</li>
    </ul>
  </li>
  <li>Purpose of Using Function Call Keys
    <ul>
      <li>By passing it to the dApp‚Äôs client, creating an environment where the dApp can immediately invoke contract calls with limited permissions.</li>
    </ul>
  </li>
</ul>

<h3 id="parameters">Parameters</h3>

<p><strong>1. Full Access Key</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pub</span> <span class="kr">enum</span> <span class="nx">AccessKeyPermission</span> <span class="p">{</span>  
    <span class="nc">FunctionCall</span><span class="p">(</span><span class="nx">FunctionCallPermission</span><span class="p">),</span>  
    <span class="nx">FullAccess</span><span class="p">,</span>  
<span class="p">}</span>
</code></pre></div></div>

<p><strong>2. Function Call Key</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pub</span> <span class="nx">struct</span> <span class="nx">FunctionCallPermission</span> <span class="p">{</span>  
    <span class="nx">pub</span> <span class="nx">receiver_id</span><span class="p">:</span> <span class="nx">AccountId</span><span class="p">,</span> <span class="c1">// a Specific Contract  </span>
    <span class="nx">pub</span> <span class="nx">method_names</span><span class="p">:</span> <span class="nx">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span> <span class="c1">// Specific Functions  </span>
    <span class="nx">pub</span> <span class="nx">allowance</span><span class="p">:</span> <span class="nx">Option</span><span class="o">&lt;</span><span class="nx">Balance</span><span class="o">&gt;</span><span class="p">,</span> <span class="c1">// Max Gas Fee Payment Amount  </span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="locked-account">Locked Account</h3>
<ul>
  <li>Simply remove all keys through the transaction of the  <code class="language-plaintext highlighter-rouge">DeleteKey</code>  action.</li>
  <li>No one will be able to control the account.</li>
  <li>In other words, after deploying the smart contract account itself, it can be made fully decentralized, allowing only internal transactions to occur.</li>
</ul>

<h2 id="13-a-sample-ux-case">1.3. A Sample UX Case</h2>

<h3 id="typical-dapp-transaction-signing-architecture">Typical dApp Transaction Signing Architecture</h3>

<p><img src="/assets/2023-11-18-near-protocol/Typical dApp Transaction Signing Architecture.webp" alt="" /></p>
<blockquote>
  <p><a href="https://docs.near.org/concepts/web3/near">Source</a></p>
</blockquote>

<ul>
  <li>To execute a specific transaction within the dApp, the user must undergo repeated redirection between the wallet and the client.</li>
  <li><strong>Advantage</strong>: Excellent  <strong>security</strong>  as the private key is not exposed to the client.</li>
  <li><strong>Disadvantage</strong>: Repeated redirections can be annoying for  <strong>users</strong>.</li>
</ul>

<h3 id="dapp-transaction-signing-architecture-using-function-call-key">dApp Transaction Signing Architecture Using Function Call Key</h3>
<blockquote>
  <p>It is possible to address the Disadvantage without significantly compromising the Advantage.</p>
</blockquote>

<p><strong>1. Add Key</strong></p>

<p><img src="/assets/2023-11-18-near-protocol/add-key.webp" alt="" /></p>
<blockquote>
  <p><a href="https://docs.near.org/concepts/web3/near">Source</a></p>
</blockquote>

<p><strong>2. Call a Specific Function within a dApp‚Äôs Contract</strong></p>

<p><img src="/assets/2023-11-18-near-protocol/call a specific function within a dapps contract.webp" alt="" /></p>
<blockquote>
  <p><a href="https://docs.near.org/concepts/web3/near">Source</a></p>
</blockquote>

<h1 id="2-transaction-story">2. Transaction Story</h1>

<p><strong>Overall Execution Flow of the Transactions</strong></p>

<p><img src="/assets/2023-11-18-near-protocol/transaction-story.webp" alt="" /></p>
<blockquote>
  <p><a href="https://www.youtube.com/@NEARProtocol">Source</a></p>
</blockquote>

<p><strong>Important Terms</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">Transaction</code></li>
  <li><code class="language-plaintext highlighter-rouge">Action</code></li>
  <li><code class="language-plaintext highlighter-rouge">Receipt</code></li>
</ul>

<h2 id="21-transactions">2.1. Transactions</h2>
<p><strong>A Transaction is:</strong></p>
<ul>
  <li>a set of  <code class="language-plaintext highlighter-rouge">actions</code>  that need to be performed on the receiving account.</li>
  <li>üôÖüèª‚Äç‚ôÇÔ∏è In other words, a transaction is NOT the atomic unit driving state changes in Near Blockchain.</li>
</ul>

<h2 id="22-actions">2.2. Actions</h2>
<p><strong>An Action is:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">the unit of work</code>  that the virtual machine needs to process through a transaction.</li>
  <li>There are a total of 8 types recognizable by the Near Protocol. (You have already checked them above!)</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Transfer</span><span class="p">,</span> <span class="c1"># Transfer Tokens  
</span><span class="n">CreateAccount</span><span class="p">,</span> <span class="c1"># Create Accounts  
</span><span class="n">DeleteAccount</span><span class="p">,</span> <span class="c1"># Delete Accounts  
</span><span class="n">DeployContract</span><span class="p">,</span> <span class="c1"># Deploy Contracts  
</span><span class="n">FunctionCall</span><span class="p">,</span> <span class="c1"># Call Functions of Contracts  
</span><span class="n">Stake</span><span class="p">,</span> <span class="c1"># Staking  
</span><span class="n">AddKey</span><span class="p">,</span> <span class="c1"># Add Keys  
</span><span class="n">DeleteKey</span> <span class="c1"># Delete Keys
</span></code></pre></div></div>

<h2 id="23-receipts">2.3. Receipts</h2>
<p><strong>A Receipt is:</strong></p>
<ul>
  <li>the smallest unit executed by the virtual machine, in other words,  <code class="language-plaintext highlighter-rouge">the execution object</code>.</li>
</ul>

<h2 id="24-a-sample-transaction-case">2.4. A Sample Transaction Case</h2>

<h3 id="a-randomly-chosen-transaction-case">A Randomly Chosen Transaction Case</h3>

<p><strong>1. A Transaction Sending 0.02 NEAR</strong></p>

<p><img src="/assets/2023-11-18-near-protocol/A Transaction Sending 0.02 NEAR.webp" alt="" /></p>
<blockquote>
  <p><a href="https://nearblocks.io/txns/6aqjvabatzFkvoBzYmnpEZbAfnLbGo6PsUM6WdpUYxmG#">Source</a></p>
</blockquote>

<p><strong>2. Receipt Executions - (1) TRANSFER Action</strong></p>

<p><img src="/assets/2023-11-18-near-protocol/Receipt Executions TRANSFER Action.webp" alt="" /></p>
<blockquote>
  <p><a href="https://nearblocks.io/txns/6aqjvabatzFkvoBzYmnpEZbAfnLbGo6PsUM6WdpUYxmG#">Source</a></p>
</blockquote>

<p><strong>2. Receipt Executions - (2) Receiving a Refund for the difference between Gas Limit and Gas Used</strong></p>

<p><img src="/assets/2023-11-18-near-protocol/Receipt Executions Receiving a Refund for the difference between Gas Limit and Gas Used.webp" alt="" /></p>
<blockquote>
  <p><a href="https://nearblocks.io/txns/6aqjvabatzFkvoBzYmnpEZbAfnLbGo6PsUM6WdpUYxmG#">Source</a></p>
</blockquote>

<h1 id="3-personal-thoughts">3. Personal Thoughts</h1>

<h3 id="1-protocolized-address-system-for-dns">1. Protocolized Address System for DNS</h3>

<p>It seems that the computational burden on nodes has been compromised to become a user-friendly blockchain. (Due to the increased size of dtype‚Ä¶)</p>
<ul>
  <li>Wouldn‚Äôt there be a slowdown and an increase in gas fees then?</li>
  <li>It seems that this has been addressed by dividing a block into multiple chunks to create the block.</li>
  <li>Let me study deeper when I have more expertise to check out if there are any potential security drawbacks of this approach. üòÅ</li>
</ul>

<p><img src="/assets/2023-11-18-near-protocol/nightshade.webp" alt="" /></p>
<blockquote>
  <p><a href="https://near.org/papers/nightshade">Source</a></p>
</blockquote>

<h3 id="2-key-generation-structure-for-dapp-end-user-ux">2. Key Generation Structure for dApp End-User UX</h3>

<p>Of course, in the initial Add Key situation, wallet redirection still occurs, so it may not be possible to completely alleviate user confusion.</p>
<ul>
  <li>üó£Ô∏è<strong>Picky Users (say, Joshua)</strong>: ‚ÄúEarlier, my signature was required, but why are you executing things now without it?‚Äù üò†üò°</li>
</ul>

<p><img src="/assets/2023-11-18-near-protocol/add-key.webp" alt="" /></p>
<blockquote>
  <p><a href="https://docs.near.org/concepts/web3/near">Source</a></p>
</blockquote>

<h1 id="4-references">4. References</h1>
<ul>
  <li><strong>Near</strong>  <strong>Whitepaper</strong>:  <a href="https://near.org/papers/nightshade">https://near.org/papers/nightshade</a></li>
  <li><strong>Near Official Docs</strong>:  <a href="https://docs.near.org/">https://docs.near.org</a></li>
  <li><strong>Near Official Dev Docs</strong>:  <a href="https://nomicon.io/">https://nomicon.io</a></li>
  <li><strong>Near Official YouTube Channel</strong>:  <a href="https://www.youtube.com/@NEARProtocol">https://www.youtube.com/@NEARProtocol</a></li>
  <li><strong>Blockchain Explorer (Nearblocks)</strong>:  <a href="https://nearblocks.io/">https://nearblocks.io</a></li>
  <li><strong>Vital Point AI Content</strong>:  <a href="https://www.vitalpoint.ai/understanding-near-keys">https://www.vitalpoint.ai/understanding-near-keys</a></li>
</ul>

<p><img src="/assets/2023-11-18-near-protocol/near-logo.webp" alt="" /></p>

<hr />

<h2 id="published-by-joshua-kim"><em>Published by</em> Joshua Kim</h2>
<p><img src="/assets/profile/joshua-profile.png" alt="Joshua Kim" /></p>]]></content><author><name></name></author><category term="english" /><category term="blockchain" /><summary type="html"><![CDATA[Dive into the intricate world of blockchain with Joshua. Uncover the complexities of Near Protocol‚Äôs account model, transaction stories, and personal insights. This article offers a captivating exploration of addresses, private keys, and the execution flow of transactions, providing a unique perspective on user experience and protocol design. Join me on this insightful journey, backed by personal research and a wealth of references from the blockchain realm.]]></summary></entry><entry><title type="html">Intro to Encoding &amp;amp; Decoding Ethereum Contract Functions</title><link href="http://localhost:4000/encoding-and-decoding-ethereum-contract-functions/" rel="alternate" type="text/html" title="Intro to Encoding &amp;amp; Decoding Ethereum Contract Functions" /><published>2023-10-16T00:00:00+09:00</published><updated>2023-10-16T00:00:00+09:00</updated><id>http://localhost:4000/encoding-and-decoding-ethereum-contract-functions</id><content type="html" xml:base="http://localhost:4000/encoding-and-decoding-ethereum-contract-functions/"><![CDATA[<blockquote>
  <p>In this article, I will briefly explore the Ethereum ABI Specification and show you how to decode contract functions when conducting on-chain data analysis. Additionally, I will demonstrate a simple data extraction and analysis case about ‚ÄúWho are the Top 10 Recipients of USDT approve Functions?‚Äù using DuneSQL while handling ABIs.</p>
</blockquote>

<h3 id="contents">CONTENTS</h3>
<ol>
  <li>Argument Types Key Content
    <ul>
      <li>1.1. Elementary Types</li>
      <li>1.2. Fixed-size Types</li>
      <li>1.3. Dynamic-size Types</li>
    </ul>
  </li>
  <li>Key Points of Argument Padding to 32 Bytes Rules</li>
  <li>A Contract Example
    <ul>
      <li>3.1. How to Call <code class="language-plaintext highlighter-rouge">baz(uint32 x, bool y)</code></li>
      <li>3.2. How to Call <code class="language-plaintext highlighter-rouge">bar(bytes3[2])</code></li>
      <li>3.3. How to Call <code class="language-plaintext highlighter-rouge">sam(bytes, bool, uint[])</code></li>
    </ul>
  </li>
  <li>Case Study: Who are the Top 10 Recipients of USDT <code class="language-plaintext highlighter-rouge">approve</code> Functions?
    <ul>
      <li>4.1. Function Selector</li>
      <li>4.2. Extract only the transactions that have called the <code class="language-plaintext highlighter-rouge">approve</code> function on the USDT Contract.</li>
      <li>4.3. Extract the first argument value, <code class="language-plaintext highlighter-rouge">address</code>, from the functions.</li>
      <li>4.4. Now, aggregate the number of unique addresses that executed <code class="language-plaintext highlighter-rouge">approve</code> function, grouped by each <code class="language-plaintext highlighter-rouge">approve</code> recipient, over the past week.</li>
      <li>4.5. Label the <code class="language-plaintext highlighter-rouge">approve</code> recipient addresses based on Dune Tables regarding ‚Äúaddress labeling‚Äù.</li>
      <li>4.6. The Final Query Results</li>
    </ul>
  </li>
  <li>Let‚Äôs Conclude!</li>
  <li>References</li>
</ol>

<hr />

<h1 id="1-argument-types-key-content">1. Argument Types Key Content</h1>

<p>Before diving into the Ethereum ABI specification, let‚Äôs take a quick look at the argument data types of Ethereum contracts. Ethereum contract functions can have various parameter data types, and among them, I have listed some of the important types and summarize their key characteristics.</p>

<h2 id="11-elementary-types">1.1. Elementary Types</h2>

<p><code class="language-plaintext highlighter-rouge">uint</code></p>
<ul>
  <li>Same as  <code class="language-plaintext highlighter-rouge">uint256</code>,</li>
  <li>which means it should be considered as  <code class="language-plaintext highlighter-rouge">uint256</code>  type during encoding.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">int</code></p>
<ul>
  <li>Same as  <code class="language-plaintext highlighter-rouge">int256</code>,</li>
  <li>which means it should be considered as  <code class="language-plaintext highlighter-rouge">int256</code>  type during encoding.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">bool</code></p>
<ul>
  <li>Same as  <code class="language-plaintext highlighter-rouge">uint8</code>,</li>
  <li>which means only 0 or 1 can be assigned to it.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">bytes{n}</code></p>
<ul>
  <li>Binary type with a length of n bytes (0 &lt; n ‚â§ 32)</li>
</ul>

<h2 id="12-fixed-size-types">1.2. Fixed-size Types</h2>

<p><code class="language-plaintext highlighter-rouge">{type_name}[{n}]</code></p>
<ul>
  <li>An array with n elements (n ‚â• 0)</li>
</ul>

<h2 id="13-dynamic-size-types">1.3. Dynamic-size Types</h2>

<p><code class="language-plaintext highlighter-rouge">bytes</code></p>
<ul>
  <li>Binary type with a dynamic length of bytes</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">string</code></p>
<ul>
  <li>A dynamically sized string (assuming it‚Äôs UTF-8 encoded)</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">{type_name}[]</code></p>
<ul>
  <li>An array with a dynamic number of elements</li>
</ul>

<h1 id="2-key-points-of-argument-padding-to-32-bytes-rules">2. Key Points of Argument Padding to 32 Bytes Rules</h1>

<p>When calling Ethereum contract functions, you need to encode each argument and input them concatenated. In this process, there are rules regarding ‚Äúlength.‚Äù To avoid confusion, I‚Äôve summarized the key rules for you in advance.</p>

<p><code class="language-plaintext highlighter-rouge">uint{n}</code></p>
<ul>
  <li>Padding with preceding 0 to achieve a length of 32 bytes</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">int{n}</code></p>
<ul>
  <li>Padding with preceding 0 to achieve a length of 32 bytes</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">bytes{n}</code></p>
<ul>
  <li>Padding with trailing 0 to achieve a length of 32 bytes</li>
</ul>

<h1 id="3-a-contract-example">3. A Contract Example</h1>

<p>The following example has been taken from  <a href="https://docs.soliditylang.org/en/develop/abi-spec.html#examples">Contract ABI Specification Docs</a>. Let me explain this in simpler terms.</p>

<p><strong>Given the Contract:</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>  
  
<span class="nx">contract</span> <span class="nx">Foo</span> <span class="p">{</span>  
  <span class="kd">function</span> <span class="nf">baz</span><span class="p">(</span><span class="nx">uint32</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">bool</span> <span class="nx">y</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">pure</span> <span class="nf">returns </span><span class="p">(</span><span class="nx">bool</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">32</span> <span class="o">||</span> <span class="nx">y</span><span class="p">;</span> <span class="p">}</span>  
  <span class="kd">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nx">bytes3</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="kr">public</span> <span class="nx">pure</span> <span class="p">{}</span>  
  <span class="kd">function</span> <span class="nf">sam</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">bool</span><span class="p">,</span> <span class="nx">uint</span><span class="p">[])</span> <span class="kr">public</span> <span class="nx">pure</span> <span class="p">{}</span>  
<span class="p">}</span>
</code></pre></div></div>

<h2 id="31-how-to-call-bazuint32-x-bool-y">3.1. How to Call <code class="language-plaintext highlighter-rouge">baz(uint32 x, bool y)</code></h2>

<p>Let‚Äôs say you‚Äôre calling the function in the format of:  <code class="language-plaintext highlighter-rouge">baz(69, true)</code></p>

<p><strong>Function Selector</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">baz(uint32,bool)</code>  ‚Üí Keccak-256 Hash
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0xcdcd77c0992ec5bbfc459984220f8c45084cc24d9b6efed1fae540db8de801d2</span>
</code></pre></div>    </div>
  </li>
  <li>Slice the left 4 bytes.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0xcdcd77c0</span>
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Parameter 1:</strong>  <code class="language-plaintext highlighter-rouge">69</code></p>
<ul>
  <li>Convert it to hexadecimal.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0x45</span>
</code></pre></div>    </div>
  </li>
  <li>Left pad it to a length of 32 bytes.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0x0000000000000000000000000000000000000000000000000000000000000045</span>
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Parameter 2:</strong>  <code class="language-plaintext highlighter-rouge">true</code></p>
<ul>
  <li>Convert it to uint8.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span>
</code></pre></div>    </div>
  </li>
  <li>Left pad it to a length of 32 bytes.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0x0000000000000000000000000000000000000000000000000000000000000001</span>
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>The Final Encoding with Concatenating All</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0xcdcd77c0</span> <span class="c1"># Function Selector  
</span><span class="mh">0x0000000000000000000000000000000000000000000000000000000000000045</span> <span class="c1"># 69  
</span><span class="mh">0x0000000000000000000000000000000000000000000000000000000000000001</span> <span class="c1"># true  
</span>  
<span class="c1"># Concat  
</span><span class="mh">0xdcdcd77c000000000000000000000000000000000000000000000000000000000000000450000000000000000000000000000000000000000000000000000000000000001</span>
</code></pre></div></div>

<h2 id="32-how-to-call-barbytes32">3.2. How to Call <code class="language-plaintext highlighter-rouge">bar(bytes3[2])</code></h2>

<p>Let‚Äôs say you‚Äôre calling the function in the format of:  <code class="language-plaintext highlighter-rouge">baz("abc", "def")</code></p>

<p><strong>Function Selector</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">bar(bytes3[2])</code>  ‚Üí Keccak-256 Hash
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0xfce353f601a3db60cb33e4b6ef4f91e4465eaf93c292b64fcde1bf4ba6819b6a</span>
</code></pre></div>    </div>
  </li>
  <li>Slice the left 4 bytes.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0xfce353f6</span>
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Parameter 1:</strong>  <code class="language-plaintext highlighter-rouge">‚Äúabc‚Äù</code></p>
<ul>
  <li>Convert it to utf-8 bytes (<a href="https://onlinetools.com/utf8/convert-utf8-to-bytes">String to UTF-8 Bytes Convertor</a>)
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">616263</span>
</code></pre></div>    </div>
  </li>
  <li>Right pad it to a length of 32 bytes.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0x6162630000000000000000000000000000000000000000000000000000000000</span>
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Parameter 2</strong>:  <code class="language-plaintext highlighter-rouge">‚Äúdef‚Äù</code></p>
<ul>
  <li>Convert it to utf-8 bytes (<a href="https://onlinetools.com/utf8/convert-utf8-to-bytes">String to UTF-8 Bytes Convertor</a>)
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">646566</span>
</code></pre></div>    </div>
  </li>
  <li>Right pad it to a length of 32 bytes.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0x6465660000000000000000000000000000000000000000000000000000000000</span>
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>The Final Encoding with Concatenating All</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0xfce353f6</span> <span class="c1"># Function Selector  
</span><span class="mi">6162630000000000000000000000000000000000000000000000000000000000</span> <span class="c1"># "abc"  
</span><span class="mi">6465660000000000000000000000000000000000000000000000000000000000</span> <span class="c1"># "def"  
</span>  
<span class="c1"># Concat  
</span><span class="mh">0xfce353f661626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000</span>
</code></pre></div></div>

<h2 id="33-how-to-call-sambytes-bool-uint">3.3. How to Call <code class="language-plaintext highlighter-rouge">sam(bytes, bool, uint[])</code></h2>

<p>Let‚Äôs say you‚Äôre calling the function in the format of:  <code class="language-plaintext highlighter-rouge">sam(‚Äúdave‚Äù, true, [1, 2, 3])</code></p>

<p><strong>Function Selector</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">sam(bytes,bool,uint256[])</code>  ‚Üí Keccak-256 Hash</li>
  <li>Note that  <code class="language-plaintext highlighter-rouge">uint</code>  is replaced with its canonical representation  <code class="language-plaintext highlighter-rouge">uint256</code>.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0xa5643bf27e2786816613d3eeb0b62650200b5a98766dfcfd4428f296fb56d043</span>
</code></pre></div>    </div>
  </li>
  <li>Slice the left 4 bytes.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0xa5643bf2</span>
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Parameters</strong></p>
<ul>
  <li>In the order of: ‚Äú<strong>iLoc &gt; Len &gt; Value</strong>‚Äù</li>
</ul>

<p><img src="/assets/2023-10-16-encoding-and-decoding-ethereum-contract-functions/parameters.webp" alt="" /></p>
<blockquote>
  <p>made by Joshua</p>
</blockquote>

<p><strong>The Final Encoding with Concatenating All</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0xa5643bf2</span> <span class="c1"># Function Selector  
</span>  
<span class="mh">0x0000000000000000000000000000000000000000000000000000000000000060</span> <span class="c1"># 1st Param iLoc : 96 bytes  
</span><span class="mh">0x0000000000000000000000000000000000000000000000000000000000000001</span> <span class="c1"># 2nd Param Value : true   
</span><span class="mh">0x00000000000000000000000000000000000000000000000000000000000000a0</span> <span class="c1"># 3rd Param iLoc : 160 bytes  
</span><span class="mh">0x0000000000000000000000000000000000000000000000000000000000000004</span> <span class="c1"># 1st Param Len : 4 bytes  
</span><span class="mh">0x6461766500000000000000000000000000000000000000000000000000000000</span> <span class="c1"># 1sst Param Value : "dave"  
</span><span class="mh">0x0000000000000000000000000000000000000000000000000000000000000003</span> <span class="c1"># 3rd Params Len : 3 items  
</span><span class="mh">0x0000000000000000000000000000000000000000000000000000000000000001</span> <span class="c1"># 3rd Param Value (item 0) : 1  
</span><span class="mh">0x0000000000000000000000000000000000000000000000000000000000000002</span> <span class="c1"># 3rd Param Value (item 1) : 2  
</span><span class="mh">0x0000000000000000000000000000000000000000000000000000000000000003</span> <span class="c1"># 3rd Param Value (item 2) : 3  
</span>  
<span class="c1"># Concat  
</span><span class="mh">0xa5643bf20000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000464617665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003</span>
</code></pre></div></div>

<h1 id="4-case-study-who-are-the-top-10-recipients-of-usdt-approve-functions">4. Case Study: Who are the Top 10 Recipients of USDT <code class="language-plaintext highlighter-rouge">approve</code> Functions?</h1>

<p>According to  <a href="https://docs.openzeppelin.com/contracts/2.x/api/token/erc20">ERC-20 Interface</a>, it is possible to delegate the permission to use a specific token (the authority to transfer the token, specifically) to a particular account using the <code class="language-plaintext highlighter-rouge">approve</code> function. This permission is frequently requested, particularly in DeFi platforms. In this case study, I aim to aggregate and analyze the top 10 accounts that people commonly delegate their USDT through <code class="language-plaintext highlighter-rouge">approve</code> function.</p>

<h2 id="41-function-selector">4.1. Function Selector</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">approve(address,uint256)</code>  ‚Üí Keccak-256 Hash
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0x095ea7b334ae44009aa867bfb386f5c3b4b443ac6f0ee573fa91c4608fbadfba</span>
</code></pre></div>    </div>
  </li>
  <li>Slice the left 4 bytes.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0x095ea7b3</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="42-extract-only-the-transactions-that-have-called-the-approve-function-on-the-usdt-contract">4.2. Extract only the transactions that have called the <code class="language-plaintext highlighter-rouge">approve</code> function on the USDT Contract.</h2>

<ul>
  <li>For more info about <code class="language-plaintext highlighter-rouge">BYTEARRAY_STARTS_WITH</code> Function, click  <a href="https://dune.com/docs/query/DuneSQL-reference/Functions-and-operators/varbinary/#bytearray_starts_with">here</a>.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span>  
    <span class="o">*</span>  
<span class="k">FROM</span>  
    <span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span>  
<span class="k">WHERE</span>  
    <span class="nv">"to"</span> <span class="o">=</span> <span class="mi">0</span><span class="n">xdAC17F958D2ee523a2206206994597C13D831ec7</span> <span class="c1">-- USDT ERC-20 Contract  </span>
    <span class="k">AND</span> <span class="n">BYTEARRAY_STARTS_WITH</span><span class="p">(</span><span class="k">data</span><span class="p">,</span> <span class="mi">0</span><span class="n">x095ea7b3</span><span class="p">)</span> <span class="c1">-- approve(address,uint256) Function Call</span>
</code></pre></div></div>

<h2 id="43-extract-the-first-argument-value-address-from-the-functions">4.3. Extract the first argument value, <code class="language-plaintext highlighter-rouge">address</code>, from the functions.</h2>

<ul>
  <li>For more info about <code class="language-plaintext highlighter-rouge">BYTEARRAY_SUBSTRING</code> Function, click  <a href="https://dune.com/docs/query/DuneSQL-reference/Functions-and-operators/varbinary/#bytearray_substring">here</a>.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span>  
    <span class="n">BYTEARRAY_SUBSTRING</span><span class="p">(</span>  
        <span class="n">BYTEARRAY_SUBSTRING</span><span class="p">(</span><span class="k">data</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>  
        <span class="mi">13</span><span class="p">,</span>  
        <span class="mi">20</span>  
    <span class="p">)</span> <span class="k">AS</span> <span class="n">approved_to</span>  
<span class="k">FROM</span>  
    <span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span>  
<span class="k">WHERE</span>  
    <span class="nv">"to"</span> <span class="o">=</span> <span class="mi">0</span><span class="n">xdAC17F958D2ee523a2206206994597C13D831ec7</span> <span class="c1">-- USDT ERC-20 Contract  </span>
    <span class="k">AND</span> <span class="n">BYTEARRAY_STARTS_WITH</span><span class="p">(</span><span class="k">data</span><span class="p">,</span> <span class="mi">0</span><span class="n">x095ea7b3</span><span class="p">)</span> <span class="c1">-- approve(address,uint256) Function Call</span>
</code></pre></div></div>

<h2 id="44-now-aggregate-the-number-of-unique-addresses-that-executed-approve-function-grouped-by-each-approve-recipient-over-the-past-week">4.4. Now, aggregate the number of unique addresses that executed <code class="language-plaintext highlighter-rouge">approve</code> function, grouped by each <code class="language-plaintext highlighter-rouge">approve</code> recipient, over the past week.</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span>  
    <span class="n">BYTEARRAY_SUBSTRING</span><span class="p">(</span>  
        <span class="n">BYTEARRAY_SUBSTRING</span><span class="p">(</span><span class="k">data</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>  
        <span class="mi">13</span><span class="p">,</span>  
        <span class="mi">20</span>  
    <span class="p">)</span> <span class="k">AS</span> <span class="n">approved_to</span><span class="p">,</span>  
    <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="nv">"from"</span><span class="p">)</span> <span class="k">AS</span> <span class="n">approved_from_cnt</span>  
<span class="k">FROM</span>  
    <span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span>  
<span class="k">WHERE</span>  
    <span class="k">CAST</span><span class="p">(</span><span class="n">block_date</span> <span class="k">AS</span> <span class="nb">DATE</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">DATE_ADD</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="k">CURRENT_DATE</span><span class="p">)</span> <span class="c1">-- Recent 7 Days  </span>
    <span class="k">AND</span> <span class="nv">"to"</span> <span class="o">=</span> <span class="mi">0</span><span class="n">xdAC17F958D2ee523a2206206994597C13D831ec7</span> <span class="c1">-- USDT ERC-20 Contract  </span>
    <span class="k">AND</span> <span class="n">BYTEARRAY_STARTS_WITH</span><span class="p">(</span><span class="k">data</span><span class="p">,</span> <span class="mi">0</span><span class="n">x095ea7b3</span><span class="p">)</span> <span class="c1">-- approve(address,uint256) Function Call  </span>
<span class="k">GROUP</span> <span class="k">BY</span>  
    <span class="mi">1</span>
</code></pre></div></div>

<h2 id="45-label-the-approve-recipient-addresses-based-on-dune-tables-regarding-address-labeling">4.5. Label the <code class="language-plaintext highlighter-rouge">approve</code> recipient addresses based on Dune Tables regarding ‚Äúaddress labeling‚Äù.</h2>

<ul>
  <li>Looking at the original address values alone does not provide any meaningful information, as y‚Äôall know here.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span>  
<span class="n">CTE_approves</span> <span class="k">AS</span> <span class="p">(</span>  
    <span class="k">SELECT</span>  
        <span class="n">BYTEARRAY_SUBSTRING</span><span class="p">(</span>  
            <span class="n">BYTEARRAY_SUBSTRING</span><span class="p">(</span><span class="k">data</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>  
            <span class="mi">13</span><span class="p">,</span>  
            <span class="mi">20</span>  
        <span class="p">)</span> <span class="k">AS</span> <span class="n">approved_to</span><span class="p">,</span>  
        <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="nv">"from"</span><span class="p">)</span> <span class="k">AS</span> <span class="n">approved_from_cnt</span>  
    <span class="k">FROM</span>  
        <span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span>  
    <span class="k">WHERE</span>  
        <span class="k">CAST</span><span class="p">(</span><span class="n">block_date</span> <span class="k">AS</span> <span class="nb">DATE</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">DATE_ADD</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="k">CURRENT_DATE</span><span class="p">)</span> <span class="c1">-- Recent 7 Days  </span>
        <span class="k">AND</span> <span class="nv">"to"</span> <span class="o">=</span> <span class="mi">0</span><span class="n">xdAC17F958D2ee523a2206206994597C13D831ec7</span> <span class="c1">-- USDT ERC-20 Contract  </span>
        <span class="k">AND</span> <span class="n">BYTEARRAY_STARTS_WITH</span><span class="p">(</span><span class="k">data</span><span class="p">,</span> <span class="mi">0</span><span class="n">x095ea7b3</span><span class="p">)</span> <span class="c1">-- approve(address,uint256) Function Call  </span>
    <span class="k">GROUP</span> <span class="k">BY</span>  
        <span class="mi">1</span>  
<span class="p">)</span>  
  
<span class="k">SELECT</span>  
    <span class="n">MAIN</span><span class="p">.</span><span class="n">approved_to</span><span class="p">,</span>  
    <span class="n">COALESCE</span><span class="p">(</span>  
        <span class="n">SUB1</span><span class="p">.</span><span class="n">dex_name</span> <span class="o">||</span> <span class="s1">' - '</span> <span class="o">||</span> <span class="n">SUB1</span><span class="p">.</span><span class="n">distinct_name</span><span class="p">,</span>  
        <span class="n">SUB2</span><span class="p">.</span><span class="n">project</span> <span class="o">||</span> <span class="s1">' - '</span> <span class="o">||</span> <span class="n">SUB2</span><span class="p">.</span><span class="n">project_type</span><span class="p">,</span>  
        <span class="n">SUB3</span><span class="p">.</span><span class="n">bridge_name</span> <span class="o">||</span> <span class="s1">' - '</span> <span class="o">||</span> <span class="n">SUB3</span><span class="p">.</span><span class="n">description</span><span class="p">,</span>  
        <span class="n">SUB4</span><span class="p">.</span><span class="n">cex_name</span> <span class="o">||</span> <span class="s1">' - '</span> <span class="o">||</span> <span class="n">SUB4</span><span class="p">.</span><span class="n">distinct_name</span><span class="p">,</span>  
        <span class="s1">'Unknown'</span>  
    <span class="p">)</span> <span class="k">AS</span> <span class="n">name</span><span class="p">,</span>  
    <span class="n">MAIN</span><span class="p">.</span><span class="n">approved_from_cnt</span> <span class="k">AS</span> <span class="n">addresses_cnt</span>  
<span class="k">FROM</span>  
    <span class="n">CTE_approves</span> <span class="n">MAIN</span>  
<span class="k">LEFT</span> <span class="k">JOIN</span>  
    <span class="n">addresses_ethereum</span><span class="p">.</span><span class="n">dex</span> <span class="n">SUB1</span> <span class="c1">-- DEX named addresses  </span>
    <span class="k">ON</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">approved_to</span> <span class="o">=</span> <span class="n">SUB1</span><span class="p">.</span><span class="n">address</span>  
<span class="k">LEFT</span> <span class="k">JOIN</span>  
    <span class="n">addresses_ethereum</span><span class="p">.</span><span class="n">defi</span> <span class="n">SUB2</span> <span class="c1">-- DeFi named addresses  </span>
    <span class="k">ON</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">approved_to</span> <span class="o">=</span> <span class="n">SUB2</span><span class="p">.</span><span class="n">address</span>  
<span class="k">LEFT</span> <span class="k">JOIN</span>  
    <span class="n">addresses_ethereum</span><span class="p">.</span><span class="n">bridges</span> <span class="n">SUB3</span> <span class="c1">-- Bridge named addresses  </span>
    <span class="k">ON</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">approved_to</span> <span class="o">=</span> <span class="n">SUB3</span><span class="p">.</span><span class="n">address</span>  
<span class="k">LEFT</span> <span class="k">JOIN</span>  
    <span class="n">addresses_ethereum</span><span class="p">.</span><span class="n">cex</span> <span class="n">SUB4</span> <span class="c1">-- CEX named addresses  </span>
    <span class="k">ON</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">approved_to</span> <span class="o">=</span> <span class="n">SUB4</span><span class="p">.</span><span class="n">address</span>  
<span class="k">ORDER</span> <span class="k">BY</span>  
    <span class="mi">3</span> <span class="k">DESC</span>  
<span class="k">LIMIT</span>  
    <span class="mi">10</span>  
<span class="p">;</span>
</code></pre></div></div>

<h2 id="46-the-final-query-results">4.6. The Final Query Results</h2>

<p><img src="/assets/2023-10-16-encoding-and-decoding-ethereum-contract-functions/query-results.webp" alt="" /></p>
<blockquote>
  <p>Dune Analytics</p>
</blockquote>

<h1 id="5-lets-conclude">5. Let‚Äôs Conclude!</h1>

<p>So far, we have delved into <strong>the Ethereum‚Äôs ABI Specification</strong>, learned how data is encoded when transactions call contract functions, and understood how to extract meaningful insights by decoding specific function names and arguments from Ethereum transactions data.</p>

<p>In fact, Dune Analytics, Etherscan, and many other on-chain data platforms all incorporate these decoding processes internally.</p>

<p>Hopefully this article will serve as an excellent foundation for your future, more detailed and complex on-chain data analysis endeavors.</p>

<h1 id="6-references">6. References</h1>

<ul>
  <li><a href="https://docs.soliditylang.org/en/develop/abi-spec.html#function-selector-and-argument-encoding">Contract ABI Specification</a></li>
  <li><a href="https://docs.openzeppelin.com/contracts/4.x/api/token/erc721">OpenZeppelin Docs</a></li>
  <li><a href="https://dune.com/joshua_web3">Dune Analytics</a></li>
</ul>

<hr />

<h2 id="published-by-joshua-kim"><em>Published by</em> Joshua Kim</h2>
<p><img src="/assets/profile/joshua-profile.png" alt="Joshua Kim" /></p>]]></content><author><name></name></author><category term="english" /><category term="blockchain" /><category term="on_chain_data" /><category term="sql" /><summary type="html"><![CDATA[In this article, I will briefly explore the Ethereum ABI Specification and show you how to decode contract functions when conducting on-chain data analysis. Additionally, I will demonstrate a simple data extraction and analysis case about ‚ÄúWho are the Top 10 Recipients of USDT approve Functions?‚Äù using DuneSQL while handling ABIs.]]></summary></entry><entry><title type="html">Finding all NFTs (ERC721) held by an address (feat. Dune Analytics)</title><link href="http://localhost:4000/finding-nfts/" rel="alternate" type="text/html" title="Finding all NFTs (ERC721) held by an address (feat. Dune Analytics)" /><published>2023-10-08T00:00:00+09:00</published><updated>2023-10-08T00:00:00+09:00</updated><id>http://localhost:4000/finding-nfts</id><content type="html" xml:base="http://localhost:4000/finding-nfts/"><![CDATA[<blockquote>
  <p>Embark on a journey through blockchain data with Joshua. Explore the intricacies of smart contracts, ERC721, and data analysis techniques. Joshua‚Äôs expertise shines as he guides you through interpreting transfer events using tools like Dune Analytics. Don‚Äôt miss the case study featuring Binance 7 EOA addresses. Verify insights with Etherscan for a deeper understanding of on-chain data architecture.</p>
</blockquote>

<h3 id="contents">CONTENTS</h3>
<ol>
  <li>Contract = Functions + Events</li>
  <li>ERC721 Interface</li>
  <li>Summary: From Collecting Transfer Events To Calculating Wallet Balance</li>
  <li>Step by Step
    <ul>
      <li>4.1Ô∏è. Collect All Transfer Events.</li>
      <li>4.2Ô∏è. Filter Out the Most Recent Transfer Events for Each Token.</li>
      <li>4.3. Filter the Results to Show Only Those Related to the Specific Address.</li>
      <li>4.4Ô∏è. Determine the Acquisition Price of the Tokens and Label the Contracts.</li>
    </ul>
  </li>
  <li>Case Study</li>
  <li>References</li>
</ol>

<hr />

<h1 id="1-contract--functions--events">1. Contract = Functions + Events</h1>

<p><img src="/assets/2023-10-08-finding-nfts/flowchart.webp" alt="" /></p>

<h3 id="functions"><code class="language-plaintext highlighter-rouge">Functions</code></h3>
<p>When you call a <code class="language-plaintext highlighter-rouge">function</code>:</p>
<ul>
  <li>
    <ol>
      <li>it returns a value, or</li>
    </ol>
  </li>
  <li>
    <ol>
      <li>it trigers an event. (= emits an event.)</li>
    </ol>
  </li>
</ul>

<h3 id="events"><code class="language-plaintext highlighter-rouge">Events</code></h3>
<p>WHen an <code class="language-plaintext highlighter-rouge">event</code> is emitted:</p>
<ul>
  <li>
    <ol>
      <li>it creates and. broadcasts a TX message, then</li>
    </ol>
  </li>
  <li>
    <ol>
      <li>the TX message leads to state change of Ethereum.</li>
    </ol>
  </li>
</ul>

<h1 id="2-erc721-interface">2. ERC721 Interface</h1>

<h3 id="functions-1"><code class="language-plaintext highlighter-rouge">Functions</code></h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">balanceOf</span><span class="p">(</span><span class="n">owner</span><span class="p">):</span>  
    <span class="k">return</span> <span class="sh">"</span><span class="s">Number of Tokens held by the Owner</span><span class="sh">'</span><span class="s">s Account</span><span class="sh">"</span>  
<span class="k">def</span> <span class="nf">ownerOf</span><span class="p">(</span><span class="n">tokenId</span><span class="p">):</span>  
    <span class="k">return</span> <span class="sh">"</span><span class="s">Owner</span><span class="sh">'</span><span class="s">s Address holding the Token</span><span class="sh">"</span>  
<span class="k">def</span> <span class="nf">transferFrom</span><span class="p">(</span><span class="k">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">tokenId</span><span class="p">):</span>  
    <span class="n">emit</span> <span class="n">Transfer</span>  
<span class="k">def</span> <span class="nf">approve</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">tokenId</span><span class="p">):</span>  
    <span class="n">emit</span> <span class="n">Approval</span>  
<span class="bp">...</span>
</code></pre></div></div>

<h3 id="events-1"><code class="language-plaintext highlighter-rouge">Events</code></h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">event</span> <span class="nc">Transfer</span><span class="p">(</span><span class="k">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">tokenId</span><span class="p">):</span>  
    <span class="c1">#  "tokenId" token is transferred from "from" to "to".  
</span><span class="n">event</span> <span class="nc">Approval</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">approved</span><span class="p">,</span> <span class="n">tokenId</span><span class="p">):</span>  
    <span class="c1"># "owner" enables "approved" to manage the "tokenId" token.  
</span><span class="bp">...</span>
</code></pre></div></div>

<h1 id="3-summary-from-collecting-transfer-events-to-calculating-wallet-balance">3. Summary: From Collecting Transfer Events To Calculating Wallet Balance</h1>

<h3 id="collect-all-events-involving--david">Collect All Events Involving  <code class="language-plaintext highlighter-rouge">David</code>.</h3>

<p><strong>Transfer Event #1:</strong></p>
<ul>
  <li>from = ‚ÄúJoshua‚Äù</li>
  <li>to = ‚ÄúDavid‚Äù</li>
  <li>tokenId = <code class="language-plaintext highlighter-rouge">1234</code></li>
</ul>

<p><strong>Transfer Event #2:</strong></p>
<ul>
  <li>from = ‚ÄúAngela‚Äù</li>
  <li>to = ‚ÄúDavid‚Äù</li>
  <li>tokenId = <code class="language-plaintext highlighter-rouge">5678</code></li>
</ul>

<p><strong>Transfer Event #3:</strong></p>
<ul>
  <li>from = ‚ÄúDavid‚Äù</li>
  <li>to = ‚ÄúAngela‚Äù</li>
  <li>tokenId = <code class="language-plaintext highlighter-rouge">1234</code></li>
</ul>

<h3 id="then-sum-up-all-the-events-to-determine-wallet-balance">Then Sum Up All the Events to Determine Wallet Balance.</h3>

<p><strong>Tokens List ‚ÄúDavid‚Äù currently owns:</strong></p>
<ul>
  <li>tokenId = <code class="language-plaintext highlighter-rouge">5678</code></li>
</ul>

<h1 id="4-step-by-step">4. Step by Step</h1>

<h2 id="41Ô∏è-collect-all-transfer-events">4.1Ô∏è. Collect All Transfer Events.</h2>

<p><img src="/assets/2023-10-08-finding-nfts/erc721-evt_Transfer.webp" alt="" /></p>
<blockquote>
  <p>Dune Analytics</p>
</blockquote>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span>  
<span class="n">CTE_all_transfers</span> <span class="k">AS</span> <span class="p">(</span>  
    <span class="k">SELECT</span>  
        <span class="n">contract_address</span><span class="p">,</span>  
        <span class="n">tokenId</span><span class="p">,</span>  
        <span class="n">evt_tx_hash</span><span class="p">,</span>  
        <span class="nv">"to"</span><span class="p">,</span>  
        <span class="n">ROW_NUMBER</span><span class="p">()</span> <span class="n">OVER</span> <span class="p">(</span>  
            <span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">contract_address</span><span class="p">,</span> <span class="n">tokenId</span>  
            <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">evt_block_number</span> <span class="k">DESC</span><span class="p">,</span> <span class="n">evt_index</span> <span class="k">DESC</span>  
        <span class="p">)</span> <span class="k">AS</span> <span class="n">recent_idx</span>  
    <span class="k">FROM</span>  
        <span class="n">erc721_ethereum</span><span class="p">.</span><span class="n">evt_Transfer</span>  
    <span class="k">WHERE</span>  
        <span class="n">contract_address</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
<span class="p">),</span>
</code></pre></div></div>

<p><strong>Query Results</strong></p>

<table>
  <thead>
    <tr>
      <th><strong>contract_address</strong></th>
      <th><strong>tokenId</strong></th>
      <th><strong>evt_tx_hash</strong></th>
      <th><strong>to</strong></th>
      <th><strong>recent_idx</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0x0000...8e25</code></td>
      <td>106</td>
      <td><code class="language-plaintext highlighter-rouge">0xc8c0...4e4c</code></td>
      <td><code class="language-plaintext highlighter-rouge">0x826e...1ff3</code></td>
      <td>2</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0x0000...8e25</code></td>
      <td>113</td>
      <td><code class="language-plaintext highlighter-rouge">0xcd01...66a2</code></td>
      <td><code class="language-plaintext highlighter-rouge">0xc412...0620</code></td>
      <td>2</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0x0000...8e25</code></td>
      <td>118</td>
      <td><code class="language-plaintext highlighter-rouge">0x28dd...6e20</code></td>
      <td><code class="language-plaintext highlighter-rouge">0x4d98...e5a8</code></td>
      <td>2</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0x0000...b183</code></td>
      <td>3</td>
      <td><code class="language-plaintext highlighter-rouge">0xd503...672a</code></td>
      <td><code class="language-plaintext highlighter-rouge">0x8636...a5e9</code></td>
      <td>2</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0x0000...b183</code></td>
      <td>13</td>
      <td><code class="language-plaintext highlighter-rouge">0x3cc9...4121</code></td>
      <td><code class="language-plaintext highlighter-rouge">0x47a1...c78a</code></td>
      <td>2</td>
    </tr>
  </tbody>
</table>

<h2 id="42Ô∏è-filter-out-the-most-recent-transfer-events-for-each-token">4.2Ô∏è. Filter Out the Most Recent Transfer Events for Each Token.</h2>
<blockquote>
  <p>So that we can see who owns the tokens at the moment!</p>
</blockquote>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CTE_last_transfers</span> <span class="k">AS</span> <span class="p">(</span>  
    <span class="k">SELECT</span>  
        <span class="o">*</span>  
    <span class="k">FROM</span>  
        <span class="n">CTE_all_transfers</span>  
    <span class="k">WHERE</span>  
        <span class="n">recent_idx</span> <span class="o">=</span> <span class="mi">1</span>  
<span class="p">),</span>
</code></pre></div></div>

<p><strong>Query Results</strong></p>

<table>
  <thead>
    <tr>
      <th><strong>contract_address</strong></th>
      <th><strong>tokenId</strong></th>
      <th><strong>evt_tx_hash</strong></th>
      <th><strong>to</strong></th>
      <th><strong>recent_idx</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0x0000...8e25</code></td>
      <td>0</td>
      <td><code class="language-plaintext highlighter-rouge">0xfa58...164a</code></td>
      <td><code class="language-plaintext highlighter-rouge">0x0000...5e92</code></td>
      <td>1</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0x0000...8e25</code></td>
      <td>1</td>
      <td><code class="language-plaintext highlighter-rouge">0x0595...c802</code></td>
      <td><code class="language-plaintext highlighter-rouge">0x0000...5e92</code></td>
      <td>1</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0x0000...8e25</code></td>
      <td>2</td>
      <td><code class="language-plaintext highlighter-rouge">0x0595...c802</code></td>
      <td><code class="language-plaintext highlighter-rouge">0x0000...5e92</code></td>
      <td>1</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0x0000...8e25</code></td>
      <td>3</td>
      <td><code class="language-plaintext highlighter-rouge">0x0595...c802</code></td>
      <td><code class="language-plaintext highlighter-rouge">0x0000...5e92</code></td>
      <td>1</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0x0000...8e25</code></td>
      <td>4</td>
      <td><code class="language-plaintext highlighter-rouge">0x0595...c802</code></td>
      <td><code class="language-plaintext highlighter-rouge">0x0000...5e92</code></td>
      <td>1</td>
    </tr>
  </tbody>
</table>

<h2 id="43-filter-the-results-to-show-only-those-related-to-the-specific-address">4.3. Filter the Results to Show Only Those Related to the Specific Address.</h2>
<blockquote>
  <p>So that we can see all the tokens that the address owns at the moment.</p>
</blockquote>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CTE_last_transfers_cohort</span> <span class="k">AS</span> <span class="p">(</span>  
    <span class="k">SELECT</span>  
        <span class="o">*</span>  
    <span class="k">FROM</span>  
        <span class="n">CTE_last_transfers</span>  
    <span class="k">WHERE</span>  
        <span class="nv">"to"</span> <span class="o">=</span>   
<span class="p">),</span>
</code></pre></div></div>

<p><strong>Query Results</strong></p>

<table>
  <thead>
    <tr>
      <th><strong>contract_address</strong></th>
      <th><strong>tokenId</strong></th>
      <th><strong>evt_tx_hash</strong></th>
      <th><strong>to</strong></th>
      <th><strong>recent_idx</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0x0000...8e25</code></td>
      <td>0</td>
      <td><code class="language-plaintext highlighter-rouge">0xfa58...164a</code></td>
      <td><code class="language-plaintext highlighter-rouge">0x0000...5e92</code></td>
      <td>1</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0x0000...8e25</code></td>
      <td>1</td>
      <td><code class="language-plaintext highlighter-rouge">0x0595...c802</code></td>
      <td><code class="language-plaintext highlighter-rouge">0x0000...5e92</code></td>
      <td>1</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0x0000...8e25</code></td>
      <td>2</td>
      <td><code class="language-plaintext highlighter-rouge">0x0595...c802</code></td>
      <td><code class="language-plaintext highlighter-rouge">0x0000...5e92</code></td>
      <td>1</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0x0000...8e25</code></td>
      <td>3</td>
      <td><code class="language-plaintext highlighter-rouge">0x0595...c802</code></td>
      <td><code class="language-plaintext highlighter-rouge">0x0000...5e92</code></td>
      <td>1</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0x0000...8e25</code></td>
      <td>4</td>
      <td><code class="language-plaintext highlighter-rouge">0x0595...c802</code></td>
      <td><code class="language-plaintext highlighter-rouge">0x0000...5e92</code></td>
      <td>1</td>
    </tr>
  </tbody>
</table>

<h2 id="44Ô∏è-determine-the-acquisition-price-of-the-tokens-and-label-the-contracts">4.4Ô∏è. Determine the Acquisition Price of the Tokens and Label the Contracts.</h2>

<p><strong>Determine the Acquisition Price of the Tokens.</strong></p>

<p><img src="/assets/2023-10-08-finding-nfts/flowchart.webp" alt="" /></p>

<ul>
  <li><strong>JOIN <code class="language-plaintext highlighter-rouge">hash</code> with <code class="language-plaintext highlighter-rouge">evt_tx_hash</code> and SELECT <code class="language-plaintext highlighter-rouge">value</code>.</strong></li>
</ul>

<p><img src="/assets/2023-10-08-finding-nfts/ethereum.transactions.webp" alt="" /></p>
<blockquote>
  <p>Dune Analytics</p>
</blockquote>

<p><strong>Label the Contracts.</strong></p>

<p><img src="/assets/2023-10-08-finding-nfts/label-the-contracts.webp" alt="" /></p>
<blockquote>
  <p>Dune Analytics</p>
</blockquote>

<ul>
  <li><strong>JOIN <code class="language-plaintext highlighter-rouge">contract_address</code> with <code class="language-plaintext highlighter-rouge">contract_address</code> and SELECT <code class="language-plaintext highlighter-rouge">name</code>.</strong></li>
</ul>

<p><img src="/assets/2023-10-08-finding-nfts/tokens.nft.webp" alt="" /></p>
<blockquote>
  <p>Dune Analytics</p>
</blockquote>

<p><strong>Final Query to Wrap Up</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CTE_summary</span> <span class="k">AS</span> <span class="p">(</span>  
    <span class="k">SELECT</span>  
        <span class="n">LABELS</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>  
        <span class="n">TRANSFERS</span><span class="p">.</span><span class="n">contract_address</span><span class="p">,</span>  
        <span class="n">TRANSFERS</span><span class="p">.</span><span class="n">tokenId</span><span class="p">,</span>  
        <span class="n">TXS</span><span class="p">.</span><span class="n">value</span> <span class="o">/</span> <span class="mi">1</span><span class="n">e18</span> <span class="k">AS</span> <span class="n">acquisition_cost</span>  
    <span class="k">FROM</span>  
        <span class="n">CTE_last_transfers_cohort</span> <span class="n">TRANSFERS</span>  
    <span class="k">LEFT</span> <span class="k">JOIN</span>  
        <span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span> <span class="n">TXS</span>  
        <span class="k">ON</span> <span class="n">TRANSFERS</span><span class="p">.</span><span class="n">evt_tx_hash</span> <span class="o">=</span> <span class="n">TXS</span><span class="p">.</span><span class="n">hash</span>  
    <span class="k">LEFT</span> <span class="k">JOIN</span>  
        <span class="n">tokens</span><span class="p">.</span><span class="n">nft</span> <span class="n">LABELS</span>  
        <span class="k">ON</span> <span class="n">TRANSFERS</span><span class="p">.</span><span class="n">contract_address</span> <span class="o">=</span> <span class="n">LABELS</span><span class="p">.</span><span class="n">contract_address</span>  
            <span class="k">AND</span> <span class="n">LABELS</span><span class="p">.</span><span class="n">blockchain</span> <span class="o">=</span> <span class="s1">'ethereum'</span>  
<span class="p">)</span>
<span class="k">SELECT</span>
    <span class="o">*</span>
<span class="k">FROM</span>
    <span class="n">CTE_summary</span>
<span class="p">;</span>
</code></pre></div></div>

<h1 id="5-case-study">5. Case Study</h1>

<h3 id="binance-7--eoa-address"><code class="language-plaintext highlighter-rouge">Binance 7</code>  EOA Address</h3>
<blockquote>
  <p>‚òéÔ∏è <code class="language-plaintext highlighter-rouge">0xBE0eB53F46cd790Cd13851d5EFf43D12404d33E8</code></p>
</blockquote>

<h3 id="query-results">Query Results</h3>

<p><img src="/assets/2023-10-08-finding-nfts/query-results.webp" alt="" /></p>
<blockquote>
  <p>üü†  <a href="https://dune.com/joshua_web3/blpas-sample-dashboard?address_t7a5e7=0xBE0eB53F46cd790Cd13851d5EFf43D12404d33E8">dune.com/joshua_web3</a></p>
</blockquote>

<h3 id="check-it-out-with--etherscan--just-in-case-its-not-been-correctly-queried">Check it out with  <code class="language-plaintext highlighter-rouge">Etherscan</code>  just in case it‚Äôs not been correctly queried.</h3>

<ul>
  <li>Holders of  <code class="language-plaintext highlighter-rouge">Documenta X by Vuk Cosic</code></li>
</ul>

<p><img src="/assets/2023-10-08-finding-nfts/etherscan-documenta.webp" alt="" /></p>
<blockquote>
  <p>Etherscan</p>
</blockquote>

<ul>
  <li>Holders of  <code class="language-plaintext highlighter-rouge">New World Babies</code></li>
</ul>

<p><img src="/assets/2023-10-08-finding-nfts/etherscan-new-world-babies.webp" alt="" /></p>
<blockquote>
  <p>Etherscan</p>
</blockquote>

<h1 id="6-references">6. References</h1>

<ul>
  <li><a href="https://docs.openzeppelin.com/contracts/4.x/api/token/erc721">OpenZeppelin Docs</a></li>
  <li><a href="https://dune.com/joshua_web3/blpas-sample-dashboard?address_t7a5e7=0xBE0eB53F46cd790Cd13851d5EFf43D12404d33E8">Dune Dashboard</a>  (created by Joshua)</li>
</ul>

<hr />

<h2 id="published-by-joshua-kim"><em>Published by</em> Joshua Kim</h2>
<p><img src="/assets/profile/joshua-profile.png" alt="Joshua Kim" /></p>]]></content><author><name></name></author><category term="english" /><category term="blockchain" /><category term="on_chain_data" /><category term="sql" /><summary type="html"><![CDATA[Embark on a journey through blockchain data with Joshua. Explore the intricacies of smart contracts, ERC721, and data analysis techniques. Joshua‚Äôs expertise shines as he guides you through interpreting transfer events using tools like Dune Analytics. Don‚Äôt miss the case study featuring Binance 7 EOA addresses. Verify insights with Etherscan for a deeper understanding of on-chain data architecture.]]></summary></entry><entry><title type="html">OpenSeaÏóêÏÑú Î∞úÏÉùÌïú Ìä∏ÎûúÏû≠ÏÖò Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞</title><link href="http://localhost:4000/opensea-transaction/" rel="alternate" type="text/html" title="OpenSeaÏóêÏÑú Î∞úÏÉùÌïú Ìä∏ÎûúÏû≠ÏÖò Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞" /><published>2023-09-18T00:00:00+09:00</published><updated>2023-09-18T00:00:00+09:00</updated><id>http://localhost:4000/opensea-transaction</id><content type="html" xml:base="http://localhost:4000/opensea-transaction/"><![CDATA[<blockquote>
  <p>ÏïàÎÖïÌïòÏÑ∏Ïöî. Ï†ÄÎäî Î∏îÎ°ùÏ≤¥Ïù∏ Í∏∞Î∞ò ÏÑúÎπÑÏä§ Í∏∞ÏóÖÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÏùÑ Îã¥ÎãπÌïòÍ≥† ÏûàÎäî JoshuaÎùºÍ≥† Ìï©ÎãàÎã§. Ïù¥Î≤à ÏïÑÌã∞ÌÅ¥ÏóêÏÑúÎäî OpenSeaÏóêÏÑú NFT TransferÍ∞Ä Î∞úÏÉùÌñàÏùÑ Îïå, EVM Í≥ÑÏó¥ Î∏îÎ°ùÏ≤¥Ïù∏Ïùò Ïò®Ï≤¥Ïù∏ ÏÉÅÏóê Îç∞Ïù¥ÌÑ∞Í∞Ä Ïñ¥Îñ§ Î™®ÏäµÏúºÎ°ú ÎÇ®ÏïÑ ÏûàÎäîÏßÄ ÌååÌó§Ï≥ê Î≥¥ÎèÑÎ°ù ÌïòÍ≤†ÏäµÎãàÎã§.</p>
</blockquote>

<h3 id="contents">CONTENTS</h3>
<ol>
  <li>Ïò§ÎäòÏùò ÌÜ†ÌîΩ</li>
  <li>Î∞îÏÅòÏã† Î∂ÑÎì§ÏùÑ ÏúÑÌïú ÎëêÍ¥ÑÏãù Í≤∞Î°†</li>
  <li>ÏÉÅÏÑ∏ ÎÇ¥Ïö© ÌååÌó§ÏπòÍ∏∞
    <ul>
      <li>3.1. TransactionReceipt</li>
      <li>3.2. OpenSeaÏùò Wyvern Ïª®Ìä∏ÎûôÌä∏Î°úÎ∂ÄÌÑ∞ Î∞úÏÉùÌïú Internal TXs</li>
      <li>3.3. <code class="language-plaintext highlighter-rouge">atomicMatch_</code> Ìï®ÏàòÎ°úÎ∂ÄÌÑ∞ Î∞úÏÉùÌïú Events</li>
    </ul>
  </li>
  <li>Ï†ïÎ¶¨ÌïòÍ∏∞</li>
</ol>

<hr />

<h1 id="1-Ïò§ÎäòÏùò-ÌÜ†ÌîΩ">1. Ïò§ÎäòÏùò ÌÜ†ÌîΩ</h1>

<p>Î®ºÏ†Ä Ïò§Îäò ÏÇ¨Î°ÄÎ°ú ÏÇ¥Ìé¥Î≥º NFTÎäî <strong>Bored Ape Yacht Club</strong>Ïùò <code class="language-plaintext highlighter-rouge">tokenId</code> = <code class="language-plaintext highlighter-rouge">3238</code>Ïù∏ NFTÏûÖÎãàÎã§.</p>

<p><img src="/assets/2023-09-18-opensea-transaction/bayc.webp" alt="" /></p>
<blockquote>
  <p><a href="https://opensea.io/assets/ethereum/0xbc4ca0eda7647a8ab7c2061c2e118a18a936f13d/3238">Source</a></p>
</blockquote>

<p>Ïù¥ NFTÏùò ÌôúÎèô ÎÇ¥Ïó≠ÏùÑ Î≥¥Î©¥ Transfers ÌûàÏä§ÌÜ†Î¶¨Í∞Ä ÎßéÏù¥ ÎÇ®ÏïÑ ÏûàÎäîÎç∞Ïöî. Í∑∏ Ï§ëÏóêÏÑú, <code class="language-plaintext highlighter-rouge">wizmo</code> Í≥ÑÏ†ïÏúºÎ°úÎ∂ÄÌÑ∞ <code class="language-plaintext highlighter-rouge">LGHTWRK</code> Í≥ÑÏ†ïÏúºÎ°úÏùò Transfer ÎÇ¥Ïó≠ÏùÑ ÎúØÏñ¥Î≥¥ÎèÑÎ°ù Ìï†Í≤åÏöî.</p>

<p><img src="/assets/2023-09-18-opensea-transaction/bayc-transfers.webp" alt="" /></p>
<blockquote>
  <p><a href="https://opensea.io/assets/ethereum/0xbc4ca0eda7647a8ab7c2061c2e118a18a936f13d/3238">Source</a></p>
</blockquote>

<p>Ïù¥ Transfer ÎÇ¥Ïó≠Ïùò Ïö∞Ï∏° Î∞îÎ°úÍ∞ÄÍ∏∞ Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ ÏïÑÎûòÏôÄ Í∞ôÏù¥ EtherscanÏùò <code class="language-plaintext highlighter-rouge">Transaction Receipt</code> ÌéòÏù¥ÏßÄÍ∞Ä ÌåùÏóÖÌï©ÎãàÎã§. ÌïòÏßÄÎßå ÏïàÌÉÄÍπùÍ≤åÎèÑ ÏùºÎ∞òÏ†ÅÏù∏ ETH ÏÜ°Í∏àÍ≥º Îã¨Î¶¨, Ìä∏ÎûúÏû≠ÏÖòÏù¥ ÏÉÅÎãπÌûà ÎÇúÌï¥ÌïòÏó¨ ÎèÑÎåÄÏ≤¥ Ïñ¥Îñ§ Íµ¨Ï°∞ÏôÄ Ï†àÏ∞®Î•º ÌÜµÌï¥ Ïã§ÌñâÎêú Í≤ÉÏù∏ÏßÄ ÏïåÍ∏∞ÎûÄ Ï∞∏ Ïñ¥Î†§ÏõåÏöî. ÌäπÌûà, Î∏îÎ°ùÏ≤¥Ïù∏ Ï¥àÏã¨ÏûêÎùºÎ©¥ ÎçîÏö± ÎÇúÍ∞êÌïòÍ≤†Ï£†.</p>

<p><img src="/assets/2023-09-18-opensea-transaction/etherscan-overview.webp" alt="" /></p>
<blockquote>
  <p><a href="https://etherscan.io/tx/0xe769c002eb1a13e9384d8b62270c963188a686068f2833a9c1b07b160468e80c">Source</a></p>
</blockquote>

<h1 id="2-Î∞îÏÅòÏã†-Î∂ÑÎì§ÏùÑ-ÏúÑÌïú-ÎëêÍ¥ÑÏãù-Í≤∞Î°†">2. Î∞îÏÅòÏã† Î∂ÑÎì§ÏùÑ ÏúÑÌïú ÎëêÍ¥ÑÏãù Í≤∞Î°†</h1>

<blockquote>
  <p><strong><code class="language-plaintext highlighter-rouge">wizmo</code>Ïùò NFT Í≤ΩÎß§Ïóê ÎåÄÌïòÏó¨ <code class="language-plaintext highlighter-rouge">LGHTWRK</code>Ïùò OfferÍ∞Ä ÏàòÎùΩÎêòÏñ¥, <code class="language-plaintext highlighter-rouge">wizmo</code>Í∞Ä <code class="language-plaintext highlighter-rouge">LGHTWRK</code>ÏóêÍ≤å NFTÎ•º Ï†ÑÏÜ°ÌïòÎäî Í±∞ÎûòÍ∞Ä ÏÑ±ÏÇ¨ÎêòÏóàÎã§.</strong></p>
</blockquote>

<p><img src="/assets/2023-09-18-opensea-transaction/flowchart.webp" alt="" /></p>
<blockquote>
  <p>JoshuaÍ∞Ä ÏûëÏÑ±Ìïú Flowchart</p>
</blockquote>

<h1 id="3-ÏÉÅÏÑ∏-ÎÇ¥Ïö©-ÌååÌó§ÏπòÍ∏∞">3. ÏÉÅÏÑ∏ ÎÇ¥Ïö© ÌååÌó§ÏπòÍ∏∞</h1>

<h2 id="31-transactionreceipt">3.1. TransactionReceipt</h2>

<p>Ïö∞ÏÑ†, ÌÅ¨Í≤å Îã§ÏùåÍ≥º Í∞ôÏùÄ ÎÇ¥Ïö©ÏùÑ Ïïå Ïàò ÏûàÏäµÎãàÎã§.</p>

<table>
  <thead>
    <tr>
      <th><strong>ÌååÎùºÎØ∏ÌÑ∞</strong></th>
      <th><strong>Í∞í</strong></th>
      <th><strong>Ï∞∏Í≥†ÎÇ¥Ïö©</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>from</strong></td>
      <td>0x869c‚Ä¶Bf89</td>
      <td><code class="language-plaintext highlighter-rouge">LGHTWRK</code>Ïùò Ï£ºÏÜå</td>
    </tr>
    <tr>
      <td><strong>to</strong></td>
      <td>0x7Be8‚Ä¶D12b</td>
      <td><code class="language-plaintext highlighter-rouge">OpenSea: Wyvern Exchange v1</code>Ïùò Ï£ºÏÜå</td>
    </tr>
    <tr>
      <td><strong>value</strong></td>
      <td>2.1000 ETH</td>
      <td>0.1050 ETH + 1.9950 ETH</td>
    </tr>
    <tr>
      <td><strong>tx fee</strong></td>
      <td>0.0084 ETH</td>
      <td>-</td>
    </tr>
    <tr>
      <td><strong>data</strong></td>
      <td><code class="language-plaintext highlighter-rouge">atomicMatch_</code></td>
      <td>Ìï®Ïàò Ìò∏Ï∂ú</td>
    </tr>
  </tbody>
</table>

<p>Ï¶â, Ïù¥ Ìä∏ÎûúÏû≠ÏÖòÏùò Í∏∞Î≥∏ Í≥®Í≤©ÏùÄ Îã§ÏùåÍ≥º Í∞ôÏäµÎãàÎã§.</p>
<blockquote>
  <p><strong><code class="language-plaintext highlighter-rouge">LGHTWRK</code>Î°úÎ∂ÄÌÑ∞ <code class="language-plaintext highlighter-rouge">OpenSeaÏùò Wyvern Ïª®Ìä∏ÎûôÌä∏</code>Î•º Ìñ•Ìï¥ <code class="language-plaintext highlighter-rouge">2.1000</code> ETHÎ•º ÏÜ°Í∏àÌï®Í≥º ÎèôÏãúÏóê Ìï¥Îãπ Ïª®Ìä∏ÎûôÌä∏Ïùò ABIÏóê Ï†ïÏùòÎêòÏñ¥ ÏûàÎäî  <code class="language-plaintext highlighter-rouge">atomicMatch_</code>  Ìï®ÏàòÎ•º Ïã§ÌñâÌïòÎäî Í≤ÉÏùÑ Î™©ÌëúÎ°ú ÌïúÎã§.</strong></p>
</blockquote>

<p>Ï∞∏Í≥†Î°ú, Ï†úÍ∞Ä <code class="language-plaintext highlighter-rouge">2.1000</code> ETHÎ•º <code class="language-plaintext highlighter-rouge">0.1050</code> ETH + <code class="language-plaintext highlighter-rouge">1.9950</code> ETH Î°ú Ï™ºÍ∞úÏñ¥ ÌëúÌòÑÌñàÎäîÎç∞Ïöî. Ï†úÍ∞Ä Ïôú Í∑∏Îû¨ÏùÑÍπåÏöî? Î∞îÎ°ú ÏïÑÎûòÎ•º Î≥¥ÏãúÏ£†.</p>

<h2 id="32-openseaÏùò-wyvern-Ïª®Ìä∏ÎûôÌä∏Î°úÎ∂ÄÌÑ∞-Î∞úÏÉùÌïú-internal-txs">3.2. OpenSeaÏùò Wyvern Ïª®Ìä∏ÎûôÌä∏Î°úÎ∂ÄÌÑ∞ Î∞úÏÉùÌïú Internal TXs</h2>

<p><code class="language-plaintext highlighter-rouge">LGHTWRK</code>Í∞Ä <code class="language-plaintext highlighter-rouge">OpenSeaÏùò Wyvern Ïª®Ìä∏ÎûôÌä∏</code>Î•º Ìñ•Ìï¥ ÏÜ°Í∏àÌïòÍ≤å ÎêòÎ©¥ÏÑú, Ïª®Ìä∏ÎûôÌä∏Î°úÎ∂ÄÌÑ∞ Ï¥ù 2Í∞úÏùò Ìä∏ÎûúÏû≠ÏÖòÏù¥ ÌååÏÉùÏ†ÅÏúºÎ°ú Î∞úÏÉùÌñàÏäµÎãàÎã§. Î∞îÎ°ú, NFTÎ•º Íµ¨Îß§ÌïòÍ≥† Ïã∂ÏùÄ <code class="language-plaintext highlighter-rouge">LGHTWRK</code>Í∞Ä OpenSeaÏóê ÏàòÏàòÎ£åÎ•º ÎÇ©Î∂ÄÌïòÍ≥†, NFT ÏÜåÏú†ÏûêÏù∏ <code class="language-plaintext highlighter-rouge">wizmo</code>ÏóêÍ≤å Ï†úÏãúÌïú Í∞ÄÍ≤©ÏùÑ ÏßÄÎ∂àÌï¥Ïïº ÌïòÎäî ÎÇ¥Ïö©Ïù∏ Í≤ÉÏù¥Ï£†.</p>

<p><strong>1. <code class="language-plaintext highlighter-rouge">OpenSeaÏùò Wyvern Ïª®Ìä∏ÎûôÌä∏</code>Í∞Ä  <code class="language-plaintext highlighter-rouge">OpenSea ÏàòÏàòÎ£å Ï†ÑÏö© EOA</code>Ïóê <code class="language-plaintext highlighter-rouge">0.1050</code> ETHÎ•º ÏÜ°Í∏àÌïúÎã§.</strong></p>
<ul>
  <li><strong>from</strong>  = 0x7Be8‚Ä¶D12b (<code class="language-plaintext highlighter-rouge">OpenSea: Wyvern Exchange v1</code>)</li>
  <li><strong>to</strong>  = 0x5b32‚Ä¶1073 (<code class="language-plaintext highlighter-rouge">OpenSea: Wallet</code>)</li>
</ul>

<p><strong>2. <code class="language-plaintext highlighter-rouge">OpenSeaÏùò Wyvern Ïª®Ìä∏ÎûôÌä∏</code>Í∞Ä  <code class="language-plaintext highlighter-rouge">wizmo</code>ÏóêÍ≤å <code class="language-plaintext highlighter-rouge">1.9950</code> ETHÎ•º ÏÜ°Í∏àÌïúÎã§.</strong></p>
<ul>
  <li><strong>from</strong>  = 0x7Be8‚Ä¶D12b (<code class="language-plaintext highlighter-rouge">OpenSea: Wyvern Exchange v1</code>)</li>
  <li><strong>to</strong>  = 0xc4CB‚Ä¶9B26 (<code class="language-plaintext highlighter-rouge">wizmo</code>)</li>
</ul>

<p>Ï∞∏Í≥†Î°ú, EtherscanÏùò Transaction Receipt ÌéòÏù¥ÏßÄÏóêÏÑú <strong>Internal Txns ÌÉ≠</strong>ÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ ÏúÑ ÎÇ¥Ïö©ÏùÑ ÌôïÏù∏ÌïòÏã§ Ïàò ÏûàÎäîÎç∞Ïöî. Î∏îÎ°ùÏ≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞ Ï∏°Î©¥ÏóêÏÑúÎäî Ïù¥Îü¨Ìïú <strong>Internal TX</strong>Î•º ÌùîÌûà <code class="language-plaintext highlighter-rouge">Trace</code>ÎùºÍ≥†ÎèÑ ÌëúÌòÑÌï©ÎãàÎã§.</p>

<p><img src="/assets/2023-09-18-opensea-transaction/ethersacn-internal-tx.webp" alt="" /></p>
<blockquote>
  <p><a href="https://etherscan.io/tx/0xe769c002eb1a13e9384d8b62270c963188a686068f2833a9c1b07b160468e80c#internal">Source</a></p>
</blockquote>

<h2 id="33-atomicmatch_-Ìï®ÏàòÎ°úÎ∂ÄÌÑ∞-Î∞úÏÉùÌïú-events">3.3. <code class="language-plaintext highlighter-rouge">atomicMatch_</code> Ìï®ÏàòÎ°úÎ∂ÄÌÑ∞ Î∞úÏÉùÌïú Events</h2>

<p><code class="language-plaintext highlighter-rouge">OpenSeaÏùò Wyvern Ïª®Ìä∏ÎûôÌä∏</code>ÏóêÍ≤å Input DataÎ°ú Ï†ÅÏñ¥Ï§Ä  <strong>_atomicMatch__</strong>  Ìï®ÏàòÎ•º ÌÜµÌï¥,  <code class="language-plaintext highlighter-rouge">OpenSeaÏùò Wyvern Ïª®Ìä∏ÎûôÌä∏</code>  ÏóêÏÑúÎäî Ï¥ù 3Í∞úÏùò EventsÍ∞Ä Î∞úÏÉù(emit)ÌïòÍ≤å Îê©ÎãàÎã§.</p>

<p>ÏÇ¨Ïã§, <strong>_atomicMatch__</strong> Ìï®ÏàòÎ•º ÌÜµÌï¥ Ïñ¥Îñ§ EventsÍ∞Ä Ïã§ÌñâÎêòÎäîÏßÄ Î™ÖÌôïÌïòÍ≤å ÏïåÍ∏∞ ÏúÑÌï¥ÏÑúÎäî ÏïÑÎûòÏôÄ Í∞ôÏù¥  <code class="language-plaintext highlighter-rouge">OpenSeaÏùò Wyvern Ïª®Ìä∏ÎûôÌä∏</code>Ïùò ÏΩîÎìúÎ•º Î∂ÑÏÑùÌï¥Ïïº ÌïòÎäîÎç∞Ïöî. Ïù¥Í≤ÉÍπåÏßÄ ÏÇ¥Ìé¥Î≥¥Î†§Î©¥ Î∂ÑÎüâÏù¥ ÎÑàÎ¨¥ Í∏∏Ïñ¥Ïßà Í≤É Í∞ôÏúºÎãà, Ïò§ÎäòÏùÄ ÏÉùÎûµÌï†Í≤åÏöî.</p>

<p><img src="/assets/2023-09-18-opensea-transaction/etherscan-source-code.webp" alt="" /></p>
<blockquote>
  <p><a href="https://etherscan.io/address/0x7be8076f4ea4a4ad08075c2508e481d6c946d12b#code">Source</a></p>
</blockquote>

<p><strong>1. Approval Ïù¥Î≤§Ìä∏</strong></p>
<ul>
  <li>ERC-721 ABIÏùò <code class="language-plaintext highlighter-rouge">Approval</code> Ïù¥Î≤§Ìä∏ÏôÄ ÌååÎùºÎØ∏ÌÑ∞ Íµ¨Ï°∞Í∞Ä ÎòëÍ∞ôÏäµÎãàÎã§. ERC-721 ABIÏùò <code class="language-plaintext highlighter-rouge">Approval</code> Ïù¥Î≤§Ìä∏Îäî ‚ÄúÌäπÏ†ï AddressÍ∞Ä ÏÜåÏú†ÏûêÎ•º ÎåÄÏã†ÌïòÏó¨ NFTÎ•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî Í∂åÌïúÏùÑ Ï£ºÍ≤åÎäî‚Äù Í≤ÉÏùÑ ÏùòÎØ∏Ìï©ÎãàÎã§.</li>
  <li>Approval Ïù¥Î≤§Ìä∏Îäî ERC-721 ABIÏùò <code class="language-plaintext highlighter-rouge">approve</code> Ìï®ÏàòÎ•º ÌÜµÌï¥ Î∞úÏÉùÌïòÍ≤å ÎêòÎäîÎç∞, Ïù¥Î≤à ÏïÑÌã∞ÌÅ¥ÏóêÏÑú ÏÜåÍ∞ú ÎìúÎ¶¨Í≥† ÏûàÎäî Ìä∏ÎûúÏû≠ÏÖòÏóêÏÑúÎäî approve Ìï®ÏàòÍ∞Ä Ïã§ÌñâÎêú Ï†ÅÏù¥ ÏóÜÎäî Í≤ÉÏúºÎ°ú Î≥¥ÏïÑ, ÏïÑÎßà ÏÜåÏú†ÏûêÏù∏  <code class="language-plaintext highlighter-rouge">wizmo</code>Í∞Ä ÏûêÏã†Ïùò NFTÎ•º Í≤ΩÎß§Ïóê Ïò¨Î¶∞ ÏãúÏ†êÏóê Ïò§ÌîÑÏ≤¥Ïù∏ ÏÉÅÏóêÏÑú SignedÎêú Ìä∏ÎûúÏû≠ÏÖò Î©îÏãúÏßÄÎ•º Î≥∏ Ìä∏ÎûúÏû≠ÏÖòÍ≥º Î¨∂Ïùå Îã®ÏúÑÎ°ú Î∏åÎ°úÎìúÏ∫êÏä§Ìä∏ÌñàÍ∏∞ ÎïåÎ¨∏Ïù¥ÏßÄ ÏïäÏùÑÍπå Ï∂îÏ∏°Ìï¥Î¥ÖÎãàÎã§.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">owner</span> <span class="o">=</span> <span class="mh">0xc4cb</span><span class="err">‚Ä¶</span><span class="mi">9</span><span class="n">b26</span> <span class="c1"># wizmo
</span><span class="n">approved</span> <span class="o">=</span> <span class="mh">0x0000</span><span class="err">‚Ä¶</span><span class="mi">0000</span>  
<span class="n">tokenId</span> <span class="o">=</span> <span class="mi">3238</span>
</code></pre></div></div>

<p><strong>2. Transfer Ïù¥Î≤§Ìä∏</strong></p>
<ul>
  <li>NFTÏùò ÏÜåÏú†Í∂åÏù¥ <code class="language-plaintext highlighter-rouge">wizmo</code>Î°úÎ∂ÄÌÑ∞ <code class="language-plaintext highlighter-rouge">LGHTWRK</code>Î°ú ÎÑòÏñ¥Í∞ÄÍ≤å ÎêòÎäî Ïù¥Î≤§Ìä∏ÏûÖÎãàÎã§.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">from</span> <span class="o">=</span> <span class="mh">0xc4cb</span><span class="err">‚Ä¶</span><span class="mi">9</span><span class="n">b26</span> <span class="c1"># wizmo  
</span><span class="n">to</span> <span class="o">=</span> <span class="mh">0x869c</span><span class="err">‚Ä¶</span><span class="n">bf89</span> <span class="c1"># LGHTWRK
</span><span class="n">tokenId</span> <span class="o">=</span> <span class="mi">3238</span>
</code></pre></div></div>

<p><strong>3. OrdersMatched Ïù¥Î≤§Ìä∏</strong></p>
<ul>
  <li>Ï†ïÌôïÌûà Ïñ¥Îñ§ Í≤ÉÏùÑ ÏùòÎØ∏ÌïòÎäîÏßÄ ÏïåÍ∏∞ ÏúÑÌï¥ÏÑúÎäî  <code class="language-plaintext highlighter-rouge">OpenSeaÏùò Wyvern Ïª®Ìä∏ÎûôÌä∏</code>  Ïùò ÏΩîÎìúÎ•º Î∂ÑÏÑùÌï¥Ïïº ÌïòÍ≤†ÏßÄÎßå, Ïö∞ÏÑ† Í≤ΩÎß§Î•º ÌÜµÌï¥ ÏÑ±ÏÇ¨Îêú Í±∞Îûò ÎÇ¥Ïó≠Ïù¥ Í∏∞Î°ùÎêú Í≤ÉÏù¥ÎùºÍ≥† ÏÉùÍ∞ÅÌïòÍ≥† ÎÑòÏñ¥Í∞ÄÎ¥ÖÏãúÎã§.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">maker</span> <span class="o">=</span> <span class="mh">0xc4cb</span><span class="err">‚Ä¶</span><span class="mi">9</span><span class="n">b26</span> <span class="c1"># wizmo (OpenSea Í≤ΩÎß§ ÏãúÏû•Ïùò Maker)
</span><span class="n">taker</span> <span class="o">=</span> <span class="mh">0x869c</span><span class="err">‚Ä¶</span><span class="n">bf89</span> <span class="c1"># LGHTWRK (OpenSea Í≤ΩÎß§ ÏãúÏû•Ïùò Taker)
</span><span class="n">metadata</span> <span class="o">=</span> <span class="mh">0x0000</span><span class="err">‚Ä¶</span><span class="mi">0000</span> <span class="c1"># data  
</span><span class="n">buyHash</span> <span class="o">=</span> <span class="mi">0000</span><span class="err">‚Ä¶</span><span class="mi">0000</span>  
<span class="n">sellHash</span> <span class="o">=</span> <span class="n">A7B1</span><span class="err">‚Ä¶</span><span class="mi">297</span><span class="n">F</span>  
<span class="n">price</span> <span class="o">=</span> <span class="mf">2.1000</span> <span class="c1"># ETH
</span></code></pre></div></div>

<h1 id="4-Ï†ïÎ¶¨ÌïòÍ∏∞">4. Ï†ïÎ¶¨ÌïòÍ∏∞</h1>

<p>ÏßÄÍ∏àÍπåÏßÄ Í∞ÄÎ≤ºÏö¥ ÎßàÏùåÏúºÎ°ú(?) ÏïÑÎûò ÎÇ¥Ïö©ÏùÑ Îç∞Ïù¥ÌÑ∞Ï†ÅÏúºÎ°ú ÎúØÏñ¥Î≥¥ÏïòÏäµÎãàÎã§.</p>

<blockquote>
  <p><strong><code class="language-plaintext highlighter-rouge">wizmo</code>Ïùò NFT Í≤ΩÎß§Ïóê ÎåÄÌïòÏó¨ <code class="language-plaintext highlighter-rouge">LGHTWRK</code>Ïùò OfferÍ∞Ä ÏàòÎùΩÎêòÏñ¥, <code class="language-plaintext highlighter-rouge">wizmo</code>Í∞Ä <code class="language-plaintext highlighter-rouge">LGHTWRK</code>ÏóêÍ≤å NFTÎ•º Ï†ÑÏÜ°ÌïòÎäî Í±∞ÎûòÍ∞Ä ÏÑ±ÏÇ¨ÎêòÏóàÎã§.</strong></p>
</blockquote>

<p><img src="/assets/2023-09-18-opensea-transaction/flowchart.webp" alt="" /></p>
<blockquote>
  <p>JoshuaÍ∞Ä ÏûëÏÑ±Ìïú Flowchart</p>
</blockquote>

<p>ETH, ERC-20Ïùò ÏÜ°Í∏àÍ≥º Îã¨Î¶¨, ERC-721ÏùÄ Ï¢Ä Îçî Îã§ÏñëÌïú Î©îÌÉÄÎç∞Ïù¥ÌÑ∞Î•º ÏßÄÎãàÍ≥† ÏûàÍ≥†, Ïã¨ÏßÄÏñ¥ OpenSeaÎäî ÏûêÏ≤¥Ï†ÅÏúºÎ°ú Ïª®Ìä∏ÎûôÌä∏Î•º Íµ¨ÌòÑÌïòÏó¨ ERC-721 ÌÜ†ÌÅ∞Ïùò Í≤ΩÎß§Í∞Ä ÏûêÎèôÏúºÎ°ú ÏÑ±ÏÇ¨Îê† Ïàò ÏûàÎèÑÎ°ù ÌîÑÎ°úÌÜ†ÏΩúÏùÑ Íµ¨ÌòÑÌñàÏäµÎãàÎã§. <code class="language-plaintext highlighter-rouge">OpenSeaÏùò Wyvern Ïª®Ìä∏ÎûôÌä∏</code>Îäî ÏÇ¨Ïã§ ÏµúÍ∑ºÏóêÎäî ÏÇ¨Ïö© ÎπàÎèÑÍ∞Ä Ï§ÑÏñ¥Îì§Í≤å ÎêòÏóàÎäîÎç∞Ïöî. Í∑∏ÎüºÏóêÎèÑ Î∂àÍµ¨ÌïòÍ≥†, OpenSeaÏôÄ Í∞ôÏùÄ NFT MarketplaceÏóêÏÑú Î∞úÏÉùÌïú NFT Îß§Îß§ Í≥ºÏ†ïÏù¥ Ïò®Ï≤¥Ïù∏ ÏÉÅÏóê Ïñ¥ÎñªÍ≤å Í∏∞Î°ùÎêòÏñ¥ ÏûàÎäîÏßÄ Ï°∞ÌöåÌïòÍ∏∞Ïóê Ï¢ãÏùÄ ÏòàÏãúÎùºÍ≥† ÏÉùÍ∞ÅÌï©ÎãàÎã§.</p>

<p>Ï∞∏Í≥†Î°ú, OpenSeaÎäî Í≤ΩÎß§ Í≥ºÏ†ïÏùò Í∞Å ÌäπÏ†ï ÌñâÏúÑÍ∞Ä Î∞úÏÉùÌï† ÎïåÎßàÎã§ Îß§Î≤à Ïò®Ï≤¥Ïù∏ ÏÉÅÏóê Í∏∞Î°ùÌïòÎäî Í≤ÉÏù¥ ÏïÑÎãàÎùº, Ïò§ÌîÑÏ≤¥Ïù∏ ÏÉÅÏóêÏÑú ÏÑúÎ™ÖÏù¥ ÏôÑÎ£åÎêú Ìä∏ÎûúÏû≠ÏÖò Î©îÏãúÏßÄÎ•º Î≥¥Í¥ÄÌïòÍ≥† ÏûàÎã§Í∞Ä, ÌïúÍ∫ºÎ≤àÏóê Bulk Îã®ÏúÑÎ°ú Ïò®Ï≤¥Ïù∏ ÏÉÅÏóê Î©îÏãúÏßÄÎ•º Î∏åÎ°úÎìúÏ∫êÏä§Ìä∏ÌïòÎäî Î∞©ÏãùÏùÑ ÏÇ¨Ïö©ÌïòÍ≥§ Ìï©ÎãàÎã§. Ïù¥Îäî ÏµúÏ¢Ö ÏÇ¨Ïö©Ïûê Ï∏°Î©¥ÏóêÏÑú TX FeeÏùò Î∂ÄÎã¥ÏùÑ Ï§ÑÏó¨ ÏÇ¨ÏóÖÏùò P&amp;LÏùÑ ÏµúÏ†ÅÌôîÌïòÍ∏∞ ÏúÑÌïú ÏûëÏóÖÏúºÎ°ú Î≥¥Ïù¥ÏßÄÎßå, Î∏îÎ°ùÏ≤¥Ïù∏Ïùò Ìä∏Î¶¥Î†àÎßà Ìï≠Î™© Ï§ë ÌïòÎÇòÏù∏ ‚ÄúÌÉàÏ§ëÏïôÌôî‚Äù ÌõºÏÜê ÎÖºÎûÄÏùò Ïó¨ÏßÄÍ∞Ä ÏûàÏñ¥ Î≥¥Ïù¥Í∏∞ÎèÑ Ìï©ÎãàÎã§.</p>

<p>ÏùΩÏñ¥Ï£ºÏÖîÏÑú Í∞êÏÇ¨Ìï©ÎãàÎã§.</p>

<hr />

<h2 id="published-by-joshua-kim"><em>Published by</em> Joshua Kim</h2>
<p><img src="/assets/profile/joshua-profile.png" alt="Joshua Kim" /></p>]]></content><author><name></name></author><category term="korean" /><category term="blockchain" /><category term="on_chain_data" /><summary type="html"><![CDATA[ÏïàÎÖïÌïòÏÑ∏Ïöî. Ï†ÄÎäî Î∏îÎ°ùÏ≤¥Ïù∏ Í∏∞Î∞ò ÏÑúÎπÑÏä§ Í∏∞ÏóÖÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÏùÑ Îã¥ÎãπÌïòÍ≥† ÏûàÎäî JoshuaÎùºÍ≥† Ìï©ÎãàÎã§. Ïù¥Î≤à ÏïÑÌã∞ÌÅ¥ÏóêÏÑúÎäî OpenSeaÏóêÏÑú NFT TransferÍ∞Ä Î∞úÏÉùÌñàÏùÑ Îïå, EVM Í≥ÑÏó¥ Î∏îÎ°ùÏ≤¥Ïù∏Ïùò Ïò®Ï≤¥Ïù∏ ÏÉÅÏóê Îç∞Ïù¥ÌÑ∞Í∞Ä Ïñ¥Îñ§ Î™®ÏäµÏúºÎ°ú ÎÇ®ÏïÑ ÏûàÎäîÏßÄ ÌååÌó§Ï≥ê Î≥¥ÎèÑÎ°ù ÌïòÍ≤†ÏäµÎãàÎã§.]]></summary></entry><entry><title type="html">Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÏùò ÌååÏù¥Ïç¨ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Í∞úÎ∞úÍ∏∞ feat. pyinstaller</title><link href="http://localhost:4000/pyinstaller/" rel="alternate" type="text/html" title="Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÏùò ÌååÏù¥Ïç¨ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Í∞úÎ∞úÍ∏∞ feat. pyinstaller" /><published>2023-07-15T00:00:00+09:00</published><updated>2023-07-15T00:00:00+09:00</updated><id>http://localhost:4000/pyinstaller</id><content type="html" xml:base="http://localhost:4000/pyinstaller/"><![CDATA[<blockquote>
  <p>ÌååÏù¥Ïç¨ ÌååÏùºÏùÑ Ïã§ÌñâÌïòÍ∏∞ ÏúÑÌï¥ÏÑúÎäî ÌååÏù¥Ïç¨Ïùò High-level Ïñ∏Ïñ¥Î•º Low-levelÎ°ú Î≥ÄÌôòÌï¥Ï£ºÎäî <strong>Interpreter</strong>Í∞Ä ÌïÑÏöîÌïòÍ≥†, Îòê ÌååÏù¥Ïç¨ ÌååÏùº ÎÇ¥ÏóêÏÑú LoadÌï¥Ïïº ÌïòÎäî <strong>Î™®Îìà</strong> Ïó≠Ïãú Ìï®Íªò ÏÇ¨Ï†ÑÏóê ÏÑ§ÏπòÎêòÏñ¥Ïïº ÌïòÎäîÎç∞Ïöî.  <code class="language-plaintext highlighter-rouge">pyinstaller</code>Îäî Ïù¥Îü¨Ìïú InterpreterÏôÄ Î™®ÎìàÏùÑ Ìï®Íªò ÎèôÎ¥âÌïú Ï±ÑÎ°ú ÌååÏù¥Ïç¨ ÌååÏùºÏùÑ Ìå®ÌÇ§ÏßïÌïòÏó¨ ÌïòÎÇòÏùò Ïã§Ìñâ ÌååÏùºÎ°ú ÎßåÎì§Ïñ¥Ï£ºÎäî Ïó≠Ìï†ÏùÑ ÌïòÎäî Í≤ÉÏù¥Ï£†.</p>
</blockquote>

<h3 id="contents">CONTENTS</h3>
<ol>
  <li>Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÎ°ú ÏÇ¥ÏïÑÍ∞ÄÎ©∞</li>
  <li>ÎàÑÏõåÏÑú Îñ° Î®πÎìØ ÏóÖÎ¨¥ ÏûêÎèôÌôîÎ•º Í≤ΩÌóòÌïòÏã§ Ïàò ÏûàÎèÑÎ°ù ÌïòÎ†§Î©¥ Ïñ¥ÎñªÍ≤å Ìï¥Ïïº Ìï†ÍπåÏöî?</li>
  <li>ÌååÏù¥Ïç¨ ÏÑ§ÏπòÏôÄ Ïã§Ìñâ Î∞©Î≤ïÏùÑ Î™®Î•¥ÎçîÎùºÎèÑ <code class="language-plaintext highlighter-rouge">pyinstaller</code> ÌïòÎÇòÎ©¥ Î™®Îì† Í≤ÉÏù¥ Í∞ÄÎä•Ìï¥Ïöî!</li>
  <li><code class="language-plaintext highlighter-rouge">.ipynb</code> ÌååÏùºÏùÑ <code class="language-plaintext highlighter-rouge">.exe</code> ÌååÏùºÎ°ú ÎßåÎìúÎäî Î∞©Î≤ï</li>
  <li>Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÍ∞Ä Í∞ñÏ∂îÏñ¥Ïïº ÌïòÎäî Ï§ëÏöîÌïú ÌÉúÎèÑ, ‚ÄúÎñ†Î®πÏó¨ ÎìúÎ¶¨Í∏∞‚Äù</li>
</ol>

<hr />

<h1 id="1-Îç∞Ïù¥ÌÑ∞-Î∂ÑÏÑùÍ∞ÄÎ°ú-ÏÇ¥ÏïÑÍ∞ÄÎ©∞">1. Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÎ°ú ÏÇ¥ÏïÑÍ∞ÄÎ©∞</h1>

<p><img src="/assets/2023-07-15-pyinstaller/milk.png" alt="" /></p>

<p>Ï†ÄÎäî Î∏îÎ°ùÏ≤¥Ïù∏ ÏßÄÍ∞ë Í∏∞ÏóÖÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÎ°ú Í∑ºÎ¨¥ÌïòÍ≥† ÏûàÎäî JoshuaÎùºÍ≥† Ìï©ÎãàÎã§. ÏõêÎûò Ïù¥ ÏóÖÍ≥ÑÏóêÏÑú Îã§Î•∏ Ìè¨ÏßÄÏÖòÏúºÎ°ú Í∑ºÎ¨¥ÌïòÍ≥† ÏûàÏóàÏßÄÎßå, Î®∏Ïã†Îü¨ÎãùÍ≥º ÎπÖÎç∞Ïù¥ÌÑ∞Ïóê ÎåÄÌïú Ï≤úÎ™Ö(?)Í≥º Í∞ôÏùÄ ÍπäÏùÄ Ìù•ÎØ∏Î•º ÎäêÎÅºÍ≤å ÎêòÏñ¥ ÏßÅÏû•Í≥º AI ÎåÄÌïôÏõê ÏÉùÌôúÏùÑ 2ÎÖÑ ÎèôÏïà Î≥ëÌñâÌï¥ÏôîÎäîÎç∞Ïöî. Ï†ïÎßê Í∞êÏÇ¨ÌïòÍ≤åÎèÑ ÎåÄÌïôÏõêÏùÑ Ïûò Ï°∏ÏóÖÌïòÍ≥†, ÏßÄÍ∏à ÌöåÏÇ¨ÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞Ä Ìè¨ÏßÄÏÖòÏúºÎ°ú Í∑ºÎ¨¥ÌïòÍ≤å ÎêúÏßÄ 1ÎÖÑÏù¥ ÎÑòÏñ¥Í∞ÄÍ≥† ÏûàÏäµÎãàÎã§.</p>

<p>ÌõåÎ•≠ÌïòÏã†, Í∑∏Î¶¨Í≥† Ïù∏Í∞ÑÏ†ÅÏù∏ ÎèôÎ£å Î∂ÑÎì§Í≥º Ìï®Íªò Îß§Ïùº ÏπòÏó¥ÌïòÍ≤å ÌîÑÎ°úÎçïÌä∏Ïóê ÎåÄÌï¥ Í≥†ÎØºÌïòÍ≥† ÏûàÎäîÎç∞Ïöî. ÌäπÌûà, Ìïú Î∂Ñ, Ìïú Î∂ÑÍ≥º Ïù¥ÏïºÍ∏∞Î•º ÌïòÍ±∞ÎÇò ÌòëÏóÖÏùÑ ÌïòÎã§Î≥¥Î©¥ Ï†úÍ≤å ÎßéÏùÄ ÏûêÍ∑πÏùÑ ÏïåÍ≤å Î™®Î•¥Í≤å Ï£ºÏãúÍ∏∞ÎèÑ ÌïòÍ≥†, Ïä§Ïä§Î°úÎèÑ ÏÑ±Ïû• ÏöïÍµ¨Í∞Ä ÎÅäÏûÑ ÏóÜÏù¥ ÏùºÏñ¥ÎÇòÍ∏∞ÎèÑ ÌïúÎãµÎãàÎã§. (ÏûÖÏÇ¨ ÎãπÏãúÏóêÎèÑ Í∑∏Î†áÍ≥†, 1ÎÖÑÏù¥ ÏßÄÎÇú ÏßÄÍ∏àÎèÑ Í∑∏ Í∞êÏ†ïÏù¥ Ïò§Î°ØÏù¥ Ïú†ÏßÄÎêòÍ≥† ÏûàÏñ¥Ïöî.)</p>

<p><strong>Î®∏Î¶¨Î°ú Í∏∞ÏñµÌïòÍ≥† ÏûàÎäî ÏÑ†Î∞∞ ÎèôÎ£å Î∂ÑÎì§Ïùò Ïñ¥Î°ù Î™®Ïùå</strong></p>
<blockquote>
  <p>‚ÄúÏ°∞Í∏âÌïú ÎßàÏùåÏúºÎ°ú ÏóÖÎ¨¥Î•º ÌïòÍ≤å ÎêòÎ©¥ ÎÇòÏ§ëÏóê Ïñ¥Îñ§ Î™®ÏäµÏúºÎ°úÎì† ÏÇ¨Í≥†Í∞Ä ÎÇ† Ïàò ÏûàÎã§. Ìï≠ÏÉÅ Ï∞®Í∑ºÏ∞®Í∑º Í∏∞Ï¥àÏóê Ï∂©Ïã§ÌïòÎäî Í≤å Ï§ëÏöîÌï¥Ïöî.‚Äù
‚Äú3ÎÖÑ ÌõÑ, 5ÎÖÑ ÌõÑÏùò ÎØ∏ÎûòÎ•º Ï¢ÖÏ¢Ö Í∑∏Î†§Î≥¥Î©∞ Ïª§Î¶¨Ïñ¥ Î∞©Ìñ•ÏùÑ Ï†êÍ≤ÄÌï¥Î≥¥Îäî Í≤å ÎêòÍ≤å Ï§ëÏöîÌï¥Ïöî.‚Äù
‚ÄúÏ†ÄÎäî ÎÇòÏù¥Í∞Ä Îì§ÏàòÎ°ù ÎßêÏùÑ ÌïòÍ±∞ÎÇò Í∏ÄÏùÑ Ïì∞Îäî Îì± ÌëúÌòÑÌïòÎäî Í≤å Î∂ÄÎã¥Ïä§Îü¨ÏõåÏ†∏Ïöî. ÎÇ¥Í∞Ä ÏïåÍ≥† ÎäêÎÅºÎäî Í≤ÉÏù¥ ÌãÄÎ¶¥ ÏàòÎèÑ ÏûàÏúºÎãàÍπåÏöî.‚Äù</p>
</blockquote>

<p>Ïù¥Îü∞ ÎèôÎ£å Î∂ÑÎì§Í≥º Ìï®Íªò, Í∑∏Î¶¨Í≥† ÏÑ±Ïû• Í∞ÄÎä•ÏÑ±Ïù¥ Î¨¥Í∂ÅÎ¨¥ÏßÑÌïú Î∏îÎ°ùÏ≤¥Ïù∏ ÎèÑÎ©îÏù∏ ÏÜçÏóêÏÑú Îß§Ïùº Î∞§ Ïù¥Î∂àÏùÑ ÎçÆÏúºÎ©∞ ‚Äú<strong>ÎÇòÎäî Íº≠ ÏõîÎìú ÌÅ¥ÎûòÏä§Í∞Ä Îê† Í±∞Ïïº</strong>‚ÄùÎùºÎäî ÏÉùÍ∞ÅÏùÑ ÌïòÎ©∞ ÏßÄÎÇ¥Í≥† ÏûàÏñ¥Ïöî.</p>

<p>Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÏùò Î©îÏù∏ ÏóÖÎ¨¥Ïóê ÎåÄÌïú Ïù¥ÏïºÍ∏∞Îäî Îã§Ïùå ÏïÑÌã∞ÌÅ¥ÏóêÏÑú Îòê Ï†ÑÎã¨Ìï¥ÎìúÎ¶¨ÎèÑÎ°ù ÌïòÍ≥†, Ïò§ÎäòÏùÄ Ï°∞Í∏à Ìù¨Í∑ÄÌïú(?) Ïä§ÌÜ†Î¶¨Î•º Ï†ÑÎã¨Ìï¥ÎìúÎ¶¨Í≥†Ïûê Ìï©ÎãàÎã§.</p>

<p>Í∞ÄÎÅî Î™áÎ™á ÎèôÎ£å Î∂ÑÎì§Ïù¥ Ï†úÍ≤å Ïù¥Îü∞ ÎßêÏîÄÏùÑ ÌïòÏã§ ÎïåÍ∞Ä ÎßéÏïÑÏöî.</p>
<blockquote>
  <p>‚ÄúJoshuaÎãòÏùÄ Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÏù∏Îç∞ Ïôú Í∞úÎ∞úÏùÑ ÌïòÍ≥† Í≥ÑÏÑ∏Ïöî?‚Äù</p>
</blockquote>

<p>Í∑∏Îü¥ ÎïåÎßàÎã§ Ï†ÄÎäî Ïù¥Î†áÍ≤å ÎãµÎ≥Ä ÎìúÎ¶¨Í≥§ Ìï©ÎãàÎã§.</p>
<blockquote>
  <p>‚ÄúÏ†Ä.. Ï†ÄÎäî Îã®ÏßÄ Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂úÍ≥º Í∞ÄÍ≥µ ÎïåÎ¨∏Ïóê ÏΩîÎìúÎ•º ÏßúÍ≥† ÏûàÎäî Í±¥Îç∞Ïöî? Í∞úÎ∞ú Ïûò Î™∞ÎùºÏöî^^;;;;;‚Äù</p>
</blockquote>

<p>Î¨ºÎ°† ÏãúÍ∞ÑÏù¥ ÌùêÎ•¥Î©∞, ÌîÑÎ°†Ìä∏ÏóîÎìúÏôÄ Î∞±ÏóîÎìú Í∞úÎ∞úÎèÑ Îç∞Ïù¥ÌÑ∞ ÌÅ¨Î°§ÎßÅÍ≥º Í∞ÄÍ≥µÏùò ÌîÑÎ°úÏÑ∏Ïä§ÎèÑ ÏßÄÎãàÍ≥† ÏûàÏñ¥ÏÑú ÏÉÅÎãπÌûà Ïú†ÏÇ¨Ìïú ÏûëÏóÖÏù¥ ÎßéÎã§Îäî ÏÇ¨Ïã§ÏùÑ Ïù¥Ìï¥ÌïòÍ≤å ÎêòÏñ¥ ÏßÄÍ∏àÏùÄ ÏÇ¥Ïßù Ïù∏Ï†ïÏùÑ ÌïòÍ≥† ÏûàÏñ¥Ïöî. (Í∑∏ÎüºÏóêÎèÑ Î∂àÍµ¨ÌïòÍ≥† Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÏùÄ Í≤∞Ïù¥ Ï¢Ä Îã§Î•¥Îã§Íµ¨Ïöî!üòÜ)</p>

<p>ÏïÑÎ¨¥Ìäº, Ïù¥Î≤à ÏïÑÌã∞ÌÅ¥ÏóêÏÑú Ï†úÍ∞Ä Ï†ÑÎã¨Ìï¥ÎìúÎ¶¨Î†§Îäî ÎÇ¥Ïö©ÏùÄ ‚Äú<strong>Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÎ°úÏÑú Î∞òÎìúÏãú Ïïå ÌïÑÏöîÎäî ÏóÜÎäî, Í∑∏Î†áÏßÄÎßå ÏïåÏïÑÎëêÎ©¥ Ïû¨ÎØ∏ÏûàÍ≥† Ïì∏Î™® ÏûàÎäî ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Í∞úÎ∞ú ÌõÑÍ∏∞</strong>‚ÄùÏûÖÎãàÎã§!</p>

<p>Í≥∞Í≥∞Ïù¥ ÏÉùÍ∞ÅÌï¥Î≥¥Î©¥, ÌòÑ ÌöåÏÇ¨ÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÎ°úÏÑú Day-to-day ResponsibilitiesÍ∞Ä ÌÅ¨Í≤å  <strong>Î©îÏù∏ ÏóÖÎ¨¥</strong>ÏôÄ  <strong>ÏÑúÎ∏å ÏóÖÎ¨¥</strong>  Îëê Í∞ÄÏßÄÎ°ú Ïπ¥ÌÖåÍ≥†Î¶¨ÌôîÎêòÎäî Í≤É Í∞ôÏïÑÏöî.</p>

<p><strong>| Î©îÏù∏ ÏóÖÎ¨¥</strong></p>
<ul>
  <li>ÌïµÏã¨ ÏßÄÌëú Î™®ÎãàÌÑ∞ÎßÅÏùÑ ÏúÑÌïú ÎåÄÏãúÎ≥¥Îìú ÏÉùÏÑ± Î∞è Í¥ÄÎ¶¨</li>
  <li>Ad-hoc Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù</li>
  <li>A/B ÌÖåÏä§Ìä∏ Í≤∞Í≥º Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù</li>
  <li>Ïù¥Î≤§Ìä∏ Î°úÍ∑∏ Ïä§ÌÇ§Îßà Ï†ïÏùò</li>
</ul>

<p><strong>| ÏÑúÎ∏å ÏóÖÎ¨¥</strong></p>
<ul>
  <li>API ÌÅ¨Î°§ÎßÅÏùÑ ÌÜµÌïú ÏãúÏû• Îç∞Ïù¥ÌÑ∞ ÏàòÏßë ÌõÑ Î∂ÑÏÑù</li>
  <li>Î∏îÎ°ùÏ≤¥Ïù∏ Ïò®Ï≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë ÌõÑ Î∂ÑÏÑù</li>
  <li>Î∏îÎ°ùÏ≤¥Ïù∏ Î©îÏù∏ÎÑ∑ Î¶¨ÏÑúÏπò</li>
  <li>Í∏∞ÌÉÄ Îì±Îì±</li>
</ul>

<p>ÌäπÌûà  <strong>ÏÑúÎ∏å ÏóÖÎ¨¥</strong>Îäî Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÎ°úÏÑú Must-have ÏóÖÎ¨¥Í∞Ä ÏïÑÎãê Ïàò ÏûàÏßÄÎßå, Ï†ÄÎäî Í∞úÏù∏Ï†ÅÏúºÎ°ú ÏÑúÎ∏å ÏóÖÎ¨¥Î•º Ìï®ÏúºÎ°úÏç® ÌöåÏÇ¨Ïùò ÏÇ¨ÏóÖ Ï†ÑÎûµÍ≥º ÌîÑÎ°úÎçïÌä∏Ïóê ÎåÄÌïú Domain KnowledgeÎ•º ÌÇ§ÏõåÍ∞à Ïàò ÏûàÎäî Îß§Ïö∞ Í∞íÏßÑ Í≤ΩÌóòÏù¥ÎùºÍ≥† ÏÉùÍ∞ÅÌïòÎäîÎç∞Ïöî.</p>

<p>ÏµúÍ∑ºÏóêÎäî ÏÇ¨ÎÇ¥ Ïû¨Î¨¥ÌåÄ Î∂ÑÎì§ÏùÑ ÏúÑÌï¥ ÎÇ¥Î∂ÄÏö© ÌååÏù¥Ïç¨ ÏóÖÎ¨¥ ÏûêÎèôÌôî ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏Î•º Í∞úÎ∞úÌïòÏó¨ Î∞∞Ìè¨ÌïòÎäî Í≥ºÏ†ïÏùÑ Í≤™ÏúºÎ©∞, Ïû¨Î¨¥ÌåÄ ÎèôÎ£å Î∂ÑÎì§Ïù¥ Ïñ¥Îñ§ Í≥†ÎØºÏùÑ ÌïòÏãúÎäîÏßÄ, Í∑∏Î¶¨Í≥† Ïñ¥Îñ§ Î™©ÌëúÏôÄ Ïó≠Ìï†ÏùÑ ÏúÑÌï¥ ÏµúÏÑ†ÏùÑ Îã§ÌïòÍ≥† Í≥ÑÏãúÎäîÏßÄ ÏßÑÎìùÌïòÍ≤å Ïù¥Ìï¥Ìï† Ïàò ÏûàÏóàÏñ¥Ïöî.</p>

<h1 id="2-ÎàÑÏõåÏÑú-Îñ°-Î®πÎìØ-ÏóÖÎ¨¥-ÏûêÎèôÌôîÎ•º-Í≤ΩÌóòÌïòÏã§-Ïàò-ÏûàÎèÑÎ°ù-ÌïòÎ†§Î©¥-Ïñ¥ÎñªÍ≤å-Ìï¥Ïïº-Ìï†ÍπåÏöî">2. ÎàÑÏõåÏÑú Îñ° Î®πÎìØ ÏóÖÎ¨¥ ÏûêÎèôÌôîÎ•º Í≤ΩÌóòÌïòÏã§ Ïàò ÏûàÎèÑÎ°ù ÌïòÎ†§Î©¥ Ïñ¥ÎñªÍ≤å Ìï¥Ïïº Ìï†ÍπåÏöî?</h1>

<p><img src="/assets/2023-07-15-pyinstaller/i-dont-know-why.png" alt="" /></p>

<p>ÌöåÏÇ¨ ÎÇ¥Î∂ÄÏö© Î™©Ï†ÅÏóê ÎåÄÌï¥ Í≥µÍ∞úÌï† ÏàòÎäî ÏóÜÏßÄÎßå, Ïû¨Î¨¥ÌåÄ ÏóÖÎ¨¥Ïãú Îß§Îâ¥ÏñºÌïòÍ≤å Îç∞Ïù¥ÌÑ∞Î•º ÌôïÏù∏ÌïòÎäî Í≤ÉÏù¥ Í±∞Ïùò Î∂àÍ∞ÄÎä•Ìïú ÏóÖÎ¨¥ Ìè¨Ïù∏Ìä∏Í∞Ä ÏûàÏóàÎäîÎç∞Ïöî. Í∑∏ Î∂ÄÎ∂ÑÏùÑ APIÎ•º ÌÜµÌï¥ ÌÅ¨Î°§ÎßÅÌï† Ïàò ÏûàÎèÑÎ°ù ÌååÏù¥Ïç¨ Î™®ÎìàÏùÑ ÎßåÎì§ Ïàò ÏûàÍ≤†Îã§Îäî ÏÉùÍ∞ÅÏù¥ Îì§ÏóàÏñ¥Ïöî.</p>

<p>ÌååÏù¥Ïç¨ ÌÅ¨Î°§Îü¨ ÏûêÏ≤¥Î•º ÎßåÎìúÎäî Í≤ÉÏùÄ Ïñ¥Î†§Ïö¥ ÏùºÏù¥ ÏïÑÎãàÏóàÏßÄÎßå, ÌååÏù¥Ïç¨ Ïã§Ìñâ ÌôòÍ≤ΩÏóê ÎåÄÌï¥ ÏÉùÍ∞ÅÌï¥Î≥¥Îãà Í≥†ÎØºÏù¥ ÏÉùÍ≤ºÏñ¥Ïöî.</p>
<blockquote>
  <p>‚ÄúÎç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÏôÄ Î∞±ÏóîÎìú Í∞úÎ∞úÏûêÏóêÍ≤åÎäî ÌååÏù¥Ïç¨ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏Î•º ÏÑ§ÏπòÌïòÍ≥†, ÎÖ∏Ìä∏Î∂Å ÏÉÅÏóêÏÑú ÏΩîÎìúÎ•º Ïã§ÌñâÌïòÍ±∞ÎÇò Î™ÖÎ†π ÌîÑÎ°¨ÌîÑÌä∏ ÏÉÅÏóêÏÑú ÌååÏù¥Ïç¨ÏùÑ Ïã§ÌñâÌïòÎäî Í≤å ÎÑàÎ¨¥ÎÇòÎèÑ ÏùµÏàôÌïú ÏùºÏù∏Îç∞, Ïù¥Í≤å Í≥ºÏó∞ Ïû¨Î¨¥ÌåÄ Î∂ÑÎì§ÍªòÎèÑ ÏùµÏàôÌïú ÏùºÏùºÍπå?‚Äù</p>
</blockquote>

<p>Î¨ºÎ°†, ÏóÖÎ¨¥ ÏûêÎèôÌôîÎ°ú Ïù∏Ìïú ÏãúÍ∞Ñ Ï†àÍ∞ê Ìö®Í≥ºÍ∞Ä ÌååÏù¥Ïç¨ Ïã§Ìñâ ÌôòÍ≤Ω Ï†ÅÏùë ÏãúÍ∞ÑÎ≥¥Îã§ Ìõ®Ïî¨ ÌÅ¨Îã§Î©¥ ÌÅ∞ Î¨∏Ï†úÍ∞Ä ÎêòÏßÄÎäî ÏïäÍ≤†ÏßÄÎßå, Í∑∏ÎüºÏóêÎèÑ Î∂àÍµ¨ÌïòÍ≥†  <code class="language-plaintext highlighter-rouge">CX(Colleague Experience?)</code>Î•º Í≥†Î†§Ìïú ÏóÖÎ¨¥ ÏûêÎèôÌôî ÌôòÍ≤ΩÏùÑ Ï†úÍ≥µÌï¥ÎìúÎ¶¨Í≥† Ïã∂ÏóàÍ±∞Îì†Ïöî.</p>

<h1 id="3-ÌååÏù¥Ïç¨-ÏÑ§ÏπòÏôÄ-Ïã§Ìñâ-Î∞©Î≤ïÏùÑ-Î™®Î•¥ÎçîÎùºÎèÑ-pyinstaller-ÌïòÎÇòÎ©¥-Î™®Îì†-Í≤ÉÏù¥-Í∞ÄÎä•Ìï¥Ïöî">3. ÌååÏù¥Ïç¨ ÏÑ§ÏπòÏôÄ Ïã§Ìñâ Î∞©Î≤ïÏùÑ Î™®Î•¥ÎçîÎùºÎèÑ <code class="language-plaintext highlighter-rouge">pyinstaller</code> ÌïòÎÇòÎ©¥ Î™®Îì† Í≤ÉÏù¥ Í∞ÄÎä•Ìï¥Ïöî!</h1>

<p>Í∞úÎ∞úÏûê ÏπúÍµ¨ÏóêÍ≤å Ïù¥ Í≥†ÎØºÏùÑ ÌÑ∏Ïñ¥ÎÜìÍ∏∞ÎèÑ ÌïòÍ≥†, Í∞úÏù∏Ï†ÅÏúºÎ°ú Íµ¨Í∏ÄÎßÅÏùÑ ÌïòÎ©¥ÏÑú ÏïåÍ≤å Îêú Í≤ÉÏùÄ Î∞îÎ°ú  <strong>Python Executable File</strong>Ïù¥ÎùºÎäî Í∞úÎÖêÏù¥ÏóàÏñ¥Ïöî. Ï¶â, ÌååÏù¥Ïç¨ ÌôòÍ≤ΩÏùÑ Íµ¨Ï∂ïÌïòÏßÄ ÏïäÍ≥†, ÌòπÏùÄ Î™ÖÎ†π ÌîÑÎ°¨ÌîÑÌä∏ Í∞ôÏùÄ ÌôîÏÑ± Í∞ôÏùÄ ÌôòÍ≤ΩÏùÑ Í≤ΩÌóòÌïòÏßÄ ÏïäÍ≥†ÎèÑ, <code class="language-plaintext highlighter-rouge">.exe</code> ÌôïÏû•ÏûêÏùò ÌååÏùº ÏûêÏ≤¥Î•º ÌÅ¥Î¶≠ÌïòÎäî Í≤ÉÎßåÏúºÎ°ú ÏóÖÎ¨¥ ÏûêÎèôÌôîÍ∞Ä ÏßÑÌñâÎêòÎäî Ïã§Ìñâ ÌååÏùºÏùÑ ÎßåÎìúÎäî Î∞©Î≤ïÏù∏ Í≤ÉÏù¥Ï£†.</p>

<p><img src="/assets/2023-07-15-pyinstaller/infinite-challenge.jpeg" alt="" /></p>

<p>Ï†ïÎßê Í∞êÏÇ¨ÌïòÍ≤åÎèÑ, ÌååÏù¥Ïç¨ÏóêÎäî  <code class="language-plaintext highlighter-rouge">pyinstaller</code>ÎùºÎäî Î™®ÎìàÏù¥ ÏûàÏñ¥Ïöî.</p>

<p><a href="https://pyinstaller.org/en/stable/">PyInstaller Manual</a>Ïóê Îî∞Î•¥Î©¥,  <code class="language-plaintext highlighter-rouge">pyinstaller</code>Îäî Python Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò Î∞è Ïã§ÌñâÏóê ÌïÑÏöîÌïú Î™®Îì† ÌôòÍ≤ΩÏùÑ ÌïòÎÇòÏùò Ìå®ÌÇ§ÏßÄÎ°ú Î¨∂Ïñ¥Ï§åÏúºÎ°úÏç®, ÏÇ¨Ïö©ÏûêÍ∞Ä Python InterpreterÎÇò Î™®ÎìàÏùÑ ÏÑ§ÏπòÌïòÏßÄ ÏïäÍ≥† Ìå®ÌÇ§ÏßÄ ÏûêÏ≤¥Î•º Ïã§ÌñâÌï† Ïàò ÏûàÎèÑÎ°ù Ìï¥Ï£ºÎäî Ïú†Ìã∏Î¶¨Ìã∞ÏûÖÎãàÎã§.</p>

<p>ÌååÏù¥Ïç¨ ÌååÏùºÏùÑ Ïã§ÌñâÌïòÍ∏∞ ÏúÑÌï¥ÏÑúÎäî ÌååÏù¥Ïç¨Ïùò High-level Ïñ∏Ïñ¥Î•º Low-levelÎ°ú Î≥ÄÌôòÌï¥Ï£ºÎäî <strong>Interpreter</strong>Í∞Ä ÌïÑÏöîÌïòÍ≥†, Îòê ÌååÏù¥Ïç¨ ÌååÏùº ÎÇ¥ÏóêÏÑú LoadÌï¥Ïïº ÌïòÎäî <strong>Î™®Îìà</strong> Ïó≠Ïãú Ìï®Íªò ÏÇ¨Ï†ÑÏóê ÏÑ§ÏπòÎêòÏñ¥Ïïº ÌïòÎäîÎç∞Ïöî.  <code class="language-plaintext highlighter-rouge">pyinstaller</code>Îäî Ïù¥Îü¨Ìïú InterpreterÏôÄ Î™®ÎìàÏùÑ Ìï®Íªò ÎèôÎ¥âÌïú Ï±ÑÎ°ú ÌååÏù¥Ïç¨ ÌååÏùºÏùÑ Ìå®ÌÇ§ÏßïÌïòÏó¨ ÌïòÎÇòÏùò Ïã§Ìñâ ÌååÏùºÎ°ú ÎßåÎì§Ïñ¥Ï£ºÎäî Ïó≠Ìï†ÏùÑ ÌïòÎäî Í≤ÉÏù¥Ï£†.</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/0*uKgfsMJQvUG5okP2.jpg" alt="" /></p>

<h1 id="4-ipynb-ÌååÏùºÏùÑ-exe-ÌååÏùºÎ°ú-ÎßåÎìúÎäî-Î∞©Î≤ï">4. <code class="language-plaintext highlighter-rouge">.ipynb</code> ÌååÏùºÏùÑ <code class="language-plaintext highlighter-rouge">.exe</code> ÌååÏùºÎ°ú ÎßåÎìúÎäî Î∞©Î≤ï</h1>

<p>Ïö∞ÏÑ† ÏóÖÎ¨¥ ÏûêÎèôÌôîÏóê ÌïÑÏöîÌïú ÌååÏù¥Ïç¨ ÏΩîÎìúÎ•º Jupyter NotebookÏúºÎ°ú ÏôÑÏÑ±ÏùÑ Ìï©ÎãàÎã§.</p>

<p><img src="/assets/2023-07-15-pyinstaller/step01.webp" alt="" /></p>

<p>ÏÇ¨Ïö©ÏûêÍ∞Ä ÏûÖÎ†•Ìïú Ï†ïÏàòÏùò Ï†úÍ≥±Í∞íÏùÑ Î¶¨ÌÑ¥Ìï¥Ï£ºÎäî Í∑ÄÏó¨Ïö¥ ÏΩîÎìúÎ•º Ï†ÅÏñ¥Î¥§Ïñ¥Ïöî.</p>

<p><code class="language-plaintext highlighter-rouge">.ipynb</code>ÏùÑ <code class="language-plaintext highlighter-rouge">.py</code> ÌòïÏãùÏùò ÌååÏùºÎ°ú Î≥ÄÌôòÌïòÏó¨ Îã§Ïö¥Î°úÎìúÌï©ÎãàÎã§.</p>

<p><img src="/assets/2023-07-15-pyinstaller/step02.webp" alt="" /></p>

<p>ÏõêÌïòÎäî Í≤ΩÎ°úÏóê .py ÌååÏùºÏùÑ Ïù¥ÎèôÌï¥Ï§çÎãàÎã§.</p>

<p><img src="/assets/2023-07-15-pyinstaller/step03.webp" alt="" /></p>

<p>Ïù¥Ï†ú  <code class="language-plaintext highlighter-rouge">pyinstaller</code>  Î™®ÎìàÏùÑ ÏÑ§ÏπòÌïòÍ∏∞ ÏúÑÌï¥ Î™ÖÎ†π ÌîÑÎ°¨ÌîÑÌä∏Î•º Ïã§ÌñâÌï©ÎãàÎã§. (Anaconda Powershell PromptÎÇò Anaconda PromptÍ∞Ä ÏïÑÎãå, Windows ÏûêÏ≤¥Ïùò Command PromptÎ•º ÏùòÎØ∏Ìï¥Ïöî.)</p>

<p><img src="/assets/2023-07-15-pyinstaller/step04.webp" alt="" /></p>

<p><code class="language-plaintext highlighter-rouge">pyinstaller</code>  Î™®Îìà ÏÑ§ÏπòÎ•º ÏúÑÌï¥  <code class="language-plaintext highlighter-rouge">pip install pyinstaller</code>  Î™ÖÎ†πÏñ¥Î•º ÏûÖÎ†•Ìï¥Ï§çÎãàÎã§.</p>

<p><img src="/assets/2023-07-15-pyinstaller/step05.webp" alt="" /></p>

<p>Ïù¥Ï†ú Î™ÖÎ†π ÌôòÍ≤ΩÏùÑ <code class="language-plaintext highlighter-rouge">.py</code> ÌååÏùºÏù¥ Î≥¥Í¥ÄÎêòÏñ¥ ÏûàÎäî ÎîîÎ†âÌÜ†Î¶¨Î°ú Î≥ÄÍ≤ΩÌï¥Ï§çÎãàÎã§.</p>

<p><img src="/assets/2023-07-15-pyinstaller/step06.webp" alt="" /></p>

<p><code class="language-plaintext highlighter-rouge">pyinstaller --onefile joshua_pyinstaller_practice.py</code>  Î™ÖÎ†πÏñ¥Î•º ÌÜµÌï¥ Ìå®ÌÇ§ÏßïÏùÑ ÏãúÏûëÌï©ÎãàÎã§. (onefileÏùÄ ÌïòÎÇòÏùò ÌååÏùºÎ°ú Ìå®ÌÇ§ÏßïÌï¥Ï§òÏïº Ìï®ÏùÑ ÏùòÎØ∏Ìï¥Ïöî!)</p>

<p><img src="/assets/2023-07-15-pyinstaller/step07.webp" alt="" /></p>

<p>Í∑∏Îü∞Îç∞ Í∞ÄÎÅî(ÏïÑÎãà Îß§Ïö∞ ÏûêÏ£º), ÏïàÌÉÄÍπùÍ≤åÎèÑ ÌîÑÎ°¨ÌîÑÌä∏Í∞Ä  <code class="language-plaintext highlighter-rouge">pyinstaller</code>ÎùºÎäî Î™ÖÎ†πÏñ¥Î•º Ï†úÎåÄÎ°ú Ïù¥Ìï¥ÌïòÏßÄ Î™ªÌïòÎäî Í≤ΩÏö∞Í∞Ä Î∞úÏÉùÌï¥Ïöî. Ïù¥ Í≤ΩÏö∞, ÎåÄÎ∂ÄÎ∂Ñ ÏãúÏä§ÌÖú ÌôòÍ≤Ω Î≥ÄÏàòÎ•º ÌîÑÎ°¨ÌîÑÌä∏Í∞Ä Î™®Î•¥Í∏∞ ÎïåÎ¨∏Ïóê Î∞úÏÉùÌï©ÎãàÎã§.</p>

<p>Windows Task BarÏùò Í≤ÄÏÉâÏ∞ΩÏóêÏÑú <code class="language-plaintext highlighter-rouge">Environment Variables</code>Î•º Í≤ÄÏÉâÌïòÏó¨ ÏãúÏä§ÌÖú ÌôòÍ≤Ω Î≥ÄÏàò Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄÎ•º Ïã§ÌñâÌï©ÎãàÎã§.</p>

<p><img src="/assets/2023-07-15-pyinstaller/step08.webp" alt="" /></p>

<p>Advanced ÌÉ≠ ÎÇ¥Ïùò Environment Variables Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠Ìï©ÎãàÎã§.</p>

<p><img src="/assets/2023-07-15-pyinstaller/step09.webp" alt="" /></p>

<p>User variablesÏùò NewÎ•º ÌÅ¥Î¶≠Ìï©ÎãàÎã§.</p>

<p><img src="/assets/2023-07-15-pyinstaller/step10.webp" alt="" /></p>

<p>Ïû†Ïãú ÌôÄÎìúÌïòÍ≥†, ÌååÏù¥Ïç¨Ïù¥ ÏÑ§ÏπòÎêòÏñ¥ ÏûàÎäî Í≤ΩÎ°úÎ•º ÌôïÏù∏Ìï¥Ïïº Ìï¥Ïöî. Ï¶â, ÌååÏù¥Ïç¨Ïùò Scripts Ìè¥ÎçîÎ•º Ï∞æÏïÑÏïº ÌïòÎäîÎç∞Ïöî. Î≥¥ÌÜµ  <code class="language-plaintext highlighter-rouge">Users\AppData\Local\Programs\Python\Python311</code>  Í≤ΩÎ°úÏóê Scripts Ìè¥ÎçîÍ∞Ä ÏûàÏñ¥Ïöî.</p>

<p><img src="/assets/2023-07-15-pyinstaller/step11.webp" alt="" /></p>

<p>Í≤ΩÎ°úÎ•º PATH Ïù¥Î¶ÑÏúºÎ°ú ÌôòÍ≤Ω Î≥ÄÏàò Î¶¨Ïä§Ìä∏Ïóê Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî.</p>

<p><img src="/assets/2023-07-15-pyinstaller/step12.webp" alt="" /></p>

<p><img src="/assets/2023-07-15-pyinstaller/step13.webp" alt="" /></p>

<p>Ïù¥Îü∞ ÌôòÍ≤Ω ÏÑ§Ï†ïÏù¥ ÎÑàÎ¨¥ Ïñ¥Î†µÎã§Î©¥, ÏÇ¨Ïã§  <a href="https://www.python.org/downloads/">Python3 Setup ÌååÏùº</a>ÏùÑ Îã§Ïãú Îã§Ïö¥Î°úÎìúÌïòÏó¨ ModifyÌïòÎäî Î∞©Î≤ïÏù¥ ÏûàÏñ¥Ïöî. Í∑∏Îüº ÏûêÎèôÏúºÎ°ú ÌôòÍ≤Ω Î≥ÄÏàò ÏÑ∏ÌåÖÏùÑ ÏôÑÎ£åÌï¥Ï£ºÍ±∞Îì†Ïöî.</p>

<p><img src="/assets/2023-07-15-pyinstaller/step14.webp" alt="" /></p>

<p>ModifyÎ•º ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî.</p>

<p>pip Ï≤¥ÌÅ¨ Ïó¨Î∂ÄÎ•º Î∞òÎìúÏãú ÌôïÏù∏Ìïú ÌõÑ Next Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠Ìï©ÎãàÎã§.</p>

<p><img src="/assets/2023-07-15-pyinstaller/step15.webp" alt="" /></p>

<p>pipÏùÑ Íº≠ Ï≤¥ÌÅ¨Ìï¥Ï£ºÏÑ∏Ïöî.</p>

<p>Add Python to environment variablesÎ•º Íº≠ Ï≤¥ÌÅ¨ ÌõÑ InstallÏùÑ ÏßÑÌñâÌï¥Ï£ºÏÑ∏Ïöî.</p>

<p><img src="/assets/2023-07-15-pyinstaller/step16.webp" alt="" /></p>

<p>Í∑∏Îü∞ ÌõÑ, Add Python to environment variablesÎ•º Î∞òÎìúÏãú Ï≤¥ÌÅ¨Ìï¥Ï£ºÏÑ∏Ïöî.</p>

<p>Ïûê Ïù¥Ï†ú Îã§Ïãú,  <code class="language-plaintext highlighter-rouge">pyinstaller</code>  Ìå®ÌÇ§ÏßïÏùÑ ÏãúÏûëÌï©ÎãàÎã§.</p>

<p><img src="/assets/2023-07-15-pyinstaller/step17.webp" alt="" /></p>

<p>ÎìúÎîîÏñ¥ ÏÑ±Í≥µÌñàÍµ∞Ïöî! üëè</p>

<p><img src="/assets/2023-07-15-pyinstaller/step18.webp" alt="" /></p>

<p><code class="language-plaintext highlighter-rouge">.py</code> ÌååÏùºÏù¥ Î≥¥Í¥ÄÎêòÏñ¥ ÏûàÎäî Í≤ΩÎ°úÎ•º Ï∞æÏïÑÍ∞ÄÎ≥¥Î©¥, ÏÉàÎ°úÏö¥ Ìè¥ÎçîÏôÄ ÌååÏùºÎì§Ïù¥ ÏÉùÏÑ±Îêú Í≤ÉÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§. Ïù¥ Ï§ë, Ïö∞Î¶¨Í∞Ä Î∞∞Ìè¨Ìï¥Ïïº Ìï† Ïã§Ìñâ ÌååÏùºÏùÄ <code class="language-plaintext highlighter-rouge">dist</code> Ìè¥ÎçîÏóê ÏûàÏúºÎãà, <code class="language-plaintext highlighter-rouge">dist</code> Ìè¥ÎçîÎ•º ÌÅ¥Î¶≠Ìï©ÎãàÎã§.</p>

<p><img src="/assets/2023-07-15-pyinstaller/step19.webp" alt="" /></p>

<p><code class="language-plaintext highlighter-rouge">.exe</code> ÌååÏùºÏù¥ ÏÉùÏÑ±Ïù¥ Îêú Í≤ÉÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§. Ìïú Î≤à Ïã§ÌñâÌï¥Î≥ºÍπåÏöî?</p>

<p><img src="/assets/2023-07-15-pyinstaller/step20.webp" alt="" /></p>

<p>Ïûò Ïã§ÌñâÎêòÎÑ§Ïöî!üòÉ</p>

<p><img src="/assets/2023-07-15-pyinstaller/step21.webp" alt="" /></p>

<p><img src="/assets/2023-07-15-pyinstaller/congratulations.jpeg" alt="" /></p>

<p>Ïù¥Ï†ú ÎßàÏπò ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÌòïÌÉúÎ°ú <code class="language-plaintext highlighter-rouge">.exe</code> ÌååÏùºÎßå Î∞∞Ìè¨ÌïòÎ©¥, ÌååÏù¥Ïç¨ ÌôòÍ≤Ω ÏÑ§ÏπòÏóê ÎåÄÌïú Î∂ÄÎã¥ ÏóÜÏù¥ÎèÑ ÎàÑÍµ¨ÎÇò Ìé∏Î¶¨ÌïòÍ≤å ÏõêÌÅ¥Î¶≠ ÏóÖÎ¨¥ ÏûêÎèôÌôîÎ•º ÎàÑÎ¶¥ Ïàò ÏûàÎãµÎãàÎã§!</p>

<h1 id="5--Îç∞Ïù¥ÌÑ∞-Î∂ÑÏÑùÍ∞ÄÍ∞Ä-Í∞ñÏ∂îÏñ¥Ïïº-ÌïòÎäî-Ï§ëÏöîÌïú-ÌÉúÎèÑ-Îñ†Î®πÏó¨-ÎìúÎ¶¨Í∏∞">5.  Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÍ∞Ä Í∞ñÏ∂îÏñ¥Ïïº ÌïòÎäî Ï§ëÏöîÌïú ÌÉúÎèÑ, ‚ÄúÎñ†Î®πÏó¨ ÎìúÎ¶¨Í∏∞‚Äù</h1>

<p><img src="/assets/2023-07-15-pyinstaller/feeding.png" alt="" /></p>

<p>Ï†úÍ∞Ä ÌöåÏÇ¨ÏóêÏÑú ÎèôÎ£å Î∂ÑÎì§Íªò Î∞ò ÎÜçÎã¥, Î∞ò ÏßÑÎã¥ÏúºÎ°ú ÎßêÏîÄ ÎìúÎ¶¨Îäî Ïä¨Î°úÍ±¥Ïù¥ ÏûàÎäîÎç∞Ïöî. Î∞îÎ°ú ‚Äú<code class="language-plaintext highlighter-rouge">Îñ†Î®πÏó¨ ÎìúÎ¶¥Í≤åÏöî</code>‚ÄùÎùºÎäî ÌëúÌòÑÏûÖÎãàÎã§.</p>

<p>Îç∞Ïù¥ÌÑ∞Îäî Îäò Ïñ¥Î†µÍ≥†, ÌïµÏã¨ÏùÑ Íø∞Îö´Ïù¥Îäî ÎçîÏö± Ïñ¥Î†§Ïö¥ Í≤É Í∞ôÏïÑÏöî. Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÏóêÍ≤åÎèÑ Îäò Ïñ¥Î†§Ïö¥ ÏùºÏù∏Îç∞, Îã§Î•∏ ÎèôÎ£å Î∂ÑÎì§ÍªòÎäî ÏñºÎßàÎÇò Îçî Ïñ¥Î†§Ïö∏ÍπåÏöî.</p>

<p><strong>Îç∞Ïù¥ÌÑ∞ ÎìúÎ¶¨Î∏ê Î¨∏Ìôî</strong>Î•º ÏúÑÌï¥ Ìï®Íªò Îç∞Ïù¥ÌÑ∞Î•º F/UPÌï¥Ïïº ÌïòÎäî ÎèôÎ£å Î∂ÑÎì§Ïùò Î∂ÄÎã¥ÏùÑ Ï°∞Í∏àÏù¥ÎùºÎèÑ Ï§ÑÏó¨ÎìúÎ¶¨Îäî SoftÌïú Ïó≠ÎüâÏù¥ Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÏóêÍ≤å ÏöîÍµ¨ÎêòÍ∏∞ ÎïåÎ¨∏Ïóê, Îñ†Î®πÏó¨ ÎìúÎ¶¨Í∏∞ ÏúÑÌïú ÎÖ∏Î†•ÏùÑ ÏßÄÏÜçÏ†ÅÏúºÎ°ú Ïã§Ï≤úÌïòÎäî Í≤ÉÏù¥ Ï†ïÎßê Ï§ëÏöîÌïòÎã§Í≥† ÏÉùÍ∞ÅÌïòÎäîÎç∞Ïöî. Í∞ÄÎßåÌûà ÎàÑÏõåÏÑú ÏûÖÎßå Î≤åÎ¶¨Í≥† Í≥ÑÏÖîÎèÑ Îñ†Î®πÏó¨ ÎìúÎ¶¥ Ïàò ÏûàÎäî, Í∑∏Îü∞ Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÍ∞Ä ÎêòÎäî Í≤ÉÏù¥ Ï†úÍ≤åÎäî Midterm Î™©ÌëúÍ∞Ä Îêú Í≤É Í∞ôÏäµÎãàÎã§.</p>

<p>Ïù¥Îü∞ ÏùòÎØ∏ÏóêÏÑú Ïù¥Î≤à ÌååÏù¥Ïç¨ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Í∞úÎ∞úÍ∏∞Îäî Îã®ÏàúÌïú Í∞úÎ∞úÍ∏∞ Ïù¥ÏÉÅÏúºÎ°ú, Îç∞Ïù¥ÌÑ∞Î•º ÏóÖÎ¨¥Ïóê Îπ†Î•¥Í≤å Î∞òÏòÅÌïòÏó¨ Pain PointÎ•º ÏÜêÏâΩÍ≤å Ìï¥Í≤∞Ìï¥ÎìúÎ¶¨Í≥†Ïûê ÎÖ∏Î†•Ìï¥Î≥∏ Ï†ÄÏùò ‚Äú<code class="language-plaintext highlighter-rouge">Îñ†Î®πÏó¨ ÎìúÎ¶¥Í≤åÏöî</code>‚Äù ÌîÑÎ°úÏ†ùÌä∏ Ï§ë ÌïòÎÇòÏòÄÏäµÎãàÎã§.</p>

<p>Îñ†Î®πÏó¨ ÎìúÎ¶¨Í∏∞ÎèÑ ÌïòÍ≥†, Ï†Ä ÎòêÌïú Í∑ÄÏ§ëÌïú ÏÑúÎ∏å ÏßÄÏãùÎì§ÏùÑ Ìï®ÏñëÌï† Ïàò ÏûàÏóàÎçò Í≤É Í∞ôÏïÑÏÑú Ï∞∏ ÎøåÎìØÌïòÍ∏∞ÎèÑ ÌñàÏñ¥Ïöî. ÏïûÏúºÎ°ú Îòê Ïñ¥Îñ§  <strong>ÏÑúÎ∏å ÏóÖÎ¨¥</strong>Îì§Ïù¥ Ï†ÄÎ•º Í∏∞Îã§Î¶¨Í≥† ÏûàÏùÑÍπåÏöî? Î®º ÏÇ∞ÏùÑ Î≥¥Î©∞ Í∏ÄÏùÑ ÎßàÏπ©ÎãàÎã§. ÏùΩÏñ¥Ï£ºÏÖîÏÑú Í∞êÏÇ¨Ìï©ÎãàÎã§.</p>

<hr />

<h2 id="published-by-joshua-kim"><em>Published by</em> Joshua Kim</h2>
<p><img src="/assets/profile/joshua-profile.png" alt="Joshua Kim" /></p>]]></content><author><name></name></author><category term="korean" /><category term="python" /><summary type="html"><![CDATA[ÌååÏù¥Ïç¨ ÌååÏùºÏùÑ Ïã§ÌñâÌïòÍ∏∞ ÏúÑÌï¥ÏÑúÎäî ÌååÏù¥Ïç¨Ïùò High-level Ïñ∏Ïñ¥Î•º Low-levelÎ°ú Î≥ÄÌôòÌï¥Ï£ºÎäî InterpreterÍ∞Ä ÌïÑÏöîÌïòÍ≥†, Îòê ÌååÏù¥Ïç¨ ÌååÏùº ÎÇ¥ÏóêÏÑú LoadÌï¥Ïïº ÌïòÎäî Î™®Îìà Ïó≠Ïãú Ìï®Íªò ÏÇ¨Ï†ÑÏóê ÏÑ§ÏπòÎêòÏñ¥Ïïº ÌïòÎäîÎç∞Ïöî. pyinstallerÎäî Ïù¥Îü¨Ìïú InterpreterÏôÄ Î™®ÎìàÏùÑ Ìï®Íªò ÎèôÎ¥âÌïú Ï±ÑÎ°ú ÌååÏù¥Ïç¨ ÌååÏùºÏùÑ Ìå®ÌÇ§ÏßïÌïòÏó¨ ÌïòÎÇòÏùò Ïã§Ìñâ ÌååÏùºÎ°ú ÎßåÎì§Ïñ¥Ï£ºÎäî Ïó≠Ìï†ÏùÑ ÌïòÎäî Í≤ÉÏù¥Ï£†.]]></summary></entry><entry><title type="html">It‚Äôs Harder than You Think to Extract DAU Separating New and Existing Users in BigQuery</title><link href="http://localhost:4000/extract-dau-separating-new-and-existing-users/" rel="alternate" type="text/html" title="It‚Äôs Harder than You Think to Extract DAU Separating New and Existing Users in BigQuery" /><published>2023-06-14T00:00:00+09:00</published><updated>2023-06-14T00:00:00+09:00</updated><id>http://localhost:4000/extract-dau-separating-new-and-existing-users</id><content type="html" xml:base="http://localhost:4000/extract-dau-separating-new-and-existing-users/"><![CDATA[<blockquote>
  <p>In this article, I‚Äôm going to talk about how to extract DAU separating new users and existing users directly from BigQuery. I prepared an insightful example to share some intuition with you, so that you can better understand.</p>
</blockquote>

<h3 id="contents">CONTENTS</h3>
<ol>
  <li>Full BigQuery Codes</li>
  <li>Step by Step</li>
  <li>An Intuitive Example</li>
  <li>Review Full BigQuery Codes</li>
</ol>

<hr />

<p><img src="/assets/2023-06-14-extract-dau-separating-new-and-existing-users/data-pipeline.webp" alt="" /></p>
<blockquote>
  <p>Data pipeline from the website all the way up to Redash</p>
</blockquote>

<h1 id="1-full-bigquery-codes">1. Full BigQuery Codes</h1>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span>  
<span class="n">CTE_flattened</span> <span class="k">AS</span> <span class="p">(</span>  
  <span class="c1">-- Confidential  </span>
<span class="p">),</span>  
<span class="n">CTE_users_min_gsn</span> <span class="k">AS</span> <span class="p">(</span>  
    <span class="k">SELECT</span>  
        <span class="n">PARSE_DATE</span><span class="p">(</span><span class="s1">'%Y%m%d'</span><span class="p">,</span> <span class="n">event_date</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">date</span><span class="p">,</span>  
        <span class="n">user_pseudo_id</span><span class="p">,</span>  
        <span class="k">MIN</span><span class="p">(</span><span class="n">ga_session_number</span><span class="p">)</span> <span class="k">AS</span> <span class="n">min_gsn</span>  
    <span class="k">FROM</span>
	    <span class="n">CTE_flattened</span>  
    <span class="k">WHERE</span> 
	    <span class="n">event_name</span> <span class="o">=</span> <span class="s1">'session_start'</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">event_date</span><span class="p">,</span> <span class="n">user_pseudo_id</span>  
<span class="p">)</span>  
<span class="k">SELECT</span>  
    <span class="nb">date</span><span class="p">,</span>  
    <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">user_pseudo_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau_all</span><span class="p">,</span>  
    <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">min_gsn</span> <span class="o">&lt;&gt;</span> <span class="mi">1</span> <span class="k">THEN</span> <span class="n">user_pseudo_id</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau_existing</span><span class="p">,</span>  
    <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">min_gsn</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">THEN</span> <span class="n">user_pseudo_id</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau_new</span>  
<span class="k">FROM</span>
	<span class="n">CTE_users_min_gsn</span>  
<span class="k">GROUP</span> <span class="k">BY</span> 
	<span class="nb">date</span>  
<span class="k">ORDER</span> <span class="k">BY</span> 
	<span class="nb">date</span>  
<span class="p">;</span>
</code></pre></div></div>

<h1 id="2-step-by-step">2. Step by Step</h1>

<h2 id="21-daily-initial-session-sequence-values">2.1. Daily Initial Session Sequence Values</h2>

<p>First off, extract the <strong>daily initial session sequence values</strong> of all the users triggering <code class="language-plaintext highlighter-rouge">session_start</code>event.</p>
<ul>
  <li>the session sequence values are named <code class="language-plaintext highlighter-rouge">ga_session_number</code>in <a href="https://support.google.com/analytics/answer/7029846?hl=en#zippy=%2Cevent">BigQuery Export Schema of Google Analytics 4</a>.</li>
  <li>When a user(<code class="language-plaintext highlighter-rouge">user_pseudo_id</code>) starts their session for the first time, the  <code class="language-plaintext highlighter-rouge">ga_session_number</code>  in the event parameters equals to <code class="language-plaintext highlighter-rouge">1</code>, and then it increases sequentially each time the user returns and starts the new session again.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CTE_users_min_gsn</span> <span class="k">AS</span> <span class="p">(</span>  
    <span class="k">SELECT</span>  
        <span class="n">PARSE_DATE</span><span class="p">(</span><span class="s1">'%Y%m%d'</span><span class="p">,</span> <span class="n">event_date</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">date</span><span class="p">,</span>  
        <span class="n">user_pseudo_id</span><span class="p">,</span>  
        <span class="k">MIN</span><span class="p">(</span><span class="n">ga_session_number</span><span class="p">)</span> <span class="k">AS</span> <span class="n">min_gsn</span>  
    <span class="k">FROM</span>
	    <span class="n">CTE_flattened</span>
    <span class="k">WHERE</span> 
	    <span class="n">event_name</span> <span class="o">=</span> <span class="s1">'session_start'</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">event_date</span><span class="p">,</span> <span class="n">user_pseudo_id</span>  
<span class="p">)</span>
</code></pre></div></div>

<h2 id="22-separating-new--existing-users">2.2. Separating New &amp; Existing Users</h2>

<p>For the second step, categorize users as new or existing based on whether the <strong>daily initial session sequence value</strong> is <code class="language-plaintext highlighter-rouge">1</code> or <code class="language-plaintext highlighter-rouge">not</code> on a daily basis.</p>
<ul>
  <li>A user named Joshua, who first visited your website for example, can trigger multiple <code class="language-plaintext highlighter-rouge">session_start</code>events in a single day.</li>
  <li>Even though he returns to the website after his first visit, he should be still regarded as one of the new users when calculating on a daily basis.</li>
  <li>That ‚Äòs why I mentioned above that you need to extract the <strong>‚Äúdaily‚Äù initial session sequence values</strong> of all the users.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span>  
    <span class="nb">date</span><span class="p">,</span>  
    <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">user_pseudo_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau_all</span><span class="p">,</span>  
    <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">min_gsn</span> <span class="o">&lt;&gt;</span> <span class="mi">1</span> <span class="k">THEN</span> <span class="n">user_pseudo_id</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau_existing</span><span class="p">,</span>  
    <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">min_gsn</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">THEN</span> <span class="n">user_pseudo_id</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau_new</span>  
<span class="k">FROM</span>
	<span class="n">CTE_users_min_gsn</span>  
<span class="k">GROUP</span> <span class="k">BY</span> 
	<span class="nb">date</span>  
<span class="k">ORDER</span> <span class="k">BY</span> 
	<span class="nb">date</span>
<span class="p">;</span>
</code></pre></div></div>

<h1 id="3-an-intuitive-example">3. An Intuitive Example</h1>

<table>
  <thead>
    <tr>
      <th>¬†</th>
      <th><strong>Jan 1, before noon</strong></th>
      <th><strong>Jan 1, afternoon</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Joshua</strong></td>
      <td>1st Visit</td>
      <td>2nd Visit</td>
    </tr>
    <tr>
      <td><strong>Shane</strong></td>
      <td>-</td>
      <td>1st Visit</td>
    </tr>
    <tr>
      <td><strong>Chloe</strong></td>
      <td>2nd Visit</td>
      <td>-</td>
    </tr>
    <tr>
      <td><strong>Angela</strong></td>
      <td>1st Visit</td>
      <td>2nd Visit</td>
    </tr>
  </tbody>
</table>

<p>On January 1st, the DAU will be:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">3 New Users</code> (Joshua, Shane, and Angela)</li>
  <li><code class="language-plaintext highlighter-rouge">1 Existing User</code> (Chloe)</li>
</ul>

<p>Keep in mind that Joshua and Angela are regarded as the new users <strong>in spite of the fact that they made their second visit</strong>.</p>

<h3 id="step-1-identify-the-session-sequence-values-of-all-the-users">STEP 1. Identify the session sequence values of all the users.</h3>

<table>
  <thead>
    <tr>
      <th>¬†</th>
      <th><strong>Jan 1, before noon</strong></th>
      <th><strong>Jan 1, afternoon</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Joshua</strong></td>
      <td><code class="language-plaintext highlighter-rouge">ga_session_number</code> = 1</td>
      <td><code class="language-plaintext highlighter-rouge">ga_session_number</code> = 2</td>
    </tr>
    <tr>
      <td><strong>Shane</strong></td>
      <td>-</td>
      <td><code class="language-plaintext highlighter-rouge">ga_session_number</code> = 1</td>
    </tr>
    <tr>
      <td><strong>Chloe</strong></td>
      <td><code class="language-plaintext highlighter-rouge">ga_session_number</code> = 45</td>
      <td>-</td>
    </tr>
    <tr>
      <td><strong>Angela</strong></td>
      <td><code class="language-plaintext highlighter-rouge">ga_session_number</code> = 1</td>
      <td><code class="language-plaintext highlighter-rouge">ga_session_number</code> = 2</td>
    </tr>
  </tbody>
</table>

<h3 id="step2-aggregate-each-user-with-the-minimum-session-sequence-value">STEP2. Aggregate each user with the minimum session sequence value.</h3>

<table>
  <thead>
    <tr>
      <th>¬†</th>
      <th><strong>Jan 1</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Joshua</strong></td>
      <td><code class="language-plaintext highlighter-rouge">ga_session_number</code> = 1</td>
    </tr>
    <tr>
      <td><strong>Shane</strong></td>
      <td><code class="language-plaintext highlighter-rouge">ga_session_number</code> = 1</td>
    </tr>
    <tr>
      <td><strong>Chloe</strong></td>
      <td><code class="language-plaintext highlighter-rouge">ga_session_number</code> = 45</td>
    </tr>
    <tr>
      <td><strong>Angela</strong></td>
      <td><code class="language-plaintext highlighter-rouge">ga_session_number</code> = 1</td>
    </tr>
  </tbody>
</table>

<h3 id="step-3-classify-each-user-as-a-new-or-existing-user-based-on-whether-or-not-the-minimum-session-sequence-value-equals-to-1">STEP 3. Classify each user as a new or existing user based on whether or not the minimum session sequence value equals to 1.</h3>

<table>
  <thead>
    <tr>
      <th>¬†</th>
      <th><strong>Jan 1</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Joshua</strong></td>
      <td><code class="language-plaintext highlighter-rouge">New User</code></td>
    </tr>
    <tr>
      <td><strong>Shane</strong></td>
      <td><code class="language-plaintext highlighter-rouge">New User</code></td>
    </tr>
    <tr>
      <td><strong>Chloe</strong></td>
      <td><code class="language-plaintext highlighter-rouge">Existing User</code></td>
    </tr>
    <tr>
      <td><strong>Angela</strong></td>
      <td><code class="language-plaintext highlighter-rouge">New User</code></td>
    </tr>
  </tbody>
</table>

<h1 id="4-review-full-bigquery-codes">4. Review Full BigQuery Codes</h1>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span>  
<span class="n">CTE_flattened</span> <span class="k">AS</span> <span class="p">(</span>  
  <span class="c1">-- Confidential  </span>
<span class="p">),</span>  
<span class="n">CTE_users_min_gsn</span> <span class="k">AS</span> <span class="p">(</span>  
    <span class="k">SELECT</span>  
        <span class="n">PARSE_DATE</span><span class="p">(</span><span class="s1">'%Y%m%d'</span><span class="p">,</span> <span class="n">event_date</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">date</span><span class="p">,</span>  
        <span class="n">user_pseudo_id</span><span class="p">,</span>  
        <span class="k">MIN</span><span class="p">(</span><span class="n">ga_session_number</span><span class="p">)</span> <span class="k">AS</span> <span class="n">min_gsn</span>  
    <span class="k">FROM</span>
	    <span class="n">CTE_flattened</span>  
    <span class="k">WHERE</span> 
	    <span class="n">event_name</span> <span class="o">=</span> <span class="s1">'session_start'</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">event_date</span><span class="p">,</span> <span class="n">user_pseudo_id</span>  
<span class="p">)</span>  
<span class="k">SELECT</span>  
    <span class="nb">date</span><span class="p">,</span>  
    <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">user_pseudo_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau_all</span><span class="p">,</span>  
    <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">min_gsn</span> <span class="o">&lt;&gt;</span> <span class="mi">1</span> <span class="k">THEN</span> <span class="n">user_pseudo_id</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau_existing</span><span class="p">,</span>  
    <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">min_gsn</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">THEN</span> <span class="n">user_pseudo_id</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau_new</span>  
<span class="k">FROM</span>
	<span class="n">CTE_users_min_gsn</span>  
<span class="k">GROUP</span> <span class="k">BY</span> 
	<span class="nb">date</span>  
<span class="k">ORDER</span> <span class="k">BY</span> 
	<span class="nb">date</span>  
<span class="p">;</span>
</code></pre></div></div>

<hr />

<h2 id="published-by-joshua-kim"><em>Published by</em> Joshua Kim</h2>
<p><img src="/assets/profile/joshua-profile.png" alt="Joshua Kim" /></p>]]></content><author><name></name></author><category term="english" /><category term="sql" /><category term="data_analytics" /><category term="bigquery" /><summary type="html"><![CDATA[In this article, I‚Äôm going to talk about how to extract DAU separating new users and existing users directly from BigQuery. I prepared an insightful example to share some intuition with you, so that you can better understand.]]></summary></entry><entry><title type="html">Ethereum On-chain Data: DAU, MAU, Stickiness, and Retention</title><link href="http://localhost:4000/ethereum-on-chain-data/" rel="alternate" type="text/html" title="Ethereum On-chain Data: DAU, MAU, Stickiness, and Retention" /><published>2023-05-29T00:00:00+09:00</published><updated>2023-05-29T00:00:00+09:00</updated><id>http://localhost:4000/ethereum-on-chain-data</id><content type="html" xml:base="http://localhost:4000/ethereum-on-chain-data/"><![CDATA[<blockquote>
  <p>In this article, I‚Äôm going to deep dive into Ethereum On-chain Data Analysis not just with the  <strong>DAU</strong>  and  <strong>MAU,</strong> but also with  <strong>Stickiness</strong>, and  <strong>Retention Rate</strong>, which are the basic metrics when it comes to data analysis. Let‚Äôs directly dive into it!</p>
</blockquote>

<h3 id="contents">CONTENTS</h3>
<ol>
  <li>Introduction</li>
  <li>DAU, MAU, and Stickiness (All the Transactions)
    <ul>
      <li>2.1.  Ethereum DAU and 30-day Moving MAU</li>
      <li>2.2. Ethereum DAU (by new and existing addresses)</li>
      <li>2.3. Ethereum DAU (by transaction types)</li>
      <li>2.4. Ethereum Stickiness</li>
    </ul>
  </li>
  <li>DAU, MAU, and Stickiness (Contract Call Only)
    <ul>
      <li>3.1. Ethereum DAU and 30-day Moving MAU</li>
      <li>3.2. Ethereum DAU (new and existing addresses)</li>
      <li>3.3. Ethereum DAU (by transaction types)</li>
      <li>3.4. Ethereum Stickiness</li>
    </ul>
  </li>
  <li>Cohord Retention (Contract Call Only)
    <ul>
      <li>4.1. Ethereum Cohort Retention (Since Jan 2023)</li>
      <li>4.2. Ethereum Cohort Retention (Since Jan 2022)</li>
    </ul>
  </li>
  <li>Why the Retention rate was high in May 2023?</li>
  <li>Conclusion</li>
</ol>

<hr />

<h1 id="1-introduction">1. Introduction</h1>

<p>There are already many Ethereum on-chain data analytics platforms such as Messari, Glassnode, and of course, Etherscan.</p>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/messari.webp" alt="" /></p>
<blockquote>
  <p>Ethereum Daily Number of Active Addresses (Messari)</p>
</blockquote>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/glassnode.webp" alt="" /></p>
<blockquote>
  <p>Ethereum Daily Number of Active Addresses (Glassnode)</p>
</blockquote>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/etherscan.webp" alt="" /></p>
<blockquote>
  <p>Ethereum Daily Number of Transactions Broadcasted (Etherscan)</p>
</blockquote>

<p>Unfortunately, The charts above aren‚Äôt very helpful if you try to deeply analyze the on-chain data and find a specific action point regarding any blockchain services.</p>

<p>Inthis article, I‚Äôm going to deep dive into Ethereum On-chain Data Analysis not just with the  <strong>DAU</strong>  and  <strong>MAU,</strong> but also with  <strong>Stickiness</strong>, and  <strong>Retention Rate</strong>, which are the most basic metrics when it comes to Data Analysis. Let‚Äôs directly dive into it!</p>

<h1 id="2-dau-mau-and-stickiness-all-the-transactions">2. DAU, MAU, and Stickiness (All the Transactions)</h1>

<h2 id="21--ethereum-dau-and-30-day-moving-mau">2.1.  Ethereum DAU and 30-day Moving MAU</h2>

<p>Basically, I am not able to discern any meaningful insights from the chart below as a data analyst.</p>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/ethereum-dau-mau.webp" alt="" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span>  
<span class="n">CTE_raw</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>  
        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">block_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">block_date</span><span class="p">,</span>  
        <span class="n">block_number</span><span class="p">,</span>  
        <span class="nv">"from"</span> <span class="k">AS</span> <span class="n">from_address</span><span class="p">,</span> <span class="n">nonce</span><span class="p">,</span>  
        <span class="n">success</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span>  
        <span class="n">value</span><span class="p">,</span> <span class="k">data</span>  
    <span class="k">FROM</span> 
	    <span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span>  
    <span class="k">WHERE</span>  
        <span class="n">block_time</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2022-12-01'</span>  
        <span class="k">AND</span> <span class="n">success</span> <span class="o">=</span> <span class="k">true</span>  
<span class="p">),</span>  
<span class="n">CTE_dau_mau</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>  
        <span class="n">block_date</span><span class="p">,</span>  
        <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau</span><span class="p">,</span>  
        <span class="p">(</span>  
            <span class="k">SELECT</span>
	            <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span>  
            <span class="k">FROM</span> 
	            <span class="n">CTE_raw</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span>  
                <span class="n">DATE_ADD</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="o">-</span><span class="mi">29</span><span class="p">,</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">block_date</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">block_date</span>  
                <span class="k">AND</span> <span class="n">SUB</span><span class="p">.</span><span class="n">block_date</span> <span class="o">&lt;=</span> <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">block_date</span><span class="p">)</span>  
        <span class="p">)</span> <span class="k">AS</span> <span class="n">mau</span>  
    <span class="k">FROM</span>
	    <span class="n">CTE_raw</span> <span class="n">MAIN</span>  
    <span class="k">GROUP</span> <span class="k">BY</span>
	    <span class="n">block_date</span>  
    <span class="k">ORDER</span> <span class="k">BY</span> 
	    <span class="n">block_date</span> <span class="k">DESC</span>  
<span class="p">)</span>  
<span class="k">SELECT</span>
	<span class="o">*</span>  
<span class="k">FROM</span> 
	<span class="n">CTE_dau_mau</span>  
<span class="k">WHERE</span> 
	<span class="n">block_date</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2023-01-01'</span>  
<span class="k">ORDER</span> <span class="k">BY</span> 
	<span class="n">block_date</span> <span class="k">DESC</span>  
<span class="p">;</span>
</code></pre></div></div>

<h2 id="22-ethereum-dau-by-new-and-existing-addresses">2.2. Ethereum DAU (by new and existing addresses)</h2>

<p>Here, I‚Äôve distinguished daily new addresses from existing ones depending on the <strong>Nonce</strong> values.</p>
<ul>
  <li>If a transaction has a nonce of 0, it‚Äôs considered to be broadcast by <strong>a new address</strong>.</li>
  <li>On the other hand, if a transaction nonce is not equal to 0, it‚Äôs considered to be broadcast by <strong>an existing address</strong>.</li>
</ul>

<p>Despite this analysis, I am still not able to discern any meaningful insights from the chart below.</p>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/ethereum-dau-new-vs-old.webp" alt="" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span>  
<span class="n">CTE_raw</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>  
        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">block_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">block_date</span><span class="p">,</span>  
        <span class="n">block_number</span><span class="p">,</span>  
        <span class="nv">"from"</span> <span class="k">AS</span> <span class="n">from_address</span><span class="p">,</span>   
        <span class="k">CASE</span>  
            <span class="k">WHEN</span> <span class="n">nonce</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="s1">'new_address'</span>  
            <span class="k">ELSE</span> <span class="s1">'existing_address'</span>  
        <span class="k">END</span> <span class="k">AS</span> <span class="n">new_existing</span><span class="p">,</span>  
        <span class="n">success</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span>  
        <span class="n">value</span><span class="p">,</span> <span class="k">data</span>  
    <span class="k">FROM</span>
	    <span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span>  
    <span class="k">WHERE</span>  
        <span class="n">block_time</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2022-12-01'</span>  
        <span class="k">AND</span> <span class="n">success</span> <span class="o">=</span> <span class="k">true</span>  
<span class="p">),</span>  
<span class="n">CTE_dnu_mnu</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>  
        <span class="n">block_date</span><span class="p">,</span>  
        <span class="n">new_existing</span><span class="p">,</span>  
        <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dnu</span><span class="p">,</span>  
        <span class="p">(</span>  
            <span class="k">SELECT</span>
	            <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span>  
            <span class="k">FROM</span> 
	            <span class="n">CTE_raw</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span>  
                <span class="n">DATE_ADD</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="o">-</span><span class="mi">29</span><span class="p">,</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">block_date</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">block_date</span>  
                <span class="k">AND</span> <span class="n">SUB</span><span class="p">.</span><span class="n">block_date</span> <span class="o">&lt;=</span> <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">block_date</span><span class="p">)</span>  
        <span class="p">)</span> <span class="k">AS</span> <span class="n">mnu</span>  
    <span class="k">FROM</span>
	    <span class="n">CTE_raw</span> <span class="n">MAIN</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">block_date</span><span class="p">,</span> <span class="n">new_existing</span>  
    <span class="k">ORDER</span> <span class="k">BY</span> 
	    <span class="n">block_date</span> <span class="k">DESC</span><span class="p">,</span> <span class="n">new_existing</span>  
<span class="p">)</span>  
<span class="k">SELECT</span>
	<span class="o">*</span>  
<span class="k">FROM</span>
	<span class="n">CTE_dnu_mnu</span>  
<span class="k">WHERE</span> 
	<span class="n">block_date</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2023-01-01'</span>  
<span class="k">ORDER</span> <span class="k">BY</span> 
	<span class="n">block_date</span> <span class="k">DESC</span>  
<span class="p">;</span>
</code></pre></div></div>

<h2 id="23-ethereum-dau-by-transaction-types">2.3. Ethereum DAU (by transaction types)</h2>

<p>Here, I‚Äôve distinquished daily new addresses from existing ones depending on the <strong>Nonce</strong> values.</p>
<ul>
  <li>If a transaction has a nonce of 0, it‚Äôs considered to be broadcast by <strong>a new address</strong>.</li>
  <li>On the other hand, if a transaction nonce is not equal to 0, it‚Äôs considered to be broadcast by <strong>an existing address</strong>.</li>
</ul>

<p>Despite this analysis, I am still not able to discern any meaningful insights from the chart below.</p>

<p>Again, I am still not able to discern any meaningful insights from the chart below.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">DynamicFee</code> indicates that the transaction has been broadcast in compliance with EIP-1559.</li>
  <li><code class="language-plaintext highlighter-rouge">Legacy</code> signifies that the transaction has been broadcast using the traditional data format.</li>
</ul>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/ethereum-dau-tx-type.webp" alt="" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span>  
<span class="n">CTE_raw</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>  
        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">block_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">block_date</span><span class="p">,</span>  
        <span class="n">block_number</span><span class="p">,</span>  
        <span class="nv">"from"</span> <span class="k">AS</span> <span class="n">from_address</span><span class="p">,</span> <span class="n">nonce</span><span class="p">,</span>  
        <span class="n">success</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span>  
        <span class="n">value</span><span class="p">,</span> <span class="k">data</span>  
    <span class="k">FROM</span>
	    <span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span>  
    <span class="k">WHERE</span>  
        <span class="n">block_time</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2022-12-01'</span>  
        <span class="k">AND</span> <span class="n">success</span> <span class="o">=</span> <span class="k">true</span>  
<span class="p">),</span>  
<span class="n">CTE_dau_mau</span> <span class="k">AS</span> <span class="p">(</span>   
    <span class="k">SELECT</span>  
        <span class="n">block_date</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span>  
        <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau</span><span class="p">,</span>  
        <span class="p">(</span>  
            <span class="k">SELECT</span>
	            <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span>  
            <span class="k">FROM</span>
	            <span class="n">CTE_raw</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span>  
                <span class="n">DATE_ADD</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="o">-</span><span class="mi">29</span><span class="p">,</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">block_date</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">block_date</span>  
                <span class="k">AND</span> <span class="n">SUB</span><span class="p">.</span><span class="n">block_date</span> <span class="o">&lt;=</span> <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">block_date</span><span class="p">)</span>  
        <span class="p">)</span> <span class="k">AS</span> <span class="n">mau</span>  
    <span class="k">FROM</span> 
	    <span class="n">CTE_raw</span> <span class="n">MAIN</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">block_date</span><span class="p">,</span> <span class="k">type</span>  
    <span class="k">ORDER</span> <span class="k">BY</span> 
	    <span class="n">block_date</span> <span class="k">DESC</span><span class="p">,</span> <span class="k">type</span>   
<span class="p">)</span>  
<span class="k">SELECT</span> 
	<span class="o">*</span>  
<span class="k">FROM</span> 
	<span class="n">CTE_dau_mau</span>  
<span class="k">WHERE</span> 
	<span class="n">block_date</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2023-01-01'</span>  
<span class="k">ORDER</span> <span class="k">BY</span> 
	<span class="n">block_date</span> <span class="k">DESC</span>  
<span class="p">;</span>
</code></pre></div></div>

<h2 id="24-ethereum-stickiness">2.4. Ethereum Stickiness</h2>

<blockquote>
  <p><strong>Stickiness</strong> is, by definition, the proportion of users who started their sessions on a particular day among all monthly users.</p>
</blockquote>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/stickiness-formula.webp" alt="" /></p>

<p>For instance, users on various social media platforms like Facebook typically exhibit a significantly high Stickiness Ratio.</p>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/dau-as-perc-of-mau.webp" alt="" /></p>

<p>When it comes to Ethereum Stickiness, I noticed a potential upward trend since May 2023 in the chart below.</p>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/ethereum-stickiness.webp" alt="" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span>  
<span class="n">CTE_raw</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>  
        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">block_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">block_date</span><span class="p">,</span>  
        <span class="n">block_number</span><span class="p">,</span>  
        <span class="nv">"from"</span> <span class="k">AS</span> <span class="n">from_address</span><span class="p">,</span> <span class="n">nonce</span><span class="p">,</span>  
        <span class="n">success</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span>  
        <span class="n">value</span><span class="p">,</span> <span class="k">data</span>  
    <span class="k">FROM</span>
	    <span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span>  
    <span class="k">WHERE</span>  
        <span class="n">block_time</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2022-12-01'</span>  
        <span class="k">AND</span> <span class="n">success</span> <span class="o">=</span> <span class="k">true</span>  
<span class="p">),</span>  
<span class="n">CTE_dau_mau</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">block_date</span><span class="p">,</span>  
        <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau</span><span class="p">,</span>  
        <span class="p">(</span>  
            <span class="k">SELECT</span>
	            <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span>  
            <span class="k">FROM</span>
	            <span class="n">CTE_raw</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span>  
                <span class="n">DATE_ADD</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="o">-</span><span class="mi">29</span><span class="p">,</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">block_date</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">block_date</span>  
                <span class="k">AND</span> <span class="n">SUB</span><span class="p">.</span><span class="n">block_date</span> <span class="o">&lt;=</span> <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">block_date</span><span class="p">)</span>  
        <span class="p">)</span> <span class="k">AS</span> <span class="n">mau</span>  
    <span class="k">FROM</span>
	    <span class="n">CTE_raw</span> <span class="n">MAIN</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">block_date</span>  
    <span class="k">ORDER</span> <span class="k">BY</span> 
	    <span class="n">block_date</span> <span class="k">DESC</span>  
<span class="p">),</span>  
<span class="n">CTE_dau_mau_stickiness</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">block_date</span><span class="p">,</span> <span class="n">dau</span><span class="p">,</span> <span class="n">mau</span><span class="p">,</span>  
        <span class="k">CAST</span><span class="p">(</span><span class="n">dau</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> <span class="o">/</span> <span class="k">CAST</span><span class="p">(</span><span class="n">mau</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="k">AS</span> <span class="n">stickiness</span>  
    <span class="k">FROM</span>
	    <span class="n">CTE_dau_mau</span>  
    <span class="k">WHERE</span>
	    <span class="n">block_date</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2023-01-01'</span>  
    <span class="k">ORDER</span> <span class="k">BY</span>
	    <span class="n">block_date</span> <span class="k">DESC</span>  
<span class="p">)</span>  
<span class="k">SELECT</span> 
	<span class="o">*</span> 
<span class="k">FROM</span> 
	<span class="n">CTE_dau_mau_stickiness</span><span class="p">;</span>
</code></pre></div></div>

<h1 id="3--dau-mau-and-stickiness-contract-call-only">3.  DAU, MAU, and Stickiness (Contract Call Only)</h1>

<p>Wait, I overlooked one crucial aspect in all of the above.</p>
<ol>
  <li>The primary essence of the Ethereum Network lies in its functionality as an application platform.</li>
  <li>Consequently, it would be more accurate and insightful to extract transactions data that involves at least one contract call, rather than considering all transactions data.</li>
</ol>

<p>Let‚Äôs redraw the same charts, but this time, focusing only on transactions that involve calling a contract.</p>

<h2 id="31-ethereum-dau-and-30-day-moving-mau">3.1. Ethereum DAU and 30-day Moving MAU</h2>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/ethereum-contract-call-dau-mau.webp" alt="" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span>  
<span class="n">CTE_raw</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">block_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">block_date</span><span class="p">,</span>  
        <span class="n">block_number</span><span class="p">,</span>  
        <span class="nv">"from"</span> <span class="k">AS</span> <span class="n">from_address</span><span class="p">,</span> <span class="n">nonce</span><span class="p">,</span>  
        <span class="n">success</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span>  
        <span class="n">value</span><span class="p">,</span> <span class="k">data</span>  
    <span class="k">FROM</span> 
	    <span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span>  
    <span class="k">WHERE</span>  
        <span class="n">block_time</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2022-12-01'</span>  
        <span class="k">AND</span> <span class="n">success</span> <span class="o">=</span> <span class="k">true</span>  
        <span class="k">AND</span> <span class="k">data</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span><span class="n">x</span>  
<span class="p">),</span>  
<span class="n">CTE_dau_mau</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">block_date</span><span class="p">,</span>  
        <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau</span><span class="p">,</span>  
        <span class="p">(</span>  
            <span class="k">SELECT</span> 
	            <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span>  
            <span class="k">FROM</span> 
	            <span class="n">CTE_raw</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span>  
                <span class="n">DATE_ADD</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="o">-</span><span class="mi">29</span><span class="p">,</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">block_date</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">block_date</span>  
                <span class="k">AND</span> <span class="n">SUB</span><span class="p">.</span><span class="n">block_date</span> <span class="o">&lt;=</span> <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">block_date</span><span class="p">)</span>  
        <span class="p">)</span> <span class="k">AS</span> <span class="n">mau</span>  
    <span class="k">FROM</span> 
	    <span class="n">CTE_raw</span> <span class="n">MAIN</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">block_date</span>  
    <span class="k">ORDER</span> <span class="k">BY</span> 
	    <span class="n">block_date</span> <span class="k">DESC</span>  
<span class="p">)</span>  
<span class="k">SELECT</span> 
	<span class="o">*</span>  
<span class="k">FROM</span> 
	<span class="n">CTE_dau_mau</span>  
<span class="k">WHERE</span> 
	<span class="n">block_date</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2023-01-01'</span>  
<span class="k">ORDER</span> <span class="k">BY</span> 
	<span class="n">block_date</span> <span class="k">DESC</span>  
<span class="p">;</span>
</code></pre></div></div>

<h2 id="32-ethereum-dau-new-and-existing-addresses">3.2. Ethereum DAU (new and existing addresses)</h2>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/ethereum-contract-call-dau-new-vs-old.webp" alt="" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span>  
<span class="n">CTE_raw</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">block_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">block_date</span><span class="p">,</span>  
        <span class="n">block_number</span><span class="p">,</span>  
        <span class="nv">"from"</span> <span class="k">AS</span> <span class="n">from_address</span><span class="p">,</span>   
        <span class="k">CASE</span>  
            <span class="k">WHEN</span> <span class="n">nonce</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="s1">'new_address'</span>  
            <span class="k">ELSE</span> <span class="s1">'existing_address'</span>  
        <span class="k">END</span> <span class="k">AS</span> <span class="n">new_existing</span><span class="p">,</span>  
        <span class="n">success</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span>  
        <span class="n">value</span><span class="p">,</span> <span class="k">data</span>  
    <span class="k">FROM</span> 
	    <span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span>  
    <span class="k">WHERE</span>  
        <span class="n">block_time</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2022-12-01'</span>  
        <span class="k">AND</span> <span class="n">success</span> <span class="o">=</span> <span class="k">true</span>  
        <span class="k">AND</span> <span class="k">data</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span><span class="n">x</span>  
<span class="p">),</span>  
<span class="n">CTE_dnu_mnu</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>  
        <span class="n">block_date</span><span class="p">,</span>  
        <span class="n">new_existing</span><span class="p">,</span>  
        <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dnu</span><span class="p">,</span>  
        <span class="p">(</span>  
            <span class="k">SELECT</span> 
	            <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span>  
            <span class="k">FROM</span> 
	            <span class="n">CTE_raw</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span>  
                <span class="n">DATE_ADD</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="o">-</span><span class="mi">29</span><span class="p">,</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">block_date</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">block_date</span>  
                <span class="k">AND</span> <span class="n">SUB</span><span class="p">.</span><span class="n">block_date</span> <span class="o">&lt;=</span> <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">block_date</span><span class="p">)</span>  
        <span class="p">)</span> <span class="k">AS</span> <span class="n">mnu</span>  
    <span class="k">FROM</span> 
	    <span class="n">CTE_raw</span> <span class="n">MAIN</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">block_date</span><span class="p">,</span> <span class="n">new_old</span>  
    <span class="k">ORDER</span> <span class="k">BY</span> 
	    <span class="n">block_date</span> <span class="k">DESC</span><span class="p">,</span> <span class="n">new_old</span>  
<span class="p">)</span>  
<span class="k">SELECT</span> 
	<span class="o">*</span>  
<span class="k">FROM</span> 
	<span class="n">CTE_dnu_mnu</span>  
<span class="k">WHERE</span> 
	<span class="n">block_date</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2023-01-01'</span>  
<span class="k">ORDER</span> <span class="k">BY</span> 
	<span class="n">block_date</span> <span class="k">DESC</span>  
<span class="p">;</span>
</code></pre></div></div>

<h2 id="33-ethereum-dau-by-transaction-types">3.3. Ethereum DAU (by transaction types)</h2>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/ethereum-contract-call-dau-tx-type.webp" alt="" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span>  
<span class="n">CTE_raw</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">block_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">block_date</span><span class="p">,</span>  
        <span class="n">block_number</span><span class="p">,</span>  
        <span class="nv">"from"</span> <span class="k">AS</span> <span class="n">from_address</span><span class="p">,</span> <span class="n">nonce</span><span class="p">,</span>  
        <span class="n">success</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span>  
        <span class="n">value</span><span class="p">,</span> <span class="k">data</span>  
    <span class="k">FROM</span> 
	    <span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span>  
    <span class="k">WHERE</span>  
        <span class="n">block_time</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2022-12-01'</span>  
        <span class="k">AND</span> <span class="n">success</span> <span class="o">=</span> <span class="k">true</span>  
        <span class="k">AND</span> <span class="k">data</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span><span class="n">x</span>  
<span class="p">),</span>  
<span class="n">CTE_dau_mau</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>  
        <span class="n">block_date</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span>  
        <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau</span><span class="p">,</span>  
        <span class="p">(</span>  
            <span class="k">SELECT</span> 
	            <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span>  
            <span class="k">FROM</span> 
	            <span class="n">CTE_raw</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span>  
                <span class="n">DATE_ADD</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="o">-</span><span class="mi">29</span><span class="p">,</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">block_date</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">block_date</span>  
                <span class="k">AND</span> <span class="n">SUB</span><span class="p">.</span><span class="n">block_date</span> <span class="o">&lt;=</span> <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">block_date</span><span class="p">)</span>  
        <span class="p">)</span> <span class="k">AS</span> <span class="n">mau</span>  
    <span class="k">FROM</span> 
	    <span class="n">CTE_raw</span> <span class="n">MAIN</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">block_date</span><span class="p">,</span> <span class="k">type</span>  
    <span class="k">ORDER</span> <span class="k">BY</span> 
	    <span class="n">block_date</span> <span class="k">DESC</span><span class="p">,</span> <span class="k">type</span>   
<span class="p">)</span>  
<span class="k">SELECT</span> 
	<span class="o">*</span>  
<span class="k">FROM</span> 
	<span class="n">CTE_dau_mau</span>  
<span class="k">WHERE</span> 
	<span class="n">block_date</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2023-01-01'</span>  
<span class="k">ORDER</span> <span class="k">BY</span> 
	<span class="n">block_date</span> <span class="k">DESC</span>  
<span class="p">;</span>
</code></pre></div></div>

<h2 id="34-ethereum-stickiness">3.4. Ethereum Stickiness</h2>

<p>I am even more convinced now that the upward trend I noticed earlier is indeed present here as well.</p>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/ethereum-contract-call-stickiness.webp" alt="" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span>  
<span class="n">CTE_raw</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">block_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">block_date</span><span class="p">,</span>  
        <span class="n">block_number</span><span class="p">,</span>  
        <span class="nv">"from"</span> <span class="k">AS</span> <span class="n">from_address</span><span class="p">,</span> <span class="n">nonce</span><span class="p">,</span>  
        <span class="n">success</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span>  
        <span class="n">value</span><span class="p">,</span> <span class="k">data</span>  
    <span class="k">FROM</span> 
	    <span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span>  
    <span class="k">WHERE</span>  
        <span class="n">block_time</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2022-12-01'</span>  
        <span class="k">AND</span> <span class="n">success</span> <span class="o">=</span> <span class="k">true</span>  
        <span class="k">AND</span> <span class="k">data</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span><span class="n">x</span>  
<span class="p">),</span>  
<span class="n">CTE_dau_mau</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">block_date</span><span class="p">,</span>  
        <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span> <span class="k">AS</span> <span class="n">dau</span><span class="p">,</span>  
        <span class="p">(</span>  
            <span class="k">SELECT</span> 
	            <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span>  
            <span class="k">FROM</span> 
	            <span class="n">CTE_raw</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span>  
                <span class="n">DATE_ADD</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="o">-</span><span class="mi">29</span><span class="p">,</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">block_date</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">block_date</span>  
                <span class="k">AND</span> <span class="n">SUB</span><span class="p">.</span><span class="n">block_date</span> <span class="o">&lt;=</span> <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">block_date</span><span class="p">)</span>  
        <span class="p">)</span> <span class="k">AS</span> <span class="n">mau</span>  
    <span class="k">FROM</span> 
	    <span class="n">CTE_raw</span> <span class="n">MAIN</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">block_date</span>  
    <span class="k">ORDER</span> <span class="k">BY</span> 
	    <span class="n">block_date</span> <span class="k">DESC</span>  
<span class="p">),</span>  
<span class="n">CTE_dau_mau_stickiness</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">block_date</span><span class="p">,</span> <span class="n">dau</span><span class="p">,</span> <span class="n">mau</span><span class="p">,</span>  
        <span class="k">CAST</span><span class="p">(</span><span class="n">dau</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> <span class="o">/</span> <span class="k">CAST</span><span class="p">(</span><span class="n">mau</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="k">AS</span> <span class="n">stickiness</span>  
    <span class="k">FROM</span> 
	    <span class="n">CTE_dau_mau</span>  
    <span class="k">WHERE</span> 
	    <span class="n">block_date</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2023-01-01'</span>  
    <span class="k">ORDER</span> <span class="k">BY</span> 
	    <span class="n">block_date</span> <span class="k">DESC</span>  
<span class="p">)</span>  
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">CTE_dau_mau_stickiness</span><span class="p">;</span>
</code></pre></div></div>

<h1 id="4--cohord-retention-contract-call-only">4.  Cohord Retention (Contract Call Only)</h1>

<blockquote>
  <p><strong>Retention</strong> is basically an indicator of how many users come back to the platform over time.</p>
</blockquote>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/amplitude.webp" alt="" /></p>

<p>There are at least three methodologies to measure the Retention rate, but here I‚Äôll use the Cohort Retention.</p>

<blockquote>
  <p><strong>Cohort Retention</strong> is one method of measuring the Retention trends by dividing it based on the first visit date of the new users.</p>
</blockquote>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/cohort-table.webp" alt="" /></p>

<h2 id="41-ethereum-cohort-retention-since-jan-2023">4.1. Ethereum Cohort Retention (Since Jan 2023)</h2>

<p>Newe addresses that have called contracts at least once demonstrate a notably high retention rate for at least a couple of weeks.</p>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/ethereum-cohort-retention-contract-call-only.webp" alt="" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span>  
<span class="n">CTE_raw</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">block_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">block_date</span><span class="p">,</span>  
        <span class="n">block_number</span><span class="p">,</span>  
        <span class="nv">"from"</span> <span class="k">AS</span> <span class="n">from_address</span><span class="p">,</span>   
        <span class="n">nonce</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span>  
        <span class="n">value</span><span class="p">,</span> <span class="k">data</span>  
    <span class="k">FROM</span> 
	    <span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span>  
    <span class="k">WHERE</span>  
        <span class="n">block_time</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2023-01-01'</span>  
        <span class="k">AND</span> <span class="n">success</span> <span class="o">=</span> <span class="k">true</span>  
        <span class="k">AND</span> <span class="k">data</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span><span class="n">x</span>  
<span class="p">),</span>  
<span class="n">CTE_raw_new</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span> 
	    <span class="o">*</span>   
    <span class="k">FROM</span> 
	    <span class="n">CTE_raw</span>  
    <span class="k">WHERE</span> 
	    <span class="n">from_address</span> <span class="k">IN</span> <span class="p">(</span>  
	        <span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">from_address</span>  
	        <span class="k">FROM</span> <span class="n">CTE_raw</span>  
	        <span class="k">WHERE</span> <span class="n">nonce</span> <span class="o">=</span> <span class="mi">0</span>  
	    <span class="p">)</span>  
<span class="p">),</span>  
<span class="n">CTE_address_date_first</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">from_address</span><span class="p">,</span>  
        <span class="n">block_date</span> <span class="k">AS</span> <span class="n">active_date</span><span class="p">,</span>  
        <span class="k">MIN</span><span class="p">(</span><span class="n">block_date</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span>
	        <span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">from_address</span>
	        <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">block_date</span>
	        <span class="k">ROWS</span> <span class="k">BETWEEN</span> <span class="n">UNBOUNDED</span> <span class="k">PRECEDING</span> <span class="k">AND</span> <span class="n">UNBOUNDED</span> <span class="k">FOLLOWING</span>
        <span class="p">)</span> <span class="k">AS</span> <span class="n">first_date</span>  
    <span class="k">FROM</span> 
	    <span class="n">CTE_raw_new</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">from_address</span><span class="p">,</span> <span class="n">block_date</span>  
<span class="p">),</span>  
<span class="n">CTE_address_date_first_length</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">from_address</span><span class="p">,</span>  
        <span class="n">active_date</span><span class="p">,</span> <span class="n">first_date</span><span class="p">,</span>  
        <span class="n">DATE_DIFF</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">first_date</span><span class="p">,</span> <span class="n">active_date</span><span class="p">)</span> <span class="k">AS</span> <span class="k">length</span>  
    <span class="k">FROM</span> 
	    <span class="n">CTE_address_date_first</span>  
<span class="p">),</span>  
<span class="n">CTE_address_date_first_length7d</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">from_address</span><span class="p">,</span>  
        <span class="k">MAX</span><span class="p">(</span><span class="n">active_date</span><span class="p">)</span> <span class="k">AS</span> <span class="n">active_date</span><span class="p">,</span>  
        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'WEEK'</span><span class="p">,</span> <span class="k">MIN</span><span class="p">(</span><span class="n">first_date</span><span class="p">))</span> <span class="k">AS</span> <span class="n">first_week</span><span class="p">,</span>  
        <span class="n">CEIL</span><span class="p">(</span><span class="k">length</span> <span class="o">/</span> <span class="mi">7</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">AS</span> <span class="k">length</span>  
    <span class="k">FROM</span> 
	    <span class="n">CTE_address_date_first_length</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">from_address</span><span class="p">,</span> <span class="n">CEIL</span><span class="p">(</span><span class="k">length</span> <span class="o">/</span> <span class="mi">7</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>  
<span class="p">),</span>  
<span class="n">CTE_final</span> <span class="k">AS</span> <span class="p">(</span>  
    <span class="k">SELECT</span>  
        <span class="n">first_week</span><span class="p">,</span>  
        <span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="n">new_address</span><span class="p">,</span>  
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span>
        <span class="o">/</span> 
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="k">AS</span> <span class="n">week_0</span><span class="p">,</span>  
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">/</span> 
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="k">AS</span> <span class="n">week_1</span><span class="p">,</span>  
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">/</span> 
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="k">AS</span> <span class="n">week_2</span><span class="p">,</span>  
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">3</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">/</span> 
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="k">AS</span> <span class="n">week_3</span><span class="p">,</span>  
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">4</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">/</span> <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="k">AS</span> <span class="n">week_4</span>  
    <span class="k">FROM</span> 
	    <span class="n">CTE_address_date_first_length7d</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">first_week</span>  
    <span class="k">ORDER</span> <span class="k">BY</span> 
	    <span class="n">first_week</span>  
<span class="p">)</span>  
<span class="k">SELECT</span> 
	<span class="o">*</span> 
<span class="k">FROM</span> 
	<span class="n">CTE_final</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="42-ethereum-cohort-retention-since-jan-2022">4.2. Ethereum Cohort Retention (Since Jan 2022)</h2>

<p>Let‚Äôs repeat the process from above, this time starting from January 2022 for a more convincing analysis.</p>

<p>The retention rate in May 2023 was the second-highest since last year, warranting further analysis.</p>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/ethereum-cohort-retention-contract-call-only-since-2022.webp" alt="" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span>  
<span class="n">CTE_raw</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">block_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">block_date</span><span class="p">,</span>  
        <span class="n">block_number</span><span class="p">,</span>  
        <span class="nv">"from"</span> <span class="k">AS</span> <span class="n">from_address</span><span class="p">,</span>   
        <span class="n">nonce</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span>  
        <span class="n">value</span><span class="p">,</span> <span class="k">data</span>  
    <span class="k">FROM</span> 
	    <span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span>  
    <span class="k">WHERE</span>  
        <span class="n">block_time</span> <span class="o">&gt;=</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2022-01-01'</span>  
        <span class="k">AND</span> <span class="n">success</span> <span class="o">=</span> <span class="k">true</span>  
        <span class="k">AND</span> <span class="k">data</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span><span class="n">x</span>  
<span class="p">),</span>  
<span class="n">CTE_raw_new</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span> 
	    <span class="o">*</span>   
    <span class="k">FROM</span> 
	    <span class="n">CTE_raw</span>  
    <span class="k">WHERE</span> 
	    <span class="n">from_address</span> <span class="k">IN</span> <span class="p">(</span>  
	        <span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">from_address</span>  
	        <span class="k">FROM</span> <span class="n">CTE_raw</span>  
	        <span class="k">WHERE</span> <span class="n">nonce</span> <span class="o">=</span> <span class="mi">0</span>  
	    <span class="p">)</span>  
<span class="p">),</span>  
<span class="n">CTE_address_date_first</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">from_address</span><span class="p">,</span>  
        <span class="n">block_date</span> <span class="k">AS</span> <span class="n">active_date</span><span class="p">,</span>  
        <span class="k">MIN</span><span class="p">(</span><span class="n">block_date</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span>
	        <span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">from_address</span>
	        <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">block_date</span>
	        <span class="k">ROWS</span> <span class="k">BETWEEN</span> <span class="n">UNBOUNDED</span> <span class="k">PRECEDING</span> <span class="k">AND</span> <span class="n">UNBOUNDED</span> <span class="k">FOLLOWING</span>
        <span class="p">)</span> <span class="k">AS</span> <span class="n">first_date</span>  
    <span class="k">FROM</span> 
	    <span class="n">CTE_raw_new</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">from_address</span><span class="p">,</span> <span class="n">block_date</span>  
<span class="p">),</span>  
<span class="n">CTE_address_date_first_length</span> <span class="k">AS</span> <span class="p">(</span>   
    <span class="k">SELECT</span>  
        <span class="n">from_address</span><span class="p">,</span>  
        <span class="n">active_date</span><span class="p">,</span> <span class="n">first_date</span><span class="p">,</span>  
        <span class="n">DATE_DIFF</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">first_date</span><span class="p">,</span> <span class="n">active_date</span><span class="p">)</span> <span class="k">AS</span> <span class="k">length</span>  
    <span class="k">FROM</span> 
	    <span class="n">CTE_address_date_first</span>  
<span class="p">),</span>  
<span class="n">CTE_address_date_first_length7d</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">from_address</span><span class="p">,</span>  
        <span class="k">MAX</span><span class="p">(</span><span class="n">active_date</span><span class="p">)</span> <span class="k">AS</span> <span class="n">active_date</span><span class="p">,</span>  
        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'WEEK'</span><span class="p">,</span> <span class="k">MIN</span><span class="p">(</span><span class="n">first_date</span><span class="p">))</span> <span class="k">AS</span> <span class="n">first_week</span><span class="p">,</span>  
        <span class="n">CEIL</span><span class="p">(</span><span class="k">length</span> <span class="o">/</span> <span class="mi">7</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">AS</span> <span class="k">length</span>  
    <span class="k">FROM</span> 
	    <span class="n">CTE_address_date_first_length</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">from_address</span><span class="p">,</span> <span class="n">CEIL</span><span class="p">(</span><span class="k">length</span> <span class="o">/</span> <span class="mi">7</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span>  
<span class="p">),</span>  
<span class="n">CTE_final</span> <span class="k">AS</span> <span class="p">(</span>  
    <span class="k">SELECT</span>  
        <span class="n">first_week</span><span class="p">,</span>  
        <span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="n">new_address</span><span class="p">,</span>  
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">/</span> 
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="k">AS</span> <span class="n">week_0</span><span class="p">,</span>  
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">/</span> 
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="k">AS</span> <span class="n">week_1</span><span class="p">,</span>  
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">/</span> 
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="k">AS</span> <span class="n">week_2</span><span class="p">,</span>  
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">3</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">/</span> 
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="k">AS</span> <span class="n">week_3</span><span class="p">,</span>  
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">4</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">/</span> 
        <span class="k">CAST</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="k">length</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="mi">0</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">DOUBLE</span><span class="p">)</span> 
        <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="k">AS</span> <span class="n">week_4</span>  
    <span class="k">FROM</span> 
	    <span class="n">CTE_address_date_first_length7d</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">first_week</span>  
    <span class="k">ORDER</span> <span class="k">BY</span> 
	    <span class="n">first_week</span>  
<span class="p">)</span>  
<span class="k">SELECT</span> 
	<span class="o">*</span> 
<span class="k">FROM</span> <span class="n">CTE_final</span><span class="p">;</span>
</code></pre></div></div>

<h1 id="5--why-the-retention-rate-was-high-in-may-2023">5.  Why the Retention rate was high in May 2023?</h1>

<p>The significant increase in the retention rate suggests a positive shift in user experience, indicating that users are now having a more positive experience than ever before.</p>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/ethereum-cohort-retention-contract-call-only-since-2022-2.webp" alt="" /></p>

<p>Now, let‚Äôs extract the list of contract addresses that have been called the most by the new addresses from May 1 to May 8, 2023.</p>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/to-address-rank-2023-05-01-2023-05-08.webp" alt="" /></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span>  
<span class="n">CTE_raw</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span>  
        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'DAY'</span><span class="p">,</span> <span class="n">block_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">block_date</span><span class="p">,</span>  
        <span class="n">block_number</span><span class="p">,</span>  
        <span class="nv">"from"</span> <span class="k">AS</span> <span class="n">from_address</span><span class="p">,</span>   
        <span class="nv">"to"</span> <span class="k">AS</span> <span class="n">to_address</span><span class="p">,</span>  
        <span class="n">nonce</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span>  
        <span class="n">value</span><span class="p">,</span> <span class="k">data</span>  
    <span class="k">FROM</span> 
	    <span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span>  
    <span class="k">WHERE</span>  
        <span class="nb">TIMESTAMP</span> <span class="s1">'2023-05-01'</span> <span class="o">&lt;=</span> <span class="n">block_time</span>
        <span class="k">AND</span> <span class="n">block_time</span> <span class="o">&lt;</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2023-05-08'</span>  
        <span class="k">AND</span> <span class="n">success</span> <span class="o">=</span> <span class="k">true</span>  
        <span class="k">AND</span> <span class="k">data</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span><span class="n">x</span>  
<span class="p">),</span>  
<span class="n">CTE_raw_new</span> <span class="k">AS</span> <span class="p">(</span> 
    <span class="k">SELECT</span> 
	    <span class="o">*</span>   
    <span class="k">FROM</span> 
	    <span class="n">CTE_raw</span>  
    <span class="k">WHERE</span> 
	    <span class="n">from_address</span> <span class="k">IN</span> <span class="p">(</span>  
	        <span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">from_address</span>  
	        <span class="k">FROM</span> <span class="n">CTE_raw</span>  
	        <span class="k">WHERE</span> <span class="n">nonce</span> <span class="o">=</span> <span class="mi">0</span>  
	    <span class="p">)</span>  
<span class="p">),</span>  
<span class="n">CTE_ca_new_list</span> <span class="k">AS</span> <span class="p">(</span>  
    <span class="k">SELECT</span>  
        <span class="n">to_address</span><span class="p">,</span>  
        <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">from_address</span><span class="p">)</span> <span class="k">AS</span> <span class="n">address_cnt</span>  
    <span class="k">FROM</span> 
	    <span class="n">CTE_raw_new</span>  
    <span class="k">GROUP</span> <span class="k">BY</span> 
	    <span class="n">to_address</span>  
    <span class="k">ORDER</span> <span class="k">BY</span> 
	    <span class="n">address_cnt</span> <span class="k">DESC</span>  
    <span class="k">LIMIT</span> 
	    <span class="mi">100</span>  
<span class="p">)</span>  
<span class="k">SELECT</span> 
	<span class="o">*</span> 
<span class="k">FROM</span> 
	<span class="n">CTE_ca_new_list</span><span class="p">;</span>
</code></pre></div></div>

<p>Now, let‚Äôs identify the top 2 contracts from the table shown below.</p>

<p><strong>Rank 1. Tether USD (USDT) Contract</strong></p>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/etherscan-usdt.webp" alt="" /></p>

<p>Tether USD (USDT), being a widely traded stablecoin on the Ethereum Network, does not reveal any significant changes in the new user experience.</p>

<p><strong>Rank 2. Uniswap Universal Router Contract</strong></p>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/etherscan-uniswap.webp" alt="" /></p>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/universal-router.webp" alt="" /></p>
<blockquote>
  <p><a href="https://blog.uniswap.org/permit2-and-universal-router">Permit2 and Universal Router</a></p>
</blockquote>

<p>Now we‚Äôve idenfified it. The Uniswap Universal Router, introduced in November 2022, has been instrumental in enhancing the positive user experience on the Ethereum Network.</p>

<p><img src="/assets/2023-05-29-ethereum-on-chain-data/universal-router-flowchart.webp" alt="" /></p>
<blockquote>
  <p><a href="https://blog.uniswap.org/permit2-and-universal-router">Permit2 and Universal Router</a></p>
</blockquote>

<p>As demonstrated above, we can execute multiple separate swaps in a single transaction, resulting in lowe gas fees.</p>

<h1 id="6--conclusion">6.  Conclusion</h1>

<ol>
  <li>In May 2023, new addresses exhibit the second-highest retention rate since January 2022.</li>
  <li>This abrupt increase in the retention rate appears to be significantly influenced by the swift and widespread adoption of the Uniswap Universal Router.</li>
</ol>

<hr />

<h2 id="published-by-joshua-kim"><em>Published by</em> Joshua Kim</h2>
<p><img src="/assets/profile/joshua-profile.png" alt="Joshua Kim" /></p>]]></content><author><name></name></author><category term="english" /><category term="sql" /><category term="blockchain" /><category term="on_chain_data" /><category term="data_analytics" /><summary type="html"><![CDATA[In this article, I‚Äôm going to deep dive into Ethereum On-chain Data Analysis not just with the DAU and MAU, but also with Stickiness, and Retention Rate, which are the basic metrics when it comes to data analysis. Let‚Äôs directly dive into it!]]></summary></entry><entry><title type="html">Let‚Äôs Create the Sankey Chart</title><link href="http://localhost:4000/sankey-chart/" rel="alternate" type="text/html" title="Let‚Äôs Create the Sankey Chart" /><published>2023-05-21T00:00:00+09:00</published><updated>2023-05-21T00:00:00+09:00</updated><id>http://localhost:4000/sankey-chart</id><content type="html" xml:base="http://localhost:4000/sankey-chart/"><![CDATA[<blockquote>
  <p>In this article, I‚Äôm going to tell you how you can create the Sankey Chart starting from GA4, BigQuery, and up to Redash.</p>
</blockquote>

<h3 id="contents">CONTENTS</h3>
<ol>
  <li>Introduction</li>
  <li><strong>Flatten</strong> the source table.</li>
  <li>Make sure each <strong>user</strong> and <strong>session</strong> has the same properties(or parameters).</li>
  <li>Delete the consecutive same <strong>page URL duplicates</strong> in the same <code class="language-plaintext highlighter-rouge">session_id</code>.</li>
  <li>Label each page‚Äôs <strong>visiting order number</strong> for each session.</li>
  <li><strong>Categorize</strong> all the pages.</li>
  <li>Pivot each session‚Äôs journey up to <strong>10 steps</strong>.</li>
  <li>Make the query result compatible with <strong>Redash</strong>.</li>
  <li>Final Result</li>
  <li>Conclusion</li>
</ol>

<hr />

<p><img src="/assets/2023-05-21-sankey-chart/Data Pipeline from the website all the way up to Redash.webp" alt="" /></p>
<blockquote>
  <p>Data Pipeline from the website all the way up to Redash</p>
</blockquote>

<h1 id="1-introduction">1. Introduction</h1>

<h2 id="11-what-is-sankey-chart">1.1. What is Sankey Chart?</h2>

<p><img src="/assets/2023-05-21-sankey-chart/Sankey-Diagram.webp" alt="" /></p>
<blockquote>
  <p><a href="https://www.originlab.com/doc/Origin-Help/Sankey-Diagram">Source</a></p>
</blockquote>

<p><strong>Sankey Chart</strong>, oftentimes also called Sankey Diagram, is a type of flow visualization in which the width of the arrows is proportional to the flow rate of the depicted extensive property. [<a href="https://en.wikipedia.org/wiki/Sankey_diagram">Wikipedia</a>]</p>

<h2 id="12-why-is-sankey-chart-important-in-data-analytics">1.2. Why is Sankey Chart Important in Data Analytics?</h2>

<p>In the Data Analytics world, though, we can figure out how our visitors make their journey throughout our website pages or app screens. With the Sankey Chart, we can apply <strong>our strategies</strong> as shown below.</p>
<ul>
  <li>‚ÄúMany purchasing visitors mainly make a journey starting from <code class="language-plaintext highlighter-rouge">page A</code>, <code class="language-plaintext highlighter-rouge">page B</code>, <code class="language-plaintext highlighter-rouge">page C</code>, and finally make their purchase. Therefore, we might be able to create a CTA button in order to drive the other visitors to this journey, so that we could make our revenue much higher.‚Äù</li>
  <li>‚Äú<code class="language-plaintext highlighter-rouge">Page A</code> and <code class="language-plaintext highlighter-rouge">Page B</code> are the points where our visitors bounce off the most. Bet those two pages have some problems in terms of psychology or technology. Let‚Äôs now dive into specific user interviews or research to deal with this bounce-off rate.‚Äù</li>
</ul>

<h2 id="13-limitations-of-google-analytics-4">1.3. Limitations of Google Analytics 4</h2>

<p>Although GA4 supports some custom visualizations and you can explore the path analysis to figure out how your visitors take their journey throughout the websites, it‚Äôs literally awful and much of a hassle if you‚Äôre eager to get some insights regarding that. (See below how awful it is.)</p>

<p><img src="/assets/2023-05-21-sankey-chart/GA4‚Äôs Path Analysis.webp" alt="" /></p>

<p>Now that hopefully you got deeply understood what is the Sankey Chart and why it‚Äôs important in product analytics, it‚Äôs time to show you <strong>how to create the Sankey Chart from A to Z</strong>. Let‚Äôs directly dive into it!</p>

<h1 id="2-flatten-the-source-table">2. Flatten the source table.</h1>

<p>Although it‚Äôs really handy to connect the GA4 events to BigQuery, there‚Äôs a complicated issue hard to handle; Some of the datatypes imported to BigQuery are <code class="language-plaintext highlighter-rouge">STRUCT</code> type. It‚Äôs regarded as an array type, or you can imagine this as a <code class="language-plaintext highlighter-rouge">STRUCT</code> type column that allows each row to have a multiple-dimensional value in it.</p>

<p><img src="/assets/2023-05-21-sankey-chart/address_history.webp" alt="" />
<img src="/assets/2023-05-21-sankey-chart/1. Flatten the Table.webp" alt="" /></p>
<blockquote>
  <p><a href="https://medium.com/google-cloud/how-to-work-with-array-and-structs-in-bigquery-9c0a2ea584a6">Source</a></p>
</blockquote>

<p>You can simply use <code class="language-plaintext highlighter-rouge">UNNEST</code> to flatten each <code class="language-plaintext highlighter-rouge">STRUCT</code> type column in advance of your main query.</p>

<h2 id="21-the-entire-codes">2.1. The Entire Codes</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span>
<span class="n">CTE_flattened</span> <span class="k">AS</span> <span class="p">(</span>
	<span class="k">SELECT</span>
		<span class="n">event_date</span><span class="p">,</span>
		<span class="n">event_timestamp</span><span class="p">,</span>
		<span class="n">user_pseudo_id</span><span class="p">,</span>
		<span class="n">ga_session_id</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">int_value</span> <span class="k">AS</span> <span class="n">session_id</span><span class="p">,</span>
		<span class="n">ga_session_number</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">int_value</span> <span class="k">AS</span> <span class="n">session_number</span><span class="p">,</span>
		<span class="n">event_name</span><span class="p">,</span>
		<span class="n">page_location</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">string_value</span> <span class="k">AS</span> <span class="n">page_location</span><span class="p">,</span>
		<span class="n">ecommerce</span><span class="p">.</span><span class="n">purchase_revenue_in_usd</span> <span class="k">AS</span> <span class="n">revenue_usd</span><span class="p">,</span>
		<span class="n">geo</span><span class="p">.</span><span class="n">country</span><span class="p">,</span>
		<span class="n">device</span><span class="p">.</span><span class="n">category</span> <span class="k">AS</span> <span class="n">device</span><span class="p">,</span>
		<span class="n">utm_campaign</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">string_value</span> <span class="k">AS</span> <span class="n">utm_campaign</span><span class="p">,</span>  
		<span class="n">utm_medium</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">string_value</span> <span class="k">AS</span> <span class="n">utm_medium</span><span class="p">,</span>  
		<span class="n">utm_source</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">string_value</span> <span class="k">AS</span> <span class="n">utm_source</span><span class="p">,</span>  
		<span class="n">page_referrer</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">string_value</span> <span class="k">AS</span> <span class="n">page_referrer</span>  
	<span class="k">FROM</span>
		<span class="nv">`your_table.events_*`</span>  
	<span class="k">LEFT</span> <span class="k">JOIN</span>
		<span class="k">UNNEST</span> <span class="p">(</span><span class="n">event_params</span><span class="p">)</span> <span class="k">AS</span> <span class="n">ga_session_id</span>
		<span class="k">ON</span> <span class="n">ga_session_id</span><span class="p">.</span><span class="k">key</span> <span class="o">=</span> <span class="s1">'ga_session_id'</span>  
	<span class="k">LEFT</span> <span class="k">JOIN</span>
		<span class="k">UNNEST</span> <span class="p">(</span><span class="n">event_params</span><span class="p">)</span> <span class="k">AS</span> <span class="n">ga_session_number</span>
		<span class="k">ON</span> <span class="n">ga_session_number</span><span class="p">.</span><span class="k">key</span> <span class="o">=</span> <span class="s1">'ga_session_number'</span>  
	<span class="k">LEFT</span> <span class="k">JOIN</span>
		<span class="k">UNNEST</span> <span class="p">(</span><span class="n">event_params</span><span class="p">)</span> <span class="k">AS</span> <span class="n">page_location</span>
		<span class="k">ON</span> <span class="n">page_location</span><span class="p">.</span><span class="k">key</span> <span class="o">=</span> <span class="s1">'page_location'</span>  
	<span class="k">LEFT</span> <span class="k">JOIN</span>
		<span class="k">UNNEST</span> <span class="p">(</span><span class="n">event_params</span><span class="p">)</span> <span class="k">AS</span> <span class="n">utm_campaign</span>
		<span class="k">ON</span> <span class="n">utm_campaign</span><span class="p">.</span><span class="k">key</span> <span class="o">=</span> <span class="s1">'campaign'</span>  
	<span class="k">LEFT</span> <span class="k">JOIN</span>
		<span class="k">UNNEST</span> <span class="p">(</span><span class="n">event_params</span><span class="p">)</span> <span class="k">AS</span> <span class="n">utm_medium</span>
		<span class="k">ON</span> <span class="n">utm_medium</span><span class="p">.</span><span class="k">key</span> <span class="o">=</span> <span class="s1">'medium'</span>  
	<span class="k">LEFT</span> <span class="k">JOIN</span>
		<span class="k">UNNEST</span> <span class="p">(</span><span class="n">event_params</span><span class="p">)</span> <span class="k">AS</span> <span class="n">utm_source</span>
		<span class="k">ON</span> <span class="n">utm_source</span><span class="p">.</span><span class="k">key</span> <span class="o">=</span> <span class="s1">'source'</span>  
	<span class="k">LEFT</span> <span class="k">JOIN</span>
		<span class="k">UNNEST</span> <span class="p">(</span><span class="n">event_params</span><span class="p">)</span> <span class="k">AS</span> <span class="n">page_referrer</span>
		<span class="k">ON</span> <span class="n">page_referrer</span><span class="p">.</span><span class="k">key</span> <span class="o">=</span> <span class="s1">'page_referrer'</span>  
	<span class="k">WHERE</span>  
		<span class="n">_table_suffix</span> <span class="k">BETWEEN</span>
		<span class="n">FORMAT_DATE</span><span class="p">(</span>
			<span class="s1">'%Y%m%d'</span><span class="p">,</span>
			<span class="n">DATE_SUB</span><span class="p">(</span><span class="k">CURRENT_DATE</span><span class="p">(),</span> <span class="n">INTERVAL</span> <span class="mi">90</span> <span class="k">DAY</span><span class="p">)</span>
		<span class="p">)</span>
		<span class="k">AND</span>
		<span class="n">FORMAT_DATE</span><span class="p">(</span>
			<span class="s1">'%Y%m%d'</span><span class="p">,</span>
			<span class="k">CURRENT_DATE</span><span class="p">()</span>
		<span class="p">)</span>
		<span class="k">AND</span> <span class="n">ga_session_number</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">int_value</span> <span class="o">=</span> <span class="mi">1</span>  
		<span class="k">AND</span> <span class="n">user_pseudo_id</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
		<span class="k">AND</span> <span class="n">ga_session_id</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
<span class="p">),</span>
</code></pre></div></div>

<h2 id="22-detailed-explanation-of-key-codes">2.2. Detailed Explanation of Key Codes</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">LEFT</span> <span class="k">JOIN</span>
	<span class="k">UNNEST</span> <span class="p">(</span><span class="n">event_params</span><span class="p">)</span> <span class="k">AS</span> <span class="n">ga_session_id</span>
	<span class="k">ON</span> <span class="n">ga_session_id</span><span class="p">.</span><span class="k">key</span> <span class="o">=</span> <span class="err">‚Äò</span><span class="n">ga_session_id</span><span class="err">‚Äô</span>
</code></pre></div></div>
<ul>
  <li>Each <code class="language-plaintext highlighter-rouge">event</code> may have <code class="language-plaintext highlighter-rouge">ga_session_id</code> in its parameters, and we have to grab it in order to follow through each user session‚Äôs journey based on the <code class="language-plaintext highlighter-rouge">ga_session_id</code>.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">LEFT</span> <span class="k">JOIN</span>
	<span class="k">UNNEST</span> <span class="p">(</span><span class="n">event_params</span><span class="p">)</span> <span class="k">AS</span> <span class="n">ga_session_number</span>
	<span class="k">ON</span> <span class="n">ga_session_number</span><span class="p">.</span><span class="k">key</span> <span class="o">=</span> <span class="err">‚Äò</span><span class="n">ga_session_number</span><span class="err">‚Äô</span>
</code></pre></div></div>
<ul>
  <li>Each <code class="language-plaintext highlighter-rouge">event</code> may have <code class="language-plaintext highlighter-rouge">ga_session_number</code> in its parameters, and we have to look through it in order to know if each <code class="language-plaintext highlighter-rouge">session</code> is the <strong>first visiting user‚Äôs</strong> or <strong>returning user‚Äôs</strong> session.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">LEFT</span> <span class="k">JOIN</span>
	<span class="k">UNNEST</span> <span class="p">(</span><span class="n">event_params</span><span class="p">)</span> <span class="k">AS</span> <span class="n">page_location</span>
	<span class="k">ON</span> <span class="n">page_location</span><span class="p">.</span><span class="k">key</span> <span class="o">=</span> <span class="err">‚Äò</span><span class="n">page_location</span><span class="err">‚Äô</span>
</code></pre></div></div>
<ul>
  <li>Most of each <code class="language-plaintext highlighter-rouge">event</code> has <code class="language-plaintext highlighter-rouge">page_location</code> in its parameters, and of course, we have to know <code class="language-plaintext highlighter-rouge">page_location</code> in order to follow through with their journey based on the <strong>page URL</strong>.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">LEFT</span> <span class="k">JOIN</span>
	<span class="k">UNNEST</span> <span class="p">(</span><span class="n">event_params</span><span class="p">)</span> <span class="k">AS</span> <span class="n">utm_campaign</span>
	<span class="k">ON</span> <span class="n">utm_campaign</span><span class="p">.</span><span class="k">key</span> <span class="o">=</span> <span class="err">‚Äò</span><span class="n">campaign</span><span class="err">‚Äô</span>
</code></pre></div></div>
<ul>
  <li>Many times, each <code class="language-plaintext highlighter-rouge">session</code> has a totally different shape of the journey depending on what kind of <strong>campaign channel</strong> the session has started from. Therefore, let‚Äôs also query <code class="language-plaintext highlighter-rouge">utm_campaign</code> just in case.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">LEFT</span> <span class="k">JOIN</span>
	<span class="k">UNNEST</span> <span class="p">(</span><span class="n">event_params</span><span class="p">)</span> <span class="k">AS</span> <span class="n">utm_medium</span>
	<span class="k">ON</span> <span class="n">utm_medium</span><span class="p">.</span><span class="k">key</span> <span class="o">=</span> <span class="err">‚Äò</span><span class="n">medium</span><span class="err">‚Äô</span>
</code></pre></div></div>
<ul>
  <li>Many times, each <code class="language-plaintext highlighter-rouge">session</code> has a totally different shape of the journey depending on what kind of <strong>medium channel</strong> the session has started from. Therefore, let‚Äôs also query <code class="language-plaintext highlighter-rouge">utm_medium</code> just in case.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">LEFT</span> <span class="k">JOIN</span>
	<span class="k">UNNEST</span> <span class="p">(</span><span class="n">event_params</span><span class="p">)</span> <span class="k">AS</span> <span class="n">utm_source</span>
	<span class="k">ON</span> <span class="n">utm_source</span><span class="p">.</span><span class="k">key</span> <span class="o">=</span> <span class="err">‚Äò</span><span class="k">source</span><span class="err">‚Äô</span>
</code></pre></div></div>
<ul>
  <li>Many times, each <code class="language-plaintext highlighter-rouge">session</code> has a totally different shape of the journey depending on what kind of <strong>source channel</strong> the session has started from. Therefore, let‚Äôs also query <code class="language-plaintext highlighter-rouge">utm_source</code> just in case.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">LEFT</span> <span class="k">JOIN</span>
	<span class="k">UNNEST</span> <span class="p">(</span><span class="n">event_params</span><span class="p">)</span> <span class="k">AS</span> <span class="n">page_referrer</span>
	<span class="k">ON</span> <span class="n">page_referrer</span><span class="p">.</span><span class="k">key</span> <span class="o">=</span> <span class="err">‚Äò</span><span class="n">page_referrer</span><span class="err">‚Äô</span>
</code></pre></div></div>
<ul>
  <li>Many times, each <code class="language-plaintext highlighter-rouge">session</code> has a totally different shape of the journey depending on exactly what <strong>previous page URL</strong> the session has started from. Therefore, let‚Äôs also query <code class="language-plaintext highlighter-rouge">page_referrer</code> just in case.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">AND</span> <span class="n">ga_session_number</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">int_value</span> <span class="o">=</span> <span class="mi">1</span>  
<span class="k">AND</span> <span class="n">user_pseudo_id</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
<span class="k">AND</span> <span class="n">ga_session_id</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>
</code></pre></div></div>
<ul>
  <li>Here, I wanted to know specifically about the <strong>first visiting users‚Äô journey</strong>, and that‚Äôs why I try to query with <code class="language-plaintext highlighter-rouge">ga_session_number</code> only as <code class="language-plaintext highlighter-rouge">1</code>.</li>
  <li>We basically have to track the <code class="language-plaintext highlighter-rouge">user_pseudo_id</code> and <code class="language-plaintext highlighter-rouge">ga_session_id</code> in order to <strong>make sure each user journey has been there from the same user and same session</strong>. That‚Äôs why I dropped all the missing <code class="language-plaintext highlighter-rouge">user_pseudo_id</code> and <code class="language-plaintext highlighter-rouge">ga_session_id</code> instances.</li>
</ul>

<h1 id="3-make-sure-each-user-and-session-has-the-same-propertiesor-parameters">3. Make sure each user and session has the same properties(or parameters).</h1>

<p>Sometimes, even though it‚Äôs rooted in the same <code class="language-plaintext highlighter-rouge">session_id</code>, some events have their parameters fully, but others don‚Äôt. That‚Äôs why we make duplicates for the parameters throughout the same <code class="language-plaintext highlighter-rouge">user_pseudo_id</code> and <code class="language-plaintext highlighter-rouge">session_id</code>.</p>

<p><img src="/assets/2023-05-21-sankey-chart/ This is a real BigQuery table appended from GA4, and look only one event has the medium value.webp" alt="" /></p>
<blockquote>
  <p>This is a real <strong>BigQuery</strong> table appended from GA4, and you can look only one event has the medium value.</p>
</blockquote>

<h2 id="31-the-entire-codes">3.1. The Entire Codes</h2>

<p>You can use <code class="language-plaintext highlighter-rouge">FIRST_VALUE</code> and <code class="language-plaintext highlighter-rouge">LAST_VALUE</code> functions to make the duplicates.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CTE_properties_spread</span> <span class="k">AS</span> <span class="p">(</span>  
    <span class="k">SELECT</span>  
        <span class="n">event_date</span><span class="p">,</span>
        <span class="n">event_timestamp</span><span class="p">,</span>  
        <span class="n">user_pseudo_id</span><span class="p">,</span>
        <span class="n">session_id</span><span class="p">,</span>
        <span class="n">session_number</span><span class="p">,</span>  
        <span class="n">event_name</span><span class="p">,</span> 
        <span class="n">REGEXP_REPLACE</span><span class="p">(</span>
	        <span class="n">REGEXP_REPLACE</span><span class="p">(</span>
		        <span class="k">LOWER</span><span class="p">(</span><span class="n">page_location</span><span class="p">),</span> 
		        <span class="n">r</span><span class="s1">'(</span><span class="se">\?</span><span class="s1">.*)$'</span><span class="p">,</span> <span class="s1">''</span>
	        <span class="p">),</span>
	        <span class="n">r</span><span class="s1">'/$'</span><span class="p">,</span> <span class="s1">''</span>
        <span class="p">)</span> <span class="k">AS</span> <span class="n">page_location</span><span class="p">,</span>
        <span class="n">revenue_usd</span><span class="p">,</span>  
        <span class="n">FIRST_VALUE</span><span class="p">(</span><span class="n">country</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
	        <span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span>
	        <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">event_timestamp</span>
        <span class="p">)</span> <span class="k">AS</span> <span class="n">country</span><span class="p">,</span>  
        <span class="n">FIRST_VALUE</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
	        <span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span>
	        <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">event_timestamp</span>
        <span class="p">)</span> <span class="k">AS</span> <span class="n">device</span><span class="p">,</span>  
        <span class="n">LAST_VALUE</span><span class="p">(</span><span class="n">utm_campaign</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
	        <span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span>
	        <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">event_timestamp</span>
        <span class="p">)</span> <span class="k">AS</span> <span class="n">utm_campaign</span><span class="p">,</span>  
        <span class="n">LAST_VALUE</span><span class="p">(</span><span class="n">utm_medium</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
	        <span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span>
	        <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">event_timestamp</span>
        <span class="p">)</span> <span class="k">AS</span> <span class="n">utm_medium</span><span class="p">,</span>  
        <span class="n">LAST_VALUE</span><span class="p">(</span><span class="n">utm_source</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
	        <span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span>
	        <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">event_timestamp</span>
        <span class="p">)</span> <span class="k">AS</span> <span class="n">utm_source</span><span class="p">,</span>  
        <span class="n">LAST_VALUE</span><span class="p">(</span>
	        <span class="n">REGEXP_REPLACE</span><span class="p">(</span>
		        <span class="n">REGEXP_REPLACE</span><span class="p">(</span>
			        <span class="k">LOWER</span><span class="p">(</span><span class="n">page_referrer</span><span class="p">),</span> 
			        <span class="n">r</span><span class="s1">'(</span><span class="se">\?</span><span class="s1">.*)$'</span><span class="p">,</span> <span class="s1">''</span>
		        <span class="p">),</span> 
		        <span class="n">r</span><span class="s1">'/$'</span><span class="p">,</span> <span class="s1">''</span>
	        <span class="p">)</span>
        <span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
	        <span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span> 
	        <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">event_timestamp</span>
        <span class="p">)</span> <span class="k">AS</span> <span class="n">page_referrer</span>  
    <span class="k">FROM</span>
	    <span class="n">CTE_flattened</span> 
<span class="p">),</span>
</code></pre></div></div>

<h2 id="32-detailed-explanation-of-key-codes">3.2. Detailed Explanation of Key Codes</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">REGEXP_REPLACE</span><span class="p">(</span>
	<span class="n">REGEXP_REPLACE</span><span class="p">(</span>
		<span class="k">LOWER</span><span class="p">(</span><span class="n">page_location</span><span class="p">),</span> 
		<span class="n">r</span><span class="s1">'(</span><span class="se">\?</span><span class="s1">.*)$'</span><span class="p">,</span> <span class="s1">''</span>
	<span class="p">),</span>
	<span class="n">r</span><span class="s1">'/$'</span><span class="p">,</span> <span class="s1">''</span>
<span class="p">)</span> <span class="k">AS</span> <span class="n">page_location</span><span class="p">,</span>
</code></pre></div></div>
<ul>
  <li>Many times, the <strong>page URL</strong> has different shapes even though it drives the visitors to the exact same page.</li>
  <li>The four URLs below have different values, but they direct you to the same Google main page anyways.
    <ul>
      <li><a href="https://google.com/">https://google.com</a></li>
      <li><a href="https://google.com/">https://google.com/</a></li>
      <li><a href="https://google.com?utm_source=medium">https://google.com?utm_source=medium</a></li>
      <li><a href="https://google.com/?utm_source=medium">https://google.com/?utm_source=medium</a></li>
    </ul>
  </li>
  <li>That‚Äôs why I use the <code class="language-plaintext highlighter-rouge">REGEXP_REPLACE</code> function to <strong>drop the useless letters</strong> in data analytics.</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FIRST_VALUE</span><span class="p">(</span><span class="n">country</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
	<span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span>
	<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">event_timestamp</span>
<span class="p">)</span> <span class="k">AS</span> <span class="n">country</span>
</code></pre></div></div>
<ul>
  <li>Because of some technical problems, one user and session might have multiple countries. (I‚Äôm guessing some users might have moved overseas, changed IP Address through VPNs, or GA4‚Äôs tech issue itself.) Regarding this issue, I would make a decision to <strong>grab the very first country value</strong> to know where the <code class="language-plaintext highlighter-rouge">user</code> and <code class="language-plaintext highlighter-rouge">session</code> have started.</li>
  <li>Let‚Äôs assume a visitor is aboard a plane, and when he/she starts the session the plane is located in the <strong>US</strong>, but when visiting the following page, the plane has just entered the <strong>Canada</strong> area. In this extreme case, we‚Äôd rather think of this visitor as starting from the <strong>US</strong>.</li>
</ul>

<h1 id="4-delete-the-consecutive-same-page-url-duplicates-in-the-same-session_id">4. Delete the consecutive same page URL duplicates in the same <code class="language-plaintext highlighter-rouge">session_id</code>.</h1>

<p>In most cases, if a visitor lands on page A, multiple events can happen.</p>
<ul>
  <li>i.e., <code class="language-plaintext highlighter-rouge">session_start</code>, <code class="language-plaintext highlighter-rouge">page_view</code>, <code class="language-plaintext highlighter-rouge">user_engagement</code>, <code class="language-plaintext highlighter-rouge">scroll</code>, and whatnot</li>
</ul>

<p>We need to delete all the same Page URLs triggered consecutively in one session, but <strong>only with the unique page URL</strong>.</p>

<h2 id="41-the-entire-codes">4.1. The Entire Codes</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CTE_unique_pages</span> <span class="k">AS</span> <span class="p">(</span>
	<span class="k">SELECT</span>  
        <span class="n">event_date</span><span class="p">,</span> <span class="n">event_timestamp</span><span class="p">,</span>  
        <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">session_number</span><span class="p">,</span>  
        <span class="n">event_name</span><span class="p">,</span>  
        <span class="n">page_location</span><span class="p">,</span>          
        <span class="n">LAG</span><span class="p">(</span><span class="n">page_location</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
	        <span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span> 
	        <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">event_timestamp</span>
        <span class="p">)</span> <span class="k">AS</span> <span class="n">previous_page_location</span><span class="p">,</span>  
        <span class="n">LEAD</span><span class="p">(</span><span class="n">page_location</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
	        <span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span> 
	        <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">event_timestamp</span>
        <span class="p">)</span> <span class="k">AS</span> <span class="n">next_page_location</span><span class="p">,</span>  
        <span class="n">revenue_usd</span><span class="p">,</span>  
        <span class="n">country</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span>  
        <span class="n">utm_campaign</span><span class="p">,</span> <span class="n">utm_medium</span><span class="p">,</span> <span class="n">utm_source</span><span class="p">,</span> <span class="n">page_referrer</span>      
    <span class="k">FROM</span> <span class="p">(</span>  
        <span class="k">SELECT</span>  
            <span class="o">*</span><span class="p">,</span>  
            <span class="k">CASE</span>  
	            <span class="k">WHEN</span> <span class="c1">-- Previous URL IS NULL  </span>
                    <span class="n">previous_page_location</span> <span class="k">IS</span> <span class="k">NULL</span> <span class="k">THEN</span> <span class="s1">'remain'</span>  
                <span class="k">WHEN</span> <span class="c1">-- Previous URL &lt;&gt; Current URL  </span>
                    <span class="n">previous_page_location</span> <span class="o">&lt;&gt;</span> <span class="n">page_location</span> <span class="k">THEN</span> <span class="s1">'remain'</span>  
                <span class="k">WHEN</span> <span class="c1">-- Previous URL = Current URL  </span>
                    <span class="n">previous_page_location</span> <span class="o">=</span> <span class="n">page_location</span> 
                    <span class="k">AND</span> <span class="n">page_location</span> <span class="o">&lt;&gt;</span> <span class="n">next_page_location</span> <span class="k">THEN</span> <span class="s1">'del'</span>  
            <span class="k">END</span> <span class="k">AS</span> <span class="n">remain_or_del</span>  
        <span class="k">FROM</span> <span class="p">(</span>  
            <span class="k">SELECT</span>  
                <span class="n">event_date</span><span class="p">,</span> <span class="n">event_timestamp</span><span class="p">,</span>  
                <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">session_number</span><span class="p">,</span>  
                <span class="n">event_name</span><span class="p">,</span>
                <span class="n">page_location</span><span class="p">,</span>          
                <span class="n">LAG</span><span class="p">(</span><span class="n">page_location</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
	                <span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span>
	                <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">event_timestamp</span>
                <span class="p">)</span> <span class="k">AS</span> <span class="n">previous_page_location</span><span class="p">,</span>  
                <span class="n">LEAD</span><span class="p">(</span><span class="n">page_location</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span>
	                <span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span> 
	                <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">event_timestamp</span>
                <span class="p">)</span> <span class="k">AS</span> <span class="n">next_page_location</span><span class="p">,</span>  
                <span class="n">revenue_usd</span><span class="p">,</span>  
                <span class="n">country</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span>  
                <span class="n">utm_campaign</span><span class="p">,</span> <span class="n">utm_medium</span><span class="p">,</span> <span class="n">utm_source</span><span class="p">,</span> <span class="n">page_referrer</span>  
            <span class="k">FROM</span> <span class="n">CTE_properties_spread</span>  
        <span class="p">)</span>  
    <span class="p">)</span>  
    <span class="k">WHERE</span>
	    <span class="n">remain_or_del</span> <span class="o">=</span> <span class="s1">'remain'</span>  
    <span class="k">ORDER</span> <span class="k">BY</span> 
	    <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">event_timestamp</span>  
<span class="p">),</span>
</code></pre></div></div>

<p>Here in the query above, I used <code class="language-plaintext highlighter-rouge">LAG</code> and <code class="language-plaintext highlighter-rouge">LEAD</code> window functions <strong>to know whether to delete duplicates</strong> based on the previous page URL and the next page URL.</p>

<h1 id="5-label-each-pages-visiting-order-number-for-each-session">5. Label each page‚Äôs visiting order number for each session.</h1>

<p>We can Label <code class="language-plaintext highlighter-rouge">visit_order</code> for each page URL based on the <code class="language-plaintext highlighter-rouge">event_timestamp</code> <strong>in ascending order</strong>.</p>
<ul>
  <li>Here, I used the <code class="language-plaintext highlighter-rouge">ROW_NUMBER</code> window function to do it.</li>
</ul>

<h2 id="51-the-entire-codes">5.1. The Entire Codes</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CTE_visit_orders</span> <span class="k">AS</span> <span class="p">(</span>  
    <span class="k">SELECT</span>  
        <span class="n">event_date</span><span class="p">,</span> <span class="n">event_timestamp</span><span class="p">,</span>  
        <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span>  
        <span class="n">page_location</span><span class="p">,</span>
        <span class="n">ROW_NUMBER</span><span class="p">()</span> <span class="n">OVER</span><span class="p">(</span>
	        <span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span> 
	        <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">event_timestamp</span>
        <span class="p">)</span> <span class="k">AS</span> <span class="n">visit_order</span><span class="p">,</span>  
        <span class="n">country</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span>  
        <span class="n">utm_campaign</span><span class="p">,</span> <span class="n">utm_medium</span><span class="p">,</span> <span class="n">utm_source</span><span class="p">,</span> <span class="n">page_referrer</span>  
    <span class="k">FROM</span>
	    <span class="n">CTE_unique_pages</span>  
    <span class="k">ORDER</span> <span class="k">BY</span> 
	    <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">visit_order</span>  
<span class="p">),</span>
</code></pre></div></div>

<h1 id="6-categorize-all-the-pages">6. Categorize all the pages.</h1>

<p>The page URL itself looks dirty since it‚Äôs not that human-readable, so here I wanted to <strong>categorize all the pages</strong> existing in the whole domain to <strong>make them literally human-readable</strong>.</p>

<h2 id="61-the-entire-codes">6.1. The Entire Codes</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CTE_page_groups</span> <span class="k">AS</span> <span class="p">(</span>  
    <span class="k">SELECT</span>  
        <span class="n">event_date</span><span class="p">,</span> <span class="n">event_timestamp</span><span class="p">,</span>  
        <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span>  
        <span class="n">page_location</span><span class="p">,</span>   
        <span class="k">CASE</span>  
            <span class="k">WHEN</span> <span class="n">page_location</span> <span class="o">=</span> <span class="s1">'https://google.com'</span> <span class="k">THEN</span> <span class="s1">'Google Home'</span>  
            <span class="k">WHEN</span> <span class="n">page_location</span> <span class="o">=</span> <span class="s1">'https://google.com/joshua'</span> <span class="k">THEN</span> <span class="s1">'Joshua Intro'</span>  
            <span class="k">WHEN</span> <span class="n">page_location</span> <span class="o">=</span> <span class="s1">'https://google.com/andrew'</span> <span class="k">THEN</span> <span class="s1">'Andrew Intro'</span>  
            <span class="k">WHEN</span> <span class="n">page_location</span> <span class="o">=</span> <span class="s1">'https://google.com/amber'</span> <span class="k">THEN</span> <span class="s1">'Amber Intro'</span>  
            <span class="k">WHEN</span> <span class="n">CONTAINS_SUBSTR</span><span class="p">(</span><span class="n">page_location</span><span class="p">,</span> <span class="s1">'https://google.com/policy'</span><span class="p">)</span> <span class="o">=</span> <span class="k">True</span> <span class="k">THEN</span> <span class="s1">'Policy Pages'</span>  
            <span class="k">WHEN</span> <span class="n">CONTAINS_SUBSTR</span><span class="p">(</span><span class="n">page_location</span><span class="p">,</span> <span class="s1">'https://google.com/events'</span><span class="p">)</span> <span class="o">=</span> <span class="k">True</span> <span class="k">THEN</span> <span class="s1">'Event Pages'</span>  
            <span class="k">ELSE</span> <span class="s1">'ETC'</span>  
        <span class="k">END</span> <span class="k">AS</span> <span class="n">page_group</span><span class="p">,</span>  
        <span class="n">visit_order</span><span class="p">,</span>  
        <span class="n">country</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span>  
        <span class="n">utm_campaign</span><span class="p">,</span> <span class="n">utm_medium</span><span class="p">,</span> <span class="n">utm_source</span><span class="p">,</span> <span class="n">page_referrer</span>  
    <span class="k">FROM</span>
	    <span class="n">CTE_visit_orders</span>
    <span class="k">ORDER</span> <span class="k">BY</span> 
	    <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">visit_order</span>  
<span class="p">),</span>
</code></pre></div></div>

<h1 id="7-pivot-each-sessions-journey-up-to-10-steps">7. Pivot each session‚Äôs journey up to 10 steps.</h1>

<h2 id="71-the-entire-codes">7.1. The Entire Codes</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CTE_journeys</span> <span class="k">AS</span> <span class="p">(</span>  
    <span class="k">SELECT</span>  
        <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span>
        <span class="n">country</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> 
        <span class="n">utm_campaign</span><span class="p">,</span> <span class="n">utm_medium</span><span class="p">,</span> <span class="n">utm_source</span><span class="p">,</span> <span class="n">page_referrer</span><span class="p">,</span>  
        <span class="k">MAX</span><span class="p">((</span><span class="k">SELECT</span> <span class="n">page_group</span> <span class="k">FROM</span> <span class="n">CTE_page_groups</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="k">AND</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">session_id</span> <span class="k">AND</span> <span class="n">visit_order</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span> <span class="k">AS</span> <span class="n">step01</span><span class="p">,</span>  
        <span class="k">MAX</span><span class="p">((</span><span class="k">SELECT</span> <span class="n">page_group</span> <span class="k">FROM</span> <span class="n">CTE_page_groups</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="k">AND</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">session_id</span> <span class="k">AND</span> <span class="n">visit_order</span> <span class="o">=</span> <span class="mi">2</span><span class="p">))</span> <span class="k">AS</span> <span class="n">step02</span><span class="p">,</span>  
        <span class="k">MAX</span><span class="p">((</span><span class="k">SELECT</span> <span class="n">page_group</span> <span class="k">FROM</span> <span class="n">CTE_page_groups</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="k">AND</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">session_id</span> <span class="k">AND</span> <span class="n">visit_order</span> <span class="o">=</span> <span class="mi">3</span><span class="p">))</span> <span class="k">AS</span> <span class="n">step03</span><span class="p">,</span>  
        <span class="k">MAX</span><span class="p">((</span><span class="k">SELECT</span> <span class="n">page_group</span> <span class="k">FROM</span> <span class="n">CTE_page_groups</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="k">AND</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">session_id</span> <span class="k">AND</span> <span class="n">visit_order</span> <span class="o">=</span> <span class="mi">4</span><span class="p">))</span> <span class="k">AS</span> <span class="n">step04</span><span class="p">,</span>  
        <span class="k">MAX</span><span class="p">((</span><span class="k">SELECT</span> <span class="n">page_group</span> <span class="k">FROM</span> <span class="n">CTE_page_groups</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="k">AND</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">session_id</span> <span class="k">AND</span> <span class="n">visit_order</span> <span class="o">=</span> <span class="mi">5</span><span class="p">))</span> <span class="k">AS</span> <span class="n">step05</span><span class="p">,</span>          
        <span class="k">MAX</span><span class="p">((</span><span class="k">SELECT</span> <span class="n">page_group</span> <span class="k">FROM</span> <span class="n">CTE_page_groups</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="k">AND</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">session_id</span> <span class="k">AND</span> <span class="n">visit_order</span> <span class="o">=</span> <span class="mi">6</span><span class="p">))</span> <span class="k">AS</span> <span class="n">step06</span><span class="p">,</span>  
        <span class="k">MAX</span><span class="p">((</span><span class="k">SELECT</span> <span class="n">page_group</span> <span class="k">FROM</span> <span class="n">CTE_page_groups</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="k">AND</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">session_id</span> <span class="k">AND</span> <span class="n">visit_order</span> <span class="o">=</span> <span class="mi">7</span><span class="p">))</span> <span class="k">AS</span> <span class="n">step07</span><span class="p">,</span>  
        <span class="k">MAX</span><span class="p">((</span><span class="k">SELECT</span> <span class="n">page_group</span> <span class="k">FROM</span> <span class="n">CTE_page_groups</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="k">AND</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">session_id</span> <span class="k">AND</span> <span class="n">visit_order</span> <span class="o">=</span> <span class="mi">8</span><span class="p">))</span> <span class="k">AS</span> <span class="n">step08</span><span class="p">,</span>  
        <span class="k">MAX</span><span class="p">((</span><span class="k">SELECT</span> <span class="n">page_group</span> <span class="k">FROM</span> <span class="n">CTE_page_groups</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="k">AND</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">session_id</span> <span class="k">AND</span> <span class="n">visit_order</span> <span class="o">=</span> <span class="mi">9</span><span class="p">))</span> <span class="k">AS</span> <span class="n">step09</span><span class="p">,</span>  
        <span class="k">MAX</span><span class="p">((</span><span class="k">SELECT</span> <span class="n">page_group</span> <span class="k">FROM</span> <span class="n">CTE_page_groups</span> <span class="n">SUB</span>  
            <span class="k">WHERE</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">user_pseudo_id</span> <span class="k">AND</span> <span class="n">MAIN</span><span class="p">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">SUB</span><span class="p">.</span><span class="n">session_id</span> <span class="k">AND</span> <span class="n">visit_order</span> <span class="o">=</span> <span class="mi">10</span><span class="p">))</span> <span class="k">AS</span> <span class="n">step10</span>  
    <span class="k">FROM</span> <span class="n">CTE_page_groups</span> <span class="n">MAIN</span>  
    <span class="k">GROUP</span> <span class="k">BY</span>
        <span class="n">user_pseudo_id</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> 
        <span class="n">country</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> 
        <span class="n">utm_campaign</span><span class="p">,</span> <span class="n">utm_medium</span><span class="p">,</span> <span class="n">utm_source</span><span class="p">,</span> <span class="n">page_referrer</span>  
    <span class="k">ORDER</span> <span class="k">BY</span>  
        <span class="n">step01</span><span class="p">,</span> <span class="n">step02</span><span class="p">,</span> <span class="n">step03</span><span class="p">,</span> <span class="n">step04</span><span class="p">,</span> <span class="n">step05</span><span class="p">,</span> 
        <span class="n">step06</span><span class="p">,</span> <span class="n">step07</span><span class="p">,</span> <span class="n">step08</span><span class="p">,</span> <span class="n">step09</span><span class="p">,</span> <span class="n">step10</span>  
<span class="p">),</span>
</code></pre></div></div>

<h1 id="8-make-the-query-result-compatible-with-redash">8. Make the query result compatible with Redash.</h1>

<p>Since <strong>Redash Sankey Chart</strong> has its expected framework and naming rules of the query result, we need to make the final query result in order to fit the rule.</p>

<p><img src="/assets/2023-05-21-sankey-chart/Redash Sankey Visualization‚Äôs Constraints.webp" alt="" /></p>
<blockquote>
  <p>Redash Sankey Chart‚Äôs Constraints</p>
</blockquote>

<h2 id="81-the-entire-codes">8.1. The Entire Codes</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span>  
    <span class="n">step01</span> <span class="k">AS</span> <span class="n">stage1</span><span class="p">,</span>
    <span class="n">step02</span> <span class="k">AS</span> <span class="n">stage2</span><span class="p">,</span> 
    <span class="n">step03</span> <span class="k">AS</span> <span class="n">stage3</span><span class="p">,</span> 
    <span class="n">step04</span> <span class="k">AS</span> <span class="n">stage4</span><span class="p">,</span> 
    <span class="n">step05</span> <span class="k">AS</span> <span class="n">stage5</span><span class="p">,</span>  
    <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="n">value</span>  
<span class="k">FROM</span> 
	<span class="n">CTE_sankey</span>  
<span class="k">GROUP</span> <span class="k">BY</span> 
	<span class="n">step01</span><span class="p">,</span> <span class="n">step02</span><span class="p">,</span> <span class="n">step03</span><span class="p">,</span> <span class="n">step04</span><span class="p">,</span> <span class="n">step05</span>  
<span class="k">HAVING</span> 
	<span class="n">step01</span> <span class="o">=</span> <span class="s1">'Google Home'</span> 
	<span class="k">AND</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">100</span>  
<span class="k">ORDER</span> <span class="k">BY</span> 
	<span class="n">value</span> <span class="k">DESC</span>
<span class="p">;</span>
</code></pre></div></div>

<h2 id="82-detailed-explanation-of-key-codes">8.2. Detailed Explanation of Key Codes</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HAVING</span>
	<span class="n">step01</span> <span class="o">=</span> <span class="err">‚Äò</span><span class="n">Google</span> <span class="n">Home</span><span class="err">‚Äô</span> 
	<span class="k">AND</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">100</span>
</code></pre></div></div>

<ul>
  <li>I just wanted to see how the users make their journey who is <strong>starting from Google Home</strong>.</li>
  <li>To make the visualization look simple and not distracting, I ordered the query to show me <strong>the types of user journeys of at least 100 users</strong>.</li>
</ul>

<h1 id="9-final-result">9. Final Result</h1>

<p><img src="/assets/2023-05-21-sankey-chart/Redash returns this kind of Sankey Chart.webp" alt="" /></p>
<blockquote>
  <p>Redash returns this kind of Sankey Chart.</p>
</blockquote>

<h1 id="10-conclusion">10. Conclusion</h1>

<ul>
  <li><strong>Redash Sankey Chart</strong> is much more valuable specifically when you try to figure out how the users make their journey depending on their countries, devices, UTM parameters, referrer pages, and stuff like that.</li>
  <li>It‚Äôs superbly complicated to query, but once you make the whole framework queries to return the Sankey table, I believe you can generate more value to do as many actions as possible which wouldn‚Äôt have been possible to do before.</li>
  <li>Nevertheless, <strong>Redash Sankey Chart</strong> only supports up to <code class="language-plaintext highlighter-rouge">5 steps</code>, which by that means if your website or app has too many pages and screens, it wouldn‚Äôt be enough to look through only 5 steps.</li>
</ul>

<hr />

<h2 id="published-by-joshua-kim"><em>Published by</em> Joshua Kim</h2>
<p><img src="/assets/profile/joshua-profile.png" alt="Joshua Kim" /></p>]]></content><author><name></name></author><category term="english" /><category term="sql" /><category term="bigquery" /><category term="redash" /><category term="data_visualization" /><summary type="html"><![CDATA[In this article, I‚Äôm going to tell you how you can create the Sankey Chart starting from GA4, BigQuery, and up to Redash.]]></summary></entry><entry><title type="html">ÌöåÍ∑Ä Î™®Îç∏Ïù¥ ÌíÄ Ïàò ÏóÜÎäî Î¨∏Ï†ú</title><link href="http://localhost:4000/when-regression-does-not-work/" rel="alternate" type="text/html" title="ÌöåÍ∑Ä Î™®Îç∏Ïù¥ ÌíÄ Ïàò ÏóÜÎäî Î¨∏Ï†ú" /><published>2022-12-25T00:00:00+09:00</published><updated>2022-12-25T00:00:00+09:00</updated><id>http://localhost:4000/when-regression-does-not-work</id><content type="html" xml:base="http://localhost:4000/when-regression-does-not-work/"><![CDATA[<blockquote>
  <p>Ïù¥Î≤à ÏïÑÌã∞ÌÅ¥ÏóêÏÑúÎäî ÌöåÍ∑ÄÎ™®Îç∏(Regression Model)Ïù¥ Ïñ¥Îñ§ Í≤ΩÏö∞Ïóê Ï†ÄÏ°∞Ìïú ÏÑ±Í≥ºÎ•º ÎÇ¥ÎäîÏßÄ, Îçî ÎÇòÏïÑÍ∞Ä DatasetÏù¥ Ïñ¥Îñ§ ÌäπÏÑ±ÏùÑ ÏßÄÎãê Îïå ÌöåÍ∑ÄÎ™®Îç∏Î°ú Ìï¥Îãπ Î¨∏Ï†úÎ•º ÌíÄÏñ¥ÎÇº Ïàò ÏóÜÎäîÏßÄ ÌïÑÏûêÍ∞Ä Í≤ΩÌóòÌïú Î∞îÎ•º ÏÑúÏà†Ìï¥Î≥¥Í≥†Ïûê ÌïúÎã§.</p>
</blockquote>

<h3 id="contents">CONTENTS</h3>
<ol>
  <li>Introduction</li>
  <li>ÌîÑÎ°úÏ†ùÌä∏ Î∞∞Í≤ΩÍ≥º Ï£ºÏ†ú
    <ul>
      <li>2.1. Ïó∞Íµ¨ Ï£ºÏ†ú</li>
      <li>2.2. ÏÇ∞ÏóÖ ÌòÑÌô© Î∞è Ïó∞Íµ¨ Î™©Ï†Å</li>
      <li>2.3. Ïó∞Íµ¨ Î¨∏Ï†ú Î∞è Ïã§Ìóò Ï†ïÏùò</li>
    </ul>
  </li>
  <li>Îç∞Ïù¥ÌÑ∞ ÏÜåÍ∞úÏôÄ Î≥ÄÏàò Ï†ïÏùò
    <ul>
      <li>3.1. Îç∞Ïù¥ÌÑ∞ ÌÜ∫ÏïÑÎ≥¥Í∏∞</li>
      <li>3.2. 122,400Í∞úÏùò Ïù∏Ïä§ÌÑ¥Ïä§Î°ú Íµ¨ÏÑ±Îêú Îç∞Ïù¥ÌÑ∞</li>
      <li>3.3. Î≥ÄÏàò Ï†ïÏùò</li>
    </ul>
  </li>
  <li>Data Preprocessing &amp; EDA
    <ul>
      <li>4.1. Î≥ÄÏàòÎ™Ö Renaming</li>
      <li>4.2. Data Preprocessing</li>
      <li>4.3. EDA</li>
    </ul>
  </li>
  <li>Modeling
    <ul>
      <li>5.1. Simple Linear Regression (v1)</li>
      <li>5.2. Simple Linear Regression (v2) ‚Äî ‚Äúday‚Äù Î≥ÄÏàò Ï†úÏô∏</li>
      <li>5.3. Polynomial Regression (v1) ‚Äî ‚Äúdegree=2‚Äù</li>
      <li>5.4. Polynomial Regression (v2) ‚Äî ‚Äúdegree=3‚Äù</li>
      <li>5.5. Polynomial Regression (v3) ‚Äî ‚Äúdegree=4‚Äù</li>
      <li>5.6. Polynomial Regression (v4) ‚Äî ‚Äúdegree=5‚Äù</li>
    </ul>
  </li>
  <li>Conclusion
    <ul>
      <li>6.1. Regression Model Ïô∏Ïùò Î™®Îç∏Ïù¥ ÌïÑÏöîÌïòÎã§!</li>
      <li>6.2. Regression ModelÏù¥ Ìï¥Îãπ Dataset ÌïôÏäµÏóê Ï†ÅÏ†àÌïú Î™®Îç∏Ïù¥ ÏïÑÎãòÏùÑ ÌååÏïÖÌïòÎäî Î∞©Î≤ïÏùÄ?</li>
    </ul>
  </li>
</ol>

<hr />

<p><img src="/assets/2022-12-25-when-regression-does-not-work/calculator.webp" alt="" /></p>

<h1 id="1-introduction">1. Introduction</h1>

<p>Î®∏Ïã†Îü¨ÎãùÍ≥º Îî•Îü¨Îãù ÏïåÍ≥†Î¶¨Ï¶òÏùÑ Í≥µÎ∂ÄÌïòÏã† Î∂ÑÎì§Ïù¥ÎùºÎ©¥ ÎàÑÍµ¨ÎÇò ÏïÑÎäî Ïù¥ÏïºÍ∏∞Ïù¥ÏßÄÎßå, Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïù¥Ïñ∏Ïä§ÏóêÏÑú Í∞ÄÏû• Ï§ëÏöîÌïú ÏßÄÏπ®Ïù¥ ÏûàÎã§.</p>

<blockquote>
  <p>‚ÄúÏñ¥Îäê ÌäπÏ†ï Î™®Îç∏Ïù¥ Î™®Îì† Í≤ΩÏö∞Ïóê Ìï≠ÏÉÅ Ïö∞ÏõîÌïú ÌçºÌè¨Î®ºÏä§Î•º ÏßÄÎãàÏßÄ ÏïäÎäîÎã§.‚Äù</p>
</blockquote>

<p>Ï¶â, ÏïÑÎ¨¥Î¶¨ Î≥µÏû°ÌïòÍ≥† Ïù∏Í∏∞Í∞Ä ÎßéÏùÄ Î™®Îç∏Ïù¥ÎçîÎùºÎèÑ Îç∞Ïù¥ÌÑ∞ÏÖãÏùò ÌäπÏÑ±Ïóê Îî∞Îùº Ïö∞ÏõîÌïú MetricÏùÑ ÎÇ≥ÏùÑ ÏàòÎèÑ ÏûàÍ≥†, ÌòπÏùÄ Ï†ÄÏ°∞Ìïú MetricÏùÑ ÎÇ≥ÏùÑ ÏàòÎèÑ ÏûàÎã§. (Í∑∏ÎûòÏÑú Î™®Îç∏ÎßÅ ÏûëÏóÖÏóêÏÑú Í∞ÄÏû• Ï§ëÏöîÌïú Í≤ÉÏùÄ Îã§Î¶Ñ ÏïÑÎãå, DatasetÏóê ÎåÄÌïú Ïù¥Ìï¥Ïù¥Í∏∞ÎèÑ ÌïòÎã§.)</p>

<p>Ïù¥Î≤à ÏïÑÌã∞ÌÅ¥ÏóêÏÑúÎäî ÌöåÍ∑ÄÎ™®Îç∏(Regression Model)Ïù¥ Ïñ¥Îñ§ Í≤ΩÏö∞Ïóê Ï†ÄÏ°∞Ìïú ÏÑ±Í≥ºÎ•º ÎÇ¥ÎäîÏßÄ, Îçî ÎÇòÏïÑÍ∞Ä DatasetÏù¥ Ïñ¥Îñ§ ÌäπÏÑ±ÏùÑ ÏßÄÎãê Îïå ÌöåÍ∑ÄÎ™®Îç∏Î°ú Ìï¥Îãπ Î¨∏Ï†úÎ•º ÌíÄÏñ¥ÎÇº Ïàò ÏóÜÎäîÏßÄ ÌïÑÏûêÍ∞Ä Í≤ΩÌóòÌïú Î∞îÎ•º ÏÑúÏà†Ìï¥Î≥¥Í≥†Ïûê ÌïúÎã§.</p>

<p>ÌöåÍ∑ÄÎ™®Îç∏ ÌïôÏäµ Ïã§ÌóòÏùÑ ÌïòÎã§Í∞Ä Ïö∞Ïó∞Ìûà ÏßÅÍ¥ÄÏ†ÅÏúºÎ°ú ÏïåÍ≤å Îêú Ï∂îÏ∏°ÏÑ± Í≤∞Î°†Ïù¥ÏóàÏßÄÎßå, ÌÜµÍ≥ÑÌïô ÍµêÏàòÎãòÏúºÎ°úÎ∂ÄÌÑ∞ ÌÉÄÎãπÏÑ±ÏùÑ Ïù∏Ï†ï Î∞õÏïòÍ∏∞ ÎïåÎ¨∏Ïóê Î≥∏ ÎÇ¥Ïö©ÏùÄ Ï∂©Î∂ÑÌûà Í≥µÍ∞úÌï¥ÎèÑ ÎêòÎ¶¨Îùº ÏÉùÍ∞ÅÌïúÎã§. (ÍµêÏàòÎãò, ÏÇ¨ÎûëÌï©ÎãàÎã§.)</p>

<h1 id="2-ÌîÑÎ°úÏ†ùÌä∏-Î∞∞Í≤ΩÍ≥º-Ï£ºÏ†ú">2. ÌîÑÎ°úÏ†ùÌä∏ Î∞∞Í≤ΩÍ≥º Ï£ºÏ†ú</h1>

<h2 id="21-Ïó∞Íµ¨-Ï£ºÏ†ú">2.1. Ïó∞Íµ¨ Ï£ºÏ†ú</h2>

<blockquote>
  <p>‚ÄúÍ∏∞ÏÉÅ Ï†ïÎ≥¥Î•º ÌÜµÌïú Ï†ÑÎ†• ÏÇ¨Ïö©Îüâ ÏòàÏ∏° Î™®Îç∏ Íµ¨Ï∂ïÌïòÍ∏∞‚Äù</p>
</blockquote>

<h2 id="22-ÏÇ∞ÏóÖ-ÌòÑÌô©-Î∞è-Ïó∞Íµ¨-Î™©Ï†Å">2.2. ÏÇ∞ÏóÖ ÌòÑÌô© Î∞è Ïó∞Íµ¨ Î™©Ï†Å</h2>

<h3 id="1-ÌïúÍµ≠Ïùò-Ï†ÑÎ†•-ÏÇ¨Ïö©ÎüâÏùÄ-Îß§Ìï¥-Ï¶ùÍ∞ÄÌïòÎäî-Ï∂îÏÑ∏">(1) ÌïúÍµ≠Ïùò Ï†ÑÎ†• ÏÇ¨Ïö©ÎüâÏùÄ Îß§Ìï¥ Ï¶ùÍ∞ÄÌïòÎäî Ï∂îÏÑ∏</h3>
<ul>
  <li>30ÎÖÑ Ï†Ñ ÎåÄÎπÑ 5Î∞∞ Ïù¥ÏÉÅ ÎÜíÏïÑÏßÑ ÏàòÏ§Ä</li>
</ul>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/korea.webp" alt="" /></p>
<blockquote>
  <p><a href="https://yearbook.enerdata.co.kr/electricity/electricity-domestic-consumption-data.html">electricity domestic consumption data</a></p>
</blockquote>

<h3 id="2-ÌïúÍµ≠Ïùò-Ï†ÑÍ∏∞Î£åÎäî-oecd-ÌöåÏõêÍµ≠Îì§Ïùò-50Ïóê-ÎØ∏ÏπòÏßÄ-Î™ªÌï†-Ï†ïÎèÑÎ°ú-Ï†ÄÎ†¥Ìïú-ÏàòÏ§Ä">(2) ÌïúÍµ≠Ïùò Ï†ÑÍ∏∞Î£åÎäî OECD ÌöåÏõêÍµ≠Îì§Ïùò 50%Ïóê ÎØ∏ÏπòÏßÄ Î™ªÌï† Ï†ïÎèÑÎ°ú Ï†ÄÎ†¥Ìïú ÏàòÏ§Ä</h3>
<ul>
  <li>Ï†ÑÎ†• ÏÇ¨Ïö©ÎüâÏùÄ Ï¶ùÍ∞ÄÌïòÎäî Î∞òÎ©¥, ÏÉÅÎåÄÏ†ÅÏúºÎ°ú ÎÇÆÍ≤å Ï±ÖÏ†ïÎêú Ï†ÑÍ∏∞Î£å ÏàòÏ§Ä</li>
  <li>ÏóêÎÑàÏßÄ ÎπÑÏö© Î™®ÎãàÌÑ∞ÎßÅ &amp; ÏòàÏ∏° ÏÑúÎπÑÏä§Î•º ÎèÑÏûÖÌïòÏó¨ ÏãúÏû•Í≤ΩÏüÅÎ†• ÌôïÎ≥¥Ïùò ÌïÑÏöîÏÑ±</li>
</ul>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/countries.webp" alt="" /></p>
<blockquote>
  <p><a href="https://home.kepco.co.kr/kepco/EB/A/htmlView/EBAAHP007.do">OECD ÌöåÏõêÍµ≠Ïùò Í∞ÄÏ†ïÏö© &amp; ÏÇ∞ÏóÖÏö© Ï†ÑÍ∏∞ÏöîÍ∏à</a></p>
</blockquote>

<h3 id="3-ÌïúÍµ≠Ïùò-Ï†ÑÎ†•-ÏÇ¨Ïö©ÎüâÏùÄ-Ïó¨Î¶ÑÏ≤†-Ï¶ùÍ∞ÄÌïòÎäî-Í≥ÑÏ†àÏ†Å-Ï£ºÍ∏∞ÏÑ±Ïù¥-Ï°¥Ïû¨Ìï®">(3) ÌïúÍµ≠Ïùò Ï†ÑÎ†• ÏÇ¨Ïö©ÎüâÏùÄ Ïó¨Î¶ÑÏ≤† Ï¶ùÍ∞ÄÌïòÎäî Í≥ÑÏ†àÏ†Å Ï£ºÍ∏∞ÏÑ±Ïù¥ Ï°¥Ïû¨Ìï®</h3>
<ul>
  <li>Í≥µÍ∏âÎüâ Ï°∞Ï†àÏù¥ ÏâΩÏßÄ ÏïäÏùÄ ÎèÑÎ©îÏù∏ ÌäπÏÑ±ÏùÑ Í≥†Î†§ÌñàÏùÑ Îïå, Ï†ÑÎ†• ÏÇ¨Ïö©ÎüâÏùÑ ÏòàÏ∏°ÌïòÏó¨ Ìö®Ïú®Ï†ÅÏù∏ ÏóêÎÑàÏßÄ Í¥ÄÎ¶¨ Î∞©Ïïà ÎèÑÏûÖÏùò ÌïÑÏöîÏÑ±</li>
</ul>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/monthly.webp" alt="" /></p>
<blockquote>
  <p><a href="https://epsis.kpx.or.kr/epsisnew/selectEkgeEpsAepChart.do?menuId=030200">ÏõîÎ≥Ñ ÌèâÍ∑† ÏµúÎåÄÏ†ÑÎ†•</a></p>
</blockquote>

<h2 id="23-Ïó∞Íµ¨-Î¨∏Ï†ú-Î∞è-Ïã§Ìóò-Ï†ïÏùò">2.3. Ïó∞Íµ¨ Î¨∏Ï†ú Î∞è Ïã§Ìóò Ï†ïÏùò</h2>

<blockquote>
  <p>‚ÄúÍ∏∞ÏÉÅ Îç∞Ïù¥ÌÑ∞Î•º ÌÜµÌï¥ <strong>Ï†ÑÎ†•ÏÇ¨Ïö©Îüâ</strong> ÏòàÏ∏° Î™®Îç∏ÏùÑ ÏÑ§Í≥ÑÌïòÍ≥†Ïûê ÌïúÎã§.‚Äù</p>
</blockquote>

<pre><code class="language-plain">	Ï†ÑÎ†•ÏÇ¨Ïö©Îüâ ~ Í∏∞Ïò®  
	Ï†ÑÎ†•ÏÇ¨Ïö©Îüâ ~ ÌíçÏÜç  
	Ï†ÑÎ†•ÏÇ¨Ïö©Îüâ ~ ÏäµÎèÑ  
	Ï†ÑÎ†•ÏÇ¨Ïö©Îüâ ~ Í∞ïÏàòÎüâ  
	Ï†ÑÎ†•ÏÇ¨Ïö©Îüâ ~ ÏùºÏ°∞  
	Ï†ÑÎ†•ÏÇ¨Ïö©Îüâ ~ (Í±¥Î¨º ÎÇ¥) ÎπÑÏ†ÑÍ∏∞ÎÉâÎ∞©ÏÑ§ÎπÑÏö¥ÏòÅ Ïó¨Î∂Ä  
	Ï†ÑÎ†•ÏÇ¨Ïö©Îüâ ~ (Í±¥Î¨º ÎÇ¥) ÌÉúÏñëÍ¥ë Î≥¥Ïú† Ïó¨Î∂Ä
</code></pre>

<h1 id="3-Îç∞Ïù¥ÌÑ∞-ÏÜåÍ∞úÏôÄ-Î≥ÄÏàò-Ï†ïÏùò">3. Îç∞Ïù¥ÌÑ∞ ÏÜåÍ∞úÏôÄ Î≥ÄÏàò Ï†ïÏùò</h1>

<h2 id="31-Îç∞Ïù¥ÌÑ∞-ÌÜ∫ÏïÑÎ≥¥Í∏∞">3.1. Îç∞Ïù¥ÌÑ∞ ÌÜ∫ÏïÑÎ≥¥Í∏∞</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>
<p><img src="/assets/2022-12-25-when-regression-does-not-work/df.head().webp" alt="" /></p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="n">df</span><span class="p">.</span><span class="n">tail</span><span class="p">()</span>
</code></pre></div></div>
<p><img src="/assets/2022-12-25-when-regression-does-not-work/df.tail().webp" alt="" /></p>

<h2 id="32-122400Í∞úÏùò-Ïù∏Ïä§ÌÑ¥Ïä§Î°ú-Íµ¨ÏÑ±Îêú-Îç∞Ïù¥ÌÑ∞">3.2. 122,400Í∞úÏùò Ïù∏Ïä§ÌÑ¥Ïä§Î°ú Íµ¨ÏÑ±Îêú Îç∞Ïù¥ÌÑ∞</h2>

<ul>
  <li>60Í∞úÏùò Í±¥Î¨ºÎ≥Ñ (<code class="language-plaintext highlighter-rouge">num</code>)Î°ú Íµ¨ÏÑ±</li>
  <li>2020ÎÖÑ 6Ïõî 1ÏùºÎ∂ÄÌÑ∞ 2020ÎÖÑ 8Ïõî 24ÏùºÍπåÏßÄÏùò ÏóîÏßÄÎãàÏñ¥ÎßÅ Îç∞Ïù¥ÌÑ∞Î°ú Íµ¨ÏÑ±</li>
  <li>Ï∏°Ï†ï Îç∞Ïù¥ÌÑ∞Ïùò Unit: 1ÏãúÍ∞Ñ</li>
</ul>

<h2 id="33-Î≥ÄÏàò-Ï†ïÏùò">3.3. Î≥ÄÏàò Ï†ïÏùò</h2>

<table>
  <thead>
    <tr>
      <th><strong>Î≥ÄÏàò</strong></th>
      <th><strong>ÏÑ§Î™Ö</strong></th>
      <th><strong>Î≥ÄÏàò ÌÉÄÏûÖ</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">num</code></td>
      <td>Í±¥Î¨ºÎ≤àÌò∏ (1&lt;= Integer &lt;= 60)</td>
      <td><code class="language-plaintext highlighter-rouge">x</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">date_time</code></td>
      <td>YYYY-MM-DD HH</td>
      <td><code class="language-plaintext highlighter-rouge">x</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Ï†ÑÎ†•ÏÇ¨Ïö©Îüâ(kWh)</code></td>
      <td>Ï†ÑÎ†•ÏÇ¨Ïö©Îüâ (ÌÇ¨Î°úÏôÄÌä∏Ïãú)</td>
      <td><code class="language-plaintext highlighter-rouge">y</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Í∏∞Ïò®(¬∞C)</code></td>
      <td>ÏÑ≠Ïî® Í∏∞Ïò® (Celsius Degree)</td>
      <td><code class="language-plaintext highlighter-rouge">x</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ÌíçÏÜç(m/s)</code></td>
      <td>ÌíçÏÜç (Ï¥àÎãπ ÎØ∏ÌÑ∞ ÏÜçÎèÑ)</td>
      <td><code class="language-plaintext highlighter-rouge">x</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ÏäµÎèÑ(%)</code></td>
      <td>ÏäµÎèÑ</td>
      <td><code class="language-plaintext highlighter-rouge">x</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Í∞ïÏàòÎüâ(mm)</code></td>
      <td>Í∞ïÏàòÎüâ</td>
      <td><code class="language-plaintext highlighter-rouge">x</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ÏùºÏ°∞(hr)</code></td>
      <td>1ÏãúÍ∞Ñ Ï§ë ÏùºÏ°∞ÎüâÏù¥ Ï°¥Ïû¨Ìïú ÏãúÍ∞Ñ (0.0 &lt;= Float &lt;= 1.0)</td>
      <td><code class="language-plaintext highlighter-rouge">x</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ÎπÑÏ†ÑÍ∏∞ÎÉâÎ∞©ÏÑ§ÎπÑÏö¥ÏòÅ</code></td>
      <td>Ïö¥ÏòÅ Ïó¨Î∂Ä Boolean ÌëúÌòÑ (0: False, 1: True)</td>
      <td><code class="language-plaintext highlighter-rouge">x</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ÌÉúÏñëÍ¥ëÎ≥¥Ïú†</code></td>
      <td>Î≥¥Ïú† Ïó¨Î∂Ä Boolean ÌëúÌòÑ (0: False, 1: True)</td>
      <td><code class="language-plaintext highlighter-rouge">x</code></td>
    </tr>
  </tbody>
</table>

<h1 id="4-data-preprocessing--eda">4. Data Preprocessing &amp; EDA</h1>

<h2 id="41-Î≥ÄÏàòÎ™Ö-renaming">4.1. Î≥ÄÏàòÎ™Ö Renaming</h2>

<table>
  <thead>
    <tr>
      <th>AS-IS</th>
      <th>TO-BE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">num</code></td>
      <td><code class="language-plaintext highlighter-rouge">building_num</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">date_time</code></td>
      <td><code class="language-plaintext highlighter-rouge">date_time</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Ï†ÑÎ†•ÏÇ¨Ïö©Îüâ(kWh)</code></td>
      <td><code class="language-plaintext highlighter-rouge">target</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Í∏∞Ïò®(¬∞C)</code></td>
      <td><code class="language-plaintext highlighter-rouge">temp_celsius</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ÌíçÏÜç(m/s)</code></td>
      <td><code class="language-plaintext highlighter-rouge">wind_speed</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ÏäµÎèÑ(%)</code></td>
      <td><code class="language-plaintext highlighter-rouge">humidity</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Í∞ïÏàòÎüâ(mm)</code></td>
      <td><code class="language-plaintext highlighter-rouge">rain</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ÏùºÏ°∞(hr)</code></td>
      <td><code class="language-plaintext highlighter-rouge">sunshine</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ÎπÑÏ†ÑÍ∏∞ÎÉâÎ∞©ÏÑ§ÎπÑÏö¥ÏòÅ</code></td>
      <td><code class="language-plaintext highlighter-rouge">nature_ac</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ÌÉúÏñëÍ¥ëÎ≥¥Ïú†</code></td>
      <td><code class="language-plaintext highlighter-rouge">sunpower</code></td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>Í≥†ÌÜµÏä§Îü¨Ïö¥ ÌïúÍ∏Ä Ïù∏ÏΩîÎî© Î¨∏Ï†úÎäî Ïñ∏Ï†ú Ïñ¥ÎîîÏóêÏÑú ÌÑ∞ÏßàÏßÄ Î™®Î•∏Îã§.</p>
</blockquote>

<h2 id="42-data-preprocessing">4.2. Data Preprocessing</h2>

<h3 id="1-target-Ï†ÑÎ†•ÏÇ¨Ïö©Îüâ">(1) <code class="language-plaintext highlighter-rouge">target</code> (Ï†ÑÎ†•ÏÇ¨Ïö©Îüâ)</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">target</code>Ïùò Î∂ÑÌè¨: ‚ÄúPositive Skewness‚Äù (ÏñëÏùò ÏôúÎèÑ, Ïò§Î•∏Ï™Ω Íº¨Î¶¨Í∞Ä Í∏∏Îã§.)</li>
  <li>Model FittingÏùò Ìö®Í≥ºÎ•º Ìñ•ÏÉÅÏãúÌÇ§Í∏∞ ÏúÑÌï¥, Îã§ÏùåÍ≥º Í∞ôÏù¥ Î≥ÄÌôòÌïòÏûê.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="c1"># TrainÌï† Îïå  
</span>	<span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">target</span><span class="p">)</span>  
	<span class="c1"># PredictÌï† Îïå  
</span>	<span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</code></pre></div></div>

<p><strong>[Î≥ÄÌôò Ï†Ñ] Distribution of Target Values</strong>
<img src="/assets/2022-12-25-when-regression-does-not-work/Î≥ÄÌôò Ï†Ñ- Distribution of Target Values.webp" alt="" /></p>
<blockquote>
  <p>Ïù¥Îü¨Ìïú Î∂ÑÌè¨Îäî ÏûêÏó∞ÌòÑÏÉÅÍ≥º ÏÇ¨ÌöåÌòÑÏÉÅÏóêÏÑú ÌùîÌûà ÎÇòÌÉÄÎÇòÎäîÎç∞, ModelÏùò Overfitting Î¨∏Ï†úÏóê Îß§Ïö∞ Ï∑®ÏïΩÌïòÎã§.</p>
</blockquote>

<p><strong>[Î≥ÄÌôò ÌõÑ] Distribution of Target Values</strong>
<img src="/assets/2022-12-25-when-regression-does-not-work/Î≥ÄÌôò ÌõÑ- Distribution of Target Values.webp" alt="" /></p>
<blockquote>
  <p>Gotcha! Ïñ¥Îäê Ï†ïÎèÑ Ï†ïÍ∑úÏÑ±ÏùÑ ÌôïÎ≥¥ÌñàÍµ∞‚Ä¶</p>
</blockquote>

<h3 id="2-building_num-Í±¥Î¨ºÎ≤àÌò∏">(2) <code class="language-plaintext highlighter-rouge">building_num</code> (Í±¥Î¨ºÎ≤àÌò∏)</h3>

<ul>
  <li>Integer Type (1 ‚â§ <code class="language-plaintext highlighter-rouge">building_num</code> ‚â§ 60)</li>
  <li>ÎèÑÎ©îÏù∏ ÏßÄÏãùÏùÑ Í≥†Î†§ÌñàÏùÑ Îïå, Í±¥Î¨º Î≥ÑÎ°ú Ï†ÑÎ†• ÏÑ§Í≥Ñ ÌååÏù¥ÌîÑÎùºÏù∏, Í±¥Î¨ºÏùò ÏúÑÏπò Îì±Ïóê Îî∞Îùº Ï†ÑÎ†•ÏÇ¨Ïö©ÎüâÏù¥ Íµ≠ÏßÄÏ†ÅÏúºÎ°ú ÌÅ∞ Ï∞®Ïù¥Í∞Ä Î∞úÏÉùÌï† Í≤ÉÏù¥Îã§.</li>
</ul>

<p><strong>Í∞Å 60Í∞ú building_numÎ≥Ñ Distribution of Target Values</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">if</span> <span class="n">skewness</span> <span class="o">&gt;=</span> <span class="mf">1.5</span><span class="p">:</span>  
	<span class="n">color</span> <span class="o">=</span> <span class="sh">'</span><span class="s">red</span><span class="sh">'</span>  
	<span class="k">elif</span> <span class="n">skewness</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">:</span>  
	<span class="n">color</span> <span class="o">=</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span>  
	<span class="k">else</span><span class="p">:</span>  
	<span class="n">color</span> <span class="o">=</span> <span class="sh">'</span><span class="s">grey</span><span class="sh">'</span>
</code></pre></div></div>
<p><img src="/assets/2022-12-25-when-regression-does-not-work/Í∞Å 60Í∞ú building_numÎ≥Ñ Distribution of Target Values.webp" alt="" /></p>

<p><strong>1Î∂ÄÌÑ∞ 60ÍπåÏßÄÎäî OrdinalÏù¥ÎùºÍ∏∞Î≥¥Îã§Îäî, CardinalÌïú LabelÏù¥ÎØÄÎ°ú, Î™®Îç∏Ïù¥ Í∞íÏùò Ïö∞Ïó¥Ïù¥ ÏûàÎäî Í≤ÉÏúºÎ°ú Ïò§Ìï¥Ìï† Ïàò ÏûàÎã§. Í∑∏ÎûòÏÑú One Hot EncodingÏùÑ ÌÜµÌï¥ Í∞Å <code class="language-plaintext highlighter-rouge">building_num</code>ÏùÑ dummyÌôîÌïòÎèÑÎ°ù ÌïúÎã§.</strong></p>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/building_num.webp" alt="" /></p>
<blockquote>
  <p><code class="language-plaintext highlighter-rouge">building_num</code>Ïù¥ ÏÇ¨ÎùºÏßÄÍ≥†, <code class="language-plaintext highlighter-rouge">building_#</code>Ïùò <strong>Scarse Vectors</strong>Î°ú ÎåÄÏ≤¥ÎêòÏóàÎã§.</p>
</blockquote>

<h3 id="3-date_time-yyyy-mm-dd-hh">(3) <code class="language-plaintext highlighter-rouge">date_time</code> (YYYY-MM-DD HH)</h3>

<ul>
  <li>YYYY-MM-DD HH Ìè¨Îß∑Ïù¥ String data typeÏúºÎ°ú ÎêòÏñ¥ ÏûàÏúºÎØÄÎ°ú, Ïù¥Î•º Î≥ÄÌôòÌï¥Ïïº ÌïúÎã§.</li>
  <li><code class="language-plaintext highlighter-rouge">Year</code>, <code class="language-plaintext highlighter-rouge">Month</code>, <code class="language-plaintext highlighter-rouge">Day</code>, <code class="language-plaintext highlighter-rouge">Hour</code>: Í∏∞ÏÉÅ ÌòπÏùÄ Í∏∞ÌõÑ ÌòÑÏÉÅÍ≥º ÏÉÅÍ¥ÄÏÑ±Ïù¥ ÏûàÎäî Ï†ïÎ≥¥</li>
  <li>Day of Week (DoW): <code class="language-plaintext highlighter-rouge">date_time</code>ÏóêÎäî ÏßÅÏ†ëÏ†ÅÏúºÎ°ú ÌëúÍ∏∞ÎêòÏñ¥ ÏûàÏßÄ ÏïäÏúºÎÇò, Ï†ÑÎ†•ÏÇ¨Ïö©ÎüâÏùò Ï£ºÍ∏∞ÏÑ±ÏùÑ ÏßÄÎãàÍ≥† ÏûàÎäî Ï†ïÎ≥¥Ïù¥ÎØÄÎ°ú ÏÉàÎ°≠Í≤å ÏÉùÏÑ±ÌïòÎèÑÎ°ù ÌïúÎã§.</li>
  <li>Î≥∏ DatasetÏóêÏÑúÎäî <code class="language-plaintext highlighter-rouge">Year</code>Í∞Ä ‚Äò2020‚Äô Ìïú Í∞ÄÏßÄÎßå Ï°¥Ïû¨ÌïòÎØÄÎ°ú, <code class="language-plaintext highlighter-rouge">Year</code> Î≥ÄÏàòÎäî ÏÇ≠Ï†úÌïòÎèÑÎ°ù ÌïúÎã§.</li>
</ul>

<p><strong>Î≥ÄÌôò Í≤∞Í≥º</strong></p>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/date_time.webp" alt="" /></p>
<blockquote>
  <p><code class="language-plaintext highlighter-rouge">date_time</code>ÏùÄ ÏÇ¨ÎùºÏßÄÍ≥†, <code class="language-plaintext highlighter-rouge">month</code>, <code class="language-plaintext highlighter-rouge">day</code>, <code class="language-plaintext highlighter-rouge">hour</code>, <code class="language-plaintext highlighter-rouge">dow</code>Í∞Ä ÏÉùÏÑ±ÎêòÏóàÎã§.</p>
</blockquote>

<h2 id="43-eda">4.3. EDA</h2>

<h3 id="1-correlation-coefficient-ÏÉÅÍ¥ÄÍ≥ÑÏàò">(1) Correlation Coefficient (ÏÉÅÍ¥ÄÍ≥ÑÏàò)</h3>

<p><strong>Heat Map</strong></p>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/heat-map.webp" alt="" /></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">humidity</code>(ÏäµÎèÑ) ~ <code class="language-plaintext highlighter-rouge">temp_celsius</code>(ÏÑ≠Ïî®Ïò®ÎèÑ)
    <ul>
      <li>ÏÉÅÍ¥ÄÍ≥ÑÏàò: <code class="language-plaintext highlighter-rouge">-0.5091</code></li>
      <li>ÏïΩÌïú ÏùåÏùò ÏÉÅÍ¥ÄÍ¥ÄÍ≥ÑÎ•º Í∞ÄÏßÑÎã§Í≥† Î≥¥Îäî Í≤ÉÏù¥ ÎßûÏïÑÎ≥¥Ïù∏Îã§.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/humidity(ÏäµÎèÑ) ~ temp_celsius(ÏÑ≠Ïî®Ïò®ÎèÑ).webp" alt="" /></p>
<blockquote>
  <p>humidity(ÏäµÎèÑ) ~ temp_celsius(ÏÑ≠Ïî®Ïò®ÎèÑ)</p>
</blockquote>

<ul>
  <li><code class="language-plaintext highlighter-rouge">sunshine</code>(ÏùºÏ°∞) ~ <code class="language-plaintext highlighter-rouge">temp_celsius</code>(ÏÑ≠Ïî®Ïò®ÎèÑ)
    <ul>
      <li>ÏÉÅÍ¥ÄÍ≥ÑÏàò: <code class="language-plaintext highlighter-rouge">+0.5157</code></li>
      <li>ÏïΩÌïú ÏñëÏùò ÏÉÅÍ¥ÄÍ¥ÄÍ≥ÑÎ•º Í∞ÄÏßÑÎã§Í≥† Î≥¥Îäî Í≤ÉÏù¥ ÎßûÏïÑÎ≥¥Ïù∏Îã§.</li>
      <li>ÌïòÎÇòÎäî categorical, Îã§Î•∏ ÌïòÎÇòÎäî numeric Ïù¥ÎØÄÎ°ú Îëò Ï§ë ÌïòÎÇòÎ•º dropÌï† Ïàò ÏóÜÎã§.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/sunshine(ÏùºÏ°∞) ~ temp_celsius(ÏÑ≠Ïî®Ïò®ÎèÑ).webp" alt="" /></p>
<blockquote>
  <p>sunshine(ÏùºÏ°∞) ~ temp_celsius(ÏÑ≠Ïî®Ïò®ÎèÑ)</p>
</blockquote>

<ul>
  <li><code class="language-plaintext highlighter-rouge">sunshine</code>(ÏùºÏ°∞) ~ <code class="language-plaintext highlighter-rouge">humidity</code>(ÏäµÎèÑ)
    <ul>
      <li>ÏÉÅÍ¥ÄÍ≥ÑÏàò: <code class="language-plaintext highlighter-rouge">-0.6276</code></li>
      <li>ÏïΩÌïú ÏùåÏùò ÏÉÅÍ¥ÄÍ¥ÄÍ≥ÑÎ•º Í∞ÄÏßÑÎã§Í≥† Î≥¥Îäî Í≤ÉÏù¥ ÎßûÏïÑÎ≥¥Ïù∏Îã§.</li>
      <li>ÌïòÎÇòÎäî categorical, Îã§Î•∏ ÌïòÎÇòÎäî numeric Ïù¥ÎØÄÎ°ú Îëò Ï§ë ÌïòÎÇòÎ•º dropÌï† Ïàò ÏóÜÎã§.</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/sunshine(ÏùºÏ°∞) ~ humidity(ÏäµÎèÑ).webp" alt="" /></p>
<blockquote>
  <p>sunshine(ÏùºÏ°∞) ~ humidity(ÏäµÎèÑ)</p>
</blockquote>

<h3 id="2-pairplot">(2) Pairplot</h3>

<p><strong><code class="language-plaintext highlighter-rouge">building_{##}</code> Î≥ÄÏàòÎì§ÏùÑ Ï†úÏô∏Ìïú Ï±Ñ visualize pairplot</strong></p>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/pairplot.webp" alt="" /></p>
<blockquote>
  <p>ÌäπÏ†ï ÌïòÎÇòÏùò ÎèÖÎ¶ΩÎ≥ÄÏàòÍ∞Ä TargetÏóê Ï†àÎåÄÏ†ÅÏù∏ ÏÉÅÍ¥ÄÍ¥ÄÍ≥ÑÎ•º Í∞ÄÏßÄÎäî Í≤ÉÏù¥ Í¥ÄÏ∏°ÎêòÏßÄ ÏïäÎäîÎã§.</p>
</blockquote>

<h3 id="3-Í∞Å-ÎèÖÎ¶ΩÎ≥ÄÏàòÎì§Ïùò-distribution-of-values">(3) Í∞Å ÎèÖÎ¶ΩÎ≥ÄÏàòÎì§Ïùò Distribution of Values</h3>

<p><strong><code class="language-plaintext highlighter-rouge">temp_celsius</code> (ÏÑ≠Ïî®Ïò®ÎèÑ)</strong></p>
<ul>
  <li>ÎπÑÏÑ†Ìòï Î≥ÄÌôò Î∂àÌïÑÏöî</li>
</ul>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/temp_celsius (ÏÑ≠Ïî®Ïò®ÎèÑ).webp" alt="" /></p>
<blockquote>
  <p>AS-IS</p>
</blockquote>

<p><strong><code class="language-plaintext highlighter-rouge">wind_speed</code> (ÌíçÏÜç)</strong></p>
<ul>
  <li>log Î≥ÄÌôò ÌïÑÏöî</li>
</ul>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/wind_speed (ÌíçÏÜç)-before-log.webp" alt="" /></p>
<blockquote>
  <p>AS-IS</p>
</blockquote>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/wind_speed (ÌíçÏÜç)-after-log.webp" alt="" /></p>
<blockquote>
  <p>TO-BE</p>
</blockquote>

<p><strong><code class="language-plaintext highlighter-rouge">humidity</code> (ÏäµÎèÑ)</strong></p>
<ul>
  <li>square root Î≥ÄÌôò ÌïÑÏöî</li>
</ul>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/humidity (ÏäµÎèÑ)-before-sqr.webp" alt="" /></p>
<blockquote>
  <p>AS-IS</p>
</blockquote>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/humidity (ÏäµÎèÑ)-after-sqr.webp" alt="" /></p>
<blockquote>
  <p>TO-BE</p>
</blockquote>

<p><strong><code class="language-plaintext highlighter-rouge">rain</code> (Í∞ïÏàòÎüâ)</strong></p>
<ul>
  <li>log Î≥ÄÌôò ÌïÑÏöî</li>
</ul>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/rain (Í∞ïÏàòÎüâ)-before-log.webp" alt="" /></p>
<blockquote>
  <p>AS-IS</p>
</blockquote>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/rain (Í∞ïÏàòÎüâ)-after-log.webp" alt="" /></p>
<blockquote>
  <p>TO-BE</p>
</blockquote>

<h3 id="4-Îã§Ï§ëÍ≥µÏÑ†ÏÑ±multi-collinearity-ÌôïÏù∏">(4) Îã§Ï§ëÍ≥µÏÑ†ÏÑ±(Multi-collinearity) ÌôïÏù∏</h3>

<p><strong>VIF ‚â• 10 Ïóê Ìï¥ÎãπÌïòÎäî ÎèÖÎ¶ΩÎ≥ÄÏàòÎäî ÌïôÏäµÏãú Ï†úÏô∏ÌïòÎèÑÎ°ù ÌïúÎã§.</strong></p>

<ul>
  <li><strong>‚ÄúVariance Inflation Factors (Î∂ÑÏÇ∞ÌåΩÏ∞ΩÏöîÏù∏)‚ÄùÎûÄ?</strong>
    <blockquote>
      <p>ÌäπÏ†ï Î≥ÄÏàòÏôÄ Ïù¥ÎØ∏ ÎÜíÏùÄ ÏÉÅÍ¥ÄÍ¥ÄÍ≥ÑÎ•º Í∞ÄÏßêÏúºÎ°úÏç®, Î™®Îç∏Ïùò OverfittingÏóê ÏòÅÌñ•ÏùÑ ÎÅºÏπ† Ïàò ÏûàÎäîÏßÄÎ•º Ï∏°Ï†ïÌïòÎäî ÏßÄÌëú
ÏùºÎ∞òÏ†ÅÏúºÎ°ú VIF &gt;= 5Ïù∏ Í≤ΩÏö∞Îäî warning Ïã†Ìò∏, VIF &gt;=10Ïù∏ Í≤ΩÏö∞Îäî ÏÇ≠Ï†ú ÌïÑÏöî Ïã†Ìò∏</p>
    </blockquote>
  </li>
</ul>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/vif.webp" alt="" /></p>
<blockquote>
  <p><code class="language-plaintext highlighter-rouge">nature_ac</code>, <code class="language-plaintext highlighter-rouge">sunpower</code>Îäî Í∞Å <code class="language-plaintext highlighter-rouge">building_##</code>Ïùò Î≥ÄÏàòÏôÄ Îß§Ïö∞ ÎÜíÏùÄ ÏÉÅÍ¥ÄÍ¥ÄÍ≥ÑÎ•º Í∞ÄÏßÄÍ∏∞ ÎïåÎ¨∏Ïóê <strong>VIF = Infinite</strong>Ïù∏ Í≤∞Í≥ºÎ•º ÌôïÏù∏Ìï† Ïàò ÏûàÏóàÎã§.</p>
</blockquote>

<h3 id="5-outliers-handling">(5) Outliers Handling</h3>

<blockquote>
  <p>‚ÄúÌèâÍ∑†Í∞íÏúºÎ°úÎ∂ÄÌÑ∞ <strong>3 Sigma</strong> Ïù¥ÏÉÅ Ìé∏Ï∞®Í∞Ä Î∞úÏÉùÌïòÎäî Ïù∏Ïä§ÌÑ¥Ïä§Î•º Î™®Îëê ÏÇ≠Ï†úÌïòÎèÑÎ°ù ÌïúÎã§.‚Äù</p>
</blockquote>

<p><strong>Box Plot of <code class="language-plaintext highlighter-rouge">temp_celsius</code></strong>
<img src="/assets/2022-12-25-when-regression-does-not-work/Box Plot of temp_celsius.webp" alt="" /></p>
<blockquote>
  <p>Box Plot of <code class="language-plaintext highlighter-rouge">temp_celsius</code></p>
</blockquote>

<p><strong>Box Plot of <code class="language-plaintext highlighter-rouge">wind_speed</code></strong>
<img src="/assets/2022-12-25-when-regression-does-not-work/Box Plot of wind_speed.webp" alt="" /></p>
<blockquote>
  <p>Box Plot of <code class="language-plaintext highlighter-rouge">wind_speed</code></p>
</blockquote>

<p><strong>Box Plot of <code class="language-plaintext highlighter-rouge">humidity</code></strong>
<img src="/assets/2022-12-25-when-regression-does-not-work/Box Plot of humidity.webp" alt="" /></p>
<blockquote>
  <p>Box Plot of <code class="language-plaintext highlighter-rouge">humidity</code></p>
</blockquote>

<p><strong>Box Plot of <code class="language-plaintext highlighter-rouge">rain</code></strong>
<img src="/assets/2022-12-25-when-regression-does-not-work/Box Plot of rain.webp" alt="" /></p>
<blockquote>
  <p>Box Plot of <code class="language-plaintext highlighter-rouge">rain</code></p>
</blockquote>

<p><strong>Box Plot of <code class="language-plaintext highlighter-rouge">sunshine</code></strong>
<img src="/assets/2022-12-25-when-regression-does-not-work/Box Plot of sunshine.webp" alt="" /></p>
<blockquote>
  <p>Box Plot of <code class="language-plaintext highlighter-rouge">sunshine</code></p>
</blockquote>

<p><strong>Box Plot of <code class="language-plaintext highlighter-rouge">month</code>, <code class="language-plaintext highlighter-rouge">day</code>, <code class="language-plaintext highlighter-rouge">hour</code>, and <code class="language-plaintext highlighter-rouge">dow</code></strong></p>
<ul>
  <li>date_time ÌòïÏãùÏúºÎ°ú Ïù¥ÎØ∏ outliers ÏóÜÏù¥ Í≥®Í≥†Î£® Î∂ÑÌè¨ÎêòÏñ¥ ÏûàÏúºÎØÄÎ°ú, Outliers Handling Î∂àÌïÑÏöî</li>
</ul>

<p><strong>‚ÄúStandardScaler Î™®ÎìàÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Î™®Îì† ÎèÖÎ¶ΩÎ≥ÄÏàòÎì§ÏùÑ Ï†ïÍ∑úÌôîÌïúÎã§.‚Äù</strong>
<img src="/assets/2022-12-25-when-regression-does-not-work/Box Plot of month, day, hour, and dow.webp" alt="" /></p>
<blockquote>
  <p><code class="language-plaintext highlighter-rouge">mean = 0</code>, <code class="language-plaintext highlighter-rouge">std = 1</code>Ïùò <strong>ÌëúÏ§ÄÏ†ïÍ∑úÎ∂ÑÌè¨</strong>Î°ú Î≥ÄÌôò</p>
</blockquote>

<ul>
  <li>‚Äú<code class="language-plaintext highlighter-rouge">-3 ‚â§ Scaled Value ‚â§ +3</code>Ïù¥ ÏïÑÎãå FeatureÍ∞Ä 1Í∞úÎùºÎèÑ Ï°¥Ïû¨ÌïòÎäî Ïù∏Ïä§ÌÑ¥Ïä§Ïùò Í∞úÏàò‚Äù
    <ul>
      <li>5,589Í∞ú (ÏïΩ <code class="language-plaintext highlighter-rouge">4.57%</code>)</li>
      <li>Ïù¥ Ï†ïÎèÑÏùò Îç∞Ïù¥ÌÑ∞ ÏÜêÏã§Ïù¥ÎùºÎ©¥, Ïò§ÌûàÎ†§ Ï†úÍ±∞Î•º ÌïòÎäî Í≤ÉÏù¥ TrainingÏóê Ïú†ÏùµÌïú Í≤∞Í≥ºÎ•º ÎÇ≥ÏùÑ Í≤ÉÏù¥Îã§.</li>
    </ul>
  </li>
</ul>

<p><strong>Pair Plot (After Removing All the Outliers)</strong>
<img src="/assets/2022-12-25-when-regression-does-not-work/Pair Plot (After Removing All the Outliers).webp" alt="" /></p>
<blockquote>
  <p>Îç∞Ïù¥ÌÑ∞Ïùò Íµ≠ÏßÄÏ†ÅÏù∏ Í≤ΩÌñ•ÏÑ±Ïù¥ ÏÉÅÎãπ Î∂ÄÎ∂Ñ Ï†úÍ±∞Í∞Ä ÎêòÏóàÎã§.</p>
</blockquote>

<h1 id="5-modeling">5. Modeling</h1>

<h2 id="51-simple-linear-regression-v1">5.1. Simple Linear Regression (v1)</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="n">lr</span> <span class="o">=</span> <span class="nc">LinearRegression</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  
	<span class="n">lr</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">data_input</span><span class="p">,</span> <span class="n">data_target</span><span class="p">)</span>  
	<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">R-squared:</span><span class="sh">'</span><span class="p">,</span> <span class="n">lr</span><span class="p">.</span><span class="nf">score</span><span class="p">(</span><span class="n">data_input</span><span class="p">,</span> <span class="n">data_target</span><span class="p">).</span><span class="nf">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="1-target-ÏûîÏ∞®-Î∂ÑÏÑù">(1) Target ÏûîÏ∞® Î∂ÑÏÑù</h3>
<p><img src="/assets/2022-12-25-when-regression-does-not-work/Simple Linear Regression (v1)-Target ÏûîÏ∞®Î∂ÑÏÑù.webp" alt="" /></p>
<blockquote>
  <p>[Residuals Plot] ÏûîÏ∞®Í∞Ä ÌäπÏ†ï Ìå®ÌÑ¥ ÏóÜÏù¥ Ï†ïÍ∑úÏÑ±ÏùÑ Ïûò Îî∞Î•¥Í≥† ÏûàÎäî Í≤É Í∞ôÏùÄÎç∞?</p>
</blockquote>

<h3 id="2-Í∞Å-ÎèÖÎ¶ΩÎ≥ÄÏàò-ÏûîÏ∞®Î∂ÑÏÑù">(2) Í∞Å ÎèÖÎ¶ΩÎ≥ÄÏàò ÏûîÏ∞®Î∂ÑÏÑù</h3>

<blockquote>
  <p>Ïò§Ï∞®Ìï≠Ïùò Ïù¥Î∂ÑÏÇ∞ÏÑ±(heteroscedasticity) ÏóÜÏù¥, <strong>ÏûîÏ∞®Í∞Ä Ï†ïÍ∑úÎ∂ÑÌè¨Î•º Í∞ÄÏû• Ïûò Îî∞Î•¥Í≥† ÏûàÎã§.</strong>
Îî∞ÎùºÏÑú Polynomial or LogarithmÏùÑ Ï¶âÍ∞Å Ï†ÅÏö©Ìï¥Ïïº ÌïúÎã§Í∏∞Î≥¥Îã§, Regression Model ÏûêÏ≤¥Ïùò ÏÑ±Îä•Ïù¥ Ïïà Ï¢ãÎã§Îäî Í≤ÉÏùÑ ÏùòÎØ∏ÌïúÎã§.</p>
</blockquote>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/Simple Linear Regression (v1)-Í∞Å ÎèÖÎ¶ΩÎ≥ÄÏàò ÏûîÏ∞®Î∂ÑÏÑù.webp" alt="" /></p>
<blockquote>
  <p>[Residuals Plot] ÏûîÏ∞®Í∞Ä ÌäπÏ†ï Ìå®ÌÑ¥ ÏóÜÏù¥ Ï†ïÍ∑úÏÑ±ÏùÑ Ïûò Îî∞Î•¥Í≥† ÏûàÎäî Í≤É Í∞ôÏùÄÎç∞?</p>
</blockquote>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/Simple Linear Regression (v1)-qq plot.webp" alt="" /></p>
<blockquote>
  <p>[QQ Plot] ÏûîÏ∞®Ïùò Î∂ÑÌè¨Í∞Ä Ï†ïÍ∑úÎ∂ÑÌè¨Ïóê Í∞ÄÏû• Í∞ÄÍπùÎÑ§?</p>
</blockquote>

<h3 id="3-model-summary">(3) Model Summary</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="p">.</span><span class="nf">ols</span><span class="p">(</span>  
	<span class="sh">'</span><span class="s">target</span><span class="sh">'</span> <span class="o">+</span> <span class="sh">'</span><span class="s"> ~ </span><span class="sh">'</span> <span class="o">+</span> <span class="sh">'</span><span class="s"> + </span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">data_input</span><span class="p">.</span><span class="n">columns</span><span class="p">),</span>  
	<span class="n">data</span> <span class="o">=</span> <span class="n">data_df</span>  
	<span class="p">).</span><span class="nf">fit</span><span class="p">()</span>
</code></pre></div></div>
<blockquote>
  <p><strong>F-testÏùò <code class="language-plaintext highlighter-rouge">p-value ‚â§ 0.05</code></strong>: Ï†ÅÏñ¥ÎèÑ ÌïòÎÇòÏùò ÎèÖÎ¶ΩÎ≥ÄÏàòÍ∞Ä Ï¢ÖÏÜçÎ≥ÄÏàòÏôÄ ÏÉÅÍ¥ÄÍ¥ÄÍ≥ÑÍ∞Ä ÏûàÎã§Îäî ÏïÑÏ£º Í∞ïÌïú Í∑ºÍ±∞Í∞Ä ÏûàÎã§.<br />
<strong>R-squared</strong>: ÏßÄÎÇòÏπòÍ≤å ÎÇÆÏïÑÏÑú Î≥∏ Î™®Îç∏Ïùò ÏÑ§Î™ÖÎ†•Ïù¥ <code class="language-plaintext highlighter-rouge">7.80%</code> Î∞ñÏóê ÏóÜÎã§.</p>
</blockquote>

<h3 id="4-modelÏùò-train-result--Ïú†ÏùòÏÑ±-ÏßÄÌëú">(4) ModelÏùò Train Result &amp; Ïú†ÏùòÏÑ± ÏßÄÌëú</h3>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/Simple Linear Regression (v1)-result1.webp" alt="" /></p>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">day</code> Î≥ÄÏàò <strong>T-testÏùò <code class="language-plaintext highlighter-rouge">p-value ‚â• 0.05</code></strong>: Ï†úÍ±∞ÌïòÏó¨ Refit Model ÌïÑÏöîÏÑ±Ïù¥ ÏûàÎã§.</p>
</blockquote>

<h3 id="5-ÎèÖÎ¶ΩÎ≥ÄÏàòÎ≥Ñ-train-result--Ïú†ÏùòÏÑ±-ÏßÄÌëú">(5) ÎèÖÎ¶ΩÎ≥ÄÏàòÎ≥Ñ Train Result &amp; Ïú†ÏùòÏÑ± ÏßÄÌëú</h3>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/Simple Linear Regression (v1)-result2.webp" alt="" /></p>

<h2 id="52-simple-linear-regression-v2--day-Î≥ÄÏàò-Ï†úÏô∏">5.2. Simple Linear Regression (v2) ‚Äî ‚Äúday‚Äù Î≥ÄÏàò Ï†úÏô∏</h2>

<h3 id="1-model-summary">(1) Model Summary</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="n">model</span> <span class="o">=</span> <span class="n">smf</span><span class="p">.</span><span class="nf">ols</span><span class="p">(</span>  
	    <span class="sh">'</span><span class="s">target</span><span class="sh">'</span> <span class="o">+</span> <span class="sh">'</span><span class="s"> ~ </span><span class="sh">'</span> <span class="o">+</span> <span class="sh">'</span><span class="s"> + </span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">data_input</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">day</span><span class="sh">'</span><span class="p">])),</span>  
	    <span class="n">data</span> <span class="o">=</span> <span class="n">data_df</span>  
	<span class="p">).</span><span class="nf">fit</span><span class="p">()</span>
</code></pre></div></div>
<blockquote>
  <p><strong>F-testÏùò <code class="language-plaintext highlighter-rouge">p-value ‚â§ 0.05</code></strong>: Ï†ÅÏñ¥ÎèÑ ÌïòÎÇòÏùò ÎèÖÎ¶ΩÎ≥ÄÏàòÍ∞Ä Ï¢ÖÏÜçÎ≥ÄÏàòÏôÄ ÏÉÅÍ¥ÄÍ¥ÄÍ≥ÑÍ∞Ä ÏûàÎã§Îäî ÏïÑÏ£º Í∞ïÌïú Í∑ºÍ±∞Í∞Ä ÏûàÎã§.<br />
<strong>R-squared</strong>: ÏßÄÎÇòÏπòÍ≤å ÎÇÆÏïÑÏÑú Î≥∏ Î™®Îç∏Ïùò ÏÑ§Î™ÖÎ†•Ïù¥ <code class="language-plaintext highlighter-rouge">7.80%</code> Î∞ñÏóê ÏóÜÎã§.</p>
</blockquote>

<h3 id="2-modelÏùò-train-result--Ïú†ÏùòÏÑ±-ÏßÄÌëú">(2) ModelÏùò Train Result &amp; Ïú†ÏùòÏÑ± ÏßÄÌëú</h3>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/Simple Linear Regression (v2)-result1.webp" alt="" /></p>
<blockquote>
  <p>Î™®Îì† Î≥ÄÏàòÍ∞Ä T-testÎ•º ÌÜµÍ≥ºÌïúÎã§. (<strong>Confidence Level = <code class="language-plaintext highlighter-rouge">95%</code></strong>)</p>
</blockquote>

<h3 id="3-ÎèÖÎ¶ΩÎ≥ÄÏàòÎ≥Ñ-train-result--Ïú†ÏùòÏÑ±-ÏßÄÌëú">(3) ÎèÖÎ¶ΩÎ≥ÄÏàòÎ≥Ñ Train Result &amp; Ïú†ÏùòÏÑ± ÏßÄÌëú</h3>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/Simple Linear Regression (v2)-result2.webp" alt="" /></p>
<blockquote>
  <p><code class="language-plaintext highlighter-rouge">day</code> Î≥ÄÏàòÎ•º Ï†úÏô∏ÌñàÏùåÏóêÎèÑ Î∂àÍµ¨ÌïòÍ≥†, Î™®Îç∏Ïùò ÏÑ§Î™ÖÎ†•Ïù¥ Ï†ÑÌòÄ Í∞úÏÑ†ÎêòÏßÄ ÏïäÎäîÎã§.
Îî∞ÎùºÏÑú, Î≥∏ DatasetÏóêÏÑúÎäî <strong>Simple Linear RegressionÏùò Training Capacity ÏûêÏ≤¥Í∞Ä Îß§Ïö∞ ÎÇÆÏùÄ ÏùòÎØ∏</strong>Î°ú Ïù¥Ìï¥ÎêúÎã§.</p>
</blockquote>

<h2 id="53-polynomial-regression-v1--degree2">5.3. Polynomial Regression (v1) ‚Äî ‚Äúdegree=2‚Äù</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="n">poly</span> <span class="o">=</span> <span class="nc">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  
	<span class="n">poly</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">data_input</span><span class="p">)</span>  
	<span class="n">data_input_poly</span> <span class="o">=</span> <span class="n">poly</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">data_input</span><span class="p">)</span>  
	  
	<span class="n">lr</span> <span class="o">=</span> <span class="nc">LinearRegression</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  
	<span class="n">lr</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">data_input_poly</span><span class="p">,</span> <span class="n">data_target</span><span class="p">)</span>  
	<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">R-squared:</span><span class="sh">'</span><span class="p">,</span> <span class="n">lr</span><span class="p">.</span><span class="nf">score</span><span class="p">(</span><span class="n">data_input_poly</span><span class="p">,</span> <span class="n">data_target</span><span class="p">).</span><span class="nf">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>  
	<span class="c1"># &gt; R-squared: 0.1127
</span></code></pre></div></div>

<h3 id="1-ÏûîÏ∞®Î∂ÑÏÑù">(1) ÏûîÏ∞®Î∂ÑÏÑù</h3>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/Polynomial Regression (v1)-ÏûîÏ∞®Î∂ÑÏÑù.webp" alt="" /></p>
<blockquote>
  <p>Polynomial Regression (v1) ‚Äî ‚Äúdegree=2‚Äù</p>
</blockquote>

<h2 id="54-polynomial-regression-v2--degree3">5.4. Polynomial Regression (v2) ‚Äî ‚Äúdegree=3‚Äù</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="n">poly</span> <span class="o">=</span> <span class="nc">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  
	<span class="n">poly</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">data_input</span><span class="p">)</span>  
	<span class="n">data_input_poly</span> <span class="o">=</span> <span class="n">poly</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">data_input</span><span class="p">)</span>  
	  
	<span class="n">lr</span> <span class="o">=</span> <span class="nc">LinearRegression</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  
	<span class="n">lr</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">data_input_poly</span><span class="p">,</span> <span class="n">data_target</span><span class="p">)</span>  
	<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">R-squared:</span><span class="sh">'</span><span class="p">,</span> <span class="n">lr</span><span class="p">.</span><span class="nf">score</span><span class="p">(</span><span class="n">data_input_poly</span><span class="p">,</span> <span class="n">data_target</span><span class="p">).</span><span class="nf">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>  
	<span class="c1"># &gt; R-squared: 0.1362
</span></code></pre></div></div>

<h3 id="1-ÏûîÏ∞®Î∂ÑÏÑù-1">(1) ÏûîÏ∞®Î∂ÑÏÑù</h3>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/Polynomial Regression (v2)-ÏûîÏ∞®Î∂ÑÏÑù.webp" alt="" /></p>
<blockquote>
  <p>Polynomial Regression (v2) ‚Äî ‚Äúdegree=3‚Äù</p>
</blockquote>

<h2 id="55-polynomial-regression-v3--degree4">5.5. Polynomial Regression (v3) ‚Äî ‚Äúdegree=4‚Äù</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="n">poly</span> <span class="o">=</span> <span class="nc">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>  
	<span class="n">poly</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">data_input</span><span class="p">)</span>  
	<span class="n">data_input_poly</span> <span class="o">=</span> <span class="n">poly</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">data_input</span><span class="p">)</span>  
	  
	<span class="n">lr</span> <span class="o">=</span> <span class="nc">LinearRegression</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  
	<span class="n">lr</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">data_input_poly</span><span class="p">,</span> <span class="n">data_target</span><span class="p">)</span>  
	<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">R-squared:</span><span class="sh">'</span><span class="p">,</span> <span class="n">lr</span><span class="p">.</span><span class="nf">score</span><span class="p">(</span><span class="n">data_input_poly</span><span class="p">,</span> <span class="n">data_target</span><span class="p">).</span><span class="nf">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>  
	<span class="c1"># &gt; R-squared: 0.1597
</span></code></pre></div></div>

<h3 id="1-ÏûîÏ∞®Î∂ÑÏÑù-2">(1) ÏûîÏ∞®Î∂ÑÏÑù</h3>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/Polynomial Regression (v3)-ÏûîÏ∞®Î∂ÑÏÑù.webp" alt="" /></p>
<blockquote>
  <p>Polynomial Regression (v3) ‚Äî ‚Äúdegree=4‚Äù</p>
</blockquote>

<h2 id="56-polynomial-regression-v4--degree5">5.6. Polynomial Regression (v4) ‚Äî ‚Äúdegree=5‚Äù</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="n">poly</span> <span class="o">=</span> <span class="nc">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  
	<span class="n">poly</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">data_input</span><span class="p">)</span>  
	<span class="n">data_input_poly</span> <span class="o">=</span> <span class="n">poly</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">data_input</span><span class="p">)</span>  
	  
	<span class="n">lr</span> <span class="o">=</span> <span class="nc">LinearRegression</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  
	<span class="n">lr</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">data_input_poly</span><span class="p">,</span> <span class="n">data_target</span><span class="p">)</span>  
	<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">R-squared:</span><span class="sh">'</span><span class="p">,</span> <span class="n">lr</span><span class="p">.</span><span class="nf">score</span><span class="p">(</span><span class="n">data_input_poly</span><span class="p">,</span> <span class="n">data_target</span><span class="p">).</span><span class="nf">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>  
	<span class="c1"># &gt; R-squared: 0.1806
</span></code></pre></div></div>

<h3 id="1-ÏûîÏ∞®Î∂ÑÏÑù-3">(1) ÏûîÏ∞®Î∂ÑÏÑù</h3>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/Polynomial Regression (v4)-ÏûîÏ∞®Î∂ÑÏÑù.webp" alt="" /></p>
<blockquote>
  <p>Polynomial Regression (v4) ‚Äî ‚Äúdegree=5‚Äù</p>
</blockquote>

<h1 id="6-conclusion">6. Conclusion</h1>

<h2 id="61-regression-model-Ïô∏Ïùò-Î™®Îç∏Ïù¥-ÌïÑÏöîÌïòÎã§">6.1. Regression Model Ïô∏Ïùò Î™®Îç∏Ïù¥ ÌïÑÏöîÌïòÎã§!</h2>

<h3 id="1-modeling-results">(1) Modeling Results</h3>

<table>
  <thead>
    <tr>
      <th><strong>ÌöåÍ∑Ä Î™®Îç∏</strong></th>
      <th><strong>ÌäπÏù¥ÏÇ¨Ìï≠</strong></th>
      <th><strong>R-squared</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Simple Linear Regression</td>
      <td>Î™®Îì† ÎèÖÎ¶ΩÎ≥ÄÏàò Ìè¨Ìï®</td>
      <td><code class="language-plaintext highlighter-rouge">0.0780</code></td>
    </tr>
    <tr>
      <td>Simple Linear Regression</td>
      <td><code class="language-plaintext highlighter-rouge">day</code> ÎèÖÎ¶ΩÎ≥ÄÏàò Ï†úÏô∏</td>
      <td><code class="language-plaintext highlighter-rouge">0.0780</code></td>
    </tr>
    <tr>
      <td>Polynomial Regression</td>
      <td>Up to 2nd Degree</td>
      <td><code class="language-plaintext highlighter-rouge">0.1127</code></td>
    </tr>
    <tr>
      <td>Polynomial Regression</td>
      <td>Up to 3rd Degree</td>
      <td><code class="language-plaintext highlighter-rouge">0.1362</code></td>
    </tr>
    <tr>
      <td>Polynomial Regression</td>
      <td>Up to 4th Degree</td>
      <td><code class="language-plaintext highlighter-rouge">0.1597</code></td>
    </tr>
    <tr>
      <td>Polynomial Regression</td>
      <td>Up to 5th Degree</td>
      <td><code class="language-plaintext highlighter-rouge">0.1806</code></td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>ÏïÑÎ¨¥Î¶¨ CapacityÎ•º ÎÜíÏó¨ÎèÑ Î™®Îç∏Ïùò ÏÑ§Î™ÖÎ†•Ïù¥ Í∑πÏ†ÅÏúºÎ°ú Í∞úÏÑ†ÎêòÏßÄ ÏïäÏïòÎã§!</p>
</blockquote>

<h3 id="2-model-capacity">(2) Model Capacity</h3>

<ul>
  <li><strong>Model CapacityÎûÄ?</strong>
    <blockquote>
      <p><strong>Î™®Îç∏ Ïö©Îüâ</strong>: Îã§ÏñëÌïú Ï∞®ÏõêÏùò Í¥ÄÍ≥ÑÏÑ±ÏùÑ ÌïôÏäµÌï† Ïàò ÏûàÎäî Îä•Î†• (The ability to fit a variety of functions)
üåù Í∞ÑÎã®Ìûà, Î™®Îç∏Ïùò ÌïôÏäµ Í∞ÄÎä• Ï∞®Ïàò(Ï∞®Ïõê)Î°ú Î∂àÎ¶¨Í∏∞ÎèÑ Ìï®</p>
    </blockquote>
  </li>
  <li><strong>Models with Low Capacity</strong>: ÌïôÏäµ ÏûêÏ≤¥Í∞Ä Ïñ¥Î†§ÏõåÏßÑÎã§. (<code class="language-plaintext highlighter-rouge">Underfitting</code> Î¨∏Ï†ú)</li>
  <li>
    <p><strong>Models with High Capacity</strong>: Memory EffectÏùò Î∂ÄÏ†ïÏ†Å Ìö®Í≥ºÍ∞Ä Î∞úÏÉùÌïúÎã§. (<code class="language-plaintext highlighter-rouge">Overfitting</code> Î¨∏Ï†ú)</p>
  </li>
  <li><strong>Tree</strong>, <strong>Ensemble</strong>, <strong>Time-series</strong> Í≥ÑÏó¥Ïùò ML Î™®Îç∏Îì§ÏùÑ ÌÜµÌï¥ Ï†ëÍ∑ºÌïòÎäî Í≤ÉÏù¥ Ï†ÅÏ†àÌï¥ Î≥¥Ïù∏Îã§.</li>
</ul>

<p><img src="/assets/2022-12-25-when-regression-does-not-work/dacon.webp" alt="" /></p>
<blockquote>
  <p><a href="https://dacon.io/competitions/official/235736/data">ÏÇ¨Ïã§ Ïù¥ DatasetÏùÄ DaconÏóêÏÑú Í∞ÄÏ†∏ÏôîÎäîÎç∞, Regression ModelÎ°ú Ï†ëÍ∑ºÌïòÎäî ÏÇ¨ÎûåÎì§ÏùÄ Îã® Ìïú Î™ÖÎèÑ ÏóÜÏóàÎã§.</a></p>
</blockquote>

<h2 id="62-regression-modelÏù¥-Ìï¥Îãπ-dataset-ÌïôÏäµÏóê-Ï†ÅÏ†àÌïú-Î™®Îç∏Ïù¥-ÏïÑÎãòÏùÑ-ÌååÏïÖÌïòÎäî-Î∞©Î≤ïÏùÄ">6.2. Regression ModelÏù¥ Ìï¥Îãπ Dataset ÌïôÏäµÏóê Ï†ÅÏ†àÌïú Î™®Îç∏Ïù¥ ÏïÑÎãòÏùÑ ÌååÏïÖÌïòÎäî Î∞©Î≤ïÏùÄ?</h2>

<h3 id="1-simple-linear-regressionÏùò-ÏûîÏ∞®Í∞Ä-Ïù¥Î∂ÑÏÇ∞ÏÑ±-ÏóÜÏù¥-Ï†ïÍ∑úÏÑ±ÏùÑ-Îß§Ïö∞-Ïûò-Îî∞Î•¥ÎäîÎç∞ÎèÑ-r-squared-Í∞íÏù¥-Îß§Ïö∞-Ï†ÄÏ°∞ÌïòÎã§">(1) Simple Linear RegressionÏùò ÏûîÏ∞®Í∞Ä Ïù¥Î∂ÑÏÇ∞ÏÑ± ÏóÜÏù¥ Ï†ïÍ∑úÏÑ±ÏùÑ Îß§Ïö∞ Ïûò Îî∞Î•¥ÎäîÎç∞ÎèÑ, <code class="language-plaintext highlighter-rouge">R-squared</code> Í∞íÏù¥ Îß§Ïö∞ Ï†ÄÏ°∞ÌïòÎã§.</h3>

<p><strong>Simple Linear Regression: Target ÏûîÏ∞® Î∂ÑÏÑù</strong>
<img src="/assets/2022-12-25-when-regression-does-not-work/Simple Linear Regression (v1)-Target ÏûîÏ∞®Î∂ÑÏÑù.webp" alt="" /></p>

<p><strong>Simple Linear Regression: Target QQ Plot</strong>
<img src="/assets/2022-12-25-when-regression-does-not-work/Simple Linear Regression (v1)-qq plot.webp" alt="" /></p>

<h3 id="2-polynomial-regressionÏùò-degreeÎ•º-ÎÜíÏó¨ÎèÑ-ÏûîÏ∞®-ÏûêÏ≤¥Í∞Ä-Í∞úÏÑ†ÎêòÏßÄ-ÏïäÎäîÎã§">(2) Polynomial RegressionÏùò <code class="language-plaintext highlighter-rouge">Degree</code>Î•º ÎÜíÏó¨ÎèÑ ÏûîÏ∞® ÏûêÏ≤¥Í∞Ä Í∞úÏÑ†ÎêòÏßÄ ÏïäÎäîÎã§.</h3>

<p><strong><code class="language-plaintext highlighter-rouge">Degree=2</code>Ïù∏ Polynomial RegressionÏùò Í∞Å ÎèÖÎ¶ΩÎ≥ÄÏàòÎ≥Ñ ÏûîÏ∞®</strong>
<img src="/assets/2022-12-25-when-regression-does-not-work/Polynomial Regression (v1)-ÏûîÏ∞®Î∂ÑÏÑù.webp" alt="" /></p>

<p><strong><code class="language-plaintext highlighter-rouge">Degree=5</code>Ïù∏ Polynomial RegressionÏùò Í∞Å ÎèÖÎ¶ΩÎ≥ÄÏàòÎ≥Ñ ÏûîÏ∞®</strong>
<img src="/assets/2022-12-25-when-regression-does-not-work/Polynomial Regression (v4)-ÏûîÏ∞®Î∂ÑÏÑù.webp" alt="" /></p>

<hr />

<h2 id="published-by-joshua-kim"><em>Published by</em> Joshua Kim</h2>
<p><img src="/assets/profile/joshua-profile.png" alt="Joshua Kim" /></p>]]></content><author><name></name></author><category term="korean" /><category term="machine_learning" /><category term="statistics" /><category term="python" /><summary type="html"><![CDATA[Ïù¥Î≤à ÏïÑÌã∞ÌÅ¥ÏóêÏÑúÎäî ÌöåÍ∑ÄÎ™®Îç∏(Regression Model)Ïù¥ Ïñ¥Îñ§ Í≤ΩÏö∞Ïóê Ï†ÄÏ°∞Ìïú ÏÑ±Í≥ºÎ•º ÎÇ¥ÎäîÏßÄ, Îçî ÎÇòÏïÑÍ∞Ä DatasetÏù¥ Ïñ¥Îñ§ ÌäπÏÑ±ÏùÑ ÏßÄÎãê Îïå ÌöåÍ∑ÄÎ™®Îç∏Î°ú Ìï¥Îãπ Î¨∏Ï†úÎ•º ÌíÄÏñ¥ÎÇº Ïàò ÏóÜÎäîÏßÄ ÌïÑÏûêÍ∞Ä Í≤ΩÌóòÌïú Î∞îÎ•º ÏÑúÏà†Ìï¥Î≥¥Í≥†Ïûê ÌïúÎã§.]]></summary></entry><entry><title type="html">Ïò®Ï≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÌïòÍ∏∞ | Dune Analytics 101</title><link href="http://localhost:4000/dune-analytics/" rel="alternate" type="text/html" title="Ïò®Ï≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÌïòÍ∏∞ | Dune Analytics 101" /><published>2022-12-03T00:00:00+09:00</published><updated>2022-12-03T00:00:00+09:00</updated><id>http://localhost:4000/dune-analytics</id><content type="html" xml:base="http://localhost:4000/dune-analytics/"><![CDATA[<blockquote>
  <p>Ïù¥Î≤à ÏãúÍ∞ÑÏóêÎäî Ïò®Ï≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞ Ïï†ÎÑêÎ¶¨Ìã±Ïä§ ÌîåÎû´ÌèºÎì§ Ï§ë Í∞ÄÏû• Ìï´ÌïòÍ≥† Ïª§ÎÆ§ÎãàÌã∞Í∞Ä ÌÅ∞ <a href="https://dune.com/home">Dune Analytics</a>Ïùò Íµ¨Ï°∞ÏôÄ ÏÇ¨Ïö© Î∞©Î≤ïÏóê ÎåÄÌï¥ ÏïåÏïÑÎ≥º Í≤ÉÏù¥Îã§. Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïù¥Ïñ∏Ïä§Î•º Í≥µÎ∂ÄÌïòÍ≥† Î∏îÎ°ùÏ≤¥Ïù∏ Í∏∞ÏóÖÏóêÏÑú ÏùºÌïòÎäî Î≥∏Ïù∏ÏóêÍ≤å Dune AnalyticsÎäî Í∞ÄÎßåÌûà Ï≥êÎã§Î≥¥Í∏∞Îßå Ìï¥ÎèÑ Îäò Ïã¨Ïû•Ïù¥ ÏøµÏæÖÍ±∞Î¶¨Î©∞ ÌÖêÏÖòÏù¥ ÏóÖÎêòÎäî Ïú†ÌÜ†ÌîºÏïÑ Í∞ôÏùÄ Í≥≥Ïù¥Îã§. ÌïòÏßÄÎßå ÏïàÌÉÄÍπùÍ≤åÎèÑ, Ïù¥ ÏÑ§Î†àÎäî ÎßàÏùåÏùÑ Ïù¥Ïñ¥ Î∞õÏïÑ Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞Î•º Ïù¥Ìï¥ÌïòÍ≥† ÏÇ¨Ïö© Î∞©Î≤ïÏùÑ ÏùµÌûàÍ∏∞ ÏúÑÌïú Î†àÌçºÎü∞Ïä§Í∞Ä ÏÉÅÎãπÌûà Î∂ÄÏ°±ÌïòÎã§Îäî Í≤ÉÏùÑ ÏïåÍ≤å ÎêòÏóàÎã§. Í∑∏Î¶¨ÌïòÏó¨ ÎÇò Ï≤òÎüº Îç∞Ïù¥ÌÑ∞Îßå Î≥¥Î©¥ ÎßàÏùåÏù¥ Î≤ÖÏ∞®Ïò§Î•¥Îäî Ïù¥ ÏãúÎåÄ Î™®Îì† Ïò®Ï≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞ Îü¨Î≤ÑÎì§ÏóêÍ≤å Ïù¥ Í∏ÄÏùÑ Î∞îÏπòÍ≥†Ïûê ÌïúÎã§. Happy Duning!</p>
</blockquote>

<h3 id="contents">CONTENTS</h3>
<ol>
  <li>Intro: Web 3.0Îäî Îç∞Ïù¥ÌÑ∞ Ï≤úÍµ≠</li>
  <li>Ïò®Ï≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞Î•º Îñ†Î®πÏó¨Ï£ºÎäî Dune</li>
  <li>Dune, Îèà ÎÇ¥Í≥† Ïç®Ïïº ÌïòÎäîÍ∞Ä</li>
  <li>Dune DB Schema
    <ul>
      <li>4.1. Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå Í∞ÄÎä•Ìïú Î∏îÎ°ùÏ≤¥Ïù∏ Î¶¨Ïä§Ìä∏</li>
      <li>4.2. Ïñ¥Îñ§ ÌÖåÏù¥Î∏îÎì§Î°ú Íµ¨ÏÑ±ÎêòÏñ¥ ÏûàÎäîÍ∞Ä</li>
    </ul>
  </li>
  <li>5Í∞úÏùò ÏóîÏßÑ
    <ul>
      <li>5.1. Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÏóîÏßÑ</li>
      <li>5.2. PostgreSQL vs Spark SQL</li>
    </ul>
  </li>
  <li>Case Study
    <ul>
      <li>6.1. Ethereum NFT Project WAU (Weekly Active Users)</li>
      <li>6.2. Ethereum DEX TX Volume (Token-wise)</li>
    </ul>
  </li>
  <li>ÌåÅ ÎåÄÎ∞©Ï∂ú
    <ul>
      <li>7.1. CTEÎ•º Ï†ÅÍ∑πÏ†ÅÏúºÎ°ú ÏÇ¨Ïö©ÌïòÏûê.</li>
      <li>7.2. Ï£ºÏöî CA Address LabelingÏùÑ Ìï¥ÎëêÏûê.</li>
      <li>7.3. Spark SQL Î¨∏Î≤ï Í≥µÎ∂ÄÎ•º ÌïòÏûê.</li>
    </ul>
  </li>
  <li>Outro: Let‚Äôs mingle in!</li>
</ol>

<hr />

<p><img src="/assets/2022-12-03-dune-analytics/dune-logo.webp" alt="" /></p>
<blockquote>
  <p>Dune Analytics</p>
</blockquote>

<h1 id="1-intro-web-30Îäî-Îç∞Ïù¥ÌÑ∞-Ï≤úÍµ≠">1. Intro: Web 3.0Îäî Îç∞Ïù¥ÌÑ∞ Ï≤úÍµ≠</h1>

<p>Îç∞Ïù¥ÌÑ∞ Îã¥ÎãπÏûêÏù∏ ÎÇòÏóêÍ≤å ÏûàÏñ¥ Web 3.0ÏùÄ ÏÇ¨Îûë Í∑∏ ÏûêÏ≤¥Îã§. Web 2.0 ÌîåÎû´ÌèºÏóêÏÑú Í∑ºÎ¨¥ÌïòÏãúÎäî Î∂ÑÎì§ÏùÄ Îã§ ÏïÑÏãúÍ≤†ÏßÄÎßå, Îß§Ïö∞ Îã®ÏàúÌïú Î∂ÑÏÑùÏù¥ÎÇò ML Model FittingÏùÑ ÏúÑÌï¥ Îç∞Ïù¥ÌÑ∞Î•º ÌôïÎ≥¥ÌïòÎäî Í≤ÉÏùÄ Îß§Ïö∞ Ïñ¥Î†µÍ≥† Ïû•Ïï† ÏöîÏÜåÍ∞Ä ÎßéÏùÄ ÏùºÏù¥Îã§. Í∞úÏù∏Ï†ïÎ≥¥ Î≥¥Ìò∏Î≤ï Ï§ÄÏàòÎ•º ÏúÑÌïú Í±∞Î≤ÑÎÑåÏä§ Ï°∞Í±¥Ïù¥ Îß§Ïö∞ ÎßéÍ∏∞ ÎïåÎ¨∏Ïóê, Í≥†Í∞ùÏùò ÏãùÎ≥ÑÏûêÍ∞Ä Í∞ÄÎ™ÖÌôî(Pseudonymization)Îêú Ï±ÑÎ°ú Raw DataÎ•º Î∞õÍ≤å ÎêòÎäî Í≤ΩÏö∞Í∞Ä ÎπàÎ≤àÌïòÍ≥†, Îòê ÌäπÏ†ï Í≥†Í∞ù SegmentÎ•º ÏúÑÌïú ÌÉÄÍ≤ü ÌîÑÎ°úÎ™®ÏÖò Ïã§ÌñâÏùÑ ÏúÑÌï¥ Classifier ML ModelÏùÑ Íµ¨ÌòÑÌñàÎã§Í≥† ÌïòÎçîÎùºÎèÑ Í≥†Í∞ùÏùò Í∞úÏù∏Ï†ïÎ≥¥ Î≥¥Ìò∏Î•º ÏúÑÌï¥ Ìï¥Îãπ ModelÏùÑ Í∞Å Í≥†Í∞ùÎì§ÏóêÍ≤å Îß§ÌïëÌïòÏó¨ Serving ÌïòÍ∏∞ÏóêÎèÑ Ï†úÏïΩÏù¥ ÎßéÎã§. (ÌäπÌûà, Web 2.0 Í∏àÏúµ Í∏∞ÏóÖÏùºÏàòÎ°ù Ïù¥Îü∞ Î¨∏Ï†úÎ°ú Ïù∏Ìïú Îç∞Ïù¥ÌÑ∞ ÌôúÏö© Ìè≠Ïù¥ Îß§Ïö∞ Ï¢ÅÏùÄ Í≤É Í∞ôÎã§.)</p>

<p>Í∑∏Îü¨ÎÇò Web 3.0Îäî Îã§Î•¥Îã§. Ïö∞ÏÑ†, Îç∞Ïù¥ÌÑ∞ Ï†ëÍ∑ºÏÑ±Ïù¥ Îß§Ïö∞ ÎØºÏ£ºÏ†ÅÏù¥Îã§. Ìï¥Îãπ Î∏îÎ°ùÏ≤¥Ïù∏ ÎÑ§Ìä∏ÏõåÌÅ¨ ÎÇ¥ÏóêÏÑú ÎÖ∏ÎìúÎ•º ÎèåÎ¶¨Í∏∞Îßå ÌïòÎ©¥ ÎàÑÍµ¨ÎÇò ÏûêÏú†Î°≠Í≤å Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÏ∂úÌïòÏó¨ Ï†ÅÏû¨Ìï† Ïàò ÏûàÎã§. ÎåÄÎ∂ÄÎ∂ÑÏùò Î∏îÎ°ùÏ≤¥Ïù∏Ïù¥ Í∞ÄÎ™ÖÏÑ± Ï≤†ÌïôÏùÑ Í∏∞Î∞òÏúºÎ°ú Ïù¥Î£®Ïñ¥Ï†∏ ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê Í∞úÏù∏Ï†ïÎ≥¥ Ïù¥ÏäàÍ∞Ä Ï†ÅÏùÑ Îøê ÏïÑÎãàÎùº, ÌäπÏ†ï ÌîåÎû´ÌèºÏùò Ïö¥ÏòÅ Í∏∞ÏóÖÏù¥ Îç∞Ïù¥ÌÑ∞Î•º ÎèÖÏ†êÌïòÏßÄÎèÑ ÏïäÍ∏∞ ÎïåÎ¨∏Ïóê Ï∂îÏ∂ú Ïö©Ïù¥ÏÑ±Í≥º ÌôúÏö©ÏÑ±Ïù¥ Î¨¥Í∂ÅÎ¨¥ÏßÑÌïòÎã§.</p>

<p><img src="/assets/2022-12-03-dune-analytics/web3-platform.webp" alt="" /></p>
<blockquote>
  <p>Web 3.0Îäî ÌîåÎû´Ìèº Ï∞∏Ïó¨Ïûê Î™®ÎëêÍ∞Ä Îç∞Ïù¥ÌÑ∞ ÏÜåÏú†Í∂åÏùÑ Î∂ÄÏó¨ Î∞õÏùÑ Ïàò ÏûàÎã§.</p>
</blockquote>

<p>ÎòêÌïú, Web 3.0 Îç∞Ïù¥ÌÑ∞Îäî Data Cleaning ÏûëÏóÖÎèÑ ÏÉÅÎãπÌûà Îçú ÏöîÍµ¨ÎêòÎäî Ìé∏Ïù¥Îã§. Îç∞Ïù¥ÌÑ∞ ÌåÄÏóêÏÑú Í∑ºÎ¨¥ÌïòÏãúÎäî Î∂ÑÎì§ÏùÄ Îã§ ÏïÑÏãúÍ≤†ÏßÄÎßå, Î∂ÑÏÑùÏùÑ ÌïòÍ∏∞ ÏúÑÌïú ÎåÄÎ∂ÄÎ∂ÑÏùò Raw DataÎäî Îß§Ïö∞ ÏßÄÏ†ÄÎ∂ÑÌïòÎã§. Null Í∞í, Typos, Outliers, Special Characters Îì±ÏùÑ Ìï¥Í≤∞ÌïòÎäî Í≤ÉÏù¥ Î∂ÑÏÑùÏùÑ ÏúÑÌïú ÌïÑÏàò ÏÑ†Í≤∞ Í≥ºÏ†úÎã§. Ï¶â, Ïö∞Î¶¨Îäî ÎåÄÎ∂ÄÎ∂ÑÏùò ÏãúÍ∞ÑÏùÑ Îç∞Ïù¥ÌÑ∞ ‚ÄúÎ∂ÑÏÑù‚ÄùÏù¥ ÏïÑÎãå, Îç∞Ïù¥ÌÑ∞ ‚ÄúÏ†ÑÏ≤òÎ¶¨‚ÄùÎ•º ÌïòÎäî Îç∞ Ïì¥Îã§. (Î¨ºÎ°†, Category Features Encoding, Imputation with Mean, Median, and ModeÏôÄ Í∞ôÏùÄ Ï†ÑÏ≤òÎ¶¨Îäî Îß§Ïö∞ Ï§ëÏöîÌïú Í≥ºÏ†ïÏù¥Îãà, Ïó¨Í∏∞ÏóêÏÑú ÎßêÌïòÎäî ‚ÄúÏ†ÑÏ≤òÎ¶¨‚ÄùÎûÄ Ïù∏Í∞ÑÏùò ÏßÅÍ¥ÄÏù¥ ÏöîÍµ¨ÎêòÏßÄ ÏïäÎäî Îã®Ïàú ÏûëÏóÖÏóê Í∞ÄÍπåÏö¥ Í≤ÉÎì§ÏùÑ ÏùòÎØ∏ÌïúÎã§. Ïò§Ìï¥ÌïòÏãúÏßÄ ÎßêÎùº.)</p>

<p>Î∞òÎ©¥, Web 3.0 Îç∞Ïù¥ÌÑ∞Îäî Ïù¥ÎØ∏ Ï†ïÌï©ÏÑ±Í≥º Í±∞Î≤ÑÎÑåÏä§Î•º ÌîÑÎ°úÌÜ†ÏΩúÎ°ú Î™ÖÌôïÌïòÍ≤å Í∑úÏ†ïÎêú Ï±ÑÎ°ú Î∏îÎ°ùÏóê ÏåìÏù¥Í∏∞ ÎïåÎ¨∏Ïóê, ÏòàÏô∏Ï†ÅÏù∏ InstanceÎÇò Naming RuleÎ°úÎ∂ÄÌÑ∞ Î≤óÏñ¥ÎÇú FeatureÍ∞Ä Îß§Ïö∞ ÎìúÎ¨ºÎã§. Í∞ÄÎ†π, EthereumÏùò Block DataÎäî  <a href="https://ethereum.org/ko/developers/docs/blocks/">Ethereum Docs</a>ÏóêÏÑú ÌôïÏù∏Ìï† Ïàò ÏûàÎìØÏù¥ Î™ÖÌôïÌïòÍ≤å Í∑úÏ†ïÎêòÏñ¥ ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê, Îß§Ïö∞ ÌÅ¥Î¶∞Ìïú Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÏ∂úÌï† Ïàò ÏûàÎã§. ÎòêÌïú, EthereumÏùò StateÎ•º Î≥ÄÌôîÏãúÌÇ§Îäî Î™®Îì† TransactionsÏùò Input Data ÏûêÏ≤¥Í∞Ä TypoÎÇò Null ValueÍ∞Ä Ï°¥Ïû¨Ìï† Í≤ΩÏö∞ ValidatorsÏóê ÏùòÌï¥ FailÎêòÍ±∞ÎÇò ContractÏùò Function CallÏù¥ ÎêòÏßÄ ÏïäÏùÑ Í≤ÉÏù¥ÎØÄÎ°ú Ïù¥Îäî MinersÎÇò ValidatorsÍ∞Ä Îç∞Ïù¥ÌÑ∞ ScreeningÏùò Í∏∞Îä•ÏùÑ ÌïòÎäî Í≤ÉÏúºÎ°úÎèÑ Ïù¥Ìï¥Îê† Ïàò ÏûàÎã§.</p>

<p><img src="/assets/2022-12-03-dune-analytics/eth-state-change.webp" alt="" /></p>
<blockquote>
  <p><a href="https://ethereum.org/ko/developers/docs/blocks/">Ethereum State Change</a></p>
</blockquote>

<p>ÏïÑÎ¨¥Ìäº Í∑∏ÎûòÏÑú Web 3.0Îäî Îç∞Ïù¥ÌÑ∞Ïùò Î≥¥Î¨ºÏÑ¨(?) Í∞ôÏùÄ Í≥≥Ïù¥Îã§. Ïù¥Îü¨Ìïú Ï†ê ÎïåÎ¨∏Ïóê, Î™á ÎÖÑ Ï†ÑÎ∂ÄÌÑ∞ Ï†ÑÏÑ∏Í≥ÑÏùò ÏàòÎßéÏùÄ Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞ÄÎì§Ïù¥ Ïò®Ï≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞Ïóê Ï£ºÎ™©ÌïòÍ∏∞ ÏãúÏûëÌñàÍ≥†, ÏàòÎßéÏùÄ Ïò®Ï≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞ Ïó∞Íµ¨ÏôÄ ÏûëÏóÖÎì§Ïù¥ ÏßÑÌñâÎêòÍ≥† ÏûàÎã§.</p>

<h1 id="2-Ïò®Ï≤¥Ïù∏-Îç∞Ïù¥ÌÑ∞Î•º-Îñ†Î®πÏó¨Ï£ºÎäî-dune">2. Ïò®Ï≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞Î•º Îñ†Î®πÏó¨Ï£ºÎäî Dune</h1>

<p>ÏÇ¨Ïã§ Î∏îÎ°ùÏ≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞Î•º ÎèÖÏûêÏ†ÅÏúºÎ°ú Ï∂îÏ∂úÌïòÏó¨ Ï†ÅÏû¨ÌïòÎäî ÏùºÏùÄ ÏÉÅÎãπÌûà Ïñ¥Î†§Ïö¥ ÏùºÏù¥Îã§. Î∞©Í∏à ÌïÑÏûêÍ∞Ä Îã§ÏùåÍ≥º Í∞ôÏù¥ ÏÉÅÏà†ÌñàÎäîÎç∞, ÏÇ¨Ïã§ Ïù¥Í±¥ ÎßêÏù¥ ÏâΩÏßÄ, ÌïÑÏûêÏùò Îû©ÌÉëÏúºÎ°ú ÎÖ∏ÎìúÎ•º ÎèåÎ¶∞Îã§Î©¥ ÏïÑÎßà Ìéë ÌïòÍ≥† ÌÑ∞Ïßà Í≤ÉÏù¥Îã§.</p>

<blockquote>
  <p>‚ÄúÌï¥Îãπ Î∏îÎ°ùÏ≤¥Ïù∏ ÎÑ§Ìä∏ÏõåÌÅ¨ ÎÇ¥ÏóêÏÑú ÎÖ∏ÎìúÎ•º ÎèåÎ¶¨Í∏∞Îßå ÌïòÎ©¥ ÎàÑÍµ¨ÎÇò ÏûêÏú†Î°≠Í≤å Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÏ∂úÌïòÏó¨ Ï†ÅÏû¨Ìï† Ïàò ÏûàÎã§.‚Äù</p>
</blockquote>

<p>ÎÖ∏ÎìúÎ•º On-premiseÎ°ú Íµ¨Ï∂ïÌïòÎäî ÏûëÏóÖÏùÄ ÏÉÅÎãπÌïú ÏàòÏ§ÄÏùò Î¶¨ÏÜåÏä§Î•º ÏöîÍµ¨ÌïúÎã§. ÏÇ¥Ïßù Ïò§ÎûòÎêú ÏûêÎ£åÏù¥ÏßÄÎßå, ÏïÑÎûò ÌÖåÏù¥Î∏îÏùÑ Î≥¥Î©¥ Í∞Å Î∏îÎ°ùÏ≤¥Ïù∏ Î≥ÑÎ°ú ÎÖ∏ÎìúÏùò ÏµúÏÜå ÏÇ¨Ïñë ÏàòÏ§ÄÏù¥ ÎßåÎßåÏπò ÏïäÎã§Îäî Í≤ÉÏùÑ Ïïå Ïàò ÏûàÎã§.</p>

<p><img src="/assets/2022-12-03-dune-analytics/node-specs.webp" alt="" /></p>
<blockquote>
  <p>Validator Node Specifications</p>
</blockquote>

<p>Ïù¥Îü¨Ìïú Î¨∏Ï†úÎ•º Ìï¥Í≤∞Ìï¥Ï£ºÍ≥†Ïûê Ìïú Í≤ÉÏù¥ Î∞îÎ°ú Dune AnalyticsÎã§. Ï¶â, DuneÏùÄ ÏûêÏ≤¥Ï†ÅÏúºÎ°ú Í∞Å Î∏îÎ°ùÏ≤¥Ïù∏ Î≥ÑÎ°ú ÎÖ∏ÎìúÎ•º Íµ¨Ï∂ïÌï®ÏúºÎ°úÏç® ÏµúÏ¢Ö ÏÇ¨Ïö©ÏûêÍ∞Ä Î°úÏª¨ ÌôòÍ≤ΩÏóêÏÑú Íµ≥Ïù¥ ÎÖ∏ÎìúÎ•º Ïö¥ÏòÅÌïòÏßÄ ÏïäÍ≥†ÎèÑ DuneÏùò DBÎ•º Ï°∞ÌöåÌïòÍ≥†, Ïã§ÏãúÍ∞ÑÏúºÎ°ú Ïò®Ï≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞Î•º Ï°∞ÌöåÌï† Ïàò ÏûàÎèÑÎ°ù ÎßåÎì† ÏÑúÎπÑÏä§Ïù∏ Í≤ÉÏù¥Îã§.</p>

<p><img src="/assets/2022-12-03-dune-analytics/dune-flow.webp" alt="" /></p>
<blockquote>
  <p><a href="https://dune.com/docs/#how-the-data-flows">how-the-data-flows</a>  Î•º ÏùΩÍ≥† ÏßÅÏ†ë ÎßåÎì§Ïñ¥Î≥∏ Flow Chart</p>
</blockquote>

<p>Ïù¥Î≥¥Îã§ Îçî ÏÉÅÏÑ∏Ìïú DuneÏùò Operational FlowÎ•º ÌôïÏù∏ÌïòÍ≥† Ïã∂Îã§Î©¥,  <a href="https://dune.com/docs/">Ïó¨Í∏∞</a>Î•º ÌÅ¥Î¶≠ÌïòÏó¨ Îß§Ïö∞ Î™ÖÏæåÌïú ÏÑ§Î™ÖÏùÑ ÌôïÏù∏Ìï¥Î≥¥ÎèÑÎ°ù ÌïòÏûê.</p>

<h1 id="3-dune-Îèà-ÎÇ¥Í≥†-Ïç®Ïïº-ÌïòÎäîÍ∞Ä">3. Dune, Îèà ÎÇ¥Í≥† Ïç®Ïïº ÌïòÎäîÍ∞Ä</h1>

<p>Ï∞∏Í≥†Î°ú DuneÏùÄ Freemium (Free + Premium) ÌòïÌÉúÎ°ú ÏÑúÎπÑÏä§Î•º Ï†úÍ≥µÌïòÍ≥† ÏûàÎã§. DuneÎèÑ ÏòÅÎ¶¨Ï†Å Í∏∞ÏóÖÏù¥Í∏∞ ÎïåÎ¨∏Ïóê Pricing PlanÏù¥ ÏàòÏãúÎ°ú Î≥ÄÎèôÎê† Ïàò ÏûàÎäîÎç∞, 2022ÎÖÑ 12Ïõî ÌòÑÏû¨ PlanÏùÄ Îã§ÏùåÍ≥º Í∞ôÎã§.</p>

<p><img src="/assets/2022-12-03-dune-analytics/dune-pricing.webp" alt="" /></p>
<blockquote>
  <p><a href="https://dune.com/docs/reference/pricing/">Dune Pricing</a></p>
</blockquote>

<p>ÏòàÏ†ÑÏóêÎäî PlanÏù¥ Free or PremiumÏùò Binary Classification ÌòïÌÉúÎ°úÎßå Íµ¨Î∂ÑÎêòÏñ¥ ÏûàÏóàÏßÄÎßå, ÏµúÍ∑ºÏóê Ïù¥Î†áÍ≤å Îã§ÏñëÌïú PlanÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏ ÎêòÏóàÎã§. Free PlanÏùÑ Ïç®Î≥∏ ÌïÑÏûêÏùò Í≤ΩÌóòÏùÑ Ï†ïÎ¶¨Ìï¥Î≥¥Î©¥ Îã§ÏùåÍ≥º Í∞ôÎã§.</p>
<ol>
  <li>Free PlanÏùÑ Ïì∞ÎçîÎùºÎèÑ Query ÏÜçÎèÑÏôÄ Ï≤òÎ¶¨ÎüâÏù¥ Ïã¨Í∞ÅÌïòÍ≤å ÎäêÎ¶¨ÏßÄÎäî ÏïäÎã§.
    <ul>
      <li>Î¨ºÎ°† ÏïΩÍ∞ÑÏùò ÏΩîÎìú ÏµúÏ†ÅÌôîÎ•º ÌÜµÌï¥ Request Ï≤òÎ¶¨ÎüâÏùÑ Ï°∞Ï†àÌïòÎäî Ïä§ÌÇ¨Ïù¥ ÌïÑÏöîÌïòÎã§. (Ïù¥Í≤å Î¨¥Ïä® ÏùòÎØ∏Ïù∏ÏßÄ Ïû†Ïãú ÌõÑÏóê ÌåÅÏúºÎ°ú ÏÑ§Î™ÖÌïòÍ≤†Îã§.)</li>
    </ul>
  </li>
  <li>ÏûêÏã†Ïù¥ Ï†ÄÏû•Ìïú ÏøºÎ¶¨ Í≤∞Í≥ºÏôÄ Ï∞®Ìä∏Îäî Ìï≠ÏÉÅ Í≥µÍ∞úÎêúÎã§.
    <ul>
      <li>ÎπÑÏ¶àÎãàÏä§Ïùò ÎåÄÏô∏ÎπÑÏôÄ Ïó∞Í¥ÄÎêú Ï§ëÏöîÌïú Îç∞Ïù¥ÌÑ∞Ïùº Í≤ΩÏö∞, Premium PlanÏùÑ ÏÇ¨Ïö©ÌïòÍ±∞ÎÇò ÌòπÏùÄ SQL Î¨∏ÏùÑ Î°úÏª¨Ïóê Îî∞Î°ú Î≥¥Í¥ÄÌïú Îí§ ÌïÑÏöîÌï† ÎïåÎßàÎã§ ÎèåÎ¶∞ ÌõÑ Î∞îÎ°ú ÏÇ≠Ï†úÌï¥Ïïº ÌïúÎã§.</li>
    </ul>
  </li>
</ol>

<p>Îî∞ÎùºÏÑú Í∞ÅÏûê ÏûêÏã†Ïùò Ïò®Ï≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞ ÌôúÏö© ÌôòÍ≤Ω Î∞è ÏöîÍµ¨ÏÇ¨Ìï≠Ïóê ÎßûÎäî PlanÏùÑ ÏÇ¨Ïö©ÌïòÎäî Í≤ÉÏù¥ Ï§ëÏöîÌï† Í≤É Í∞ôÎã§.</p>

<h1 id="4-dune-db-schema">4. Dune DB Schema</h1>

<h2 id="41-Îç∞Ïù¥ÌÑ∞-Ï°∞Ìöå-Í∞ÄÎä•Ìïú-Î∏îÎ°ùÏ≤¥Ïù∏-Î¶¨Ïä§Ìä∏">4.1. Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå Í∞ÄÎä•Ìïú Î∏îÎ°ùÏ≤¥Ïù∏ Î¶¨Ïä§Ìä∏</h2>

<p>2022ÎÖÑ 12Ïõî ÌòÑÏû¨, DuneÏù¥ Ï†úÍ≥µÌïòÎäî Ïò®Ï≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞Îäî ÌÅ¨Í≤å Îã§ÏùåÏùò 8Í∞ú Î∏îÎ°ùÏ≤¥Ïù∏ÏúºÎ°ú Íµ¨ÏÑ±ÎêúÎã§. ÏïûÏúºÎ°ú ÏÑ§Î™ÖÌïòÎäî Î™®Îì† DB SchemaÎäî Î™®Îëê Í∏∞Î≥∏Ï†ÅÏúºÎ°ú ÏïÑÎûò 8Í∞ú Î∏îÎ°ùÏ≤¥Ïù∏ÏúºÎ°úÎ∂ÄÌÑ∞ ÎÅåÏñ¥Ïò® Í≤ÉÏù¥ÎùºÍ≥† ÏÉùÍ∞ÅÌïòÎ©¥ ÎêúÎã§.</p>

<ul>
  <li>Ethereum (<a href="https://etherscan.io/">Etherscan</a>)</li>
  <li>Gnosis Chain ‚Äî xDai (<a href="https://gnosisscan.io/">GnosisScan</a>)</li>
  <li>Polygon ‚Äî PoS Mainnet (<a href="https://medium.com/iotrustlab/Arbiscan">Polygonscan</a>)</li>
  <li>Optimism ‚Äî Ethereum L2 (<a href="https://optimistic.etherscan.io/">Optimism Etherscan</a>)</li>
  <li>Arbitrum ‚Äî Ethereum L2 (<a href="https://arbiscan.io/">Arbiscan</a>)</li>
  <li>BNB Chain (<a href="https://bscscan.com/">BscScan</a>)</li>
  <li>Solana (<a href="https://solscan.io/">Solscan</a>)</li>
  <li>Avalanche C-Chain (<a href="https://snowtrace.io/">Snowtrace</a>)</li>
</ul>

<h2 id="42-Ïñ¥Îñ§-ÌÖåÏù¥Î∏îÎì§Î°ú-Íµ¨ÏÑ±ÎêòÏñ¥-ÏûàÎäîÍ∞Ä">4.2. Ïñ¥Îñ§ ÌÖåÏù¥Î∏îÎì§Î°ú Íµ¨ÏÑ±ÎêòÏñ¥ ÏûàÎäîÍ∞Ä</h2>

<p>DuneÏùò DBÏóêÎäî ÏàòÎßéÏùÄ ÌÖåÏù¥Î∏îÎì§Ïù¥ Ï°¥Ïû¨ÌïúÎã§. Í∑∏Î†áÎã§Í≥† Ìï¥ÏÑú, Î™®Îì† ÌÖåÏù¥Î∏îÎì§ÏùÑ ÌïòÎÇòÌïòÎÇò Ï°∞ÌöåÌï¥Î≥¥Îäî Í≤ÉÏùÄ Îß§Ïö∞ ÎπÑÌö®Ïú®Ï†ÅÏù¥ÎØÄÎ°ú, Ïπ¥ÌÖåÍ≥†Î¶¨Î°ú Íµ¨Î∂ÑÌïòÏó¨ ÌÅ∞ Í∏∞Îë•ÏùÑ Ïû°ÏïÑÎ≥¥Ïûê.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">Raw Tables</code></li>
  <li><code class="language-plaintext highlighter-rouge">Decoded Tables</code></li>
  <li><code class="language-plaintext highlighter-rouge">Spells</code></li>
  <li><code class="language-plaintext highlighter-rouge">Community Tables</code></li>
  <li><code class="language-plaintext highlighter-rouge">Prices Tables</code></li>
</ul>

<h3 id="raw-tables">Raw Tables</h3>

<p>DuneÏóêÏÑú Ï°∞ÌöåÌï† Ïàò ÏûàÎäî ÌÖåÏù¥Î∏îÎì§ Ï§ë Ï≤´Î≤àÏß∏ Ï¢ÖÎ•òÎäî Î∞îÎ°ú Raw TablesÎã§. Îã®Ïñ¥ÏóêÏÑú ÎäêÎÇÑ Ïàò ÏûàÎìØÏù¥, Í∞ÄÏû• ÏõêÏãúÏ†ÅÏù∏ ÌòïÌÉúÏùò Îç∞Ïù¥ÌÑ∞Í∞Ä Îã¥Í∏¥ Í≥≥ÏùÑ ÏùòÎØ∏ÌïúÎã§. Dune DocsÏóêÏÑúÎäî Îã§ÏùåÍ≥º Í∞ôÏù¥ Í∞úÎÖêÏùÑ ÏÑúÏà†ÌïòÍ≥† ÏûàÎã§.</p>

<blockquote>
  <p>‚ÄúRaw tables provide you raw, unfiltered and unedited data.‚Äù</p>
</blockquote>

<p>Í∞ÄÎ†π, Raw TablesÏóêÎäî Îã§ÏùåÍ≥º Í∞ôÏùÄ ÌÖåÏù¥Î∏îÏù¥ ÏûàÏñ¥ÏÑú ÏßÅÏ†ë Ï°∞ÌöåÌï† Ïàò ÏûàÎã§.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">ethereum.blocks</code></li>
  <li><code class="language-plaintext highlighter-rouge">ethereum.creation_traces</code></li>
  <li><code class="language-plaintext highlighter-rouge">ethereum.traces</code></li>
  <li><code class="language-plaintext highlighter-rouge">ethereum.logs</code></li>
  <li><code class="language-plaintext highlighter-rouge">ethereum.transactions</code></li>
  <li><code class="language-plaintext highlighter-rouge">ethereum.contracts</code></li>
</ul>

<p>(1) <code class="language-plaintext highlighter-rouge">ethereum.blocks</code></p>

<p>Í∞Å BlockÏóê Ï°¥Ïû¨ÌïòÎäî Îç∞Ïù¥ÌÑ∞Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÎäî ÌÖåÏù¥Î∏îÏù¥Îã§. Block Header ÏòÅÏó≠Ïóê Ï°¥Ïû¨ÌïòÎäî Îç∞Ïù¥ÌÑ∞ Ï§ë Merkle RootÎ•º Ï†úÏô∏Ìïú Í±∞Ïùò Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÎã§.</p>

<p><img src="/assets/2022-12-03-dune-analytics/etherscan-block.webp" alt="" /></p>
<blockquote>
  <p>Ï¶â,  <a href="https://etherscan.io/block/16095248">Etherscan</a>ÏóêÏÑú Í∞Å BlockÏùÑ Ï°∞ÌöåÌñàÏùÑ Îïå ÎÇòÏò§Îäî Ïù¥ Îç∞Ïù¥ÌÑ∞Îì§ÏùÑ ÏßÅÏ†ë Ï°∞ÌöåÌï† Ïàò ÏûàÎã§Îäî ÎßêÏù¥Îã§.</p>
</blockquote>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">SELECT</span>
		<span class="o">*</span>  
	<span class="k">FROM</span>
		<span class="n">ethereum</span><span class="p">.</span><span class="n">blocks</span>  
	<span class="k">ORDER</span> <span class="k">BY</span>
		<span class="n">number</span> <span class="k">DESC</span>  
	<span class="k">LIMIT</span> <span class="mi">5</span>
</code></pre></div></div>

<p><img src="/assets/2022-12-03-dune-analytics/ethereum.blocks.webp" alt="" /></p>

<p>(2) <code class="language-plaintext highlighter-rouge">ethereum.creation_traces</code></p>

<p>CA (Contract Account) ÏÉùÏÑ±ÏùÑ Ìïú TXÎì§Ïùò Îç∞Ïù¥ÌÑ∞Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÎäî ÌÖåÏù¥Î∏îÏù¥Îã§. TXÎ•º ÏÑúÎ™ÖÌïú EOA AddressÎäî Î¨ºÎ°†Ïù¥Í≥†, Input DataÍπåÏßÄ Ï°∞ÌöåÌï† Ïàò ÏûàÎã§.</p>

<p><img src="/assets/2022-12-03-dune-analytics/transaction-types.webp" alt="" /></p>
<blockquote>
  <p>ÏúÑ Í∑∏Î¶ºÏóêÏÑú Contract AccountÎ•º Externally Owned AccountÎ°úÎ∂ÄÌÑ∞ ÏÉùÏÑ±ÌïòÎäî TXÎì§ÏùÑ ÏùòÎØ∏ÌïúÎã§.</p>
</blockquote>

<p><img src="/assets/2022-12-03-dune-analytics/contract-creation-message-call.webp" alt="" /></p>
<blockquote>
  <p><a href="https://takenobu-hs.github.io/downloads/ethereum_evm_illustrated.pdf">Creates and Calls Contract</a></p>
</blockquote>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">SELECT</span>
		<span class="o">*</span>  
	<span class="k">FROM</span>
		<span class="n">ethereum</span><span class="p">.</span><span class="n">creation_traces</span>  
	<span class="k">ORDER</span> <span class="k">BY</span>
		<span class="n">block_time</span> <span class="k">DESC</span>  
	<span class="k">LIMIT</span> <span class="mi">5</span>
</code></pre></div></div>

<p><img src="/assets/2022-12-03-dune-analytics/ethereum-creation-traces.webp" alt="" /></p>

<p>(3) <code class="language-plaintext highlighter-rouge">ethereum.traces</code></p>

<p>CAÎ°úÎ∂ÄÌÑ∞ Ïã§ÌñâÎêú TXÎì§Ïùò Îç∞Ïù¥ÌÑ∞Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÎäî ÌÖåÏù¥Î∏îÏù¥Îã§. EthereumÏóêÏÑúÎäî Ïù¥Îü¨Ìïú TXÎ•º ÌäπÎ≥ÑÌûà  Internal TransactionÏù¥ÎùºÍ≥† Î∂ÄÎ•¥ÎäîÎç∞, DuneÏóêÏÑúÎäî Ïù¥Î•º traceÎ°ú ÌëúÌòÑÌïòÍ≥† ÏûàÎäî Í≤ÉÏù¥Îã§.</p>

<p><img src="/assets/2022-12-03-dune-analytics/transaction-types.webp" alt="" /></p>
<blockquote>
  <p>ÏúÑ Í∑∏Î¶ºÏóêÏÑú CA ‚Üí CAÏóê Ìï¥ÎãπÌïòÎäî TXÎì§ÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÎã§Îäî ÏùòÎØ∏Ïù¥Îã§. (Î¨ºÎ°† CA ‚Üí EOA Ïú†ÌòïÎèÑ Ìè¨Ìï®ÌïúÎã§.)</p>
</blockquote>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">SELECT</span>
		<span class="o">*</span>  
	<span class="k">FROM</span>
		<span class="n">ethereum</span><span class="p">.</span><span class="n">traces</span>  
	<span class="k">ORDER</span> <span class="k">BY</span>
		<span class="n">block_time</span> <span class="k">DESC</span>  
	<span class="k">LIMIT</span> <span class="mi">5</span>
</code></pre></div></div>

<p><img src="/assets/2022-12-03-dune-analytics/ethereum-traces.webp" alt="" /></p>

<p>(4) <code class="language-plaintext highlighter-rouge">ethereum.logs</code></p>

<p>CAÎ•º Ïã§ÌñâÌñàÏùÑ Îïå Î∞úÏÉùÌïòÎäî Ïù¥Î≤§Ìä∏ Î°úÍ∑∏ ÎÇ¥Ïùò Îç∞Ïù¥ÌÑ∞Î•º Ï°∞ÌöåÌï† Ïàò ÏûàÎäî ÌÖåÏù¥Î∏îÏù¥Îã§.</p>

<p><img src="/assets/2022-12-03-dune-analytics/transaction-types.webp" alt="" /></p>
<blockquote>
  <p>ÏúÑ Í∑∏Î¶ºÏóêÏÑú EOA ‚Üí CAÏóê Ìï¥ÎãπÌïòÎäî TXÏùò Î°úÍ∑∏Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÎã§Îäî ÏùòÎØ∏Ïù¥Îã§. (Î¨ºÎ°†, CA ‚Üí CA Ïú†ÌòïÎèÑ ÏûàÎã§.)</p>
</blockquote>

<p><img src="/assets/2022-12-03-dune-analytics/etherscan-ca-call.webp" alt="" /></p>
<blockquote>
  <p>Ï¶â,  <a href="https://etherscan.io/tx/0x218b632d932371478d1ae5a01620ebab1a2030f9dad6f8fba4a044ea6335a57e#eventlog">Etherscan</a>ÏóêÏÑú CA CallÏùÑ Ïã§ÌñâÌïú TXÏùò Logs ÌÉ≠Ïùò Îç∞Ïù¥ÌÑ∞Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÎã§.</p>
</blockquote>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">SELECT</span>
		<span class="o">*</span>  
	<span class="k">FROM</span>
		<span class="n">ethereum</span><span class="p">.</span><span class="n">logs</span>  
	<span class="k">ORDER</span> <span class="k">BY</span> 
		<span class="n">block_time</span> <span class="k">DESC</span>  
	<span class="k">LIMIT</span> <span class="mi">5</span>
</code></pre></div></div>

<p><img src="/assets/2022-12-03-dune-analytics/ethereum-logs.webp" alt="" /></p>

<p>(5) <code class="language-plaintext highlighter-rouge">ethereum.transactions</code></p>

<p>Internal TransactionÏùÑ Ï†úÏô∏Ìïú Î™®Îì† TX Îç∞Ïù¥ÌÑ∞Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÎäî ÌÖåÏù¥Î∏îÏù¥Îã§. Ï¶â, EOAÎ°úÎ∂ÄÌÑ∞ Î∏åÎ°úÎìúÏ∫êÏä§Ìä∏Îêú TXÎì§Ïóê ÎåÄÌï¥ÏÑúÎßå Îç∞Ïù¥ÌÑ∞Î•º Ï°∞ÌöåÌï† Ïàò ÏûàÎã§.</p>

<p><img src="/assets/2022-12-03-dune-analytics/transaction-types.webp" alt="" /></p>
<blockquote>
  <p>ÏúÑ Í∑∏Î¶ºÏóêÏÑú EOA ‚Üí CA, EOA ‚Üí EOA Ïú†ÌòïÏùò TXÎì§ÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÎã§Îäî ÏùòÎØ∏Ïù¥Îã§.</p>
</blockquote>

<p><img src="/assets/2022-12-03-dune-analytics/etherscan-transaction.webp" alt="" /></p>
<blockquote>
  <p>Ï¶â,  <a href="https://etherscan.io/tx/0xbcd46c6c6befc4c6ecf234c3385a1caea6601688105fcc7c48037c80d7414613">Etherscan</a>ÏóêÏÑú Í∞Å TXÏùÑ Ï°∞ÌöåÌñàÏùÑ Îïå ÎÇòÏò§Îäî Ïù¥ Îç∞Ïù¥ÌÑ∞Îì§ÏùÑ ÏßÅÏ†ë Ï°∞ÌöåÌï† Ïàò ÏûàÎã§Îäî ÎßêÏù¥Îã§.</p>
</blockquote>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">SELECT</span>
		<span class="o">*</span>  
	<span class="k">FROM</span>
		<span class="n">ethereum</span><span class="p">.</span><span class="n">transactions</span>  
	<span class="k">ORDER</span> <span class="k">BY</span>
		<span class="n">block_time</span> <span class="k">DESC</span>  
	<span class="k">LIMIT</span> <span class="mi">5</span>
</code></pre></div></div>

<p><img src="/assets/2022-12-03-dune-analytics/ethereum-transactions.webp" alt="" /></p>

<p>(6) <code class="language-plaintext highlighter-rouge">ethereum.contracts</code></p>

<p>Ethereum Network ÏÉÅÏóê Î∞∞Ìè¨Îêú CA Í¥ÄÎ†® Îç∞Ïù¥ÌÑ∞Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÎäî ÌÖåÏù¥Î∏îÏù¥Îã§. CA AddressÎäî Î¨ºÎ°†Ïù¥Í≥†, Contract Name, ABI, Creation Code Îì± Ïã§ÏßàÏ†ÅÏù∏ Îç∞Ïù¥ÌÑ∞ÍπåÏßÄ Î™®Îëê Ï°∞ÌöåÌï† Ïàò ÏûàÎã§.</p>

<p><img src="/assets/2022-12-03-dune-analytics/etherscan-contract.webp" alt="" /></p>
<blockquote>
  <p>Ï¶â,  <a href="https://etherscan.io/address/0x00000000219ab540356cbb839cbe05303d7705fa#code">Etherscan</a>ÏóêÏÑú Í∞Å CAÎ•º Ï°∞ÌöåÌñàÏùÑ Îïå ÎÇòÏò§Îäî Ïù¥ Contract Í¥ÄÎ†® Îç∞Ïù¥ÌÑ∞Î•º ÏßÅÏ†ë Ï°∞ÌöåÌï† Ïàò ÏûàÎã§Îäî ÎßêÏù¥Îã§.</p>
</blockquote>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">SELECT</span>
		<span class="o">*</span>  
	<span class="k">FROM</span>
		<span class="n">ethereum</span><span class="p">.</span><span class="n">contracts</span>  
	<span class="k">ORDER</span> <span class="k">BY</span>
		<span class="n">block_time</span> <span class="k">DESC</span>  
	<span class="k">LIMIT</span> <span class="mi">5</span>
</code></pre></div></div>

<p><img src="/assets/2022-12-03-dune-analytics/ethereum-contracts.webp" alt="" /></p>

<h3 id="decoded-tables">Decoded Tables</h3>

<blockquote>
  <p>‚ÄúInstead of working with the transactions, logs, and traces in their raw states, on Dune we decode smart contract activity into nice human-readable tables.‚Äù</p>
</blockquote>

<p>Raw TablesÎäî Í∞ÄÏû• OriginalÌïú Îç∞Ïù¥ÌÑ∞Î•º Ï°∞ÌöåÌï† Ïàò ÏûàÎã§Îäî Ï∏°Î©¥ÏóêÏÑú Îß§Ïö∞ Í∑ÄÏ§ëÌïú 1Ï∞® ÏÜåÏä§Ï†Å Í∞ÄÏπòÎ•º ÏßÄÎãàÍ≥† ÏûàÏßÄÎßå, ÌäπÌûà CAÏùò Ïã§Ìñâ Í¥ÄÎ†® Îç∞Ïù¥ÌÑ∞ÎùºÎ©¥ ABIÎÇò Bytecode Ìè¨Îß∑ÏúºÎ°ú ÎêòÏñ¥ ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê Ïù¥Î•º Ìï¥ÏÑùÌïòÎäî Í≤ÉÏùÄ Îß§Ïö∞ Ïñ¥Î†µÎã§. (Î¨ºÎ°† Ï≤úÏû¨ Í∞úÎ∞úÏûê Î∂ÑÎì§Ïù¥ÎùºÎ©¥ Îáå ÎÇ¥ ÎîîÏΩîÎî©(?)ÏùÑ ÌÜµÌï¥ Ï¶âÍ∞Å Ìï¥ÏÑùÌïòÏã§ ÏàòÎèÑ‚Ä¶?) Îî∞ÎùºÏÑú DuneÏùÄ Raw TablesÏóê Ï†ÅÏû¨ÎêòÍ≥† ÏûàÎäî Îç∞Ïù¥ÌÑ∞Îì§ÏùÑ Key-Value ÌòïÌÉúÎ°ú ÎîîÏΩîÎî©Ìï®ÏúºÎ°úÏç® Decoded TablesÏóê Column-wiseÎ°ú Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÍ≥µÌïòÏó¨ Ï†úÍ≥µÌïòÍ≥† ÏûàÎã§.</p>

<p>Ïù¥Îü¨Ìïú Decoded TablesÎ•º ÌôúÏö©ÌïòÎ©¥, UniswapÏù¥ÎÇò Sushiswap Îì± DEXÍ∞Ä ÏûêÏ≤¥Ï†ÅÏúºÎ°ú Î∞úÌëúÌïú Ïã§Ï†Å Îç∞Ïù¥ÌÑ∞Ïóê ÏùòÏ°¥ÌïòÏßÄ ÏïäÍ≥†, Ïò§Î°úÏßÄ Decoded TablesÎ•º ÌÜµÌï¥ Í±∞ÎûòÎåÄÍ∏àÏù¥ÎÇò ÌôúÏÑ± ÏÇ¨Ïö©Ïûê Í∑úÎ™® Îì±ÏùÑ Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÌôïÏù∏Ìï† Ïàò ÏûàÍ∏∞ ÎïåÎ¨∏Ïóê Îß§Ïö∞ Ïú†Ïö©ÌïòÍ≥† Í∑∏ÎßåÌÅº Ïù∏Í∏∞ÎèÑ ÎßéÏùÄ ÌÖåÏù¥Î∏îÏù¥Îã§.</p>

<p>Decoded TablesÎäî ÌÅ¨Í≤å Îëê Í∞ÄÏßÄ Ïú†ÌòïÏúºÎ°ú Íµ¨Î∂ÑÎêúÎã§.</p>

<p>(1) CAÏóêÏÑú Î∏åÎ°úÎìúÏ∫êÏä§Ìä∏Îêú Internal TX Îç∞Ïù¥ÌÑ∞</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">{projectname_blockchain}.{contractName}_evt_{eventName}</code></li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">SELECT</span>
		<span class="o">*</span>
	<span class="k">FROM</span>
		<span class="n">uniswap_v2_ethereum</span><span class="p">.</span><span class="n">Pair_evt_Swap</span>  
	<span class="k">ORDER</span> <span class="k">BY</span>
		<span class="n">evt_block_time</span> <span class="k">DESC</span>  
	<span class="k">LIMIT</span> <span class="mi">5</span>
</code></pre></div></div>

<p><img src="/assets/2022-12-03-dune-analytics/uniswap_v2_ethereum.Pair_evt_Swap.webp" alt="" /></p>

<p>(2) EOA ‚Üí CA / CA ‚Üí CA (Function Call) Ïã§Ìñâ Í¥ÄÎ†® Îç∞Ïù¥ÌÑ∞</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">{projectname_blockchain}.{contractName}_call_{eventName}</code></li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">SELECT</span>
		<span class="o">*</span>
	<span class="k">FROM</span>
		<span class="n">uniswap_v2_ethereum</span><span class="p">.</span><span class="n">Pair_call_Swap</span>  
	<span class="k">ORDER</span> <span class="k">BY</span>
		<span class="n">call_block_time</span> <span class="k">DESC</span>  
	<span class="k">LIMIT</span> <span class="mi">5</span>
</code></pre></div></div>

<p><img src="/assets/2022-12-03-dune-analytics/uniswap_v2_ethereum.Pair_call_Swap.webp" alt="" /></p>

<h3 id="prices-tables">Prices Tables</h3>

<blockquote>
  <p>‚ÄúWe pull price data from the coinpaprika API. The Price is the volume-weighted price based on real-time market data, translated to USD.‚Äù</p>
</blockquote>

<p>Prices TablesÎäî Í∞Å ÌÅ¨Î¶ΩÌÜ† ÏûêÏÇ∞Ïùò ÏãúÏû• Í∞ÄÍ≤© Îç∞Ïù¥ÌÑ∞Î•º Ïã§ÏãúÍ∞ÑÏúºÎ°ú Ï°∞ÌöåÌï† Ïàò ÏûàÎäî ÌÖåÏù¥Î∏îÏù¥Îã§. Î∏îÎ°ùÏ≤¥Ïù∏Ïóê ChainlinkÏùò Price FeedÍ∞Ä ÏûàÎã§Î©¥, DuneÏóêÎäî Prices TablesÍ∞Ä ÏûàÎã§Í≥† ÎπÑÏú†Ìï¥Î≥¥Î©¥ Ï†ÅÏ†àÌï†Íπå. Ïù¥ ÏãúÏû• Í∞ÄÍ≤© Îç∞Ïù¥ÌÑ∞Îäî 3rd Party Data PartnerÏù∏  <a href="https://coinpaprika.com/">Coinpaprika</a>Ïùò APIÎ•º ÌôúÏö©ÌïòÏó¨ Îç∞Ïù¥ÌÑ∞Î•º Ï†ÅÏû¨ÌïòÍ≥† ÏûàÎäî Í≤ÉÏúºÎ°ú Î≥¥Ïù∏Îã§. Í∑∏Î¶¨Í≥† Í∞Å ÏãúÏû• Í∞ÄÍ≤©ÏùÄ Í∞Å Í±∞ÎûòÏÜåÏùò Í±∞ÎûòÎåÄÍ∏à Í∏∞Ï§ÄÏúºÎ°ú Í∞ÄÏ§ëÌèâÍ∑†ÎêòÏñ¥ USDÎ°ú ÌôòÏÇ∞ÎêúÎã§. Í∞ÄÏû• ÎßéÏù¥ ÏÇ¨Ïö©ÎêòÎäî prices.usd ÌÖåÏù¥Î∏îÏùÄ Î∂Ñ(minute) Îã®ÏúÑÎ°ú ÏãúÏû• Í∞ÄÍ≤©ÏùÑ Ï†ÅÏû¨ÌïòÍ≥† ÏûàÎã§.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">SELECT</span>
		<span class="k">DISTINCT</span> <span class="n">symbol</span>
	<span class="k">FROM</span>
		<span class="n">prices</span><span class="p">.</span><span class="n">usd</span>  
	<span class="k">ORDER</span> <span class="k">BY</span>
		<span class="n">symbol</span>  
	<span class="k">LIMIT</span> <span class="mi">10</span>
</code></pre></div></div>

<p><img src="/assets/2022-12-03-dune-analytics/prices-usd.webp" alt="" /></p>

<h3 id="spells">Spells</h3>

<blockquote>
  <p>‚ÄúSpells are custom tables that are built and maintained by Dune and our community.‚Äù</p>
</blockquote>

<p>SpellsÎäî DuneÍ≥º Ïª§ÎÆ§ÎãàÌã∞Ïóê ÏùòÌï¥ ÏÉùÏÑ±ÎêòÍ≥† Ïú†ÏßÄÎ≥¥ÏàòÎêòÎäî Ïª§Ïä§ÌÖÄ ÌÖåÏù¥Î∏îÎì§ÏùÑ ÏùòÎØ∏ÌïúÎã§. ÌïÑÏûêÍ∞Ä Í≤ΩÌóòÌñàÏùÑ Îïå SpellsÎäî Ïû•/Îã®Ï†êÏùÑ Îß§Ïö∞ ÎöúÎ†∑ÌïòÍ≤å ÏßÄÎãàÍ≥† ÏûàÏóàÎã§.</p>

<p><strong>Ïû•Ï†ê</strong></p>
<ul>
  <li>Raw TablesÏôÄ Decoded TablesÏùÑ Ïù¥Ìï¥ÌïòÍ∏∞Ïóê Îß§Ïö∞ Î≤ÖÏ∞¨ ÏÇ¨ÎûåÎì§ÏùÑ ÏúÑÌï¥, Ïª§ÎÆ§ÎãàÌã∞ ÎßàÎ≤ïÏÇ¨(Wizard)Îì§Ïù¥ Îç∞Ïù¥ÌÑ∞Î•º NÏ∞® Í∞ÄÍ≥µÌïòÏó¨ ÏòàÏÅòÍ≥† Ìé∏Î¶¨ÌïòÍ≤å ÎßåÎì§Ïñ¥Ï§ÄÎã§. Í∞ÄÎ†π, Contract Î≥ÑÎ°ú ÌîåÎû´ÌèºÎ™Ö LabelingÏùÑ Ìï¥Ï£ºÍ±∞ÎÇò, ÌòπÏùÄ Ïú†Î™ÖÌïú dAppsÎì§ÏùÑ Ï§ëÏã¨ÏúºÎ°ú TableÏùÑ ÏÉùÏÑ±ÌïòÍ∏∞ÎèÑ ÌïúÎã§. Îî∞ÎùºÏÑú Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂úÏóê ÌïÑÏöîÌïú ÏãúÍ∞ÑÏùÑ ÎìúÎùºÎßàÌã±ÌïòÍ≤å Ï†àÏïΩÌï¥Ï§Ñ Ïàò ÏûàÎã§.</li>
</ul>

<p><strong>Îã®Ï†ê</strong></p>
<ul>
  <li>Îç∞Ïù¥ÌÑ∞Ïùò ÏïàÏ†ïÏÑ±Ïù¥ Îß§Ïö∞(X100) Îñ®Ïñ¥ÏßÑÎã§. ÏïÑÎ¨¥ÎûòÎèÑ Ïò§ÌîàÏÜåÏä§Î°ú Í¥ÄÎ¶¨ÎêòÎäî ÌÖåÏù¥Î∏îÏù¥ÎØÄÎ°ú, Ï¢ÖÏ¢Ö ÎßêÎèÑ ÏïàÎêòÎäî Îç∞Ïù¥ÌÑ∞ Î°úÍ∑∏Í∞Ä Î∞úÍ≤¨ÎêòÍ∏∞ÎèÑ ÌïúÎã§. Ïù¥Îäî Îç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò ÏùòÏÇ¨Í≤∞Ï†ïÏóê Îß§Ïö∞ ÏπòÎ™ÖÏ†ÅÏù∏ ÏúÑÌóòÏÑ±Ïù¥ ÏûàÏùåÏùÑ ÏùòÎØ∏ÌïúÎã§. Î∞òÎìúÏãú Ïú†ÎÖêÌïòÎèÑÎ°ù ÌïòÏûê.</li>
</ul>

<p>SpellsÏóê Ìï¥ÎãπÎêòÎäî ÌÖåÏù¥Î∏îÎì§ÏùÄ ÍµâÏû•Ìûà ÎßéÏúºÎØÄÎ°ú, ÏßÅÏ†ë Í¥ÄÏã¨ ÏûàÎäî Í≤ÉÎì§Î∂ÄÌÑ∞ ÌïòÎÇòÌïòÎÇò Ï°∞ÌöåÌï¥Î≥¥Îäî Í≤ÉÏùÑ Ï∂îÏ≤úÌïúÎã§. Îã§Îßå, ÎåÄÌëúÏ†ÅÏù∏ 3Í∞ÄÏßÄ ÌÖåÏù¥Î∏îÎßå ÏÇ¨Î°ÄÎ°ú ÎÇòÏó¥Ìï¥Î≥¥Í≤†Îã§.</p>

<p>(1) <strong><code class="language-plaintext highlighter-rouge">dex.trades</code></strong></p>

<p>Ethereum Í∏∞Î∞òÏùò DEX ÏÉÅÏóêÏÑú Î∞úÏÉùÌïú Í±∞ÎûòÎÇ¥Ïó≠ÏùÑ DEX Î≥ÑÎ°ú ÏÉÅÏÑ∏ÌïòÍ≤å ÌôïÏù∏Ìï† Ïàò ÏûàÎäî ÌÖåÏù¥Î∏îÏù¥Îã§. Í∑∏Îü¨ÎÇò, LabeledÎêú DEXÏùò ÏàòÍ∞Ä Îß§Ïö∞ Ï†úÌïúÏ†ÅÏù¥Í≥†, ÌäπÏ†ï Í∏∞Í∞Ñ Î≥ÑÎ°ú ÎàÑÎùΩÎêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÎßéÏúºÎãà ÏïÑÏßÅÍπåÏßÄÎäî Ïú†ÏßÄÎ≥¥ÏàòÍ∞Ä ÌïÑÏöîÌïú Í≤ÉÏúºÎ°ú Î≥¥Ïù∏Îã§.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">SELECT</span>
		<span class="o">*</span>  
	<span class="k">FROM</span>
		<span class="n">dex</span><span class="p">.</span><span class="n">trades</span>  
	<span class="k">ORDER</span> <span class="k">BY</span>
		<span class="n">block_time</span> <span class="k">DESC</span>  
	<span class="k">LIMIT</span> <span class="mi">5</span><span class="p">;</span>
</code></pre></div></div>

<p><img src="/assets/2022-12-03-dune-analytics/dex-trades.webp" alt="" /></p>

<p>(2) <strong><code class="language-plaintext highlighter-rouge">erc20.stablecoins</code></strong></p>

<p>Ethereum ERC-20 ÌëúÏ§Ä StablecoinÏùò Îç∞Ïù¥ÌÑ∞Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÎäî ÌÖåÏù¥Î∏îÏù¥Îã§. Ìï¥Îãπ CAÍ∞Ä Ïä§ÌÖåÏù¥Î∏îÏΩîÏù∏ ÌîÑÎ°úÏ†ùÌä∏Ïù∏ÏßÄ Ïó¨Î∂ÄÎ•º Îß§Îâ¥ÏñºÌïòÍ≤å LabelingÌïú Í≤ÉÏúºÎ°ú Î≥¥Ïù¥Î©∞, Ïù¥ ÌÖåÏù¥Î∏îÏùÑ MapperÎ°ú ÎëêÍ≥†  <code class="language-plaintext highlighter-rouge">ethereum.traces</code>  ÏÉÅÏóêÏÑú Í∞Å Ïä§ÌÖåÏù¥Î∏îÏΩîÏù∏Ïùò Mint &amp; Burn ÌòÑÌô©ÏùÑ Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÌôïÏù∏ÌïòÎäî Îç∞ Îß§Ïö∞ Ïú†Ïö©Ìï† Í≤ÉÏúºÎ°ú Î≥¥Ïù∏Îã§. Í∑∏Îü¨ÎÇò Î∞©Ïã¨ÏùÄ Í∏àÎ¨º. Ïñ∏Ï†úÎì†ÏßÄ Îç∞Ïù¥ÌÑ∞ Ï†ïÌï©ÏÑ±Ïù¥ ÌõºÏÜêÎê† ÏàòÎèÑ ÏûàÏùåÏùÑ Î∞òÎìúÏãú Î™ÖÏã¨ÌïòÏûê.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">SELECT</span>
		<span class="o">*</span>  
	<span class="k">FROM</span>
		<span class="n">erc20</span><span class="p">.</span><span class="n">stablecoins</span>  
	<span class="k">LIMIT</span> <span class="mi">5</span>
</code></pre></div></div>

<p><img src="/assets/2022-12-03-dune-analytics/erc20.stablecoins.webp" alt="" /></p>

<p>(3) <strong><code class="language-plaintext highlighter-rouge">lending.borrow</code></strong></p>

<p>Ethereum Í∏∞Î∞òÏùò ÎåÄÏ∂ú ÌîåÎû´ÌèºÎì§ÏóêÏÑú Î∞úÏÉùÌïú ÎåÄÏ∂ú Ïã§Ìñâ TXÎì§ÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÎäî ÌÖåÏù¥Î∏îÏù¥Îã§. ÎåÄÌëúÏ†ÅÏù∏ Aave, Compound Îì±ÏùÑ Ï§ëÏã¨ÏúºÎ°ú ÎåÄÏ∂ú Ïã§ÌñâÏûêÏùò Address, ÎåÄÏ∂úÏï°, ÌÜ†ÌÅ∞ Îì± ÏÉÅÏÑ∏ Ï†ïÎ≥¥Î•º Ï°∞ÌöåÌï† Ïàò ÏûàÎã§. Îã§Îßå,  <code class="language-plaintext highlighter-rouge">dex.trades</code>  ÌÖåÏù¥Î∏îÍ≥º ÎßàÏ∞¨Í∞ÄÏßÄÎ°ú, Î™®Îì† ÎåÄÏ∂ú ÌîåÎû´ÌèºÎì§Ïùò Îç∞Ïù¥ÌÑ∞Î•º ÌôïÏù∏Ìï† Ïàò ÏóÜÏúºÎ©∞, ÏãúÏû• Ï†ÑÏ≤¥Ïùò Ìä∏Î†åÎìúÎ•º Î∞òÏòÅÌïòÎ†§Î©¥ Ï¢Ä Îçî ÎßéÏùÄ Labeling ÏûëÏóÖÏù¥ ÏöîÍµ¨Îê† Í≤ÉÏúºÎ°ú Î≥¥Ïù∏Îã§.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">SELECT</span>
		<span class="o">*</span>  
	<span class="k">FROM</span>
		<span class="n">lending</span><span class="p">.</span><span class="n">borrow</span>  
	<span class="k">ORDER</span> <span class="k">BY</span>
		<span class="n">block_time</span> <span class="k">DESC</span>  
	<span class="k">LIMIT</span> <span class="mi">5</span>
</code></pre></div></div>

<p><img src="/assets/2022-12-03-dune-analytics/lending.borrow.webp" alt="" /></p>

<p>Ïù¥ Ïô∏ÏóêÎèÑ ÏàòÎßéÏùÄ Spells ÌÖåÏù¥Î∏îÎì§Ïù¥ ÏûàÎã§. ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ DuneÏóêÏÑú Ï†úÍ≥µÌïòÎäî ÏïÑÎûò ÎßÅÌÅ¨Îì§ÏùÑ ÌôïÏù∏ÌïòÏó¨ Ïó¨Îü¨ Í∞ÅÎèÑÎ°ú Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÏ∂úÌïòÍ≥† Í∞ÄÍ≥µÌï¥Î≥º Ïàò ÏûàÏùÑ Í≤ÉÏù¥Îã§.</p>

<ul>
  <li><a href="https://dune.com/docs/spellbook/">Spellbook</a></li>
  <li><a href="https://dune.com/docs/spellbook/spellbook-model-docs/">Spellbook Model Docs</a></li>
</ul>

<h1 id="5-5Í∞úÏùò-ÏóîÏßÑ">5. 5Í∞úÏùò ÏóîÏßÑ</h1>

<h2 id="51-Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§-ÏóîÏßÑ">5.1. Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÏóîÏßÑ</h2>

<p>DuneÏóêÏÑú New Query Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ SQL ÏûëÏÑ±ÏùÑ ÌïòÎ†§Í≥† ÌïòÎ©¥ Îã§ÏùåÍ≥º Í∞ôÏùÄ ÏóîÏßÑ Î¶¨Ïä§Ìä∏Í∞Ä ÏûàÏùåÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÏùÑ Í≤ÉÏù¥Îã§.</p>

<p><img src="/assets/2022-12-03-dune-analytics/engine.webp" alt="" /></p>

<p>Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÏóîÏßÑÏùÄ Ïä§ÌÜ†Î¶¨ÏßÄ ÏóîÏßÑ(Storage Engine)ÏúºÎ°ú Î∂àÎ¶¨Í∏∞ÎèÑ ÌïòÎäîÎç∞, DBMSÍ∞Ä Îç∞Ïù¥ÌÑ∞Î•º CRUD (Create, Read, Update, and Delete) ÌïòÍ∏∞ ÏúÑÌï¥ ÏÇ¨Ïö©ÌïòÎäî Ïª¥Ìè¨ÎÑåÌä∏Î•º ÏùòÎØ∏ÌïúÎã§. Ìè¨Ìä∏ Î≤àÌò∏Î•º Îã¨Î¶¨ÌïòÏó¨ Íµ¨Î∂ÑÌïòÍ∏∞ ÌïòÍ≥† UIÎ°ú Íµ¨Î∂ÑÌïòÍ∏∞ÎèÑ ÌïòÎäîÎç∞, ÏïÑÎ¨¥Ìäº DuneÏùÑ ÌôúÏö©ÌïòÎäî Ïö∞Î¶¨ ÏûÖÏû•ÏóêÏÑú Ï§ëÏöîÌïú Ï†êÏùÄ Îã§ÏùåÍ≥º Í∞ôÎã§.</p>
<ul>
  <li>ÎèôÏùºÌïú ÏóîÏßÑ ÎÇ¥Ïùò ÌÖåÏù¥Î∏îÎÅºÎ¶¨Îäî JOINÏù¥ÎÇò UNIONÏùÑ Ìï† Ïàò ÏûàÎã§.</li>
  <li>ÏÑúÎ°ú Îã§Î•∏ ÏóîÏßÑ ÎÇ¥Ïóê Ï°¥Ïû¨ÌïòÎäî ÌÖåÏù¥Î∏îÎÅºÎ¶¨Îäî JOINÏù¥ÎÇò UNIONÏùÑ Ìï† Ïàò ÏóÜÎã§.</li>
</ul>

<h2 id="52-postgresql-vs-spark-sql">5.2. PostgreSQL vs Spark SQL</h2>

<p>ÏúÑ ÏóîÏßÑ 5Í∞ú Ï§ëÏóêÏÑú 1~4Îäî Row-oriented DB, 5Îäî Column-oriented DBÏù¥Îã§.</p>
<ol>
  <li>Ethereum: PostgreSQL (Row-oriented DB)</li>
  <li>Gnosis Chain: PostgreSQL (Row-oriented DB)</li>
  <li>Optimism (OVM 1.0): PostgreSQL (Row-oriented DB)</li>
  <li>Optimism (OVM 2.0): PostgreSQL (Row-oriented DB)</li>
  <li>Dune Engine v2: Spark SQL (Column-oriented DB)</li>
</ol>

<p>Í∑∏Î¶¨Í≥† DuneÏùÄ Ï†êÏßÑÏ†ÅÏúºÎ°ú Row-oriented DBÏóêÏÑú Column-orientedÎ°ú DBÎ°úÏùò Migration Î°úÎìúÎßµÏùÑ Í≥µÏãúÌñàÎã§. (Ï¶â, ÌòÑÏû¨ Dune Engine v2Î°ú Îç∞Ïù¥ÌÑ∞Î•º Ïù¥Í¥ÄÌïòÎäî ÏûëÏóÖÏùÑ Îã®Í≥ÑÏ†ÅÏúºÎ°ú ÏßÑÌñâ Ï§ëÏù¥Îã§. 2023ÎÖÑ 1Î∂ÑÍ∏∞ ÎÇ¥Î°ú 1~4 ÏóîÏßÑÏùÄ Î™®Îëê ÌèêÍ∏∞Îê† ÏòàÏ†ïÏù¥Îãà,  <a href="https://dune.com/docs/reference/v1-sunsetting/">Ïó¨Í∏∞</a>Î•º Ï∞∏Í≥†ÌïòÏó¨ ÏùºÏ†ï Í¥ÄÎ¶¨Î•º ÌïòÎèÑÎ°ù ÌïòÏûê.)</p>

<p>ÏßÄÎÇòÏπòÍ≤å Í∞úÎ∞úÏ†ÅÏù∏ ÎÇ¥Ïö©ÏùÄ Î≥∏ Í∏ÄÏóêÏÑú Îã§Î£®ÏßÄ ÏïäÍ≤†ÏßÄÎßå, Row-oriented DBÏôÄ Column-orinted DBÎäî ÏùºÎ∞òÏ†ÅÏúºÎ°ú Îã§ÏùåÍ≥º Í∞ôÏùÄ Í∞úÎÖêÏúºÎ°ú Ïù¥Ìï¥ÌïòÎ©¥ ÎêúÎã§.</p>

<p><img src="/assets/2022-12-03-dune-analytics/facebook.webp" alt="" /></p>
<blockquote>
  <p><a href="https://dataschool.com/data-modeling-101/row-vs-column-oriented-databases">Row- vs. Column-oriented-databases</a></p>
</blockquote>

<ul>
  <li>Row-oriented DBÍ∞Ä ÏúÑ ÌÖåÏù¥Î∏îÏùÑ ÎîîÏä§ÌÅ¨Ïóê Ï†ÄÏû•ÌïòÍ≥† ÏÉàÎ°úÏö¥ Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÍ∞Ä(append)ÌïòÎäî Î©îÏª§ÎãàÏ¶ò</li>
</ul>

<p><img src="/assets/2022-12-03-dune-analytics/raw-oriented-1.webp" alt="" />
<img src="/assets/2022-12-03-dune-analytics/raw-oriented-2.webp" alt="" /></p>

<ul>
  <li>Column-oriented DBÍ∞Ä ÏúÑ ÌÖåÏù¥Î∏îÏùÑ ÎîîÏä§ÌÅ¨Ïóê Ï†ÄÏû•ÌïòÍ≥† ÏÉàÎ°úÏö¥ Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÍ∞Ä(append)ÌïòÎäî Î©îÏª§ÎãàÏ¶ò</li>
</ul>

<p><img src="/assets/2022-12-03-dune-analytics/col-oriented-1.webp" alt="" />
<img src="/assets/2022-12-03-dune-analytics/col-oriented-2.webp" alt="" /></p>

<p>Row-oriented DBÏùò Ïû•Ï†ê</p>
<ul>
  <li>Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÍ∞Ä(append)Ìï† Îïå, Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Ïùò Index Í≥†Î†§ ÏóÜÏù¥ Îã®ÏàúÌûà Ï†úÏùº ÎßàÏßÄÎßâÏóê Î∂ôÏó¨ÎÑ£Í∏∞Îßå ÌïòÎ©¥ ÎêòÎØÄÎ°ú Ïó∞ÏÇ∞ ÏöîÍµ¨ÎüâÏù¥ Ï†ÅÎã§.</li>
</ul>

<p>Row-oriented DBÏùò Îã®Ï†ê</p>
<ul>
  <li>ÌäπÏ†ï ÏπºÎüºÏùò Í∞íÏùÑ Ï°∞ÌöåÌï† Îïå Î©îÎ™®Î¶¨ ÏÇ¨Ïö©ÎüâÏù¥ ÎßéÎã§. Í∞ÄÎ†π, ÏúÑ ÏÇ¨Î°ÄÏóêÏÑú Î™®Îì† ÏÇ¨ÎûåÎì§Ïùò Age ÌèâÍ∑†Í∞íÏùÑ Íµ¨ÌïòÎ†§Í≥† ÌïúÎã§Î©¥, Í∞Å InstanceÏùò AgeÎ•º MemoryÏóê Ï†ÄÏû•ÌïòÏó¨ AVERAGE MethodÎ•º ÏÇ¨Ïö©Ìï¥Ïïº ÌïúÎã§.</li>
</ul>

<p>Column-oriented DBÏùò Ïû•Ï†ê</p>
<ul>
  <li>ÌäπÏ†ï ÏπºÎüºÏùò Í∞íÏùÑ Ï°∞ÌöåÌï† Îïå Î©îÎ™®Î¶¨ ÏÇ¨Ïö©ÎüâÏù¥ Ï†ÅÎã§. Í∞ÄÎ†π, ÏúÑ ÏÇ¨Î°ÄÏóêÏÑú Age ÌèâÍ∑†Í∞íÏùÑ Íµ¨ÌïòÎ†§Í≥† ÌïúÎã§Î©¥, Age Í∞íÎì§Ïù¥ ÌïòÎÇòÏùò Instance ÏïàÏóê Ï°¥Ïû¨ÌïòÎØÄÎ°ú Í≥ßÎ∞îÎ°ú AVERAGE MethodÎ•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎã§.</li>
</ul>

<p>Column-oriented DBÏùò Îã®Ï†ê</p>
<ul>
  <li>Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÍ∞Ä(append)Ìï† Îïå, Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Ïùò IndexÎ•º Í≥†Î†§Ìïú ÌõÑ Í∞Å InstanceÎßàÎã§ ÏùºÏùºÏù¥ Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÍ∞ÄÌï¥Ïïº ÌïúÎã§. Îî∞ÎùºÏÑú Ïó∞ÏÇ∞ ÏöîÍµ¨ÎüâÏù¥ ÎßéÎã§.</li>
</ul>

<p>Ï§ëÏöîÌïú Ï†êÏùÄ, Column-oriented DBÏùò Îã®Ï†êÏù¥ Îç∞Ïù¥ÌÑ∞Î•º Ï°∞ÌöåÌïòÍ≥†Ïûê ÌïòÎäî ÏµúÏ¢Ö ÏÇ¨Ïö©ÏûêÏù∏ Ïö∞Î¶¨ÏóêÍ≤åÎäî Ìï¥ÎãπÌïòÏßÄ ÏïäÎäîÎã§Îäî Ï†êÏù¥Îã§. Ïù¥Îäî DuneÏù¥ ÎÖ∏ÎìúÎ°úÎ∂ÄÌÑ∞ Îç∞Ïù¥ÌÑ∞Î•º Ï†ÅÏû¨ÌïòÎäî ÏãúÍ∞ÑÍ≥º ÎπÑÏö©ÏùÑ ÎçîÏö± ÎäòÎ¶¨Îäî ÎåÄÏã†, ÏµúÏ¢Ö ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏÜçÎèÑÍ∞Ä ÎçîÏö± Í∞úÏÑ†Îêú ÌÄ¥Î¶¨ ÌôòÍ≤Ω UXÎ•º Ï†úÍ≥µÌïòÍ≥†Ïûê ÌïòÎäî ÏùòÏßÄÎ°ú ÌëúÌòÑÎêúÎã§.</p>

<p><img src="/assets/2022-12-03-dune-analytics/row-store-col-store.webp" alt="" /></p>
<blockquote>
  <p><a href="[https://www.heavy.ai/technical-glossary/columnar-database](https://www.heavy.ai/technical-glossary/columnar-database)">Columnar Databases</a></p>
</blockquote>

<h1 id="6-case-study">6. Case Study</h1>

<p>ÌïÑÏûêÎäî ÏµúÍ∑º DeFi Î∞è NFT ÏãúÏû• Ìä∏Î†åÎìúÎ•º ÌåîÎ°úÏö∞ÏóÖÌïòÍ≥†Ïûê Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÏ∂úÌïòÏó¨ Í∞ÑÎã®Ìïú Ï∞®Ìä∏Î•º ÎßåÎì§Ïñ¥Î¥§Îã§. Îß§Ïö∞ Í∏∞Ï¥àÏ†ÅÏù∏ Ï∞®Ìä∏Ïù¥ÎØÄÎ°ú, ÎèÖÏûê Î∂ÑÎì§Ïù¥ ÎçîÏö± Î©ãÏßÑ Ï∞®Ìä∏Î°ú Í∞ÄÍ≥µÌï¥Î≥¥ÏãúÍ∏∏ Î∞îÎûÄÎã§.</p>

<h2 id="61-ethereum-nft-project-wau-weekly-active-users">6.1. Ethereum NFT Project WAU (Weekly Active Users)</h2>

<p>NFT Project Î≥ÑÎ°ú Ïù∏Í∏∞ÎèÑÎ•º ÌôïÏù∏ÌïòÍ∏∞ ÏúÑÌï¥ÏÑúÎäî Ïã§Ï†ú Í±∞ÎûòÎåÄÍ∏à, ÌôúÏÑ± ÏÇ¨Ïö©Ïûê Ïàò Îì± Îã§ÏñëÌïú Ï∏°Î©¥ÏùÑ Í≥†Î†§ÌïòÏó¨ Ìä∏Î†åÎìúÎ•º ÌôïÏù∏Ìï¥Ïïº Ìï† Í≤ÉÏù¥Îã§. Ïù¥ Ï∞®Ìä∏ÏóêÏÑúÎäî Í∞Å NFT Project Í±∞ÎûòÏóê Ï∞∏Ïó¨Ìïú Account Address ÏàòÏùò Market Share(%)Î•º Ï£º Îã®ÏúÑÎ°ú ÌëúÌòÑÌï¥Î≥¥ÏïòÎã§.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">WITH</span> <span class="n">CTE_raw</span> <span class="k">AS</span> <span class="p">(</span>  
	    <span class="k">SELECT</span>  
	        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'WEEK'</span><span class="p">,</span> <span class="n">block_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">yyyymmdd</span><span class="p">,</span>  
	        <span class="n">project</span><span class="p">,</span>  
	        <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">sellerbuyer</span><span class="p">)</span> <span class="k">AS</span> <span class="n">wau</span>  
	    <span class="k">FROM</span> <span class="p">(</span>  
	        <span class="k">SELECT</span>  
	            <span class="n">block_time</span><span class="p">,</span>  
	            <span class="n">nft_project_name</span> <span class="k">AS</span> <span class="n">project</span><span class="p">,</span> <span class="n">seller</span> <span class="k">as</span> <span class="n">sellerbuyer</span>  
	        <span class="k">FROM</span>  
	            <span class="n">nft</span><span class="p">.</span><span class="n">trades</span>  
	        <span class="k">WHERE</span>  
	            <span class="n">block_time</span> <span class="o">&gt;=</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">-</span> <span class="s1">'1 YEAR'</span><span class="p">::</span><span class="n">INTERVAL</span>  
	            <span class="k">AND</span> <span class="n">nft_project_name</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	            <span class="k">AND</span> <span class="n">usd_amount</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	            <span class="k">AND</span> <span class="n">seller</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	            <span class="k">AND</span> <span class="n">buyer</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	            <span class="k">AND</span> <span class="n">seller</span> <span class="o">!=</span> <span class="n">buyer</span>  
	        <span class="k">UNION</span> <span class="k">ALL</span>  
	        <span class="k">SELECT</span>  
	            <span class="n">block_time</span><span class="p">,</span>  
	            <span class="n">nft_project_name</span> <span class="k">AS</span> <span class="n">project</span><span class="p">,</span> <span class="n">buyer</span> <span class="k">as</span> <span class="n">sellerbuyer</span>  
	        <span class="k">FROM</span>  
	            <span class="n">nft</span><span class="p">.</span><span class="n">trades</span>  
	        <span class="k">WHERE</span>  
	            <span class="n">block_time</span> <span class="o">&gt;=</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">-</span> <span class="s1">'1 YEAR'</span><span class="p">::</span><span class="n">INTERVAL</span>  
	            <span class="k">AND</span> <span class="n">nft_project_name</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	            <span class="k">AND</span> <span class="n">usd_amount</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	            <span class="k">AND</span> <span class="n">seller</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	            <span class="k">AND</span> <span class="n">buyer</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	            <span class="k">AND</span> <span class="n">seller</span> <span class="o">!=</span> <span class="n">buyer</span>  
	        <span class="p">)</span> <span class="n">SUB</span>  
	    <span class="k">GROUP</span> <span class="k">BY</span>  
	        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'WEEK'</span><span class="p">,</span> <span class="n">block_time</span><span class="p">),</span>  
	        <span class="n">project</span>  
	<span class="p">),</span>  
	<span class="n">CTE_top_projects</span> <span class="k">AS</span> <span class="p">(</span>  
	    <span class="k">SELECT</span>  
	        <span class="n">project</span><span class="p">,</span>  
	        <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">sellerbuyer</span><span class="p">)</span> <span class="k">AS</span> <span class="n">active_users</span>  
	    <span class="k">FROM</span> <span class="p">(</span>  
	        <span class="k">SELECT</span>  
	            <span class="n">nft_project_name</span> <span class="k">AS</span> <span class="n">project</span><span class="p">,</span> <span class="n">seller</span> <span class="k">AS</span> <span class="n">sellerbuyer</span>  
	        <span class="k">FROM</span>  
	            <span class="n">nft</span><span class="p">.</span><span class="n">trades</span>  
	        <span class="k">WHERE</span>  
	            <span class="n">block_time</span> <span class="o">&gt;=</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">-</span> <span class="s1">'1 YEAR'</span><span class="p">::</span><span class="n">INTERVAL</span>  
	            <span class="k">AND</span> <span class="n">nft_project_name</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	            <span class="k">AND</span> <span class="n">usd_amount</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	            <span class="k">AND</span> <span class="n">seller</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	            <span class="k">AND</span> <span class="n">buyer</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	            <span class="k">AND</span> <span class="n">seller</span> <span class="o">!=</span> <span class="n">buyer</span>  
	        <span class="k">UNION</span> <span class="k">ALL</span>  
	        <span class="k">SELECT</span>  
	            <span class="n">nft_project_name</span> <span class="k">AS</span> <span class="n">project</span><span class="p">,</span> <span class="n">seller</span> <span class="k">AS</span> <span class="n">sellerbuyer</span>  
	        <span class="k">FROM</span>  
	            <span class="n">nft</span><span class="p">.</span><span class="n">trades</span>  
	        <span class="k">WHERE</span>  
	            <span class="n">block_time</span> <span class="o">&gt;=</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">-</span> <span class="s1">'1 YEAR'</span><span class="p">::</span><span class="n">INTERVAL</span>  
	            <span class="k">AND</span> <span class="n">nft_project_name</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	            <span class="k">AND</span> <span class="n">usd_amount</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	            <span class="k">AND</span> <span class="n">seller</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	            <span class="k">AND</span> <span class="n">buyer</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	            <span class="k">AND</span> <span class="n">seller</span> <span class="o">!=</span> <span class="n">buyer</span>  
	        <span class="p">)</span> <span class="n">SUB</span>  
	    <span class="k">GROUP</span> <span class="k">BY</span>  
	        <span class="n">project</span>  
	    <span class="k">ORDER</span> <span class="k">BY</span>  
	        <span class="n">active_users</span> <span class="k">DESC</span>  
	    <span class="k">LIMIT</span>  
	        <span class="mi">50</span>  
	<span class="p">),</span>  
	<span class="n">CTE_final</span> <span class="k">AS</span> <span class="p">(</span>  
	    <span class="k">SELECT</span>  
	        <span class="n">yyyymmdd</span><span class="p">,</span>  
	        <span class="k">CASE</span>  
	            <span class="k">WHEN</span> <span class="n">project</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">project</span> <span class="k">FROM</span> <span class="n">CTE_top_projects</span><span class="p">)</span> <span class="k">THEN</span> <span class="n">project</span>  
	            <span class="k">ELSE</span> <span class="s1">'Others'</span>  
	        <span class="k">END</span> <span class="k">AS</span> <span class="n">project</span><span class="p">,</span>  
	        <span class="k">SUM</span><span class="p">(</span><span class="n">wau</span><span class="p">)</span> <span class="k">AS</span> <span class="n">wau</span>  
	    <span class="k">FROM</span>  
	        <span class="n">CTE_raw</span>  
	    <span class="k">GROUP</span> <span class="k">BY</span>  
	        <span class="n">yyyymmdd</span><span class="p">,</span>  
	        <span class="k">CASE</span>  
	            <span class="k">WHEN</span> <span class="n">project</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">project</span> <span class="k">FROM</span> <span class="n">CTE_top_projects</span><span class="p">)</span> <span class="k">THEN</span> <span class="n">project</span>  
	            <span class="k">ELSE</span> <span class="s1">'Others'</span>  
	        <span class="k">END</span>  
	    <span class="k">ORDER</span> <span class="k">BY</span>  
	        <span class="n">yyyymmdd</span> <span class="k">DESC</span><span class="p">,</span>  
	        <span class="n">wau</span> <span class="k">DESC</span>  
	<span class="p">)</span>  
	<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">CTE_final</span><span class="p">;</span>
</code></pre></div></div>

<p><img src="/assets/2022-12-03-dune-analytics/Ethereum NFT Project WAU (Weekly Active Users).webp" alt="" /></p>

<h2 id="62-ethereum-dex-tx-volume-token-wise">6.2. Ethereum DEX TX Volume (Token-wise)</h2>

<p>Í∞Å DEX ÎÇ¥ÏóêÏÑú Î∞úÏÉùÌïú Í±∞ÎûòÎì§ÏùÑ ÌÜ†ÌÅ∞ Î≥ÑÎ°ú Í∑úÎ™®Î•º ÌôïÏù∏ÌïòÎäî Í≤É Ïó≠Ïãú, ÏãúÏû• Ìä∏Î†åÎìúÎ•º ÌååÏïÖÌïòÍ∏∞ ÏúÑÌï¥ Îß§Ïö∞ Ï§ëÏöîÌïú Îç∞Ïù¥ÌÑ∞Í∞Ä Îê† Í≤ÉÏù¥Îã§. Ïñ¥Îñ§ ÌÜ†ÌÅ∞Îì§Ïù¥ ShortÎêòÍ±∞ÎÇò LongÎêòÎäîÏßÄÎ•º Ïã§ÏãúÍ∞ÑÏúºÎ°ú Ï°∞ÌöåÌï®ÏúºÎ°úÏç® ÌÜ†ÌÅ∞Ïùò ÏãúÏû• Í∞ÄÍ≤©Ïù¥ÎÇò NeedsÏóê ÎßûÎäî Ïï°ÏÖòÏùÑ Ï∑®Ìï† Ïàò ÏûàÏßÄ ÏïäÏùÑÍπå.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">WITH</span> <span class="n">CTE_raw</span> <span class="k">AS</span> <span class="p">(</span>  
	    <span class="k">SELECT</span>  
	        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'WEEK'</span><span class="p">,</span> <span class="n">block_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">yyyymmdd</span><span class="p">,</span>  
	        <span class="n">token_a_symbol</span> <span class="k">AS</span> <span class="n">from_token</span><span class="p">,</span>  
	        <span class="k">SUM</span><span class="p">(</span><span class="n">usd_amount</span><span class="p">)</span> <span class="k">AS</span> <span class="n">tx_volume</span>  
	    <span class="k">FROM</span>  
	        <span class="n">dex</span><span class="p">.</span><span class="n">trades</span>  
	    <span class="k">WHERE</span>  
	        <span class="n">block_time</span> <span class="o">&gt;=</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">-</span> <span class="s1">'1 YEAR'</span><span class="p">::</span><span class="n">INTERVAL</span>   
	        <span class="k">AND</span> <span class="n">category</span> <span class="o">=</span> <span class="s1">'DEX'</span>  
	        <span class="k">AND</span> <span class="n">project</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	        <span class="k">AND</span> <span class="n">token_a_symbol</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	        <span class="k">AND</span> <span class="n">tx_from</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	        <span class="k">AND</span> <span class="n">tx_hash</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	        <span class="k">AND</span> <span class="n">usd_amount</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>  
	    <span class="k">GROUP</span> <span class="k">BY</span>  
	        <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">'WEEK'</span><span class="p">,</span> <span class="n">block_time</span><span class="p">),</span>  
	        <span class="n">token_a_symbol</span>  
	<span class="p">),</span>  
	<span class="n">CTE_top_from_tokens</span> <span class="k">AS</span> <span class="p">(</span>  
	    <span class="k">SELECT</span>  
	        <span class="n">from_token</span><span class="p">,</span>  
	        <span class="k">SUM</span><span class="p">(</span><span class="n">tx_volume</span><span class="p">)</span> <span class="k">AS</span> <span class="n">tx_volume</span>  
	    <span class="k">FROM</span>  
	        <span class="n">CTE_raw</span>  
	    <span class="k">GROUP</span> <span class="k">BY</span>  
	        <span class="n">from_token</span>  
	    <span class="k">ORDER</span> <span class="k">BY</span>  
	        <span class="n">tx_volume</span> <span class="k">DESC</span>  
	    <span class="k">LIMIT</span>  
	        <span class="mi">50</span>  
	<span class="p">),</span>  
	<span class="n">CTE_final</span> <span class="k">AS</span> <span class="p">(</span>  
	    <span class="k">SELECT</span>  
	        <span class="n">yyyymmdd</span><span class="p">,</span>  
	        <span class="k">CASE</span>  
	            <span class="k">WHEN</span> <span class="n">from_token</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">from_token</span> <span class="k">FROM</span> <span class="n">CTE_top_from_tokens</span><span class="p">)</span> <span class="k">THEN</span> <span class="n">from_token</span>  
	            <span class="k">ELSE</span> <span class="s1">'Others'</span>  
	        <span class="k">END</span> <span class="k">AS</span> <span class="n">from_token</span><span class="p">,</span>  
	        <span class="k">SUM</span><span class="p">(</span><span class="n">tx_volume</span><span class="p">)</span> <span class="k">AS</span> <span class="n">tx_volume</span>  
	    <span class="k">FROM</span>  
	        <span class="n">CTE_raw</span>  
	    <span class="k">GROUP</span> <span class="k">BY</span>  
	        <span class="n">yyyymmdd</span><span class="p">,</span>  
	        <span class="k">CASE</span>  
	            <span class="k">WHEN</span> <span class="n">from_token</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">from_token</span> <span class="k">FROM</span> <span class="n">CTE_top_from_tokens</span><span class="p">)</span> <span class="k">THEN</span> <span class="n">from_token</span>  
	            <span class="k">ELSE</span> <span class="s1">'Others'</span>  
	        <span class="k">END</span>  
	    <span class="k">ORDER</span> <span class="k">BY</span>  
	        <span class="n">yyyymmdd</span> <span class="k">DESC</span><span class="p">,</span>  
	        <span class="n">tx_volume</span> <span class="k">DESC</span>  
	<span class="p">)</span>  
	<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">CTE_final</span><span class="p">;</span>
</code></pre></div></div>

<p><img src="/assets/2022-12-03-dune-analytics/Ethereum DEX TX Volume (Token-wise).webp" alt="" /></p>

<h1 id="7-ÌåÅ-ÎåÄÎ∞©Ï∂ú">7. ÌåÅ ÎåÄÎ∞©Ï∂ú</h1>

<h2 id="71-cteÎ•º-Ï†ÅÍ∑πÏ†ÅÏúºÎ°ú-ÏÇ¨Ïö©ÌïòÏûê">7.1. CTEÎ•º Ï†ÅÍ∑πÏ†ÅÏúºÎ°ú ÏÇ¨Ïö©ÌïòÏûê.</h2>

<p>Ï°∞ÌöåÎ•º Ìï¥Î≥¥Î©¥ ÎäêÎÇÑ Ïàò ÏûàÎäîÎç∞ InstanceÍ∞Ä ÏóÑÏ≤≠ÎÇòÍ≤å ÎßéÏùÄ ÌÖåÏù¥Î∏îÏùò Í≤ΩÏö∞, ÏøºÎ¶¨ ÏÜçÎèÑÍ∞Ä Îß§Ïö∞(X100) ÎäêÎ¶¨Îã§. Ïù¥ ÎïåÎ¨∏Ïóê Î©òÌÉà ÏºÄÏñ¥Î•º ÏúÑÌï¥ Premium PlanÏùÑ Íµ¨ÎèÖÌïòÍ≥† Ïã∂ÏùÄ ÏöïÍµ¨Í∞Ä ÏÉòÏÜüÍ∏∞ÎèÑ ÌïúÎã§. Í∑∏Îü¨ÎÇò Free Plan ÏÉÅÏóêÏÑúÎèÑ ÏøºÎ¶¨ ÏÜçÎèÑÎ•º 10Î∞∞ Ïù¥ÏÉÅ ÎäòÎ¶¥ Ïàò ÏûàÎäî Î∞©Î≤ïÏù¥ ÏûàÎã§. Î∞îÎ°ú  CTE(Common Table Expression)Ïù¥Îã§.</p>

<p>DBÎ•º Í≥µÎ∂ÄÌï¥Î≥¥Ïã† Î∂ÑÎì§Ïù¥ÎùºÎ©¥ CTE Í∞úÎÖêÏùÄ ÎÑàÎ¨¥ÎÇòÎèÑ Í∏∞Ï¥àÏ†ÅÏù∏ ÎÇ¥Ïö©Ïù¥ÏßÄÎßå, Dune Ï≤òÎüº ÏøºÎ¶¨ ÏÜçÎèÑÍ∞Ä Ïã¨Í∞ÅÌïòÍ≤å ÎäêÎ¶∞ ÌôòÍ≤ΩÏùºÏàòÎ°ù CTEÎäî Îß§Ïö∞ Ï§ëÏöîÌïú Í∞ÄÏπòÎ•º ÏßÄÎãåÎã§. ÌïÑÏûêÍ∞Ä Í≤ΩÌóòÌï¥Î≥¥Îãà, 30Î∂Ñ Í±∏Î¶¨Îçò ÏøºÎ¶¨Ïóê CTEÎ•º ÌôúÏö©Ìï®ÏúºÎ°úÏç® 3Î∂ÑÏúºÎ°ú Îã®Ï∂ïÎêú Ï†ÅÎèÑ ÏûàÏóàÎã§.</p>

<p>CTEÎäî ÎπÑÎã® ÏøºÎ¶¨Î¨∏Ïùò Í∞ÄÎèÖÏÑ±ÏùÑ ÎÜíÏùº Îøê ÏïÑÎãàÎùº, Ïó¨Îü¨ Î≤à Ï∞∏Ï°∞Ìï¥Ïïº Ìï† ÌÖåÏù¥Î∏îÏùÑ ÎØ∏Î¶¨ Virtual TableÎ°ú Î©îÎ™®Î¶¨Ïóê ÏÉùÏÑ±Ìï¥Îëî ÌõÑ Re-read DB Í≥ºÏ†ï ÏóÜÏù¥ Î©îÎ™®Î¶¨ÎßåÏùÑ Ï∞∏Ï°∞Ìï† Ïàò ÏûàÏúºÎØÄÎ°ú ÏÑ±Îä•Í≥º ÏÜçÎèÑ Ïó≠Ïãú ÌÅ¨Í≤å Ìñ•ÏÉÅÎê† Ïàò ÏûàÎã§. Îã§Ïùå FrameworkÎ•º Ìï≠ÏÉÅ Î®∏Î¶¨ ÏÜçÏóê ÏÉàÍ≤®ÎÜìÎèÑÎ°ù ÌïòÏûê.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">WITH</span>  
	<span class="n">CTE_a</span> <span class="k">AS</span> <span class="p">(</span>  
		<span class="k">SELECT</span> <span class="o">*</span>  
		<span class="k">FROM</span> <span class="n">raw1</span>  
	<span class="p">),</span>  
	<span class="n">CTE_b</span> <span class="k">AS</span> <span class="p">(</span>  
		<span class="k">SELECT</span> <span class="o">*</span>  
		<span class="k">FROM</span> <span class="n">raw2</span>  
	<span class="p">)</span>  
	<span class="k">SELECT</span> <span class="o">*</span>  
	<span class="k">FROM</span> <span class="n">CTE_a</span>  
	<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">CTE_b</span>  
		<span class="k">USING</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>  
	<span class="k">WHERE</span> <span class="n">CTE_a</span><span class="p">.</span><span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">id</span> <span class="k">FROM</span> <span class="n">CTE_b</span><span class="p">)</span>  
	<span class="p">;</span>
</code></pre></div></div>

<h2 id="72--Ï£ºÏöî-ca-address-labelingÏùÑ-Ìï¥ÎëêÏûê">7.2.  Ï£ºÏöî CA Address LabelingÏùÑ Ìï¥ÎëêÏûê.</h2>

<p>Data Labeling ÏûëÏóÖÏùÄ ÎπÑÎã® Î®∏Ïã†Îü¨ÎãùÏùò ÏßÄÎèÑÌïôÏäµ(Supervised Learning)ÏóêÎßå ÏöîÍµ¨ÎêòÎäî ÏûëÏóÖÏù¥ ÏïÑÎãàÎã§. DeFiÎÇò NFT ÏÑπÌÑ∞ Î≥ÑÎ°ú Ï£ºÏöî ÌîÑÎ°úÏ†ùÌä∏Îì§ÏùÑ ÌåîÎ°úÏö∞ÏóÖ Ìï¥Ïïº ÌïúÎã§Î©¥ Í∞Å ÌîÑÎ°úÏ†ùÌä∏Îì§Ïù¥ Î∞∞Ìè¨Ìïú CA AddressÎ•º Íæ∏Ï§ÄÌûà Ï∞æÏïÑÏÑú Î≥ÑÎèÑ Îç∞Ïù¥ÌÑ∞ÏÖãÏúºÎ°ú Í¥ÄÎ¶¨ÌïòÍ≥†, Îòê ÏóÖÎç∞Ïù¥Ìä∏ Ïãú CAÍ∞Ä Î≥ÄÍ≤ΩÎê† Í≤ΩÏö∞ Ìï¥Îãπ Îç∞Ïù¥ÌÑ∞ÏÖã Ïó≠Ïãú Ï£ºÍ∏∞Ï†ÅÏúºÎ°ú Î≥ÄÍ≤ΩÌï¥Ï§òÏïº ÌïúÎã§.</p>

<p>Î¨ºÎ°†, <code class="language-plaintext highlighter-rouge">dex.trades</code> Í∞ôÏùÄ Spells ÌÖåÏù¥Î∏îÏùò Í≤ΩÏö∞ Ïª§ÎÆ§ÎãàÌã∞Í∞Ä Ìï®Íªò DEX Name LabelingÏùÑ ÌïòÏó¨ Ìé∏Î¶¨ÌïòÍ≤å ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ ÌòÑÌô©ÏùÑ ÌååÏïÖÌï† Ïàò ÏûàÏßÄÎßå, Îç∞Ïù¥ÌÑ∞ Ï†ïÌï©ÏÑ±ÏùÑ Í≤∞ÏΩî Î≥¥Ïû•Ìï† Ïàò ÏóÜÎã§. Îç∞Ïù¥ÌÑ∞ Ï†ïÌï©ÏÑ±ÏùÑ ÏúÑÌïú ÏµúÍ≥†Ïùò Î∞©Î≤ïÏùÄ Uniswap, Sushiswap, BAYC, CryptoPunk Îì± Î≥ÑÎ°ú Î∞∞Ìè¨Ìïú CA AddressÎ•º ÏßÅÏ†ë Ï∞æÏïÑ Ïù¥Î•º Raw TablesÎÇò Encoded TablesÏóêÏÑú Ï°∞ÌöåÌïòÎäî Í≤ÉÏù¥Îã§.</p>

<h2 id="73--spark-sql--Î¨∏Î≤ï-Í≥µÎ∂ÄÎ•º-ÌïòÏûê">7.3.  Spark SQL  Î¨∏Î≤ï Í≥µÎ∂ÄÎ•º ÌïòÏûê.</h2>

<p>ÏïûÏÑú Ïñ∏Í∏âÌñàÎìØÏù¥, 2023ÎÖÑ 1Î∂ÑÍ∏∞ Ï§ëÏúºÎ°ú PostgreSQL Í∏∞Î∞ò DB EngineÏùÄ Î™®Îëê ÏÇ¨ÎùºÏßÄÍ≥†, Spark SQL Í∏∞Î∞òÏù∏ Dune Engine v2Î°ú Í∞úÌé∏Îê† ÏòàÏ†ïÏù¥Îã§. Í∑∏Îü∞Îç∞, MySQL, Oracle, PostgreSQLÏóê ÎπÑÌï¥ Spark SQLÏùÄ Î¨∏Î≤ïÏù¥ ÏÉÅÎåÄÏ†ÅÏúºÎ°ú ÍπåÏπ†Ìïú(?) Ìé∏Ïù¥Îã§. ÎåÄÎ∂ÄÎ∂ÑÏùò Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞Ä Î∂ÑÎì§Ïù¥ Spark SQLÎ≥¥Îã§ Îã§Î•∏ SQLÏóê ÎçîÏö± ÏùµÏàôÌïòÏã§ Í≤ÉÏù¥Îã§. Îî∞ÎùºÏÑú Ïù¥Ïóê ÎåÄÌïú ÎåÄÎπÑÍ∞Ä ÌïÑÏöîÌïòÎã§.</p>

<p>Dune V1ÏóêÏÑúÎäî Î¨∏Î≤ï ÏöîÏÜåÍ∞Ä OptionalÌïú Í≤ÉÎì§Ïù¥ ÎßéÏïÑ Í∞úÏù∏Ïùò ÏøºÎ¶¨ ÏûëÏÑ± Ï∑®Ìñ•Ïóê Îî∞Îùº Ï∑®ÏÇ¨ÏÑ†ÌÉùÌï† Ïàò ÏûàÏñ¥ Î∂ÄÎã¥Ïù¥ Ï†ÅÏóàÎã§Î©¥, Dune V2ÏóêÏÑúÎäî ÏïÑÎûòÏôÄ Í∞ôÏù¥ RequirableÌïú Í≤ÉÎì§Ïù¥ ÎßéÏïÑÏßÄÎØÄÎ°ú Ïù¥Î•º Î∞òÎìúÏãú Ï†ïÎ¶¨Î•º ÌïòÍ≥† ÎÑòÏñ¥Í∞ÄÎäî Í≤ÉÏùÑ Ï∂îÏ≤úÌïúÎã§. ÏûêÏÑ∏Ìïú ÎπÑÍµêÌëúÎäî  <a href="https://dune.com/docs/reference/dune-v2/query-engine/#spark-sql-postgressql-operator-changes">Ïó¨Í∏∞</a>Î•º Ï∞∏Í≥†ÌïòÎ©¥ ÎêúÎã§.</p>

<table>
  <thead>
    <tr>
      <th><strong>Íµ¨Î∂Ñ</strong></th>
      <th><strong>PostgreSQL</strong></th>
      <th><strong>SparkSQL</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Index Base</td>
      <td><code class="language-plaintext highlighter-rouge">1</code></td>
      <td><code class="language-plaintext highlighter-rouge">0</code></td>
    </tr>
    <tr>
      <td>Column ÌÇ§ÏõåÎìú</td>
      <td><code class="language-plaintext highlighter-rouge">"block_time"</code></td>
      <td><code class="language-plaintext highlighter-rouge">block_time</code> (Back Tick)</td>
    </tr>
    <tr>
      <td>Alias Naming</td>
      <td><code class="language-plaintext highlighter-rouge">AS "dt"</code></td>
      <td><code class="language-plaintext highlighter-rouge">AS dt</code> (Back Tick</td>
    </tr>
    <tr>
      <td>Interval ÌëúÌòÑ</td>
      <td><code class="language-plaintext highlighter-rouge">INTERVAL '1day'</code></td>
      <td><code class="language-plaintext highlighter-rouge">INTERVAL '1 day'</code></td>
    </tr>
    <tr>
      <td>NULL Array Ï†ïÏùò</td>
      <td><code class="language-plaintext highlighter-rouge">NULL::integer[]</code></td>
      <td><code class="language-plaintext highlighter-rouge">CAST(NULL AS ARRAY&lt;int&gt;)</code></td>
    </tr>
  </tbody>
</table>

<h1 id="8-outro-lets-mingle-in">8. Outro: Let‚Äôs mingle in!</h1>

<p>Í∏ÄÏùÑ ÏùΩÏúºÎ©∞ Í≥µÍ∞ê ÎêòÏóàÍ≤†ÏßÄÎßå, DuneÏùÄ Ïª§ÎÆ§ÎãàÌã∞Î•º ÌôúÏö©ÌïòÎäî Í≤ÉÏù¥ ÍµâÏû•Ìûà Ï§ëÏöîÌïú Ïò®Ï≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞ ÌîåÎû´ÌèºÏù¥Îã§. Raw Tables, Decoded Tables Ïô∏Ïóê ÏàòÎßéÏùÄ ÌÖåÏù¥Î∏îÎì§ÏùÄ Ïª§ÎÆ§ÎãàÌã∞Ïóê ÏùòÌï¥ Ïú†ÏßÄÎ≥¥ÏàòÎêòÍ≥†, Îç∞Ïù¥ÌÑ∞ Ï†ïÌï©ÏÑ± Ïù¥ÏäàÎ•º Ïñ¥ÎñªÍ≤å Í∞úÏÑ†Ìï¥Í∞ÄÍ≥† ÏûàÎäîÏßÄ, Í∑∏Î¶¨Í≥† Ïñ¥Îñ§ ÏãùÏúºÎ°ú Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÏ∂úÌïòÍ≥† ÏûàÎäîÏßÄ Îì± Ïù¥ Î™®Îì† Í≤ÉÎì§ÏùÑ Ï†úÎåÄÎ°ú Í≥µÎ∂ÄÌïòÍ≥† Ïù¥Ìï¥Ìï¥Í∞ÄÍ∏∞ ÏúÑÌï¥ÏÑúÎäî Íæ∏Ï§ÄÌûà Ïª§ÎÆ§ÎãàÌã∞ ÎÇ¥ Dune WizardÎì§Í≥º ÍµêÎ•òÎ•º Ìï¥Ïïº ÌïúÎã§.</p>
<ul>
  <li><a href="https://dune.com/browse/dashboards/favorite">WizardÎì§Ïù¥ ÎßåÎì§Ïñ¥ÎÜìÏùÄ ÎåÄÏãúÎ≥¥ÎìúÎì§</a></li>
  <li><a href="https://dune.com/community">Dune Community</a></li>
</ul>

<p>Îî∞ÎùºÏÑú ÎèÖÏûê Î∂ÑÎì§Íªò Í∞êÌûà ÏÜêÏùÑ ÎÇ¥Î∞ÄÍ≥† Ïã∂Îã§. Ïö∞Î¶¨ Ìï®Íªò Ïò®Ï≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞Î•º Ïûò ÌôúÏö©ÌïòÍ∏∞ ÏúÑÌï¥ÏÑú Ìï®Íªò ÎßéÏùÄ Í≤ÉÎì§ÏùÑ Í≥µÏú†ÌïòÍ≥†, Îã§ÏñëÌïú ÌîºÎìúÎ∞±Îì§ÏùÑ Ï£ºÍ≥† Î∞õÏûêÍ≥†. Ïö∞Î¶¨Îäî Web 3.0 ÏãúÎåÄÏùò Îç∞Ïù¥ÌÑ∞ ÎßàÎ≤ïÏÇ¨, Dune WizardÏù¥ÎãàÍπå. Let‚Äôs web 3.0 the data analytics!</p>

<p><img src="/assets/2022-12-03-dune-analytics/dune-xmas.webp" alt="" /></p>

<hr />

<h2 id="published-by-joshua-kim"><em>Published by</em> Joshua Kim</h2>
<p><img src="/assets/profile/joshua-profile.png" alt="Joshua Kim" /></p>]]></content><author><name></name></author><category term="korean" /><category term="blockchain" /><category term="on_chain_data" /><category term="sql" /><summary type="html"><![CDATA[Ïù¥Î≤à ÏãúÍ∞ÑÏóêÎäî Ïò®Ï≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞ Ïï†ÎÑêÎ¶¨Ìã±Ïä§ ÌîåÎû´ÌèºÎì§ Ï§ë Í∞ÄÏû• Ìï´ÌïòÍ≥† Ïª§ÎÆ§ÎãàÌã∞Í∞Ä ÌÅ∞ Dune AnalyticsÏùò Íµ¨Ï°∞ÏôÄ ÏÇ¨Ïö© Î∞©Î≤ïÏóê ÎåÄÌï¥ ÏïåÏïÑÎ≥º Í≤ÉÏù¥Îã§. Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïù¥Ïñ∏Ïä§Î•º Í≥µÎ∂ÄÌïòÍ≥† Î∏îÎ°ùÏ≤¥Ïù∏ Í∏∞ÏóÖÏóêÏÑú ÏùºÌïòÎäî Î≥∏Ïù∏ÏóêÍ≤å Dune AnalyticsÎäî Í∞ÄÎßåÌûà Ï≥êÎã§Î≥¥Í∏∞Îßå Ìï¥ÎèÑ Îäò Ïã¨Ïû•Ïù¥ ÏøµÏæÖÍ±∞Î¶¨Î©∞ ÌÖêÏÖòÏù¥ ÏóÖÎêòÎäî Ïú†ÌÜ†ÌîºÏïÑ Í∞ôÏùÄ Í≥≥Ïù¥Îã§. ÌïòÏßÄÎßå ÏïàÌÉÄÍπùÍ≤åÎèÑ, Ïù¥ ÏÑ§Î†àÎäî ÎßàÏùåÏùÑ Ïù¥Ïñ¥ Î∞õÏïÑ Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞Î•º Ïù¥Ìï¥ÌïòÍ≥† ÏÇ¨Ïö© Î∞©Î≤ïÏùÑ ÏùµÌûàÍ∏∞ ÏúÑÌïú Î†àÌçºÎü∞Ïä§Í∞Ä ÏÉÅÎãπÌûà Î∂ÄÏ°±ÌïòÎã§Îäî Í≤ÉÏùÑ ÏïåÍ≤å ÎêòÏóàÎã§. Í∑∏Î¶¨ÌïòÏó¨ ÎÇò Ï≤òÎüº Îç∞Ïù¥ÌÑ∞Îßå Î≥¥Î©¥ ÎßàÏùåÏù¥ Î≤ÖÏ∞®Ïò§Î•¥Îäî Ïù¥ ÏãúÎåÄ Î™®Îì† Ïò®Ï≤¥Ïù∏ Îç∞Ïù¥ÌÑ∞ Îü¨Î≤ÑÎì§ÏóêÍ≤å Ïù¥ Í∏ÄÏùÑ Î∞îÏπòÍ≥†Ïûê ÌïúÎã§. Happy Duning!]]></summary></entry></feed>